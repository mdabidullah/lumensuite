{"version":3,"file":"options.js","sourceRoot":"","sources":["../../../src/attachment-block/components/options.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AttachmentBlockModel } from '@blocksuite/affine-model';\n\nimport {\n  CaptionIcon,\n  DownloadIcon,\n  EditIcon,\n  MoreVerticalIcon,\n  SmallArrowDownIcon,\n} from '@blocksuite/affine-components/icons';\nimport { createLitPortal } from '@blocksuite/affine-components/portal';\nimport {\n  cloneGroups,\n  renderGroups,\n  renderToolbarSeparator,\n} from '@blocksuite/affine-components/toolbar';\nimport { flip, offset } from '@floating-ui/dom';\nimport { html, nothing } from 'lit';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AttachmentBlockComponent } from '../attachment-block.js';\n\nimport { getMoreMenuConfig } from '../../root-block/configs/toolbar.js';\nimport { allowEmbed, convertToEmbed } from '../embed.js';\nimport { BUILT_IN_GROUPS } from './config.js';\nimport { AttachmentToolbarMoreMenuContext } from './context.js';\nimport { RenameModal } from './rename-model.js';\nimport { styles } from './styles.js';\n\nexport function AttachmentOptionsTemplate({\n  anchor,\n  model,\n  abortController,\n}: {\n  anchor: AttachmentBlockComponent;\n  model: AttachmentBlockModel;\n  abortController: AbortController;\n}) {\n  const disableEmbed = !allowEmbed(model, anchor.service.maxFileSize);\n  const readonly = model.doc.readonly;\n  const viewType = model.embed ? 'embed' : 'card';\n\n  const viewActions = [\n    {\n      type: 'card',\n      label: 'Card view',\n      disabled: readonly || !model.embed,\n      action: () => {\n        model.doc.updateBlock(model, { embed: false });\n        abortController.abort();\n      },\n    },\n    {\n      type: 'embed',\n      label: 'Embed view',\n      disabled: readonly || disableEmbed,\n      action: () => {\n        convertToEmbed(model, anchor.service.maxFileSize);\n        abortController.abort();\n      },\n    },\n  ];\n\n  const context = new AttachmentToolbarMoreMenuContext(anchor, abortController);\n  const groups = getMoreMenuConfig(anchor.std).configure(\n    cloneGroups(BUILT_IN_GROUPS)\n  );\n  const moreMenuActions = renderGroups(groups, context);\n\n  const buttons = [\n    // preview\n    // html`\n    //   <editor-icon-button aria-label=\"Preview\" .tooltip=${'Preview'}>\n    //     ${ViewIcon}\n    //   </editor-icon-button>\n    // `,\n\n    readonly\n      ? nothing\n      : html`\n          <editor-icon-button\n            aria-label=\"Rename\"\n            .tooltip=${'Rename'}\n            @click=${() => {\n              abortController.abort();\n              const renameAbortController = new AbortController();\n              createLitPortal({\n                template: RenameModal({\n                  editorHost: anchor.host,\n                  model,\n                  abortController: renameAbortController,\n                }),\n                computePosition: {\n                  referenceElement: anchor,\n                  placement: 'top-start',\n                  middleware: [flip(), offset(4)],\n                  // It has a overlay mask, so we don't need to update the position.\n                  // autoUpdate: true,\n                },\n                abortController: renameAbortController,\n              });\n            }}\n          >\n            ${EditIcon}\n          </editor-icon-button>\n        `,\n\n    html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Switch view\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n            .iconContainerWidth=${'110px'}\n          >\n            <div class=\"label\">\n              <span style=\"text-transform: capitalize\">${viewType}</span>\n              view\n            </div>\n            ${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"small\" data-orientation=\"vertical\">\n          ${repeat(\n            viewActions,\n            button => button.type,\n            ({ type, label, action }) => html`\n              <editor-menu-action\n                data-testid=${`link-to-${type}`}\n                ?data-selected=${type === viewType}\n                @click=${action}\n              >\n                ${label}\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `,\n\n    readonly\n      ? nothing\n      : html`\n          <editor-icon-button\n            aria-label=\"Download\"\n            .tooltip=${'Download'}\n            @click=${() => anchor.download()}\n          >\n            ${DownloadIcon}\n          </editor-icon-button>\n        `,\n\n    readonly\n      ? nothing\n      : html`\n          <editor-icon-button\n            aria-label=\"Caption\"\n            .tooltip=${'Caption'}\n            @click=${() => anchor.captionEditor?.show()}\n          >\n            ${CaptionIcon}\n          </editor-icon-button>\n        `,\n\n    html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button aria-label=\"More\" .tooltip=${'More'}>\n            ${MoreVerticalIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"large\" data-orientation=\"vertical\">\n          ${moreMenuActions}\n        </div>\n      </editor-menu-button>\n    `,\n  ];\n\n  return html`\n    <style>\n      ${styles}\n    </style>\n    <editor-toolbar class=\"affine-attachment-toolbar\">\n      ${join(\n        buttons.filter(button => button !== nothing),\n        renderToolbarSeparator\n      )}\n    </editor-toolbar>\n  `;\n}\n"]}