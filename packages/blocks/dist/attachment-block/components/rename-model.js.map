{"version":3,"file":"rename-model.js","sourceRoot":"","sources":["../../../src/attachment-block/components/rename-model.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,WAAW,EAAE,MAAM,qCAAqC,CAAC;AAClE,OAAO,EAAE,KAAK,EAAE,MAAM,qCAAqC,CAAC;AAC5D,OAAO,EAAE,IAAI,EAAE,MAAM,KAAK,CAAC;AAC3B,OAAO,EAAE,SAAS,EAAE,GAAG,EAAE,MAAM,uBAAuB,CAAC;AAEvD,OAAO,EAAE,YAAY,EAAE,MAAM,aAAa,CAAC;AAE3C,MAAM,CAAC,MAAM,WAAW,GAAG,CAAC,EAC1B,UAAU,EACV,KAAK,EACL,eAAe,GAKhB,EAAE,EAAE;IACH,MAAM,QAAQ,GAAG,SAAS,EAAoB,CAAC;IAC/C,iBAAiB;IACjB,UAAU,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;IAC1C,MAAM,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC;IAChC,MAAM,oBAAoB,GAAG,YAAY,CAAC,KAAK,CAC7C,CAAC,EACD,YAAY,CAAC,WAAW,CAAC,GAAG,CAAC,CAC9B,CAAC;IACF,MAAM,iBAAiB,GAAG,YAAY,CAAC,KAAK,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5E,MAAM,gBAAgB,GACpB,iBAAiB,CAAC,QAAQ,CAAC,GAAG,CAAC;QAC/B,iBAAiB,CAAC,MAAM,IAAI,CAAC;QAC7B,oBAAoB;QACpB,YAAY,CAAC,MAAM,GAAG,iBAAiB,CAAC,MAAM,CAAC;IAEjD,IAAI,QAAQ,GAAG,gBAAgB,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,YAAY,CAAC;IACtE,MAAM,SAAS,GAAG,gBAAgB,CAAC,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC,EAAE,CAAC;IAE5D,MAAM,SAAS,GAAG,GAAG,EAAE;QACrB,MAAM,WAAW,GAAG,QAAQ,GAAG,SAAS,CAAC;QACzC,IAAI,CAAC,WAAW,EAAE,CAAC;YACjB,KAAK,CAAC,UAAU,EAAE,2BAA2B,CAAC,CAAC;YAC/C,OAAO;QACT,CAAC;QACD,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,EAAE;YAC3B,IAAI,EAAE,WAAW;SAClB,CAAC,CAAC;QACH,eAAe,CAAC,KAAK,EAAE,CAAC;IAC1B,CAAC,CAAC;IACF,MAAM,OAAO,GAAG,CAAC,CAAa,EAAE,EAAE;QAChC,QAAQ,GAAI,CAAC,CAAC,MAA2B,CAAC,KAAK,CAAC;IAClD,CAAC,CAAC;IACF,MAAM,SAAS,GAAG,CAAC,CAAgB,EAAE,EAAE;QACrC,CAAC,CAAC,eAAe,EAAE,CAAC;QAEpB,IAAI,CAAC,CAAC,GAAG,KAAK,QAAQ,IAAI,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;YACzC,eAAe,CAAC,KAAK,EAAE,CAAC;YACxB,OAAO;QACT,CAAC;QACD,IAAI,CAAC,CAAC,GAAG,KAAK,OAAO,IAAI,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;YACxC,SAAS,EAAE,CAAC;YACZ,OAAO;QACT,CAAC;IACH,CAAC,CAAC;IAEF,OAAO,IAAI,CAAA;;QAEL,YAAY;;;;gBAIJ,GAAG,EAAE,CAAC,eAAe,CAAC,KAAK,EAAE;;;;;YAKjC,GAAG,CAAC,QAAQ,CAAC;;mBAEN,QAAQ;mBACR,OAAO;qBACL,SAAS;;2DAE6B,SAAS;;;;oBAIhD,MAAM;iBACT,SAAS;;UAEhB,WAAW;;;GAGlB,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import type { AttachmentBlockModel } from '@blocksuite/affine-model';\nimport type { EditorHost } from '@blocksuite/block-std';\n\nimport { ConfirmIcon } from '@blocksuite/affine-components/icons';\nimport { toast } from '@blocksuite/affine-components/toast';\nimport { html } from 'lit';\nimport { createRef, ref } from 'lit/directives/ref.js';\n\nimport { renameStyles } from './styles.js';\n\nexport const RenameModal = ({\n  editorHost,\n  model,\n  abortController,\n}: {\n  editorHost: EditorHost;\n  model: AttachmentBlockModel;\n  abortController: AbortController;\n}) => {\n  const inputRef = createRef<HTMLInputElement>();\n  // Fix auto focus\n  setTimeout(() => inputRef.value?.focus());\n  const originalName = model.name;\n  const nameWithoutExtension = originalName.slice(\n    0,\n    originalName.lastIndexOf('.')\n  );\n  const originalExtension = originalName.slice(originalName.lastIndexOf('.'));\n  const includeExtension =\n    originalExtension.includes('.') &&\n    originalExtension.length <= 7 &&\n    // including the dot\n    originalName.length > originalExtension.length;\n\n  let fileName = includeExtension ? nameWithoutExtension : originalName;\n  const extension = includeExtension ? originalExtension : '';\n\n  const onConfirm = () => {\n    const newFileName = fileName + extension;\n    if (!newFileName) {\n      toast(editorHost, 'File name cannot be empty');\n      return;\n    }\n    model.doc.updateBlock(model, {\n      name: newFileName,\n    });\n    abortController.abort();\n  };\n  const onInput = (e: InputEvent) => {\n    fileName = (e.target as HTMLInputElement).value;\n  };\n  const onKeydown = (e: KeyboardEvent) => {\n    e.stopPropagation();\n\n    if (e.key === 'Escape' && !e.isComposing) {\n      abortController.abort();\n      return;\n    }\n    if (e.key === 'Enter' && !e.isComposing) {\n      onConfirm();\n      return;\n    }\n  };\n\n  return html`\n    <style>\n      ${renameStyles}\n    </style>\n    <div\n      class=\"affine-attachment-rename-overlay-mask\"\n      @click=\"${() => abortController.abort()}\"\n    ></div>\n    <div class=\"affine-attachment-rename-container\">\n      <div class=\"affine-attachment-rename-input-wrapper\">\n        <input\n          ${ref(inputRef)}\n          type=\"text\"\n          .value=${fileName}\n          @input=${onInput}\n          @keydown=${onKeydown}\n        />\n        <span class=\"affine-attachment-rename-extension\">${extension}</span>\n      </div>\n      <editor-icon-button\n        class=\"affine-confirm-button\"\n        .iconSize=${'24px'}\n        @click=${onConfirm}\n      >\n        ${ConfirmIcon}\n      </editor-icon-button>\n    </div>\n  `;\n};\n"]}