{"version":3,"file":"context.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/element-toolbar/more-menu/context.ts"],"names":[],"mappings":"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","sourcesContent":["import type { SurfaceBlockComponent } from '@blocksuite/affine-block-surface';\nimport type { BlockModel } from '@blocksuite/store';\n\nimport { GfxPrimitiveElementModel } from '@blocksuite/block-std/gfx';\n\nimport type { EdgelessRootBlockComponent } from '../../../edgeless/edgeless-root-block.js';\nimport type { EdgelessRootService } from '../../../edgeless/edgeless-root-service.js';\nimport type { EdgelessSelectionManager } from '../../../edgeless/services/selection-manager.js';\n\nimport { MenuContext } from '../../../configs/toolbar.js';\nimport {\n  isAttachmentBlock,\n  isBookmarkBlock,\n  isEmbeddedLinkBlock,\n  isEmbedLinkedDocBlock,\n  isEmbedSyncedDocBlock,\n  isFrameBlock,\n  isImageBlock,\n  isNoteBlock,\n} from '../../../edgeless/utils/query.js';\n\nexport class ElementToolbarMoreMenuContext extends MenuContext {\n  #empty = true;\n\n  #includedFrame = false;\n\n  #multiple = false;\n\n  #single = false;\n\n  edgeless!: EdgelessRootBlockComponent;\n\n  get doc() {\n    return this.edgeless.doc;\n  }\n\n  get firstBlockComponent() {\n    return this.getBlockComponent(this.firstElement.id);\n  }\n\n  override get firstElement() {\n    return this.selection.firstElement;\n  }\n\n  get host() {\n    return this.edgeless.host;\n  }\n\n  get selectedBlockModels() {\n    const [result, { selectedModels }] = this.std.command\n      .chain()\n      .getSelectedModels()\n      .run();\n\n    if (!result) return [];\n\n    return selectedModels ?? [];\n  }\n\n  get selectedElements() {\n    return this.selection.selectedElements;\n  }\n\n  get selection(): EdgelessSelectionManager {\n    return this.service.selection;\n  }\n\n  get service(): EdgelessRootService {\n    return this.edgeless.service;\n  }\n\n  get std() {\n    return this.edgeless.host.std;\n  }\n\n  get surface(): SurfaceBlockComponent {\n    return this.edgeless.surface;\n  }\n\n  get view() {\n    return this.host.view;\n  }\n\n  constructor(edgeless: EdgelessRootBlockComponent) {\n    super();\n    this.edgeless = edgeless;\n\n    const selectedElements = this.selection.selectedElements;\n    const len = selectedElements.length;\n\n    this.#empty = len === 0;\n    this.#single = len === 1;\n    this.#multiple = !this.#empty && !this.#single;\n    this.#includedFrame = !this.#empty && selectedElements.some(isFrameBlock);\n  }\n\n  getBlockComponent(id: string) {\n    return this.view.getBlock(id);\n  }\n\n  getLinkedDocBlock() {\n    const valid =\n      this.#single &&\n      (isEmbedLinkedDocBlock(this.firstElement) ||\n        isEmbedSyncedDocBlock(this.firstElement));\n\n    if (!valid) return null;\n\n    return this.firstElement;\n  }\n\n  getNoteBlock() {\n    const valid = this.#single && isNoteBlock(this.firstElement);\n\n    if (!valid) return null;\n\n    return this.firstElement;\n  }\n\n  hasFrame() {\n    return this.#includedFrame;\n  }\n\n  override isElement() {\n    return (\n      this.#single && this.firstElement instanceof GfxPrimitiveElementModel\n    );\n  }\n\n  override isEmpty() {\n    return this.#empty;\n  }\n\n  isMultiple() {\n    return this.#multiple;\n  }\n\n  isSingle() {\n    return this.#single;\n  }\n\n  refreshable(model: BlockModel) {\n    return (\n      isImageBlock(model) ||\n      isBookmarkBlock(model) ||\n      isAttachmentBlock(model) ||\n      isEmbeddedLinkBlock(model)\n    );\n  }\n}\n"]}