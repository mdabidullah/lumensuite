{"version":3,"file":"change-attachment-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-attachment-button.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  CaptionIcon,\n  DownloadIcon,\n  PaletteIcon,\n} from '@blocksuite/affine-components/icons';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { assertExists, Bound } from '@blocksuite/global/utils';\nimport { html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { EmbedCardStyle } from '../../../_common/types.js';\nimport type {\n  AttachmentBlockComponent,\n  AttachmentBlockModel,\n  EdgelessRootBlockComponent,\n} from '../../../index.js';\n\nimport {\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '../../../_common/consts.js';\nimport { getEmbedCardIcons } from '../../../_common/utils/url.js';\nimport { downloadAttachmentBlob } from '../../../attachment-block/utils.js';\nimport '../../edgeless/components/panel/card-style-panel.js';\n\n@customElement('edgeless-change-attachment-button')\nexport class EdgelessChangeAttachmentButton extends WithDisposable(LitElement) {\n  private _download = () => {\n    if (!this._block) return;\n    downloadAttachmentBlob(this._block);\n  };\n\n  private _setCardStyle = (style: EmbedCardStyle) => {\n    const bounds = Bound.deserialize(this.model.xywh);\n    bounds.w = EMBED_CARD_WIDTH[style];\n    bounds.h = EMBED_CARD_HEIGHT[style];\n    const xywh = bounds.serialize();\n    this.model.doc.updateBlock(this.model, { style, xywh });\n  };\n\n  private _showCaption = () => {\n    this._block?.captionEditor?.show();\n  };\n\n  private get _block() {\n    const blockSelection =\n      this.edgeless.service.selection.surfaceSelections.filter(sel =>\n        sel.elements.includes(this.model.id)\n      );\n    if (blockSelection.length !== 1) {\n      return;\n    }\n\n    const block = this.std.view.getBlock(\n      blockSelection[0].blockId\n    ) as AttachmentBlockComponent | null;\n    assertExists(block);\n\n    return block;\n  }\n\n  private get _doc() {\n    return this.model.doc;\n  }\n\n  private get _getCardStyleOptions(): {\n    style: EmbedCardStyle;\n    Icon: TemplateResult<1>;\n    tooltip: string;\n  }[] {\n    const { EmbedCardListIcon, EmbedCardCubeIcon } = getEmbedCardIcons();\n    return [\n      {\n        style: 'horizontalThin',\n        Icon: EmbedCardListIcon,\n        tooltip: 'Horizontal style',\n      },\n      {\n        style: 'cubeThick',\n        Icon: EmbedCardCubeIcon,\n        tooltip: 'Vertical style',\n      },\n    ];\n  }\n\n  get std() {\n    return this.edgeless.std;\n  }\n\n  override render() {\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button aria-label=\"Card style\" .tooltip=${'Card style'}>\n            ${PaletteIcon}\n          </editor-icon-button>\n        `}\n      >\n        <card-style-panel\n          .value=${this.model.style}\n          .options=${this._getCardStyleOptions}\n          .onSelect=${this._setCardStyle}\n        >\n        </card-style-panel>\n      </editor-menu-button>\n\n      <editor-toolbar-separator></editor-toolbar-separator>\n\n      <editor-icon-button\n        aria-label=\"Download\"\n        .tooltip=${'Download'}\n        ?disabled=${this._doc.readonly}\n        @click=${this._download}\n      >\n        ${DownloadIcon}\n      </editor-icon-button>\n\n      <editor-toolbar-separator></editor-toolbar-separator>\n\n      <editor-icon-button\n        aria-label=\"Add caption\"\n        .tooltip=${'Add caption'}\n        class=\"change-attachment-button caption\"\n        ?disabled=${this._doc.readonly}\n        @click=${this._showCaption}\n      >\n        ${CaptionIcon}\n      </editor-icon-button>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor model!: AttachmentBlockModel;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-attachment-button': EdgelessChangeAttachmentButton;\n  }\n}\n\nexport function renderAttachmentButton(\n  edgeless: EdgelessRootBlockComponent,\n  attachments?: AttachmentBlockModel[]\n) {\n  if (attachments?.length !== 1) return nothing;\n\n  return html`\n    <edgeless-change-attachment-button\n      .model=${attachments[0]}\n      .edgeless=${edgeless}\n    ></edgeless-change-attachment-button>\n  `;\n}\n"]}