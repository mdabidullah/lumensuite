{"version":3,"file":"lang-button.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/code-language-list/components/lang-button.ts"],"names":[],"mappings":"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","sourcesContent":["import { ArrowDownIcon } from '@blocksuite/affine-components/icons';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/block-std';\nimport { noop } from '@blocksuite/global/utils';\nimport { css, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { CodeBlockComponent } from '../../../../code-block/code-block.js';\n\nimport {\n  type FilterableListItem,\n  type FilterableListOptions,\n  showPopFilterableList,\n} from '../../../../_common/components/filterable-list/index.js';\n\n@customElement('language-list-button')\nexport class LanguageListButton extends WithDisposable(\n  SignalWatcher(LitElement)\n) {\n  static override styles = css`\n    :host {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 1;\n    }\n\n    .lang-button {\n      background-color: var(--affine-background-primary-color);\n      box-shadow: var(--affine-shadow-1);\n      display: flex;\n      gap: 4px;\n      padding: 2px 4px;\n    }\n\n    .lang-button:hover {\n      background: var(--affine-hover-color-filled);\n    }\n\n    .lang-button[hover] {\n      background: var(--affine-hover-color-filled);\n    }\n  `;\n\n  private _abortController?: AbortController;\n\n  private _clickLangBtn = () => {\n    if (this.blockComponent.doc.readonly) return;\n    if (this._abortController) {\n      // Close the language list if it's already opened.\n      this._abortController.abort();\n      return;\n    }\n    this._abortController = new AbortController();\n    this._abortController.signal.addEventListener('abort', () => {\n      this.onActiveStatusChange(false);\n      this._abortController = undefined;\n    });\n    this.onActiveStatusChange(true);\n\n    const options: FilterableListOptions = {\n      placeholder: 'Search for a language',\n      onSelect: item => {\n        const sortedBundledLanguages = this._sortedBundledLanguages;\n        const index = sortedBundledLanguages.indexOf(item);\n        if (index !== -1) {\n          sortedBundledLanguages.splice(index, 1);\n          sortedBundledLanguages.unshift(item);\n        }\n        this.blockComponent.doc.transact(() => {\n          this.blockComponent.model.language$.value = item.name;\n        });\n      },\n      active: item => item.name === this.blockComponent.model.language,\n      items: this._sortedBundledLanguages,\n    };\n\n    showPopFilterableList({\n      options,\n      referenceElement: this._langButton,\n      container: this.blockComponent.host,\n      abortController: this._abortController,\n      // stacking-context(editor-host)\n      portalStyles: {\n        zIndex: 'var(--affine-z-index-popover)',\n      },\n    });\n  };\n\n  private _sortedBundledLanguages: FilterableListItem[] = [];\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    const langList = localStorage.getItem('blocksuite:code-block:lang-list');\n    if (langList) {\n      this._sortedBundledLanguages = JSON.parse(langList);\n    } else {\n      this._sortedBundledLanguages = this.blockComponent.service.langs.map(\n        lang => ({\n          label: lang.name,\n          name: lang.id,\n          aliases: lang.aliases,\n        })\n      );\n    }\n\n    this.disposables.add(() => {\n      localStorage.setItem(\n        'blocksuite:code-block:lang-list',\n        JSON.stringify(this._sortedBundledLanguages)\n      );\n    });\n  }\n\n  override render() {\n    return html`<icon-button\n      class=\"lang-button\"\n      data-testid=\"lang-button\"\n      width=\"auto\"\n      text=${this.blockComponent.languageName$.value}\n      height=\"24px\"\n      @click=${this._clickLangBtn}\n      ?disabled=${this.blockComponent.doc.readonly}\n    >\n      <span slot=\"suffix\">\n        ${!this.blockComponent.doc.readonly ? ArrowDownIcon : nothing}\n      </span>\n    </icon-button> `;\n  }\n\n  @query('.lang-button')\n  private accessor _langButton!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor blockComponent!: CodeBlockComponent;\n\n  @property({ attribute: false })\n  accessor onActiveStatusChange: (active: boolean) => void = noop;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'language-list-button': LanguageListButton;\n  }\n}\n"]}