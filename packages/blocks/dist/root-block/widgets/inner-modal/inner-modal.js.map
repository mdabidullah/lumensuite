{"version":3,"file":"inner-modal.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/inner-modal/inner-modal.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,uBAAuB,CAAC;AACxD,OAAO,EACL,UAAU,EACV,eAAe,EAGf,IAAI,GACL,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AAC9B,OAAO,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAElD,MAAM,CAAC,MAAM,yBAAyB,GAAG,2BAA2B,CAAC;IAGxD,sBAAsB;4BADlC,aAAa,CAAC,yBAAyB,CAAC;;;;sBACG,eAAe;sCAAvB,SAAQ,WAAe;;;;YAA3D,6KA6CC;;;YA7CY,uDAAsB;;QAGjC,IAAI,MAAM;YACR,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;gBACpB,OAAO,IAAI,CAAC,UAAU,EAAE,CAAC;YAC3B,CAAC;YACD,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAED,IAAI,CACF,KAAsB,EACtB,GAA6B;YAE7B,MAAM,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE;gBACjD,eAAe,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE;oBAClC,UAAU,EAAE;wBACV,IAAI,CAAC;4BACH,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE;gCACnB,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE;oCACzB,IAAI,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI;oCAC9B,GAAG,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI;oCAC7B,KAAK,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI;oCACnC,MAAM,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,MAAM,IAAI;iCACtC,CAAC,CAAC;4BACL,CAAC;yBACF,CAAC;qBACH;iBACF,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YAC1B,CAAC,CAAC,CAAC;YACH,MAAM,KAAK,GAAG,GAAG,EAAE;gBACjB,KAAK,CAAC,MAAM,EAAE,CAAC;gBACf,GAAG,CAAC,OAAO,EAAE,EAAE,CAAC;gBAChB,MAAM,EAAE,CAAC;YACX,CAAC,CAAC;YACF,OAAO,EAAE,KAAK,EAAE,CAAC;QACnB,CAAC;QAEQ,MAAM;YACb,OAAO,OAAO,CAAC;QACjB,CAAC;QAED,SAAS,CAAC,EAA0B;YAClC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACvB,CAAC;;;;SA5CU,sBAAsB","sourcesContent":["import { WidgetComponent } from '@lumensuite/block-std';\nimport {\n  autoUpdate,\n  computePosition,\n  type FloatingElement,\n  type ReferenceElement,\n  size,\n} from '@floating-ui/dom';\nimport { nothing } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nexport const AFFINE_INNER_MODAL_WIDGET = 'affine-inner-modal-widget';\n\n@customElement(AFFINE_INNER_MODAL_WIDGET)\nexport class AffineInnerModalWidget extends WidgetComponent {\n  private _getTarget?: () => ReferenceElement;\n\n  get target(): ReferenceElement {\n    if (this._getTarget) {\n      return this._getTarget();\n    }\n    return document.body;\n  }\n\n  open(\n    modal: FloatingElement,\n    ops: { onClose?: () => void }\n  ): { close(): void } {\n    const cancel = autoUpdate(this.target, modal, () => {\n      computePosition(this.target, modal, {\n        middleware: [\n          size({\n            apply: ({ rects }) => {\n              Object.assign(modal.style, {\n                left: `${rects.reference.x}px`,\n                top: `${rects.reference.y}px`,\n                width: `${rects.reference.width}px`,\n                height: `${rects.reference.height}px`,\n              });\n            },\n          }),\n        ],\n      }).catch(console.error);\n    });\n    const close = () => {\n      modal.remove();\n      ops.onClose?.();\n      cancel();\n    };\n    return { close };\n  }\n\n  override render() {\n    return nothing;\n  }\n\n  setTarget(fn: () => ReferenceElement) {\n    this._getTarget = fn;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_INNER_MODAL_WIDGET]: AffineInnerModalWidget;\n  }\n}\n"]}