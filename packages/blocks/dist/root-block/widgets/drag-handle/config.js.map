{"version":3,"file":"config.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/drag-handle/config.ts"],"names":[],"mappings":"AASA,MAAM,CAAC,MAAM,4BAA4B,GAAG,EAAE,CAAC;AAC/C,MAAM,CAAC,MAAM,2BAA2B,GAAG,EAAE,CAAC;AAC9C,MAAM,CAAC,MAAM,qCAAqC,GAAG,CAAC,CAAC;AACvD,MAAM,CAAC,MAAM,iCAAiC,GAAG,CAAC,CAAC;AACnD,MAAM,CAAC,MAAM,sCAAsC,GAAG,EAAE,CAAC;AACzD,MAAM,CAAC,MAAM,2CAA2C,GAAG,CAAC,CAAC;AAC7D,MAAM,CAAC,MAAM,6BAA6B,GAAG,CAAC,CAAC;AAE/C,MAAM,CAAC,MAAM,0BAA0B,GAAG,EAAE,CAAC;AAC7C,MAAM,CAAC,MAAM,yBAAyB,GAAG,CAAC,CAAC;AAC3C,MAAM,CAAC,MAAM,iCAAiC,GAAG,CAAC,CAAC;AACnD,MAAM,CAAC,MAAM,iCAAiC,GAAG,CAAC,CAAC;AACnD,MAAM,CAAC,MAAM,0BAA0B,GAAG,CAAC,CAAC;AAE5C,MAAM,CAAC,MAAM,iCAAiC,GAAG,CAAC,CAAC;AAEnD,MAAM,CAAC,MAAM,sBAAsB,GAAG,EAAE,CAAC;AACzC,MAAM,CAAC,MAAM,2BAA2B,GAAG,EAAE,CAAC;AAC9C,MAAM,CAAC,MAAM,uBAAuB,GAAG,CAAC,CAAC;AA0CzC,MAAM,OAAO,uBAAuB;IAApC;QACU,cAAS,GAAG,IAAI,GAAG,EAA4B,CAAC;IA6C1D,CAAC;IA3CC,IAAI,OAAO;QACT,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC;IAC3C,CAAC;IAEO,oBAAoB,CAAC,MAAwB;QACnD,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC9C,IAAI,KAAK,GAAG,CAAC,EAAE,CAAC;YACd,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;QACxC,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC;IACH,CAAC;IAEO,iCAAiC,CACvC,MAAwB;QAExB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAC3C,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,OAAO,KAAK,MAAM,CAAC,OAAO,CACpC,CAAC;IACJ,CAAC;IAED,SAAS,CAAC,OAAe;QACvB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YAChC,IAAI,OAAO,MAAM,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;gBACvC,OAAO,MAAM,CAAC,OAAO,KAAK,OAAO,CAAC;YACpC,CAAC;iBAAM,CAAC;gBACN,OAAO,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACtC,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,QAAQ,CAAC,MAAwB;QAC/B,MAAM,aAAa,GACjB,IAAI,CAAC,iCAAiC,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC;QAC3D,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;QAE7C,OAAO;YACL,OAAO,EAAE,GAAG,EAAE;gBACZ,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,CAAC;YAC3C,CAAC;SACF,CAAC;IACJ,CAAC;CACF","sourcesContent":["import type {\n  BlockComponent,\n  EditorHost,\n  PointerEventState,\n} from '@lumensuite/block-std';\nimport type { Disposable, Point, Rect } from '@lumensuite/global/utils';\n\nimport type { DragPreview } from './components/drag-preview.js';\n\nexport const DRAG_HANDLE_CONTAINER_HEIGHT = 24;\nexport const DRAG_HANDLE_CONTAINER_WIDTH = 16;\nexport const DRAG_HANDLE_CONTAINER_WIDTH_TOP_LEVEL = 8;\nexport const DRAG_HANDLE_CONTAINER_OFFSET_LEFT = 2;\nexport const DRAG_HANDLE_CONTAINER_OFFSET_LEFT_LIST = 18;\nexport const DRAG_HANDLE_CONTAINER_OFFSET_LEFT_TOP_LEVEL = 5;\nexport const DRAG_HANDLE_CONTAINER_PADDING = 8;\n\nexport const DRAG_HANDLE_GRABBER_HEIGHT = 12;\nexport const DRAG_HANDLE_GRABBER_WIDTH = 4;\nexport const DRAG_HANDLE_GRABBER_WIDTH_HOVERED = 2;\nexport const DRAG_HANDLE_GRABBER_BORDER_RADIUS = 4;\nexport const DRAG_HANDLE_GRABBER_MARGIN = 4;\n\nexport const HOVER_AREA_RECT_PADDING_TOP_LEVEL = 6;\n\nexport const NOTE_CONTAINER_PADDING = 24;\nexport const EDGELESS_NOTE_EXTRA_PADDING = 20;\nexport const DRAG_HOVER_RECT_PADDING = 4;\n\nexport type DropType = 'before' | 'after' | 'in';\nexport type DropResult = {\n  rect: Rect | null;\n  dropBlockId: string;\n  dropType: DropType;\n};\n\nexport type OnDragStartProps = {\n  state: PointerEventState;\n  startDragging: (\n    blocks: BlockComponent[],\n    state: PointerEventState,\n    dragPreview?: HTMLElement,\n    dragPreviewOffset?: Point\n  ) => void;\n  anchorBlockId: string | null;\n  editorHost: EditorHost;\n};\n\nexport type OnDragEndProps = {\n  state: PointerEventState;\n  draggingElements: BlockComponent[];\n  dropBlockId: string;\n  dropType: DropType | null;\n  dragPreview: DragPreview;\n  noteScale: number;\n  editorHost: EditorHost;\n};\n\nexport type DragHandleOption = {\n  flavour: string | RegExp;\n  edgeless?: boolean;\n  onDragStart?: (props: OnDragStartProps) => boolean;\n  onDragMove?: (\n    state: PointerEventState,\n    draggingElements?: BlockComponent[]\n  ) => boolean;\n  onDragEnd?: (props: OnDragEndProps) => boolean;\n};\n\nexport class DragHandleOptionsRunner {\n  private optionMap = new Map<DragHandleOption, number>();\n\n  get options(): DragHandleOption[] {\n    return Array.from(this.optionMap.keys());\n  }\n\n  private _decreaseOptionCount(option: DragHandleOption) {\n    const count = this.optionMap.get(option) || 0;\n    if (count > 1) {\n      this.optionMap.set(option, count - 1);\n    } else {\n      this.optionMap.delete(option);\n    }\n  }\n\n  private _getExistingOptionWithSameFlavour(\n    option: DragHandleOption\n  ): DragHandleOption | undefined {\n    return Array.from(this.optionMap.keys()).find(\n      op => op.flavour === option.flavour\n    );\n  }\n\n  getOption(flavour: string): DragHandleOption | undefined {\n    return this.options.find(option => {\n      if (typeof option.flavour === 'string') {\n        return option.flavour === flavour;\n      } else {\n        return option.flavour.test(flavour);\n      }\n    });\n  }\n\n  register(option: DragHandleOption): Disposable {\n    const currentOption =\n      this._getExistingOptionWithSameFlavour(option) || option;\n    const count = this.optionMap.get(currentOption) || 0;\n    this.optionMap.set(currentOption, count + 1);\n\n    return {\n      dispose: () => {\n        this._decreaseOptionCount(currentOption);\n      },\n    };\n  }\n}\n"]}