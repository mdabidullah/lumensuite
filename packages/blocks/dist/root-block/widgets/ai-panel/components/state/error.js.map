{"version":3,"file":"error.js","sourceRoot":"","sources":["../../../../../../src/root-block/widgets/ai-panel/components/state/error.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@lumensuite/block-std';\n\nimport { WithDisposable } from '@lumensuite/block-std';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, nothing, unsafeCSS } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\n\nimport type { AIPanelErrorConfig, CopyConfig } from '../../type.js';\n\nimport {\n  AIErrorType,\n  type AIItemGroupConfig,\n} from '../../../../../_common/components/index.js';\nimport { filterAIItemGroup } from '../../utils.js';\nimport '../finish-tip.js';\n\n@customElement('ai-panel-error')\nexport class AIPanelError extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      width: 100%;\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      padding: 0;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n    }\n\n    .error {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: flex-start;\n      align-self: stretch;\n      padding: 0px 12px;\n      gap: 4px;\n      .answer-tip {\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: flex-start;\n        gap: 4px;\n        align-self: stretch;\n        .answer-label {\n          align-self: stretch;\n          color: var(--affine-text-secondary-color);\n          /* light/xsMedium */\n          font-size: var(--affine-font-xs);\n          font-style: normal;\n          font-weight: 500;\n          line-height: 20px; /* 166.667% */\n        }\n      }\n      .error-info {\n        align-self: stretch;\n        color: var(--affine-error-color, #eb4335);\n        font-feature-settings:\n          'clig' off,\n          'liga' off;\n        /* light/sm */\n        font-size: var(--affine-font-sm);\n        font-style: normal;\n        font-weight: 400;\n        line-height: 22px; /* 157.143% */\n\n        a {\n          color: inherit;\n        }\n      }\n      .action-button-group {\n        display: flex;\n        width: 100%;\n        gap: 16px;\n        align-items: center;\n        justify-content: end;\n        margin-top: 4px;\n      }\n      .action-button {\n        display: flex;\n        box-sizing: border-box;\n        padding: 4px 12px;\n        justify-content: center;\n        align-items: center;\n        gap: 4px;\n        border-radius: 8px;\n        border: 1px solid var(--affine-border-color);\n        background: var(--affine-white);\n        color: var(--affine-text-primary-color);\n        /* light/xsMedium */\n        font-size: var(--affine-font-xs);\n        font-style: normal;\n        font-weight: 500;\n        line-height: 20px; /* 166.667% */\n      }\n      .action-button:hover {\n        cursor: pointer;\n      }\n      .action-button.primary {\n        border: 1px solid var(--affine-black-10);\n        background: var(--affine-primary-color);\n        color: var(--affine-pure-white);\n      }\n      .action-button > span {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 0 4px;\n      }\n      .action-button:not(.primary):hover {\n        background: var(--affine-hover-color);\n      }\n    }\n\n    ai-panel-divider {\n      margin-top: 4px;\n    }\n\n    .response-list-container {\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      padding: 0 8px;\n      user-select: none;\n    }\n\n    .response-list-container ai-item-list {\n      --item-padding: 4px;\n      --item-icon-color: var(--affine-icon-secondary);\n      --item-icon-hover-color: var(--affine-icon-color);\n    }\n  `;\n\n  private _getResponseGroup = () => {\n    let responseGroup: AIItemGroupConfig[] = [];\n    const errorType = this.config.error?.type;\n    if (errorType && errorType !== AIErrorType.GeneralNetworkError) {\n      return responseGroup;\n    }\n\n    responseGroup = filterAIItemGroup(this.host, this.config.responses);\n\n    return responseGroup;\n  };\n\n  override render() {\n    const responseGroup = this._getResponseGroup();\n    const errorTemplate = choose(\n      this.config.error?.type,\n      [\n        [\n          AIErrorType.Unauthorized,\n          () =>\n            html` <div class=\"error-info\">\n                You need to login to AFFiNE Cloud to continue using AFFiNE AI.\n              </div>\n              <div class=\"action-button-group\">\n                <div @click=${this.config.cancel} class=\"action-button\">\n                  <span>Cancel</span>\n                </div>\n                <div @click=${this.config.login} class=\"action-button primary\">\n                  <span>login</span>\n                </div>\n              </div>`,\n        ],\n        [\n          AIErrorType.PaymentRequired,\n          () =>\n            html` <div class=\"error-info\">\n                You've reached the current usage cap for AFFiNE AI. You can\n                subscribe to AFFiNE AI to continue the AI experience!\n              </div>\n              <div class=\"action-button-group\">\n                <div @click=${this.config.cancel} class=\"action-button\">\n                  <span>Cancel</span>\n                </div>\n                <div\n                  @click=${this.config.upgrade}\n                  class=\"action-button primary\"\n                >\n                  <span>Upgrade</span>\n                </div>\n              </div>`,\n        ],\n      ],\n      // default error handler\n      () => {\n        const tip = this.config.error?.message;\n        const error = tip\n          ? html`<a class=\"tip\" href=\"#\" data-tip=\"${tip}\"\n              >An error occurred</a\n            >`\n          : 'An error occurred';\n        return html`\n          <style>\n            .tip {\n              position: relative;\n              cursor: pointer;\n            }\n\n            .tip:hover::after {\n              content: attr(data-tip);\n              position: absolute;\n              left: 0;\n              top: 20px;\n              background-color: black;\n              white-space: nowrap;\n              color: white;\n              padding: 5px 10px;\n              border-radius: 5px;\n              z-index: 1000;\n              white-space: pre;\n            }\n          </style>\n          <div class=\"error-info\">\n            ${error}. Please try again later. If this issue persists, please let\n            us know at\n            <a href=\"mailto:support@toeverything.info\">\n              support@toeverything.info\n            </a>\n          </div>\n        `;\n      }\n    );\n\n    return html`\n      <div class=\"error\">\n        <div class=\"answer-tip\">\n          <div class=\"answer-label\">Answer</div>\n          <slot></slot>\n        </div>\n        ${errorTemplate}\n      </div>\n      ${this.withAnswer\n        ? html`<ai-finish-tip\n            .copy=${this.copy}\n            .host=${this.host}\n          ></ai-finish-tip>`\n        : nothing}\n      ${responseGroup.length > 0\n        ? html`\n            <ai-panel-divider></ai-panel-divider>\n            ${responseGroup.map(\n              (group, index) => html`\n                ${index !== 0\n                  ? html`<ai-panel-divider></ai-panel-divider>`\n                  : nothing}\n                <div class=\"response-list-container\">\n                  <ai-item-list\n                    .host=${this.host}\n                    .groups=${[group]}\n                  ></ai-item-list>\n                </div>\n              `\n            )}\n          `\n        : nothing}\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor config!: AIPanelErrorConfig;\n\n  @property({ attribute: false })\n  accessor copy: CopyConfig | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor withAnswer = false;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-panel-error': AIPanelError;\n  }\n}\n"]}