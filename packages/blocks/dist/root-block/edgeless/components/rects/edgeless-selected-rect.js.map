{"version":3,"file":"edgeless-selected-rect.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/rects/edgeless-selected-rect.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  Disposable,\n  IPoint,\n  IVec,\n  PointLocation,\n} from '@lumensuite/global/utils';\n\nimport {\n  CanvasElementType,\n  CommonUtils,\n  normalizeShapeBound,\n  TextUtils,\n} from '@lumensuite/affine-block-surface';\nimport {\n  type BookmarkBlockModel,\n  ConnectorElementModel,\n  type EdgelessTextBlockModel,\n  type EmbedHtmlModel,\n  type EmbedSyncedDocModel,\n  FrameBlockModel,\n  NoteBlockModel,\n  ShapeElementModel,\n  TextElementModel,\n} from '@lumensuite/affine-model';\nimport {\n  clamp,\n  requestThrottledConnectedFrame,\n  stopPropagation,\n} from '@lumensuite/affine-shared/utils';\nimport { WithDisposable } from '@lumensuite/block-std';\nimport {\n  assertType,\n  Bound,\n  deserializeXYWH,\n  pickValues,\n  Slot,\n} from '@lumensuite/global/utils';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessTextBlockComponent } from '../../../../edgeless-text-block/edgeless-text-block.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless-root-block.js';\n\nimport { EMBED_CARD_HEIGHT } from '../../../../_common/consts.js';\nimport { isMindmapNode } from '../../../../_common/edgeless/mindmap/index.js';\nimport { EDGELESS_TEXT_BLOCK_MIN_WIDTH } from '../../../../edgeless-text-block/edgeless-text-block.js';\nimport {\n  EMBED_HTML_MIN_HEIGHT,\n  EMBED_HTML_MIN_WIDTH,\n} from '../../../../embed-html-block/styles.js';\nimport {\n  SYNCED_MIN_HEIGHT,\n  SYNCED_MIN_WIDTH,\n} from '../../../../embed-synced-doc-block/styles.js';\nimport {\n  AI_CHAT_BLOCK_MAX_HEIGHT,\n  AI_CHAT_BLOCK_MAX_WIDTH,\n  AI_CHAT_BLOCK_MIN_HEIGHT,\n  AI_CHAT_BLOCK_MIN_WIDTH,\n  NOTE_MIN_HEIGHT,\n  NOTE_MIN_WIDTH,\n} from '../../utils/consts.js';\nimport { getElementsWithoutGroup } from '../../utils/group.js';\nimport {\n  getSelectableBounds,\n  getSelectedRect,\n  isAIChatBlock,\n  isAttachmentBlock,\n  isBookmarkBlock,\n  isCanvasElement,\n  isEdgelessTextBlock,\n  isEmbeddedBlock,\n  isEmbedFigmaBlock,\n  isEmbedGithubBlock,\n  isEmbedHtmlBlock,\n  isEmbedLinkedDocBlock,\n  isEmbedLoomBlock,\n  isEmbedSyncedDocBlock,\n  isEmbedYoutubeBlock,\n  isFrameBlock,\n  isImageBlock,\n  isNoteBlock,\n} from '../../utils/query.js';\nimport { getTopElements } from '../../utils/tree.js';\nimport '../auto-complete/edgeless-auto-complete.js';\nimport '../connector/connector-handle.js';\nimport { HandleDirection } from '../resize/resize-handles.js';\nimport { ResizeHandles, type ResizeMode } from '../resize/resize-handles.js';\nimport { HandleResizeManager } from '../resize/resize-manager.js';\nimport {\n  calcAngle,\n  calcAngleEdgeWithRotation,\n  calcAngleWithRotation,\n  generateCursorUrl,\n  getResizeLabel,\n  rotateResizeCursor,\n} from '../utils.js';\n\nexport type SelectedRect = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n  borderWidth: number;\n  borderStyle: string;\n  rotate: number;\n};\n\n@customElement('edgeless-selected-rect')\nexport class EdgelessSelectedRect extends WithDisposable(LitElement) {\n  // disable change-in-update warning\n  static override enabledWarnings = [];\n\n  static override styles = css`\n    :host {\n      display: block;\n      user-select: none;\n      contain: size layout;\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 1;\n    }\n\n    .affine-edgeless-selected-rect {\n      position: absolute;\n      top: 0;\n      left: 0;\n      transform-origin: center center;\n      border-radius: 0;\n      pointer-events: none;\n      box-sizing: border-box;\n      z-index: 1;\n      border-color: var(--affine-blue);\n      border-width: 2px;\n      border-style: solid;\n      transform: translate(0, 0) rotate(0);\n    }\n\n    .affine-edgeless-selected-rect .handle {\n      position: absolute;\n      user-select: none;\n      outline: none;\n      pointer-events: auto;\n\n      /**\n       * Fix: pointerEvent stops firing after a short time.\n       * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,\n       * up to the one that implements the gesture (in other words, the first containing scrolling element)\n       * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action\n       */\n      touch-action: none;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label^='top-'],\n    .affine-edgeless-selected-rect .handle[aria-label^='bottom-'] {\n      width: 18px;\n      height: 18px;\n      box-sizing: border-box;\n      z-index: 10;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label^='top-'] .resize,\n    .affine-edgeless-selected-rect .handle[aria-label^='bottom-'] .resize {\n      position: absolute;\n      width: 12px;\n      height: 12px;\n      box-sizing: border-box;\n      border-radius: 50%;\n      border: 2px var(--affine-blue) solid;\n      background: white;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label^='top-'] .rotate,\n    .affine-edgeless-selected-rect .handle[aria-label^='bottom-'] .rotate {\n      position: absolute;\n      width: 12px;\n      height: 12px;\n      box-sizing: border-box;\n      background: transparent;\n    }\n\n    /* -18 + 6.5 */\n    .affine-edgeless-selected-rect .handle[aria-label='top-left'] {\n      left: -12px;\n      top: -12px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='top-left'] .resize {\n      right: 0;\n      bottom: 0;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='top-left'] .rotate {\n      right: 6px;\n      bottom: 6px;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='top-right'] {\n      top: -12px;\n      right: -12px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='top-right'] .resize {\n      left: 0;\n      bottom: 0;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='top-right'] .rotate {\n      left: 6px;\n      bottom: 6px;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='bottom-right'] {\n      right: -12px;\n      bottom: -12px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='bottom-right'] .resize {\n      left: 0;\n      top: 0;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='bottom-right'] .rotate {\n      left: 6px;\n      top: 6px;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='bottom-left'] {\n      bottom: -12px;\n      left: -12px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='bottom-left'] .resize {\n      right: 0;\n      top: 0;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='bottom-left'] .rotate {\n      right: 6px;\n      top: 6px;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='top'],\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'],\n    .affine-edgeless-selected-rect .handle[aria-label='left'],\n    .affine-edgeless-selected-rect .handle[aria-label='right'] {\n      border: 0;\n      background: transparent;\n      border-color: var('--affine-blue');\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='left'],\n    .affine-edgeless-selected-rect .handle[aria-label='right'] {\n      top: 0;\n      bottom: 0;\n      height: 100%;\n      width: 6px;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='top'],\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'] {\n      left: 0;\n      right: 0;\n      width: 100%;\n      height: 6px;\n    }\n\n    /* calc(-1px - (6px - 1px) / 2) = -3.5px */\n    .affine-edgeless-selected-rect .handle[aria-label='left'] {\n      left: -3.5px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='right'] {\n      right: -3.5px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='top'] {\n      top: -3.5px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'] {\n      bottom: -3.5px;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize,\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize,\n    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize,\n    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize {\n      width: 100%;\n      height: 100%;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize:after,\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize:after,\n    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize:after,\n    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize:after {\n      position: absolute;\n      width: 7px;\n      height: 7px;\n      box-sizing: border-box;\n      border-radius: 6px;\n      z-index: 10;\n      content: '';\n      background: white;\n    }\n\n    .affine-edgeless-selected-rect\n      .handle[aria-label='top']\n      .transparent-handle:after,\n    .affine-edgeless-selected-rect\n      .handle[aria-label='bottom']\n      .transparent-handle:after,\n    .affine-edgeless-selected-rect\n      .handle[aria-label='left']\n      .transparent-handle:after,\n    .affine-edgeless-selected-rect\n      .handle[aria-label='right']\n      .transparent-handle:after {\n      opacity: 0;\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize:after,\n    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize:after {\n      top: calc(50% - 6px);\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize:after,\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize:after {\n      left: calc(50% - 6px);\n    }\n\n    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize:after {\n      left: -0.5px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize:after {\n      right: -0.5px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize:after {\n      top: -0.5px;\n    }\n    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize:after {\n      bottom: -0.5px;\n    }\n\n    .affine-edgeless-selected-rect .handle .resize::before {\n      content: '';\n      display: none;\n      position: absolute;\n      width: 20px;\n      height: 20px;\n      background-image: url(\"data:image/svg+xml,%3Csvg width='26' height='26' viewBox='0 0 26 26' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M23 3H19C10.1634 3 3 10.1634 3 19V23' stroke='black' stroke-opacity='0.3' stroke-width='5' stroke-linecap='round'/%3E%3C/svg%3E\");\n      background-size: contain;\n      background-repeat: no-repeat;\n    }\n    .affine-edgeless-selected-rect[data-mode='scale']\n      .handle[aria-label='top-left']\n      .resize:hover::before,\n    .affine-edgeless-selected-rect[data-scale-direction='top-left'][data-scale-percent]\n      .handle[aria-label='top-left']\n      .resize::before {\n      display: block;\n      top: 0px;\n      left: 0px;\n      transform: translate(-100%, -100%);\n    }\n    .affine-edgeless-selected-rect[data-mode='scale']\n      .handle[aria-label='top-right']\n      .resize:hover::before,\n    .affine-edgeless-selected-rect[data-scale-direction='top-right'][data-scale-percent]\n      .handle[aria-label='top-right']\n      .resize::before {\n      display: block;\n      top: 0px;\n      right: 0px;\n      transform: translate(100%, -100%) rotate(90deg);\n    }\n    .affine-edgeless-selected-rect[data-mode='scale']\n      .handle[aria-label='bottom-right']\n      .resize:hover::before,\n    .affine-edgeless-selected-rect[data-scale-direction='bottom-right'][data-scale-percent]\n      .handle[aria-label='bottom-right']\n      .resize::before {\n      display: block;\n      bottom: 0px;\n      right: 0px;\n      transform: translate(100%, 100%) rotate(180deg);\n    }\n    .affine-edgeless-selected-rect[data-mode='scale']\n      .handle[aria-label='bottom-left']\n      .resize:hover::before,\n    .affine-edgeless-selected-rect[data-scale-direction='bottom-left'][data-scale-percent]\n      .handle[aria-label='bottom-left']\n      .resize::before {\n      display: block;\n      bottom: 0px;\n      left: 0px;\n      transform: translate(-100%, 100%) rotate(-90deg);\n    }\n\n    .affine-edgeless-selected-rect::after {\n      content: attr(data-scale-percent);\n      display: none;\n      position: absolute;\n      color: var(--affine-icon-color);\n      font-feature-settings:\n        'clig' off,\n        'liga' off;\n      font-family: var(--affine-font-family);\n      font-size: 12px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 24px;\n    }\n    .affine-edgeless-selected-rect[data-scale-direction='top-left']::after {\n      display: block;\n      top: -20px;\n      left: -20px;\n      transform: translate(-100%, -100%);\n    }\n    .affine-edgeless-selected-rect[data-scale-direction='top-right']::after {\n      display: block;\n      top: -20px;\n      right: -20px;\n      transform: translate(100%, -100%);\n    }\n    .affine-edgeless-selected-rect[data-scale-direction='bottom-right']::after {\n      display: block;\n      bottom: -20px;\n      right: -20px;\n      transform: translate(100%, 100%);\n    }\n    .affine-edgeless-selected-rect[data-scale-direction='bottom-left']::after {\n      display: block;\n      bottom: -20px;\n      left: -20px;\n      transform: translate(-100%, 100%);\n    }\n  `;\n\n  private _cursorRotate = 0;\n\n  private _dragEndCallback: (() => void)[] = [];\n\n  private _initSelectedSlot = () => {\n    this._propDisposables.forEach(disposable => disposable.dispose());\n    this._propDisposables = [];\n\n    this.selection.selectedElements.forEach(element => {\n      if ('flavour' in element) {\n        this._propDisposables.push(\n          element.propsUpdated.on(() => {\n            this._updateOnElementChange(element.id);\n          })\n        );\n      }\n    });\n  };\n\n  private _onDragEnd = () => {\n    this.slots.dragEnd.emit();\n\n    this.doc.transact(() => {\n      this._dragEndCallback.forEach(cb => cb());\n    });\n\n    this._dragEndCallback = [];\n    this._isWidthLimit = false;\n    this._isHeightLimit = false;\n\n    this._updateCursor(false);\n\n    this._scalePercent = undefined;\n    this._scaleDirection = undefined;\n    this._updateMode();\n\n    this.edgeless.slots.elementResizeEnd.emit();\n\n    this.edgeless.service.frameOverlay.clear();\n  };\n\n  private _onDragMove = (\n    newBounds: Map<\n      string,\n      {\n        bound: Bound;\n        path?: PointLocation[];\n        matrix?: DOMMatrix;\n      }\n    >,\n    direction: HandleDirection\n  ) => {\n    this.slots.dragMove.emit();\n\n    const { edgeless } = this;\n\n    newBounds.forEach(({ bound, matrix, path }, id) => {\n      const element = edgeless.service.getElementById(id);\n      if (!element) return;\n\n      if (isNoteBlock(element)) {\n        this.#adjustNote(element, bound, direction);\n        return;\n      }\n\n      if (isEdgelessTextBlock(element)) {\n        this.#adjustEdgelessText(element, bound, direction);\n        return;\n      }\n\n      if (isEmbedSyncedDocBlock(element)) {\n        this.#adjustEmbedSyncedDoc(element, bound, direction);\n        return;\n      }\n\n      if (isEmbedHtmlBlock(element)) {\n        this.#adjustEmbedHtml(element, bound, direction);\n        return;\n      }\n\n      if (isAIChatBlock(element)) {\n        this.#adjustAIChat(element, bound, direction);\n        return;\n      }\n\n      if (this._isProportionalElement(element)) {\n        this.#adjustProportional(element, bound, direction);\n        return;\n      }\n\n      if (element instanceof TextElementModel) {\n        this.#adjustText(element, bound, direction);\n        return;\n      }\n\n      if (element instanceof ShapeElementModel) {\n        this.#adjustShape(element, bound, direction);\n        return;\n      }\n\n      if (element instanceof ConnectorElementModel && matrix && path) {\n        this.#adjustConnector(element, bound, matrix, path);\n        return;\n      }\n\n      if (element instanceof FrameBlockModel) {\n        this.#adjustFrame(element, bound);\n        return;\n      }\n\n      this.#adjustUseFallback(element, bound, direction);\n    });\n  };\n\n  private _onDragRotate = (center: IPoint, delta: number) => {\n    this.slots.dragRotate.emit();\n\n    const { selection } = this;\n    const m = new DOMMatrix()\n      .translateSelf(center.x, center.y)\n      .rotateSelf(delta)\n      .translateSelf(-center.x, -center.y);\n\n    const elements = selection.selectedElements.filter(\n      element =>\n        isImageBlock(element) ||\n        isEdgelessTextBlock(element) ||\n        isCanvasElement(element)\n    );\n\n    getElementsWithoutGroup(elements).forEach(element => {\n      const { id, rotate } = element;\n      const bounds = Bound.deserialize(element.xywh);\n      const originalCenter = bounds.center;\n      const point = new DOMPoint(...originalCenter).matrixTransform(m);\n      bounds.center = [point.x, point.y];\n\n      if (\n        isCanvasElement(element) &&\n        element instanceof ConnectorElementModel\n      ) {\n        this.#adjustConnector(\n          element,\n          bounds,\n          m,\n          element.absolutePath.map(p => p.clone())\n        );\n      } else {\n        this.edgeless.service.updateElement(id, {\n          xywh: bounds.serialize(),\n          rotate: CommonUtils.normalizeDegAngle(rotate + delta),\n        });\n      }\n    });\n\n    this._updateCursor(true, { type: 'rotate', angle: delta });\n    this._updateMode();\n  };\n\n  private _onDragStart = () => {\n    this.slots.dragStart.emit();\n\n    const rotation = this._resizeManager.rotation;\n\n    this._dragEndCallback = [];\n    this.edgeless.slots.elementResizeStart.emit();\n    this.selection.selectedElements.forEach(el => {\n      el.stash('xywh');\n\n      if (el instanceof NoteBlockModel) {\n        el.stash('edgeless');\n      }\n\n      if (rotation) {\n        el.stash('rotate' as 'xywh');\n      }\n\n      if (el instanceof TextElementModel && !rotation) {\n        el.stash('fontSize');\n        el.stash('hasMaxWidth');\n      }\n\n      this._dragEndCallback.push(() => {\n        el.pop('xywh');\n\n        if (el instanceof NoteBlockModel) {\n          el.pop('edgeless');\n        }\n\n        if (rotation) {\n          el.pop('rotate' as 'xywh');\n        }\n\n        if (el instanceof TextElementModel && !rotation) {\n          el.pop('fontSize');\n          el.pop('hasMaxWidth');\n        }\n      });\n    });\n    this._updateResizeManagerState(true);\n  };\n\n  private _propDisposables: Disposable[] = [];\n\n  private _resizeManager: HandleResizeManager;\n\n  private _updateCursor = (\n    dragging: boolean,\n    options?: {\n      type: 'resize' | 'rotate';\n      angle?: number;\n      target?: HTMLElement;\n      point?: IVec;\n    }\n  ) => {\n    let cursor = 'default';\n\n    if (dragging && options) {\n      const { type, target, point } = options;\n      let { angle } = options;\n      if (type === 'rotate') {\n        if (target && point) {\n          angle = calcAngle(target, point, 45);\n        }\n        this._cursorRotate += angle || 0;\n        cursor = generateCursorUrl(this._cursorRotate).toString();\n      } else {\n        if (this.resizeMode === 'edge') {\n          cursor = 'ew';\n        } else if (target && point) {\n          const label = getResizeLabel(target);\n          const { width, height, left, top } = this._selectedRect;\n          if (\n            label === 'top' ||\n            label === 'bottom' ||\n            label === 'left' ||\n            label === 'right'\n          ) {\n            angle = calcAngleEdgeWithRotation(\n              target,\n              this._selectedRect.rotate\n            );\n          } else {\n            angle = calcAngleWithRotation(\n              target,\n              point,\n              new DOMRect(\n                left + this.edgeless.viewport.left,\n                top + this.edgeless.viewport.top,\n                width,\n                height\n              ),\n              this._selectedRect.rotate\n            );\n          }\n          cursor = rotateResizeCursor((angle * Math.PI) / 180);\n        }\n        cursor += '-resize';\n      }\n    } else {\n      this._cursorRotate = 0;\n    }\n    this.edgelessSlots.cursorUpdated.emit(cursor);\n  };\n\n  private _updateMode = () => {\n    if (this._cursorRotate) {\n      this._mode = 'rotate';\n      return;\n    }\n\n    const { selection } = this;\n    const elements = selection.selectedElements;\n\n    if (elements.length !== 1) this._mode = 'scale';\n\n    const element = elements[0];\n\n    if (isNoteBlock(element) || isEmbedSyncedDocBlock(element)) {\n      this._mode = this._shiftKey ? 'scale' : 'resize';\n    } else if (this._isProportionalElement(element)) {\n      this._mode = 'scale';\n    } else {\n      this._mode = 'resize';\n    }\n\n    if (this._mode !== 'scale') {\n      this._scalePercent = undefined;\n      this._scaleDirection = undefined;\n    }\n  };\n\n  private _updateOnElementChange = (\n    element: string | { id: string },\n    fromRemote: boolean = false\n  ) => {\n    if ((fromRemote && this._resizeManager.dragging) || !this.isConnected) {\n      return;\n    }\n\n    const id = typeof element === 'string' ? element : element.id;\n\n    if (this._resizeManager.bounds.has(id) || this.selection.has(id)) {\n      this._updateSelectedRect();\n      this._updateMode();\n    }\n  };\n\n  private _updateOnSelectionChange = () => {\n    this._initSelectedSlot();\n    this._updateSelectedRect();\n    this._updateResizeManagerState(true);\n    // Reset the cursor\n    this._updateCursor(false);\n    this._updateMode();\n  };\n\n  private _updateOnViewportChange = () => {\n    if (this.selection.empty) {\n      return;\n    }\n\n    this._updateSelectedRect();\n    this._updateMode();\n  };\n\n  /**\n   * @param refresh indicate whether to completely refresh the state of resize manager, otherwise only update the position\n   */\n  private _updateResizeManagerState = (refresh: boolean) => {\n    const {\n      _resizeManager,\n      _selectedRect,\n      resizeMode,\n      zoom,\n      selection: { selectedElements },\n    } = this;\n\n    const rect = getSelectedRect(selectedElements);\n    const proportion = selectedElements.some(element =>\n      this._isProportionalElement(element)\n    );\n    // if there are more than one element, we need to refresh the state of resize manager\n    if (selectedElements.length > 1) refresh = true;\n\n    _resizeManager.updateState(\n      resizeMode,\n      _selectedRect.rotate,\n      zoom,\n      refresh ? undefined : rect,\n      refresh ? rect : undefined,\n      proportion\n    );\n    _resizeManager.updateBounds(getSelectableBounds(selectedElements));\n  };\n\n  private _updateSelectedRect = requestThrottledConnectedFrame(() => {\n    const { zoom, selection, edgeless } = this;\n\n    const elements = selection.selectedElements;\n    // in surface\n    const rect = getSelectedRect(elements);\n\n    // in viewport\n    const [left, top] = edgeless.service.viewport.toViewCoord(\n      rect.left,\n      rect.top\n    );\n    const [width, height] = [rect.width * zoom, rect.height * zoom];\n\n    let rotate = 0;\n    if (elements.length === 1 && elements[0].rotate) {\n      rotate = elements[0].rotate;\n    }\n\n    this._selectedRect = {\n      width,\n      height,\n      left,\n      top,\n      rotate,\n      borderStyle: 'solid',\n      borderWidth: 2,\n    };\n  }, this);\n\n  readonly slots = {\n    dragStart: new Slot(),\n    dragMove: new Slot(),\n    dragRotate: new Slot(),\n    dragEnd: new Slot(),\n  };\n\n  get doc() {\n    return this.edgeless.doc;\n  }\n\n  get dragDirection() {\n    return this._resizeManager.dragDirection;\n  }\n\n  get dragging() {\n    return this._resizeManager.dragging || this.edgeless.tools.dragging;\n  }\n\n  get edgelessSlots() {\n    return this.edgeless.slots;\n  }\n\n  get resizeMode(): ResizeMode {\n    const elements = this.selection.selectedElements;\n\n    let areAllConnectors = true;\n    let areAllIndependentConnectors = elements.length > 1;\n    let areAllShapes = true;\n    let areAllTexts = true;\n    let hasMindmapNode = false;\n\n    for (const element of elements) {\n      if (isNoteBlock(element) || isEmbedSyncedDocBlock(element)) {\n        areAllConnectors = false;\n        if (this._shiftKey) {\n          areAllShapes = false;\n          areAllTexts = false;\n        }\n      } else if (isEmbedHtmlBlock(element)) {\n        areAllConnectors = false;\n      } else if (isFrameBlock(element)) {\n        areAllConnectors = false;\n      } else if (this._isProportionalElement(element)) {\n        areAllConnectors = false;\n        areAllShapes = false;\n        areAllTexts = false;\n      } else if (isEdgelessTextBlock(element)) {\n        areAllConnectors = false;\n        areAllShapes = false;\n      } else {\n        assertType<LumenSuite.SurfaceElementModel>(element);\n        if (element.type === CanvasElementType.CONNECTOR) {\n          const connector = element as ConnectorElementModel;\n          areAllIndependentConnectors &&= !(\n            connector.source.id || connector.target.id\n          );\n        } else {\n          areAllConnectors = false;\n        }\n        if (\n          element.type !== CanvasElementType.SHAPE &&\n          element.type !== CanvasElementType.GROUP\n        )\n          areAllShapes = false;\n        if (element.type !== CanvasElementType.TEXT) areAllTexts = false;\n\n        if (isMindmapNode(element)) {\n          hasMindmapNode = true;\n        }\n      }\n    }\n\n    if (areAllConnectors) {\n      if (areAllIndependentConnectors) {\n        return 'all';\n      } else {\n        return 'none';\n      }\n    }\n\n    if (hasMindmapNode) return 'none';\n    if (areAllShapes) return 'all';\n    if (areAllTexts) return 'edgeAndCorner';\n\n    return 'corner';\n  }\n\n  get selection() {\n    return this.edgeless.service.selection;\n  }\n\n  get surface() {\n    return this.edgeless.surface;\n  }\n\n  get zoom() {\n    return this.edgeless.service.viewport.zoom;\n  }\n\n  constructor() {\n    super();\n    this._resizeManager = new HandleResizeManager(\n      this._onDragStart,\n      this._onDragMove,\n      this._onDragRotate,\n      this._onDragEnd\n    );\n    this.addEventListener('pointerdown', stopPropagation);\n  }\n\n  /**\n   * TODO: Remove this function after the edgeless refactor completed\n   * This function is used to adjust the element bound and scale\n   * Should not be used in the future\n   * Related issue: https://linear.app/affine-design/issue/BS-1009/\n   * @deprecated\n   */\n  #adjustAIChat(\n    element: LumenSuite.EdgelessModel,\n    bound: Bound,\n    direction: HandleDirection\n  ) {\n    const curBound = Bound.deserialize(element.xywh);\n\n    let scale = 1;\n    if ('scale' in element) {\n      scale = element.scale as number;\n    }\n    let width = curBound.w / scale;\n    let height = curBound.h / scale;\n    if (this._shiftKey) {\n      scale = bound.w / width;\n      this._scalePercent = `${Math.round(scale * 100)}%`;\n      this._scaleDirection = direction;\n    }\n\n    width = bound.w / scale;\n    width = clamp(width, AI_CHAT_BLOCK_MIN_WIDTH, AI_CHAT_BLOCK_MAX_WIDTH);\n    bound.w = width * scale;\n\n    height = bound.h / scale;\n    height = clamp(height, AI_CHAT_BLOCK_MIN_HEIGHT, AI_CHAT_BLOCK_MAX_HEIGHT);\n    bound.h = height * scale;\n\n    this._isWidthLimit =\n      width === AI_CHAT_BLOCK_MIN_WIDTH || width === AI_CHAT_BLOCK_MAX_WIDTH;\n    this._isHeightLimit =\n      height === AI_CHAT_BLOCK_MIN_HEIGHT ||\n      height === AI_CHAT_BLOCK_MAX_HEIGHT;\n\n    this.edgeless.service.updateElement(element.id, {\n      scale,\n      xywh: bound.serialize(),\n    });\n  }\n\n  #adjustConnector(\n    element: ConnectorElementModel,\n    bounds: Bound,\n    matrix: DOMMatrix,\n    originalPath: PointLocation[]\n  ) {\n    const props = element.resize(bounds, originalPath, matrix);\n    this.edgeless.service.updateElement(element.id, props);\n  }\n\n  #adjustEdgelessText(\n    element: EdgelessTextBlockModel,\n    bound: Bound,\n    direction: HandleDirection\n  ) {\n    const oldXYWH = Bound.deserialize(element.xywh);\n    if (\n      direction === HandleDirection.TopLeft ||\n      direction === HandleDirection.TopRight ||\n      direction === HandleDirection.BottomRight ||\n      direction === HandleDirection.BottomLeft\n    ) {\n      const newScale = element.scale * (bound.w / oldXYWH.w);\n      this._scalePercent = `${Math.round(newScale * 100)}%`;\n      this._scaleDirection = direction;\n\n      bound.h = bound.w * (oldXYWH.h / oldXYWH.w);\n      this.edgeless.service.updateElement(element.id, {\n        scale: newScale,\n        xywh: bound.serialize(),\n      });\n    } else if (\n      direction === HandleDirection.Left ||\n      direction === HandleDirection.Right\n    ) {\n      const textPortal = this.edgeless.host.view.getBlock(\n        element.id\n      ) as EdgelessTextBlockComponent | null;\n      if (!textPortal) return;\n\n      if (!textPortal.checkWidthOverflow(bound.w)) return;\n\n      const newRealWidth = clamp(\n        bound.w / element.scale,\n        EDGELESS_TEXT_BLOCK_MIN_WIDTH,\n        Infinity\n      );\n      bound.w = newRealWidth * element.scale;\n      this.edgeless.service.updateElement(element.id, {\n        xywh: Bound.serialize({\n          ...bound,\n          h: oldXYWH.h,\n        }),\n        hasMaxWidth: true,\n      });\n    }\n  }\n\n  #adjustEmbedHtml(\n    element: EmbedHtmlModel,\n    bound: Bound,\n    _direction: HandleDirection\n  ) {\n    bound.w = clamp(bound.w, EMBED_HTML_MIN_WIDTH, Infinity);\n    bound.h = clamp(bound.h, EMBED_HTML_MIN_HEIGHT, Infinity);\n\n    this._isWidthLimit = bound.w === EMBED_HTML_MIN_WIDTH;\n    this._isHeightLimit = bound.h === EMBED_HTML_MIN_HEIGHT;\n\n    this.edgeless.service.updateElement(element.id, {\n      xywh: bound.serialize(),\n    });\n  }\n\n  #adjustEmbedSyncedDoc(\n    element: EmbedSyncedDocModel,\n    bound: Bound,\n    direction: HandleDirection\n  ) {\n    const curBound = Bound.deserialize(element.xywh);\n\n    let scale = element.scale ?? 1;\n    let width = curBound.w / scale;\n    let height = curBound.h / scale;\n    if (this._shiftKey) {\n      scale = bound.w / width;\n      this._scalePercent = `${Math.round(scale * 100)}%`;\n      this._scaleDirection = direction;\n    }\n\n    width = bound.w / scale;\n    width = clamp(width, SYNCED_MIN_WIDTH, Infinity);\n    bound.w = width * scale;\n\n    height = bound.h / scale;\n    height = clamp(height, SYNCED_MIN_HEIGHT, Infinity);\n    bound.h = height * scale;\n\n    this._isWidthLimit = width === SYNCED_MIN_WIDTH;\n    this._isHeightLimit = height === SYNCED_MIN_HEIGHT;\n\n    this.edgeless.service.updateElement(element.id, {\n      scale,\n      xywh: bound.serialize(),\n    });\n  }\n\n  #adjustFrame(frame: FrameBlockModel, bound: Bound) {\n    const frameManager = this.edgeless.service.frame;\n\n    const oldChildren = frameManager.getChildElementsInFrame(frame);\n\n    this.edgeless.service.updateElement(frame.id, {\n      xywh: bound.serialize(),\n    });\n\n    const newChildren = getTopElements(\n      frameManager.getElementsInFrameBound(frame)\n    ).concat(\n      oldChildren.filter(oldChild => {\n        return frame.intersectsBound(oldChild.elementBound);\n      })\n    );\n\n    frameManager.removeAllChildrenFromFrame(frame);\n    frameManager.addElementsToFrame(frame, newChildren);\n    this.edgeless.service.frameOverlay.highlight(frame, true);\n  }\n\n  #adjustNote(\n    element: NoteBlockModel,\n    bound: Bound,\n    direction: HandleDirection\n  ) {\n    const curBound = Bound.deserialize(element.xywh);\n\n    let scale = element.edgeless.scale ?? 1;\n    let width = curBound.w / scale;\n    let height = curBound.h / scale;\n\n    if (this._shiftKey) {\n      scale = bound.w / width;\n      this._scalePercent = `${Math.round(scale * 100)}%`;\n      this._scaleDirection = direction;\n    } else if (curBound.h !== bound.h) {\n      this.edgeless.doc.updateBlock(element, () => {\n        element.edgeless.collapse = true;\n        element.edgeless.collapsedHeight = bound.h / scale;\n      });\n    }\n\n    width = bound.w / scale;\n    width = clamp(width, NOTE_MIN_WIDTH, Infinity);\n    bound.w = width * scale;\n\n    height = bound.h / scale;\n    height = clamp(height, NOTE_MIN_HEIGHT, Infinity);\n    bound.h = height * scale;\n\n    this._isWidthLimit = width === NOTE_MIN_WIDTH;\n    this._isHeightLimit = height === NOTE_MIN_HEIGHT;\n\n    this.edgeless.service.updateElement(element.id, {\n      edgeless: {\n        ...element.edgeless,\n        scale,\n      },\n      xywh: bound.serialize(),\n    });\n  }\n\n  #adjustProportional(\n    element: LumenSuite.EdgelessModel,\n    bound: Bound,\n    direction: HandleDirection\n  ) {\n    const curBound = Bound.deserialize(element.xywh);\n\n    if (isImageBlock(element)) {\n      const { height } = element;\n      if (height) {\n        this._scalePercent = `${Math.round((bound.h / height) * 100)}%`;\n        this._scaleDirection = direction;\n      }\n    } else {\n      const cardStyle = (element as BookmarkBlockModel).style;\n      const height = EMBED_CARD_HEIGHT[cardStyle];\n      this._scalePercent = `${Math.round((bound.h / height) * 100)}%`;\n      this._scaleDirection = direction;\n    }\n    if (\n      direction === HandleDirection.Left ||\n      direction === HandleDirection.Right\n    ) {\n      bound.h = (curBound.h / curBound.w) * bound.w;\n    } else if (\n      direction === HandleDirection.Top ||\n      direction === HandleDirection.Bottom\n    ) {\n      bound.w = (curBound.w / curBound.h) * bound.h;\n    }\n\n    this.edgeless.service.updateElement(element.id, {\n      xywh: bound.serialize(),\n    });\n  }\n\n  #adjustShape(\n    element: ShapeElementModel,\n    bound: Bound,\n    _direction: HandleDirection\n  ) {\n    bound = normalizeShapeBound(element, bound);\n    this.edgeless.service.updateElement(element.id, {\n      xywh: bound.serialize(),\n    });\n  }\n\n  #adjustText(\n    element: TextElementModel,\n    bound: Bound,\n    direction: HandleDirection\n  ) {\n    let p = 1;\n    if (\n      direction === HandleDirection.Left ||\n      direction === HandleDirection.Right\n    ) {\n      const {\n        text: yText,\n        fontFamily,\n        fontSize,\n        fontStyle,\n        fontWeight,\n        hasMaxWidth,\n      } = element;\n      // If the width of the text element has been changed by dragging,\n      // We need to set hasMaxWidth to true for wrapping the text\n      bound = TextUtils.normalizeTextBound(\n        {\n          yText,\n          fontFamily,\n          fontSize,\n          fontStyle,\n          fontWeight,\n          hasMaxWidth,\n        },\n        bound,\n        true\n      );\n      // If the width of the text element has been changed by dragging,\n      // We need to set hasMaxWidth to true for wrapping the text\n      this.edgeless.service.updateElement(element.id, {\n        xywh: bound.serialize(),\n        fontSize: element.fontSize * p,\n        hasMaxWidth: true,\n      });\n    } else {\n      p = bound.h / element.h;\n      // const newFontsize = element.fontSize * p;\n      // bound = normalizeTextBound(element, bound, false, newFontsize);\n\n      this.edgeless.service.updateElement(element.id, {\n        xywh: bound.serialize(),\n        fontSize: element.fontSize * p,\n      });\n    }\n  }\n\n  #adjustUseFallback(\n    element: LumenSuite.EdgelessModel,\n    bound: Bound,\n    _direction: HandleDirection\n  ) {\n    this.edgeless.service.updateElement(element.id, {\n      xywh: bound.serialize(),\n    });\n  }\n\n  private _canAutoComplete() {\n    return (\n      !this.autoCompleteOff &&\n      !this._isResizing &&\n      this.selection.selectedElements.length === 1 &&\n      (this.selection.selectedElements[0] instanceof ShapeElementModel ||\n        isNoteBlock(this.selection.selectedElements[0]))\n    );\n  }\n\n  private _canRotate() {\n    return !this.selection.selectedElements.every(\n      ele =>\n        isNoteBlock(ele) ||\n        isFrameBlock(ele) ||\n        isBookmarkBlock(ele) ||\n        isAttachmentBlock(ele) ||\n        isEmbeddedBlock(ele)\n    );\n  }\n\n  private _isProportionalElement(element: LumenSuite.EdgelessModel) {\n    return (\n      isAttachmentBlock(element) ||\n      isImageBlock(element) ||\n      isBookmarkBlock(element) ||\n      isEmbedFigmaBlock(element) ||\n      isEmbedGithubBlock(element) ||\n      isEmbedYoutubeBlock(element) ||\n      isEmbedLoomBlock(element) ||\n      isEmbedLinkedDocBlock(element)\n    );\n  }\n\n  private _shouldRenderSelection(elements?: LumenSuite.EdgelessModel[]) {\n    elements = elements ?? this.selection.selectedElements;\n    return elements.length > 0 && !this.selection.editing;\n  }\n\n  override firstUpdated() {\n    const { _disposables, edgelessSlots, selection, edgeless } = this;\n\n    _disposables.add(\n      // viewport zooming / scrolling\n      edgeless.service.viewport.viewportUpdated.on(this._updateOnViewportChange)\n    );\n\n    pickValues(edgeless.service.surface, [\n      'elementAdded',\n      'elementRemoved',\n      'elementUpdated',\n    ]).forEach(slot => {\n      _disposables.add(slot.on(this._updateOnElementChange));\n    });\n\n    _disposables.add(\n      this.doc.slots.blockUpdated.on(this._updateOnElementChange)\n    );\n\n    _disposables.add(\n      edgelessSlots.pressShiftKeyUpdated.on(pressed => {\n        this._shiftKey = pressed;\n        this._resizeManager.onPressShiftKey(pressed);\n        this._updateSelectedRect();\n        this._updateMode();\n      })\n    );\n\n    _disposables.add(selection.slots.updated.on(this._updateOnSelectionChange));\n\n    _disposables.add(\n      edgeless.slots.readonlyUpdated.on(() => this.requestUpdate())\n    );\n\n    _disposables.add(\n      edgeless.slots.elementResizeStart.on(() => (this._isResizing = true))\n    );\n    _disposables.add(\n      edgeless.slots.elementResizeEnd.on(() => (this._isResizing = false))\n    );\n    _disposables.add(() => {\n      this._propDisposables.forEach(disposable => disposable.dispose());\n    });\n  }\n\n  override render() {\n    if (!this.isConnected) return nothing;\n\n    const { selection } = this;\n    const elements = selection.selectedElements;\n\n    if (!this._shouldRenderSelection(elements)) return nothing;\n\n    const {\n      edgeless,\n      doc,\n      resizeMode,\n      _resizeManager,\n      _selectedRect,\n      _updateCursor,\n    } = this;\n\n    const hasResizeHandles = !selection.editing && !doc.readonly;\n    const inoperable = selection.inoperable;\n    const handlers = [];\n\n    if (!inoperable) {\n      const resizeHandles = hasResizeHandles\n        ? ResizeHandles(\n            resizeMode,\n            (e: PointerEvent, direction: HandleDirection) => {\n              const target = e.target as HTMLElement;\n              if (target.classList.contains('rotate') && !this._canRotate()) {\n                return;\n              }\n              const proportional = elements.some(\n                el => el instanceof TextElementModel\n              );\n              _resizeManager.onPointerDown(e, direction, proportional);\n            },\n            (\n              dragging: boolean,\n              options?: {\n                type: 'resize' | 'rotate';\n                angle?: number;\n                target?: HTMLElement;\n                point?: IVec;\n              }\n            ) => {\n              if (!this._canRotate() && options?.type === 'rotate') return;\n              _updateCursor(dragging, options);\n            }\n          )\n        : nothing;\n\n      const connectorHandle =\n        elements.length === 1 && elements[0] instanceof ConnectorElementModel\n          ? html`\n              <edgeless-connector-handle\n                .connector=${elements[0]}\n                .edgeless=${edgeless}\n              ></edgeless-connector-handle>\n            `\n          : nothing;\n\n      const elementHandle =\n        elements.length > 1 &&\n        !elements.reduce(\n          (p, e) => p && e instanceof ConnectorElementModel,\n          true\n        )\n          ? elements.map(element => {\n              const [modelX, modelY, w, h] = deserializeXYWH(element.xywh);\n              const [x, y] = edgeless.service.viewport.toViewCoord(\n                modelX,\n                modelY\n              );\n              const { left, top, borderWidth } = this._selectedRect;\n              const style = {\n                position: 'absolute',\n                boxSizing: 'border-box',\n                left: `${x - left - borderWidth}px`,\n                top: `${y - top - borderWidth}px`,\n                width: `${w * this.zoom}px`,\n                height: `${h * this.zoom}px`,\n                transform: `rotate(${element.rotate}deg)`,\n                border: `1px solid var(--affine-primary-color)`,\n              };\n              return html`<div\n                class=\"element-handle\"\n                style=${styleMap(style)}\n              ></div>`;\n            })\n          : nothing;\n\n      handlers.push(resizeHandles, connectorHandle, elementHandle);\n    }\n\n    if (elements.length === 1 && elements[0] instanceof ConnectorElementModel) {\n      _selectedRect.width = 0;\n      _selectedRect.height = 0;\n      _selectedRect.borderWidth = 0;\n    }\n\n    return html`\n      <style>\n        .affine-edgeless-selected-rect .handle[aria-label='right']::after {\n          content: '';\n          display: ${this._isWidthLimit ? 'initial' : 'none'};\n          position: absolute;\n          top: 0;\n          left: 1.5px;\n          width: 2px;\n          height: 100%;\n          background: var(--affine-error-color);\n          filter: drop-shadow(-6px 0px 12px rgba(235, 67, 53, 0.35));\n        }\n\n        .affine-edgeless-selected-rect .handle[aria-label='bottom']::after {\n          content: '';\n          display: ${this._isHeightLimit ? 'initial' : 'none'};\n          position: absolute;\n          top: 1.5px;\n          left: 0px;\n          width: 100%;\n          height: 2px;\n          background: var(--affine-error-color);\n          filter: drop-shadow(-6px 0px 12px rgba(235, 67, 53, 0.35));\n        }\n      </style>\n\n      ${!doc.readonly && !inoperable && this._canAutoComplete()\n        ? html`<edgeless-auto-complete\n            .current=${this.selection.selectedElements[0]}\n            .edgeless=${edgeless}\n            .selectedRect=${_selectedRect}\n          >\n          </edgeless-auto-complete>`\n        : nothing}\n\n      <div\n        class=\"affine-edgeless-selected-rect\"\n        style=${styleMap({\n          width: `${_selectedRect.width}px`,\n          height: `${_selectedRect.height}px`,\n          borderWidth: `${_selectedRect.borderWidth}px`,\n          borderStyle: _selectedRect.borderStyle,\n          transform: `translate(${_selectedRect.left}px, ${_selectedRect.top}px) rotate(${_selectedRect.rotate}deg)`,\n        })}\n        disabled=\"true\"\n        data-mode=${this._mode}\n        data-scale-percent=${ifDefined(this._scalePercent)}\n        data-scale-direction=${ifDefined(this._scaleDirection)}\n      >\n        ${handlers}\n      </div>\n    `;\n  }\n\n  @state()\n  private accessor _isHeightLimit = false;\n\n  @state()\n  private accessor _isResizing = false;\n\n  @state()\n  private accessor _isWidthLimit = false;\n\n  @state()\n  private accessor _mode: 'resize' | 'scale' | 'rotate' = 'resize';\n\n  @state()\n  private accessor _scaleDirection: HandleDirection | undefined = undefined;\n\n  @state()\n  private accessor _scalePercent: string | undefined = undefined;\n\n  @state()\n  private accessor _selectedRect: SelectedRect = {\n    width: 0,\n    height: 0,\n    left: 0,\n    top: 0,\n    rotate: 0,\n    borderWidth: 0,\n    borderStyle: 'solid',\n  };\n\n  @state()\n  private accessor _shiftKey = false;\n\n  @state()\n  accessor autoCompleteOff = false;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-selected-rect': EdgelessSelectedRect;\n  }\n}\n"]}