{"version":3,"file":"basket-elements.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/mindmap/basket-elements.ts"],"names":[],"mappings":"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","sourcesContent":["import type { TemplateResult } from 'lit';\n\nimport {\n  CanvasElementType,\n  type MindmapElementModel,\n} from '@lumensuite/affine-block-surface';\nimport {\n  LayoutType,\n  type MindmapStyle,\n  type ShapeElementModel,\n  TextElementModel,\n} from '@lumensuite/affine-model';\nimport { TelemetryProvider } from '@lumensuite/affine-shared/services';\nimport { assertInstanceOf, Bound } from '@lumensuite/global/utils';\nimport { DocCollection } from '@lumensuite/store';\n\nimport type { EdgelessRootBlockComponent } from '../../../edgeless-root-block.js';\nimport type { EdgelessRootService } from '../../../edgeless-root-service.js';\n\nimport { mountTextElementEditor } from '../../../utils/text.js';\n\nexport type ConfigProperty = 'x' | 'y' | 'r' | 's' | 'z' | 'o';\nexport type ConfigState = 'default' | 'active' | 'hover' | 'next';\nexport type ConfigStyle = Partial<Record<ConfigProperty, number | string>>;\nexport type ToolConfig = Record<ConfigState, ConfigStyle>;\n\nexport type DraggableTool = {\n  name: 'text' | 'mindmap';\n  icon: TemplateResult;\n  config: ToolConfig;\n  standardWidth?: number;\n  render: (\n    bound: Bound,\n    edgelessService: EdgelessRootService,\n    edgeless: EdgelessRootBlockComponent\n  ) => string;\n};\n\nconst unitMap = { x: 'px', y: 'px', r: 'deg', s: '', z: '', o: '' };\nexport const textConfig: ToolConfig = {\n  default: { x: -20, y: -8, r: 7.74, s: 0.92, z: 2 },\n  active: { x: -22, y: -9, r: -8, s: 0.92 },\n  hover: { x: -22, y: -9, r: -8, s: 1, z: 3 },\n  next: { x: -22, y: 64, r: 0 },\n};\nexport const mindmapConfig: ToolConfig = {\n  default: { x: 4, y: -4, s: 1, z: 1, r: -7 },\n  active: { x: 11, y: -14, r: 9, s: 1 },\n  hover: { x: 11, y: -14, r: 9, s: 1.16, z: 3 },\n  next: { y: 64, r: 0 },\n};\n\nexport const getMindmapRender =\n  (mindmapStyle: MindmapStyle): DraggableTool['render'] =>\n  (bound, edgelessService) => {\n    const [x, y, _, h] = bound.toXYWH();\n    const mindmapId = edgelessService.addElement('mindmap', {\n      style: mindmapStyle,\n    }) as string;\n\n    edgelessService.std\n      .getOptional(TelemetryProvider)\n      ?.track('CanvasElementAdded', {\n        control: 'toolbar:dnd', // for now we use toolbar:dnd for all mindmap creation here\n        page: 'whiteboard editor',\n        module: 'toolbar',\n        segment: 'toolbar',\n        type: 'mindmap',\n      });\n\n    const mindmap = edgelessService.getElementById(\n      mindmapId\n    ) as MindmapElementModel;\n\n    const rootW = 145;\n    const rootH = 50;\n\n    const nodeW = 80;\n    const nodeH = 35;\n\n    const centerVertical = y + h / 2;\n    const rootX = x;\n    const rootY = centerVertical - rootH / 2;\n\n    const createNode = (\n      ...args: Parameters<MindmapElementModel['addNode']>\n    ) => {\n      const id = mindmap.addNode(...args);\n      const node = edgelessService.getElementById(id) as ShapeElementModel;\n      return { node, id };\n    };\n    const root = createNode(null, undefined, undefined, {\n      text: 'Mind Map',\n      xywh: `[${rootX},${rootY},${rootW},${rootH}]`,\n    });\n\n    for (let i = 0; i < 3; i++) {\n      const nodeX = x + rootW + 300;\n      const nodeY = centerVertical - nodeH / 2 + (i - 1) * 50;\n      createNode(\n        root.id,\n        undefined,\n        undefined,\n        {\n          text: 'Text',\n          xywh: `[${nodeX},${nodeY},${nodeW},${nodeH}]`,\n        },\n        LayoutType.RIGHT\n      );\n    }\n\n    return mindmapId;\n  };\nexport const textRender: DraggableTool['render'] = (\n  bound,\n  service,\n  edgeless\n) => {\n  const vCenter = bound.y + bound.h / 2;\n  const w = 100;\n  const h = 32;\n\n  const flag = edgeless.doc.awarenessStore.getFlag('enable_edgeless_text');\n  let id: string;\n  if (flag) {\n    const { textId } = edgeless.std.command.exec('insertEdgelessText', {\n      x: bound.x,\n      y: vCenter - h / 2,\n    });\n    id = textId!;\n  } else {\n    id = service.addElement(CanvasElementType.TEXT, {\n      xywh: new Bound(bound.x, vCenter - h / 2, w, h).serialize(),\n      text: new DocCollection.Y.Text(),\n    });\n\n    edgeless.doc.captureSync();\n    const textElement = edgeless.service.getElementById(id);\n    assertInstanceOf(textElement, TextElementModel);\n    mountTextElementEditor(textElement, edgeless);\n  }\n\n  service.std.getOptional(TelemetryProvider)?.track('CanvasElementAdded', {\n    control: 'toolbar:dnd',\n    page: 'whiteboard editor',\n    module: 'toolbar',\n    segment: 'toolbar',\n    type: 'text',\n  });\n\n  return id;\n};\n\nconst toolStyle2StyleObj = (state: ConfigState, style: ConfigStyle = {}) => {\n  const styleObj = {} as Record<string, string>;\n  for (const [key, value] of Object.entries(style)) {\n    styleObj[`--${state}-${key}`] = `${value}${unitMap[key as ConfigProperty]}`;\n  }\n  return styleObj;\n};\nexport const toolConfig2StyleObj = (config: ToolConfig) => {\n  const styleObj = {} as Record<string, string>;\n  for (const [state, style] of Object.entries(config)) {\n    Object.assign(\n      styleObj,\n      toolStyle2StyleObj(state as ConfigState, {\n        ...config.default,\n        ...style,\n      })\n    );\n  }\n  return styleObj;\n};\n"]}