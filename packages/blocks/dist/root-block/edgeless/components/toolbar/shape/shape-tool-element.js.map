{"version":3,"file":"shape-tool-element.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/shape/shape-tool-element.ts"],"names":[],"mappings":"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","sourcesContent":["import { CanvasElementType } from '@lumensuite/affine-block-surface';\nimport {\n  getShapeRadius,\n  getShapeType,\n  type ShapeName,\n  type ShapeStyle,\n} from '@lumensuite/affine-model';\nimport { WithDisposable } from '@lumensuite/block-std';\nimport { Bound, sleep } from '@lumensuite/global/utils';\nimport {\n  css,\n  html,\n  LitElement,\n  type PropertyValues,\n  type TemplateResult,\n} from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\n\nimport type { EdgelessRootBlockComponent } from '../../../edgeless-root-block.js';\n\nimport { ShapeToolController } from '../../../tools/shape-tool.js';\n\nexport interface Shape {\n  name: ShapeName;\n  svg: TemplateResult<1>;\n}\n\ninterface Coord {\n  x: number;\n  y: number;\n}\n\ntype TransformMap = Record<\n  string,\n  {\n    x: number;\n    y: number;\n    scale: number;\n    origin: string;\n  }\n>;\n\n@customElement('edgeless-shape-tool-element')\nexport class EdgelessShapeToolElement extends WithDisposable(LitElement) {\n  static override styles = css`\n    .shape {\n      --x: 0px;\n      --y: 0px;\n      --offset-x: 0px;\n      --offset-y: 0px;\n      --scale: 1;\n      transform: translateX(calc(var(--offset-x) + var(--x)))\n        translateY(calc(var(--y) + var(--offset-y))) scale(var(--scale));\n      height: 60px;\n      width: 60px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      position: absolute;\n      top: 12px;\n      left: 16px;\n      transition: all 0.5s cubic-bezier(0, -0.01, 0.01, 1.01);\n    }\n    .shape.dragging {\n      transition: none;\n    }\n    .shape svg {\n      height: 100%;\n      filter: drop-shadow(0px 2px 8px rgba(0, 0, 0, 0.15));\n    }\n  `;\n\n  private _addShape = (coord: Coord, padding: Coord) => {\n    const width = 100;\n    const height = 100;\n    const { x: edgelessX, y: edgelessY } =\n      this.edgeless.getBoundingClientRect();\n    const zoom = this.edgeless.service.viewport.zoom;\n    const [modelX, modelY] = this.edgeless.service.viewport.toModelCoord(\n      coord.x - edgelessX - width * padding.x * zoom,\n      coord.y - edgelessY - height * padding.y * zoom\n    );\n    const xywh = new Bound(modelX, modelY, width, height).serialize();\n    this.edgeless.service.addElement(CanvasElementType.SHAPE, {\n      shapeType: getShapeType(this.shape.name),\n      xywh: xywh,\n      radius: getShapeRadius(this.shape.name),\n    });\n  };\n\n  private _onDragEnd = async (coord: Coord) => {\n    if (this._startCoord.x === coord.x && this._startCoord.y === coord.y) {\n      this.handleClick();\n      this._dragging = false;\n      return;\n    }\n    if (!this._dragging) {\n      return;\n    }\n    this._dragging = false;\n    this.edgeless.tools.setEdgelessTool({ type: 'default' });\n    if (this._isOutside) {\n      const rect = this._shapeElement.getBoundingClientRect();\n      this._backupShapeElement.style.setProperty('transition', 'none');\n      this._backupShapeElement.style.setProperty('--y', '100px');\n      this._shapeElement.style.setProperty('--offset-x', `${0}px`);\n      this._shapeElement.style.setProperty('--offset-y', `${0}px`);\n      await sleep(0);\n      this._shapeElement.classList.remove('dragging');\n      this._backupShapeElement.style.removeProperty('transition');\n      const padding = {\n        x: (coord.x - rect.left) / rect.width,\n        y: (coord.y - rect.top) / rect.height,\n      };\n      this._addShape(coord, padding);\n    } else {\n      this._shapeElement.classList.remove('dragging');\n      this._shapeElement.style.setProperty('--offset-x', `${0}px`);\n      this._shapeElement.style.setProperty('--offset-y', `${0}px`);\n      this._backupShapeElement.style.setProperty('--y', '100px');\n    }\n  };\n\n  private _onDragMove = (coord: Coord) => {\n    if (!this._dragging) {\n      return;\n    }\n    const controller = this.edgeless.tools.currentController;\n    if (controller instanceof ShapeToolController) {\n      controller.clearOverlay();\n    }\n    const { x, y } = coord;\n    this._shapeElement.style.setProperty(\n      '--offset-x',\n      `${x - this._startCoord.x}px`\n    );\n    this._shapeElement.style.setProperty(\n      '--offset-y',\n      `${y - this._startCoord.y}px`\n    );\n    const containerRect = this.getContainerRect();\n    const isOut =\n      y < containerRect.top ||\n      x < containerRect.left ||\n      x > containerRect.right;\n    if (isOut !== this._isOutside) {\n      this._backupShapeElement.style.setProperty(\n        '--y',\n        isOut ? '5px' : '100px'\n      );\n      this._backupShapeElement.style.setProperty(\n        '--scale',\n        isOut ? '1' : '0.9'\n      );\n    }\n    this._isOutside = isOut;\n  };\n\n  private _onDragStart = (coord: Coord) => {\n    this._startCoord = { x: coord.x, y: coord.y };\n    if (this.order !== 1) {\n      return;\n    }\n    this._dragging = true;\n    this._shapeElement.classList.add('dragging');\n  };\n\n  private _onMouseMove = (event: MouseEvent) => {\n    if (!this._dragging) {\n      return;\n    }\n    this._onDragMove({ x: event.clientX, y: event.clientY });\n  };\n\n  private _onMouseUp = (event: MouseEvent) => {\n    this._onDragEnd({ x: event.clientX, y: event.clientY }).catch(\n      console.error\n    );\n  };\n\n  private _onTouchEnd = (event: TouchEvent) => {\n    if (!event.changedTouches.length) return;\n\n    this._onDragEnd({\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent#touchend\n      x: event.changedTouches[0].clientX,\n      y: event.changedTouches[0].clientY,\n    }).catch(console.error);\n  };\n\n  private _touchMove = (event: TouchEvent) => {\n    if (!this._dragging) {\n      return;\n    }\n    this._onDragMove({\n      x: event.touches[0].clientX,\n      y: event.touches[0].clientY,\n    });\n  };\n\n  private _transformMap: TransformMap = {\n    z1: { x: 0, y: 5, scale: 1.1, origin: '50% 100%' },\n    z2: { x: -15, y: 0, scale: 0.75, origin: '20% 20%' },\n    z3: { x: 15, y: 0, scale: 0.75, origin: '80% 20%' },\n    hidden: { x: 0, y: 120, scale: 0, origin: '50% 50%' },\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(\n      this.edgeless.host,\n      'mousemove',\n      this._onMouseMove\n    );\n    this._disposables.addFromEvent(\n      this.edgeless.host,\n      'touchmove',\n      this._touchMove\n    );\n    this._disposables.addFromEvent(\n      this.edgeless.host,\n      'mouseup',\n      this._onMouseUp\n    );\n    this._disposables.addFromEvent(\n      this.edgeless.host,\n      'touchend',\n      this._onTouchEnd\n    );\n  }\n\n  override render() {\n    return html`\n      <div\n        id=\"shape-tool-element\"\n        class=\"shape\"\n        @mousedown=${(event: MouseEvent) =>\n          this._onDragStart({ x: event.clientX, y: event.clientY })}\n        @touchstart=${(event: TouchEvent) => {\n          event.preventDefault();\n          this._onDragStart({\n            x: event.touches[0].clientX,\n            y: event.touches[0].clientY,\n          });\n        }}\n      >\n        ${this.shape.svg}\n      </div>\n      ${this.order === 1\n        ? html`<div id=\"backup-shape-element\" class=\"shape\">\n            ${this.shape.svg}\n          </div>`\n        : null}\n    `;\n  }\n\n  override updated(changedProperties: PropertyValues<this>) {\n    if (!changedProperties.has('shape') && !changedProperties.has('order')) {\n      return;\n    }\n    const transform =\n      this._transformMap[this.order <= 3 ? `z${this.order}` : 'hidden'];\n    this._shapeElement.style.setProperty('--x', `${transform.x}px`);\n    this._shapeElement.style.setProperty('--y', `${transform.y}px`);\n    this._shapeElement.style.setProperty(\n      '--scale',\n      String(transform.scale || 1)\n    );\n    this._shapeElement.style.zIndex = String(999 - this.order);\n    this._shapeElement.style.transformOrigin = transform.origin;\n\n    if (this._backupShapeElement) {\n      this._backupShapeElement.style.setProperty('--y', '100px');\n      this._backupShapeElement.style.setProperty('--scale', '0.9');\n      this._backupShapeElement.style.zIndex = '999';\n    }\n  }\n\n  @query('#backup-shape-element')\n  private accessor _backupShapeElement!: HTMLElement;\n\n  @state()\n  private accessor _dragging: boolean = false;\n\n  @state()\n  private accessor _isOutside: boolean = false;\n\n  @query('#shape-tool-element')\n  private accessor _shapeElement!: HTMLElement;\n\n  @state()\n  private accessor _startCoord: Coord = { x: -1, y: -1 };\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor getContainerRect!: () => DOMRect;\n\n  @property({ attribute: false })\n  accessor handleClick!: () => void;\n\n  @property({ attribute: false })\n  accessor order!: number;\n\n  @property({ attribute: false })\n  accessor shape!: Shape;\n\n  @property({ attribute: false })\n  accessor shapeStyle!: ShapeStyle;\n\n  @property({ attribute: false })\n  accessor shapeType!: ShapeName;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-shape-tool-element': EdgelessShapeToolElement;\n  }\n}\n"]}