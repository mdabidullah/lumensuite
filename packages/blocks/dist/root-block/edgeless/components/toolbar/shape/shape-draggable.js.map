{"version":3,"file":"shape-draggable.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/shape/shape-draggable.ts"],"names":[],"mappings":"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","sourcesContent":["import { CanvasElementType } from '@blocksuite/affine-block-surface';\nimport {\n  ellipseSvg,\n  roundedSvg,\n  triangleSvg,\n} from '@blocksuite/affine-components/icons';\nimport {\n  getShapeRadius,\n  getShapeType,\n  ShapeType,\n} from '@blocksuite/affine-model';\nimport { TelemetryProvider } from '@blocksuite/affine-shared/services';\nimport { ThemeObserver } from '@blocksuite/affine-shared/theme';\nimport { SignalWatcher } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { DraggableShape } from './utils.js';\n\nimport { ShapeToolController } from '../../../tools/shape-tool.js';\nimport { EdgelessDraggableElementController } from '../common/draggable/draggable-element.controller.js';\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\nimport { buildVariablesObject } from './utils.js';\n\nconst shapes: DraggableShape[] = [];\n// to move shapes together\nconst oy = -2;\nconst ox = 0;\nshapes.push({\n  name: 'roundedRect',\n  svg: roundedSvg,\n  style: {\n    default: { x: -9, y: 6 },\n    hover: { y: -5, z: 1 },\n    next: { y: 60 },\n  },\n});\nshapes.push({\n  name: ShapeType.Ellipse,\n  svg: ellipseSvg,\n  style: {\n    default: { x: -20, y: 31 },\n    hover: { y: 15, z: 1 },\n    next: { y: 64 },\n  },\n});\nshapes.push({\n  name: ShapeType.Triangle,\n  svg: triangleSvg,\n  style: {\n    default: { x: 18, y: 25 },\n    hover: { y: 7, z: 1 },\n    next: { y: 64 },\n  },\n});\nshapes.forEach(s => {\n  Object.values(s.style).forEach(style => {\n    if (style.y) (style.y as number) += oy;\n    if (style.x) (style.x as number) += ox;\n  });\n});\n\n@customElement('edgeless-toolbar-shape-draggable')\nexport class EdgelessToolbarShapeDraggable extends EdgelessToolbarToolMixin(\n  SignalWatcher(LitElement)\n) {\n  static override styles = css`\n    :host {\n      display: flex;\n      justify-content: center;\n      align-items: flex-end;\n    }\n    .edgeless-shape-draggable {\n      /* avoid shadow clipping */\n      --shadow-safe-area: 10px;\n      box-sizing: border-box;\n      flex-shrink: 0;\n      width: calc(100% + 2 * var(--shadow-safe-area));\n      height: calc(100% + var(--shadow-safe-area));\n      padding-top: var(--shadow-safe-area);\n      padding-left: var(--shadow-safe-area);\n      padding-right: var(--shadow-safe-area);\n      overflow: hidden;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: relative;\n      pointer-events: none;\n    }\n\n    .shape {\n      width: fit-content;\n      height: fit-content;\n      position: absolute;\n      transition:\n        transform 0.3s,\n        z-index 0.1s;\n      transform: translateX(var(--default-x, 0)) translateY(var(--default-y, 0))\n        scale(var(--default-s, 1));\n      z-index: var(--default-z, 0);\n      pointer-events: none;\n    }\n    .shape svg {\n      display: block;\n    }\n    .shape svg path,\n    .shape svg circle,\n    .shape svg rect {\n      pointer-events: auto;\n      cursor: grab;\n    }\n    .shape:hover,\n    .shape.cancel {\n      transform: translateX(var(--hover-x, 0)) translateY(var(--hover-y, 0))\n        scale(var(--hover-s, 1));\n      z-index: var(--hover-z, 0);\n    }\n    .shape.next {\n      transition: all 0.5s cubic-bezier(0.39, 0.28, 0.09, 0.95);\n      pointer-events: none;\n      transform: translateX(var(--next-x, 0)) translateY(var(--next-y, 0))\n        scale(var(--next-s, 1));\n    }\n    .shape.next.coming {\n      transform: translateX(var(--default-x, 0)) translateY(var(--default-y, 0))\n        scale(var(--default-s, 1));\n    }\n  `;\n\n  draggableController!: EdgelessDraggableElementController<DraggableShape>;\n\n  draggingShape: DraggableShape['name'] = 'roundedRect';\n\n  override type = 'shape' as const;\n\n  get shapeShadow() {\n    return this.theme === 'dark'\n      ? '0 0 7px rgba(0, 0, 0, .22)'\n      : '0 0 5px rgba(0, 0, 0, .2)';\n  }\n\n  private _setShapeOverlayLock(lock: boolean) {\n    const controller = this.edgeless.tools.currentController;\n    if (controller instanceof ShapeToolController) {\n      controller.setDisableOverlay(lock);\n    }\n  }\n\n  initDragController() {\n    if (!this.edgeless || !this.toolbarContainer) return;\n    if (this.draggableController) return;\n    this.draggableController = new EdgelessDraggableElementController(this, {\n      service: this.edgeless.service,\n      edgeless: this.edgeless,\n      scopeElement: this.toolbarContainer,\n      standardWidth: 100,\n      clickToDrag: true,\n      onOverlayCreated: (overlay, element) => {\n        const shapeName =\n          this.draggableController.states.draggingElement?.data.name;\n        if (!shapeName) return;\n\n        this.setEdgelessTool({\n          type: 'shape',\n          shapeName,\n        });\n\n        const shape$ =\n          this.edgeless.service.editPropsStore.lastProps$.value[\n            `shape:${shapeName}`\n          ];\n        const color = ThemeObserver.generateColorProperty(shape$.fillColor);\n        const stroke = ThemeObserver.generateColorProperty(shape$.strokeColor);\n        Object.assign(overlay.element.style, {\n          color,\n          stroke,\n        });\n        const controller = this.edgeless.tools.currentController;\n        if (controller instanceof ShapeToolController) {\n          controller.clearOverlay();\n        }\n        overlay.element.style.filter = `drop-shadow(${this.shapeShadow})`;\n        this.readyToDrop = true;\n        this.draggingShape = element.data.name;\n      },\n      onDrop: (el, bound) => {\n        const xywh = bound.serialize();\n        const shape = el.data;\n        const id = this.edgeless.service.addElement(CanvasElementType.SHAPE, {\n          shapeType: getShapeType(shape.name),\n          xywh,\n          radius: getShapeRadius(shape.name),\n        });\n\n        this.edgeless.std\n          .getOptional(TelemetryProvider)\n          ?.track('CanvasElementAdded', {\n            control: 'toolbar:dnd',\n            page: 'whiteboard editor',\n            module: 'toolbar',\n            segment: 'toolbar',\n            type: 'shape',\n            other: {\n              shapeType: getShapeType(shape.name),\n            },\n          });\n\n        this._setShapeOverlayLock(false);\n        this.readyToDrop = false;\n\n        this.edgeless.service.tool.setEdgelessTool(\n          { type: 'default' },\n          { elements: [id], editing: false }\n        );\n      },\n      onCanceled: () => {\n        this._setShapeOverlayLock(false);\n        this.readyToDrop = false;\n      },\n      onElementClick: el => {\n        this.onShapeClick?.(el.data);\n        this._setShapeOverlayLock(true);\n      },\n      onEnterOrLeaveScope: (overlay, isOutside) => {\n        overlay.element.style.filter = isOutside\n          ? 'none'\n          : `drop-shadow(${this.shapeShadow})`;\n      },\n    });\n\n    this.edgeless.bindHotKey(\n      {\n        s: ctx => {\n          // `page.keyboard.press('Shift+s')` in playwright will also trigger this 's' key event\n          if (ctx.get('keyboardState').raw.shiftKey) return;\n\n          const service = this.edgeless.service;\n          if (service.locked || service.selection.editing) return;\n\n          if (this.readyToDrop) {\n            const activeIndex = shapes.findIndex(\n              s => s.name === this.draggingShape\n            );\n            const nextIndex = (activeIndex + 1) % shapes.length;\n            const next = shapes[nextIndex];\n            this.draggingShape = next.name;\n\n            this.draggableController.cancelWithoutAnimation();\n          }\n\n          const el = this.shapeContainer.querySelector(\n            `.shape.${this.draggingShape}`\n          ) as HTMLElement;\n          assertExists(el, 'Edgeless toolbar Shape element not found');\n          const { x, y } = service.tool.lastMousePos;\n          const { left, top } = this.edgeless.viewport;\n          const clientPos = { x: x + left, y: y + top };\n          this.draggableController.clickToDrag(el, clientPos);\n        },\n      },\n      { global: true }\n    );\n  }\n\n  override render() {\n    const { cancelled, dragOut, draggingElement } =\n      this.draggableController?.states || {};\n    const draggingShape = draggingElement?.data;\n    return html`<div class=\"edgeless-shape-draggable\">\n      ${repeat(\n        shapes,\n        s => s.name,\n        shape => {\n          const isBeingDragged = draggingShape?.name === shape.name;\n          const shape$ =\n            this.edgeless.service.editPropsStore.lastProps$.value[\n              `shape:${shape.name}`\n            ];\n          const color = ThemeObserver.generateColorProperty(shape$.fillColor);\n          const stroke = ThemeObserver.generateColorProperty(\n            shape$.strokeColor\n          );\n          const baseStyle = {\n            ...buildVariablesObject(shape.style),\n            filter: `drop-shadow(${this.shapeShadow})`,\n            color,\n            stroke,\n          };\n          const currStyle = styleMap({\n            ...baseStyle,\n            opacity: isBeingDragged ? 0 : 1,\n          });\n          const nextStyle = styleMap(baseStyle);\n          return html`${isBeingDragged\n              ? html`<div\n                  style=${nextStyle}\n                  class=${classMap({\n                    shape: true,\n                    next: true,\n                    coming: !!dragOut && !cancelled,\n                  })}\n                >\n                  ${shape.svg}\n                </div>`\n              : nothing}\n            <div\n              style=${currStyle}\n              class=${classMap({\n                shape: true,\n                [shape.name]: true,\n                cancel: isBeingDragged && !dragOut,\n              })}\n              @mousedown=${(e: MouseEvent) =>\n                this.draggableController.onMouseDown(e, {\n                  data: shape,\n                  preview: shape.svg,\n                })}\n              @touchstart=${(e: TouchEvent) =>\n                this.draggableController.onTouchStart(e, {\n                  data: shape,\n                  preview: shape.svg,\n                })}\n              @click=${(e: MouseEvent) => e.stopPropagation()}\n            >\n              ${shape.svg}\n            </div>`;\n        }\n      )}\n    </div>`;\n  }\n\n  override updated(_changedProperties: Map<PropertyKey, unknown>) {\n    const controllerRequiredProps = ['edgeless', 'toolbarContainer'] as const;\n    if (\n      controllerRequiredProps.some(p => _changedProperties.has(p)) &&\n      !this.draggableController\n    ) {\n      this.initDragController();\n    }\n  }\n\n  @property({ attribute: false })\n  accessor onShapeClick: (shape: DraggableShape) => void = () => {};\n\n  @state()\n  accessor readyToDrop = false;\n\n  @query('.edgeless-shape-draggable')\n  accessor shapeContainer!: HTMLDivElement;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-toolbar-shape-draggable': EdgelessToolbarShapeDraggable;\n  }\n}\n"]}