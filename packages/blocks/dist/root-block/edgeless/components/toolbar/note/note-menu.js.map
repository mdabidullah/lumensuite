{"version":3,"file":"note-menu.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/note/note-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { AttachmentIcon, LinkIcon } from '@lumensuite/affine-components/icons';\nimport { TelemetryProvider } from '@lumensuite/affine-shared/services';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { NoteTool } from '../../../tools/note-tool.js';\nimport type { EdgelessTool } from '../../../types.js';\n\nimport {\n  getImageFilesFromLocal,\n  type NoteChildrenFlavour,\n  openFileOrFiles,\n} from '../../../../../_common/utils/index.js';\nimport { ImageIcon } from '../../../../../image-block/styles.js';\nimport '../../buttons/tool-icon-button.js';\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport '../common/slide-menu.js';\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\nimport { NOTE_MENU_ITEMS } from './note-menu-config.js';\n\n@customElement('edgeless-note-menu')\nexport class EdgelessNoteMenu extends EdgelessToolbarToolMixin(LitElement) {\n  static override styles = css`\n    :host {\n      position: absolute;\n      display: flex;\n      z-index: -1;\n    }\n    .menu-content {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .button-group-container {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 14px;\n      fill: var(--affine-icon-color);\n    }\n    .button-group-container svg {\n      width: 20px;\n      height: 20px;\n    }\n    .divider {\n      width: 1px;\n      height: 24px;\n      background: var(--affine-border-color);\n      transform: scaleX(0.5);\n      margin: 0 14px;\n    }\n  `;\n\n  override type: EdgelessTool['type'] = 'affine:note';\n\n  private async _addImages() {\n    this._imageLoading = true;\n    const imageFiles = await getImageFilesFromLocal();\n    const ids = await this.edgeless.addImages(imageFiles);\n    this._imageLoading = false;\n    this.edgeless.service.tool.setEdgelessTool(\n      { type: 'default' },\n      { elements: ids, editing: false }\n    );\n  }\n\n  private _onHandleLinkButtonClick() {\n    const { insertedLinkType } = this.edgeless.service.std.command.exec(\n      'insertLinkByQuickSearch'\n    );\n\n    insertedLinkType\n      ?.then(type => {\n        if (!type) return;\n\n        this.edgeless.std\n          .getOptional(TelemetryProvider)\n          ?.track('CanvasElementAdded', {\n            control: 'toolbar:general',\n            page: 'whiteboard editor',\n            module: 'toolbar',\n            type: type.flavour?.split(':')[1],\n          });\n        if (type.isNewDoc) {\n          this.edgeless.std\n            .getOptional(TelemetryProvider)\n            ?.track('DocCreated', {\n              control: 'toolbar:general',\n              page: 'whiteboard editor',\n              module: 'edgeless toolbar',\n              type: type.flavour?.split(':')[1],\n            });\n        }\n      })\n      .catch(console.error);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n  }\n\n  override firstUpdated() {\n    this.disposables.add(\n      this.edgeless.slots.edgelessToolUpdated.on(tool => {\n        if (tool.type !== 'affine:note') return;\n        this.childFlavour = tool.childFlavour;\n        this.childType = tool.childType;\n        this.tip = tool.tip;\n      })\n    );\n  }\n\n  override render() {\n    const { childType } = this;\n\n    return html`\n      <edgeless-slide-menu>\n        <div class=\"menu-content\">\n          <!-- add to edgeless -->\n          <div class=\"button-group-container\">\n            <edgeless-tool-icon-button\n              .activeMode=${'background'}\n              .tooltip=${'Image'}\n              @click=${this._addImages}\n              .disabled=${this._imageLoading}\n            >\n              ${ImageIcon}\n            </edgeless-tool-icon-button>\n\n            <edgeless-tool-icon-button\n              .activeMode=${'background'}\n              .tooltip=${getTooltipWithShortcut('Link', '@')}\n              @click=${() => {\n                this._onHandleLinkButtonClick();\n              }}\n            >\n              ${LinkIcon}\n            </edgeless-tool-icon-button>\n\n            <edgeless-tool-icon-button\n              .activeMode=${'background'}\n              .tooltip=${'File'}\n              @click=${async () => {\n                const file = await openFileOrFiles();\n                if (!file) return;\n                await this.edgeless.addAttachments([file]);\n                this.edgeless.service.tool.setEdgelessTool({ type: 'default' });\n                this.edgeless.std\n                  .getOptional(TelemetryProvider)\n                  ?.track('CanvasElementAdded', {\n                    control: 'toolbar:general',\n                    page: 'whiteboard editor',\n                    module: 'toolbar',\n                    segment: 'toolbar',\n                    type: 'attachment',\n                  });\n              }}\n            >\n              ${AttachmentIcon}\n            </edgeless-tool-icon-button>\n          </div>\n\n          <div class=\"divider\"></div>\n\n          <!-- add to note -->\n          <div class=\"button-group-container\">\n            ${repeat(\n              NOTE_MENU_ITEMS,\n              item => item.childFlavour,\n              item => html`\n                <edgeless-tool-icon-button\n                  .active=${childType === item.childType}\n                  .activeMode=${'background'}\n                  .tooltip=${item.tooltip}\n                  @click=${() =>\n                    this.onChange({\n                      childFlavour: item.childFlavour,\n                      childType: item.childType,\n                      tip: item.tooltip,\n                    })}\n                >\n                  ${item.icon}\n                </edgeless-tool-icon-button>\n              `\n            )}\n          </div>\n        </div>\n      </edgeless-slide-menu>\n    `;\n  }\n\n  @state()\n  private accessor _imageLoading = false;\n\n  @property({ attribute: false })\n  accessor childFlavour!: NoteChildrenFlavour;\n\n  @property({ attribute: false })\n  accessor childType!: string | null;\n\n  @property({ attribute: false })\n  accessor onChange!: (\n    props: Partial<{\n      childFlavour: NoteTool['childFlavour'];\n      childType: string | null;\n      tip: string;\n    }>\n  ) => void;\n\n  @property({ attribute: false })\n  accessor tip!: string;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-note-menu': EdgelessNoteMenu;\n  }\n}\n"]}