{"version":3,"file":"note-tool-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/note/note-tool-button.ts"],"names":[],"mappings":"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","sourcesContent":["import { ArrowUpIcon, NoteIcon } from '@lumensuite/affine-components/icons';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { NoteTool } from '../../../tools/note-tool.js';\nimport type { EdgelessTool } from '../../../types.js';\nimport type { EdgelessNoteMenu } from './note-menu.js';\n\nimport { getTooltipWithShortcut } from '../../../components/utils.js';\nimport '../../buttons/tool-icon-button.js';\nimport { createPopper, type MenuPopper } from '../common/create-popper.js';\nimport { QuickToolMixin } from '../mixins/quick-tool.mixin.js';\nimport './note-menu.js';\n\n@customElement('edgeless-note-tool-button')\nexport class EdgelessNoteToolButton extends QuickToolMixin(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n\n    .arrow-up-icon {\n      position: absolute;\n      top: 4px;\n      right: 2px;\n      font-size: 0;\n    }\n  `;\n\n  private _noteMenu: MenuPopper<EdgelessNoteMenu> | null = null;\n\n  private _states = ['childFlavour', 'childType', 'tip'] as const;\n\n  override type: EdgelessTool['type'] = 'affine:note';\n\n  private _disposeMenu() {\n    this._noteMenu?.dispose();\n    this._noteMenu = null;\n  }\n\n  private _toggleNoteMenu() {\n    if (this._noteMenu) {\n      this._disposeMenu();\n      this.requestUpdate();\n    } else {\n      this.edgeless.tools.setEdgelessTool({\n        type: 'affine:note',\n        childFlavour: this.childFlavour,\n        childType: this.childType,\n        tip: this.tip,\n      });\n      this._noteMenu = createPopper('edgeless-note-menu', this);\n\n      this._noteMenu.element.edgeless = this.edgeless;\n      this._noteMenu.element.childFlavour = this.childFlavour;\n      this._noteMenu.element.childType = this.childType;\n      this._noteMenu.element.tip = this.tip;\n      this._noteMenu.element.onChange = (\n        props: Partial<{\n          childFlavour: NoteTool['childFlavour'];\n          childType: string | null;\n          tip: string;\n        }>\n      ) => {\n        this._states.forEach(key => {\n          if (props[key] != undefined) {\n            Object.assign(this, { [key]: props[key] });\n          }\n        });\n        this.edgeless.tools.setEdgelessTool({\n          type: 'affine:note',\n          childFlavour: this.childFlavour,\n          childType: this.childType,\n          tip: this.tip,\n        });\n      };\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.add(\n      this.edgeless.slots.edgelessToolUpdated.on(newTool => {\n        if (newTool.type !== 'affine:note') {\n          this._disposeMenu();\n        }\n      })\n    );\n  }\n\n  override disconnectedCallback() {\n    this._disposeMenu();\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    const { active } = this;\n    const arrowColor = active ? 'currentColor' : 'var(--affine-icon-secondary)';\n    return html`\n      <edgeless-tool-icon-button\n        class=\"edgeless-note-button\"\n        .tooltip=${this._noteMenu ? '' : getTooltipWithShortcut('Note', 'N')}\n        .tooltipOffset=${17}\n        .active=${active}\n        .iconContainerPadding=${6}\n        @click=${() => {\n          this._toggleNoteMenu();\n        }}\n      >\n        ${NoteIcon}\n        <span class=\"arrow-up-icon\" style=${styleMap({ color: arrowColor })}>\n          ${ArrowUpIcon}\n        </span>\n      </edgeless-tool-icon-button>\n    `;\n  }\n\n  @state()\n  accessor childFlavour: NoteTool['childFlavour'] = 'affine:paragraph';\n\n  @state()\n  accessor childType = 'text';\n\n  @state()\n  accessor tip = 'Text';\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-note-tool-button': EdgelessNoteToolButton;\n  }\n}\n"]}