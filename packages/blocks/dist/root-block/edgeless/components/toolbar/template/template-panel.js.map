{"version":3,"file":"template-panel.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/template/template-panel.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IBound } from '@blocksuite/global/utils';\n\nimport {\n  requestConnectedFrame,\n  stopPropagation,\n} from '@blocksuite/affine-shared/utils';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { Bound, getCommonBound } from '@blocksuite/global/utils';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, nothing, unsafeCSS } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { unsafeSVG } from 'lit/directives/unsafe-svg.js';\n\nimport type { EdgelessRootBlockComponent } from '../../../edgeless-root-block.js';\nimport type { TemplateJob } from '../../../services/template.js';\nimport type { Template } from './template-type.js';\n\nimport {\n  createInsertPlaceMiddleware,\n  createRegenerateIndexMiddleware,\n  createStickerMiddleware,\n  replaceIdMiddleware,\n} from '../../../services/template-middlewares.js';\nimport { EdgelessDraggableElementController } from '../common/draggable/draggable-element.controller.js';\nimport { builtInTemplates } from './builtin-templates.js';\nimport { ArrowIcon, defaultPreview } from './icon.js';\nimport './overlay-scrollbar.js';\nimport './template-loading.js';\nimport { cloneDeep } from './utils.js';\n\n@customElement('edgeless-templates-panel')\nexport class EdgelessTemplatePanel extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      position: absolute;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      z-index: 1;\n    }\n\n    .edgeless-templates-panel {\n      width: 467px;\n      height: 568px;\n      border-radius: 12px;\n      background-color: var(--affine-background-overlay-panel-color);\n      box-shadow: 0px 10px 80px 0px rgba(0, 0, 0, 0.2);\n\n      display: flex;\n      flex-direction: column;\n    }\n\n    .search-bar {\n      padding: 21px 24px;\n      font-size: 18px;\n      color: var(--affine-secondary);\n      border-bottom: 1px solid var(--affine-divider-color);\n\n      flex-shrink: 0;\n    }\n\n    .search-input {\n      border: 0;\n      color: var(--affine-text-primary-color);\n      font-size: 20px;\n      background-color: inherit;\n      outline: none;\n      width: 100%;\n    }\n\n    .search-input::placeholder {\n      color: var(--affine-text-secondary-color);\n    }\n\n    .template-categories {\n      display: flex;\n      padding: 6px 8px;\n      gap: 4px;\n      overflow-x: scroll;\n\n      flex-shrink: 0;\n    }\n\n    .category-entry {\n      color: var(--affine-text-primary-color);\n      font-size: 12px;\n      font-weight: 600;\n      line-height: 20px;\n      border-radius: 8px;\n      flex-shrink: 0;\n      flex-grow: 0;\n      width: fit-content;\n      padding: 4px 9px;\n      cursor: pointer;\n    }\n\n    .category-entry.selected,\n    .category-entry:hover {\n      color: var(--affine-text-primary-color);\n      background-color: var(--affine-background-tertiary-color);\n    }\n\n    .template-viewport {\n      position: relative;\n      flex-grow: 1;\n    }\n\n    .template-scrollcontent {\n      overflow: hidden;\n      height: 100%;\n      width: 100%;\n    }\n\n    .template-list {\n      padding: 10px;\n      display: flex;\n      align-items: flex-start;\n      align-content: flex-start;\n      gap: 10px 20px;\n      flex-wrap: wrap;\n    }\n\n    .template-item {\n      position: relative;\n      width: 135px;\n      height: 80px;\n      box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.02);\n      background-color: var(--affine-background-primary-color);\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .template-item > svg {\n      display: block;\n      margin: 0 auto;\n      width: 135px;\n      height: 80px;\n      color: var(--affine-background-primary-color);\n    }\n\n    /* .template-item:hover::before {\n      content: attr(data-hover-text);\n      position: absolute;\n      display: block;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n      width: 110px;\n      border-radius: 8px;\n      padding: 4px 22px;\n      box-sizing: border-box;\n      z-index: 1;\n      text-align: center;\n      font-size: 12px;\n\n      background-color: var(--affine-primary-color);\n      color: var(--affine-white);\n    } */\n\n    .template-item:hover::after {\n      content: '';\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      box-sizing: border-box;\n      border: 1px solid var(--affine-black-10);\n      border-radius: 4px;\n      background-color: var(--affine-hover-color);\n    }\n\n    .template-item.loading::before {\n      display: none;\n    }\n\n    .template-item.loading > affine-template-loading {\n      position: absolute;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n    }\n\n    .template-item img.template-preview {\n      object-fit: contain;\n      width: 100%;\n      height: 100%;\n      display: block;\n    }\n\n    .arrow {\n      bottom: 0;\n      position: absolute;\n      transform: translateY(20px);\n      color: var(--affine-background-overlay-panel-color);\n    }\n  `;\n\n  static templates = builtInTemplates;\n\n  private _fetchJob: null | { cancel: () => void } = null;\n\n  draggableController!: EdgelessDraggableElementController<Template>;\n\n  private _closePanel() {\n    if (this.isDragging) return;\n    this.dispatchEvent(new CustomEvent('closepanel'));\n  }\n\n  private _createTemplateJob(type: string, center: { x: number; y: number }) {\n    const middlewares: ((job: TemplateJob) => void)[] = [];\n    const service = this.edgeless.service;\n\n    if (type === 'template') {\n      const currentContentBound = getCommonBound(\n        (\n          service.blocks.map(block => Bound.deserialize(block.xywh)) as IBound[]\n        ).concat(service.elements)\n      );\n\n      if (currentContentBound) {\n        currentContentBound.x +=\n          currentContentBound.w + 20 / service.viewport.zoom;\n        middlewares.push(createInsertPlaceMiddleware(currentContentBound));\n      }\n\n      const idxGenerator = service.layer.createIndexGenerator(true);\n\n      middlewares.push(\n        createRegenerateIndexMiddleware((type: string) => idxGenerator(type))\n      );\n    }\n\n    if (type === 'sticker') {\n      middlewares.push(\n        createStickerMiddleware(center, () =>\n          service.layer.generateIndex('affine:image')\n        )\n      );\n    }\n\n    middlewares.push(replaceIdMiddleware);\n\n    return this.edgeless.service.TemplateJob.create({\n      model: this.edgeless.surfaceBlockModel,\n      type,\n      middlewares,\n    });\n  }\n\n  private _fetch(fn: (state: { canceled: boolean }) => Promise<unknown>) {\n    if (this._fetchJob) {\n      this._fetchJob.cancel();\n    }\n\n    this._loading = true;\n\n    const state = { canceled: false };\n    const job = {\n      cancel: () => {\n        state.canceled = true;\n      },\n    };\n\n    this._fetchJob = job;\n\n    fn(state)\n      .catch(() => {})\n      .finally(() => {\n        if (!state.canceled && job === this._fetchJob) {\n          this._loading = false;\n          this._fetchJob = null;\n        }\n      });\n  }\n\n  private _getLocalSelectedCategory() {\n    return this.edgeless.service.editPropsStore.getStorage('templateCache');\n  }\n\n  private async _initCategory() {\n    try {\n      this._categories = await EdgelessTemplatePanel.templates.categories();\n      this._currentCategory =\n        this._getLocalSelectedCategory() ?? this._categories[0];\n      this._updateTemplates();\n    } catch (e) {\n      console.error('Failed to load categories', e);\n    }\n  }\n\n  private _initDragController() {\n    if (this.draggableController) return;\n    this.draggableController = new EdgelessDraggableElementController(this, {\n      service: this.edgeless.service,\n      edgeless: this.edgeless,\n      clickToDrag: true,\n      standardWidth: 560,\n      onOverlayCreated: overlay => {\n        this.isDragging = true;\n        overlay.mask.style.color = 'transparent';\n      },\n      onDrop: (el, bound) => {\n        this._insertTemplate(el.data, bound)\n          .finally(() => {\n            this.isDragging = false;\n          })\n          .catch(console.error);\n      },\n      onCanceled: () => {\n        this.isDragging = false;\n      },\n    });\n  }\n\n  private async _insertTemplate(template: Template, bound: Bound) {\n    this._loadingTemplate = template;\n\n    template = cloneDeep(template);\n\n    const center = {\n      x: bound.x + bound.w / 2,\n      y: bound.y + bound.h / 2,\n    };\n    const templateJob = this._createTemplateJob(template.type, center);\n    const service = this.edgeless.service;\n\n    try {\n      const { assets } = template;\n\n      if (assets) {\n        await Promise.all(\n          Object.entries(assets).map(([key, value]) =>\n            fetch(value)\n              .then(res => res.blob())\n              .then(blob => templateJob.job.assets.set(key, blob))\n          )\n        );\n      }\n\n      const insertedBound = await templateJob.insertTemplate(template.content);\n\n      if (insertedBound && template.type === 'template') {\n        const padding = 20 / service.viewport.zoom;\n        service.viewport.setViewportByBound(\n          insertedBound,\n          [padding, padding, padding, padding],\n          true\n        );\n      }\n    } finally {\n      this._loadingTemplate = null;\n      this.edgeless.service.tool.setEdgelessTool({ type: 'default' });\n    }\n  }\n\n  private _updateSearchKeyword(inputEvt: InputEvent) {\n    this._searchKeyword = (inputEvt.target as HTMLInputElement).value;\n    this._updateTemplates();\n  }\n\n  private _updateTemplates() {\n    this._fetch(async state => {\n      try {\n        const templates = this._searchKeyword\n          ? await EdgelessTemplatePanel.templates.search(this._searchKeyword)\n          : await EdgelessTemplatePanel.templates.list(this._currentCategory);\n\n        if (state.canceled) return;\n\n        this._templates = templates;\n      } catch (e) {\n        if (state.canceled) return;\n\n        console.error('Failed to load templates', e);\n      }\n    });\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    this._initDragController();\n\n    this.addEventListener('keydown', stopPropagation, false);\n    this._disposables.add(() => {\n      if (this._currentCategory) {\n        this.edgeless.service.editPropsStore.setStorage(\n          'templateCache',\n          this._currentCategory\n        );\n      }\n    });\n  }\n\n  override firstUpdated() {\n    requestConnectedFrame(() => {\n      this._disposables.addFromEvent(document, 'click', evt => {\n        if (this.contains(evt.target as HTMLElement)) {\n          return;\n        }\n\n        this._closePanel();\n      });\n    }, this);\n    this._disposables.addFromEvent(this, 'click', stopPropagation);\n    this._disposables.addFromEvent(this, 'wheel', stopPropagation);\n\n    this._initCategory().catch(() => {});\n  }\n\n  override render() {\n    const { _categories, _currentCategory, _templates } = this;\n    const { draggingElement } = this.draggableController?.states || {};\n\n    return html`\n      <div\n        class=\"edgeless-templates-panel\"\n        style=${styleMap({\n          opacity: this.isDragging ? '0' : '1',\n          transition: 'opacity 0.2s',\n        })}\n      >\n        <div class=\"search-bar\">\n          <input\n            class=\"search-input\"\n            type=\"text\"\n            placeholder=\"Search file or anything...\"\n            @input=${this._updateSearchKeyword}\n            @cut=${stopPropagation}\n            @copy=${stopPropagation}\n            @paste=${stopPropagation}\n          />\n        </div>\n        <div class=\"template-categories\">\n          ${repeat(\n            _categories,\n            cate => cate,\n            cate => {\n              return html`<div\n                class=\"category-entry ${_currentCategory === cate\n                  ? 'selected'\n                  : ''}\"\n                @click=${() => {\n                  this._currentCategory = cate;\n                  this._updateTemplates();\n                }}\n              >\n                ${cate}\n              </div>`;\n            }\n          )}\n        </div>\n        <div class=\"template-viewport\">\n          <div class=\"template-scrollcontent\" data-scrollable>\n            <div class=\"template-list\">\n              ${this._loading\n                ? html`<affine-template-loading\n                    style=${styleMap({\n                      position: 'absolute',\n                      left: '50%',\n                      top: '50%',\n                    })}\n                  ></affine-template-loading>`\n                : repeat(\n                    _templates,\n                    template => template.name,\n                    template => {\n                      const preview = template.preview\n                        ? template.preview.startsWith('<svg')\n                          ? html`${unsafeSVG(template.preview)}`\n                          : html`<img\n                              src=\"${template.preview}\"\n                              class=\"template-preview\"\n                            />`\n                        : defaultPreview;\n\n                      const isBeingDragged =\n                        draggingElement &&\n                        draggingElement.data.name === template.name;\n                      return html`\n                        <div\n                          class=${`template-item ${\n                            template === this._loadingTemplate ? 'loading' : ''\n                          }`}\n                          style=${styleMap({\n                            opacity: isBeingDragged ? '0' : '1',\n                          })}\n                          data-hover-text=\"Add\"\n                          @mousedown=${(e: MouseEvent) =>\n                            this.draggableController.onMouseDown(e, {\n                              data: template,\n                              preview,\n                            })}\n                          @touchstart=${(e: TouchEvent) => {\n                            this.draggableController.onTouchStart(e, {\n                              data: template,\n                              preview,\n                            });\n                          }}\n                        >\n                          ${preview}\n                          ${template === this._loadingTemplate\n                            ? html`<affine-template-loading></affine-template-loading>`\n                            : nothing}\n                          ${template.name\n                            ? html`<affine-tooltip\n                                .offset=${12}\n                                tip-position=\"top\"\n                              >\n                                ${template.name}\n                              </affine-tooltip>`\n                            : nothing}\n                        </div>\n                      `;\n                    }\n                  )}\n            </div>\n          </div>\n          <overlay-scrollbar></overlay-scrollbar>\n        </div>\n        <div class=\"arrow\">${ArrowIcon}</div>\n      </div>\n    `;\n  }\n\n  @state()\n  private accessor _categories: string[] = [];\n\n  @state()\n  private accessor _currentCategory = '';\n\n  @state()\n  private accessor _loading = false;\n\n  @state()\n  private accessor _loadingTemplate: Template | null = null;\n\n  @state()\n  private accessor _searchKeyword = '';\n\n  @state()\n  private accessor _templates: Template[] = [];\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @state()\n  accessor isDragging = false;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-templates-panel': EdgelessTemplatePanel;\n  }\n}\n"]}