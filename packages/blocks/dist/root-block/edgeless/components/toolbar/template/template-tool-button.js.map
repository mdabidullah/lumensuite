{"version":3,"file":"template-tool-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/template/template-tool-button.ts"],"names":[],"mappings":"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","sourcesContent":["import { ArrowDownSmallIcon } from '@blocksuite/affine-components/icons';\nimport { once } from '@blocksuite/affine-shared/utils';\nimport {\n  arrow,\n  autoUpdate,\n  computePosition,\n  offset,\n  shift,\n} from '@floating-ui/dom';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { EdgelessTool } from '../../../types.js';\nimport type { EdgelessTemplatePanel } from './template-panel.js';\n\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\nimport { TemplateCard1, TemplateCard2, TemplateCard3 } from './icon.js';\nimport './template-panel.js';\n\n@customElement('edgeless-template-button')\nexport class EdgelessTemplateButton extends EdgelessToolbarToolMixin(\n  LitElement\n) {\n  static override styles = css`\n    :host {\n      position: relative;\n      width: 100%;\n      height: 100%;\n    }\n\n    edgeless-template-button {\n      cursor: pointer;\n    }\n\n    .template-cards {\n      width: 100%;\n      height: 64px;\n      overflow: hidden;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      position: relative;\n    }\n    .template-card,\n    .arrow-icon {\n      --x: 0;\n      --y: 0;\n      --r: 0;\n      --s: 1;\n      position: absolute;\n      transform: translate(var(--x), var(--y)) rotate(var(--r)) scale(var(--s));\n      transition: all 0.3s ease;\n    }\n\n    .arrow-icon {\n      --y: 17px;\n      background: var(--affine-black-10);\n      width: 24px;\n      height: 24px;\n      border-radius: 50%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .arrow-icon > svg {\n      color: var(--affine-icon-color);\n      fill: currentColor;\n      width: 20px;\n      height: 20px;\n    }\n\n    .template-card.card1 {\n      transform-origin: 100% 50%;\n      --x: 15px;\n      --y: 8px;\n    }\n    .template-card.card2 {\n      transform-origin: 0% 50%;\n      --x: -17px;\n    }\n    .template-card.card3 {\n      --y: 27px;\n    }\n\n    /* hover */\n    .template-cards:not(.expanded):hover .card1 {\n      --r: 8.69deg;\n    }\n    .template-cards:not(.expanded):hover .card2 {\n      --r: -10.93deg;\n    }\n    .template-cards:not(.expanded):hover .card3 {\n      --y: 22px;\n      --r: 5.19deg;\n    }\n\n    /* expanded */\n    .template-cards.expanded .card1 {\n      --x: 17px;\n      --y: -5px;\n      --r: 8.69deg;\n      --s: 0.64;\n    }\n    .template-cards.expanded .card2 {\n      --x: -19px;\n      --y: -6px;\n      --r: -10.93deg;\n      --s: 0.64;\n    }\n    .template-cards.expanded .card3 {\n      --y: -10px;\n      --s: 0.599;\n      --r: 5.19deg;\n    }\n  `;\n\n  private _cleanup: (() => void) | null = null;\n\n  private _prevTool: EdgelessTool | null = null;\n\n  override enableActiveBackground = true;\n\n  override type: EdgelessTool['type'] = 'template';\n\n  get cards() {\n    const { theme } = this;\n    return [TemplateCard1[theme], TemplateCard2[theme], TemplateCard3[theme]];\n  }\n\n  private _closePanel() {\n    if (this._openedPanel) {\n      this._openedPanel.remove();\n      this._openedPanel = null;\n      this._cleanup?.();\n      this._cleanup = null;\n      this.requestUpdate();\n\n      if (this._prevTool && this._prevTool.type !== 'template') {\n        this.setEdgelessTool(this._prevTool);\n        this._prevTool = null;\n      } else {\n        this.setEdgelessTool({ type: 'default' });\n      }\n    }\n  }\n\n  private _togglePanel() {\n    if (this._openedPanel) {\n      this._closePanel();\n      if (this._prevTool) {\n        this.setEdgelessTool(this._prevTool);\n        this._prevTool = null;\n      }\n      return;\n    }\n\n    this._prevTool = this.edgelessTool ? { ...this.edgelessTool } : null;\n\n    this.setEdgelessTool({ type: 'template' });\n\n    const panel = document.createElement('edgeless-templates-panel');\n    panel.edgeless = this.edgeless;\n\n    this._cleanup = once(panel, 'closepanel', () => {\n      this._closePanel();\n    });\n    this._openedPanel = panel;\n\n    this.renderRoot.append(panel);\n\n    requestAnimationFrame(() => {\n      const arrowEl = panel.renderRoot.querySelector('.arrow') as HTMLElement;\n\n      autoUpdate(this, panel, () => {\n        computePosition(this, panel, {\n          placement: 'top',\n          middleware: [offset(20), arrow({ element: arrowEl }), shift()],\n        })\n          .then(({ x, y, middlewareData }) => {\n            panel.style.left = `${x}px`;\n            panel.style.top = `${y}px`;\n\n            arrowEl.style.left = `${\n              (middlewareData.arrow?.x ?? 0) - (middlewareData.shift?.x ?? 0)\n            }px`;\n          })\n          .catch(e => {\n            console.warn(\"Can't compute position\", e);\n          });\n      });\n    });\n  }\n\n  override render() {\n    const { cards, _openedPanel } = this;\n    const expanded = _openedPanel !== null;\n\n    return html`<edgeless-toolbar-button @click=${this._togglePanel}>\n      <div class=\"template-cards ${expanded ? 'expanded' : ''}\">\n        <div class=\"arrow-icon\">${ArrowDownSmallIcon}</div>\n        ${repeat(\n          cards,\n          (card, n) => html`\n            <div\n              class=${classMap({\n                'template-card': true,\n                [`card${n + 1}`]: true,\n              })}\n            >\n              ${card}\n            </div>\n          `\n        )}\n      </div>\n    </edgeless-toolbar-button>`;\n  }\n\n  @state()\n  private accessor _openedPanel: EdgelessTemplatePanel | null = null;\n}\n"]}