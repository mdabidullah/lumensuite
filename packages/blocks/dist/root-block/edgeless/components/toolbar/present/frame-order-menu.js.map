{"version":3,"file":"frame-order-menu.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/present/frame-order-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import type { FrameBlockModel } from '@lumensuite/affine-model';\n\nimport { CommonUtils } from '@lumensuite/affine-block-surface';\nimport { WithDisposable } from '@lumensuite/block-std';\nimport { DisposableGroup } from '@lumensuite/global/utils';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { EdgelessRootBlockComponent } from '../../../edgeless-root-block.js';\n\n@customElement('edgeless-frame-order-menu')\nexport class EdgelessFrameOrderMenu extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      position: relative;\n    }\n    .edgeless-frame-order-items-container {\n      max-height: 281px;\n      border-radius: 8px;\n      padding: 8px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-menu-shadow);\n      overflow: auto;\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n    }\n    .edgeless-frame-order-items-container.embed {\n      padding: 0;\n      background: unset;\n      box-shadow: unset;\n      border-radius: 0;\n    }\n\n    .item {\n      box-sizing: border-box;\n      width: 256px;\n      border-radius: 4px;\n      padding: 4px;\n      display: flex;\n      gap: 4px;\n      align-items: center;\n      cursor: grab;\n    }\n\n    .draggable:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .item:hover .drag-indicator {\n      opacity: 1;\n    }\n\n    .drag-indicator {\n      cursor: pointer;\n      width: 4px;\n      height: 12px;\n      border-radius: 1px;\n      opacity: 0.2;\n      background: var(--affine-placeholder-color);\n      margin-right: 2px;\n    }\n\n    .title {\n      font-size: 14px;\n      font-weight: 400;\n      height: 22px;\n      line-height: 22px;\n      color: var(--affine-text-primary-color);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .clone {\n      visibility: hidden;\n      position: absolute;\n      z-index: 1;\n      left: 8px;\n      height: 30px;\n      border: 1px solid var(--affine-border-color);\n      box-shadow: var(--affine-menu-shadow);\n      background-color: var(--affine-white);\n      pointer-events: none;\n    }\n\n    .indicator-line {\n      visibility: hidden;\n      position: absolute;\n      z-index: 1;\n      left: 8px;\n      background-color: var(--affine-primary-color);\n      height: 1px;\n      width: 90%;\n    }\n  `;\n\n  private _bindEvent() {\n    const { _disposables } = this;\n\n    _disposables.addFromEvent(this._container, 'wheel', e => {\n      e.stopPropagation();\n    });\n\n    _disposables.addFromEvent(this._container, 'pointerdown', e => {\n      const ele = e.target as HTMLElement;\n      const draggable = ele.closest('.draggable');\n      if (!draggable) return;\n      const clone = this._clone;\n      const indicatorLine = this._indicatorLine;\n      clone.style.visibility = 'visible';\n\n      const rect = draggable.getBoundingClientRect();\n\n      const index = Number(draggable.getAttribute('index'));\n      this._curIndex = index;\n      let newIndex = -1;\n\n      const containerRect = this._container.getBoundingClientRect();\n      const start = containerRect.top + 8;\n      const end = containerRect.bottom;\n\n      const shiftX = e.clientX - rect.left;\n      const shiftY = e.clientY - rect.top;\n      function moveAt(x: number, y: number) {\n        clone.style.left = x - containerRect.left - shiftX + 'px';\n        clone.style.top = y - containerRect.top - shiftY + 'px';\n      }\n\n      function isInsideContainer(e: PointerEvent) {\n        return e.clientY >= start && e.clientY <= end;\n      }\n      moveAt(e.clientX, e.clientY);\n\n      this._disposables.addFromEvent(document, 'pointermove', e => {\n        indicatorLine.style.visibility = 'visible';\n        moveAt(e.clientX, e.clientY);\n        if (isInsideContainer(e)) {\n          const relativeY = e.pageY + this._container.scrollTop - start;\n          let top = 0;\n          if (relativeY < rect.height / 2) {\n            newIndex = 0;\n            top = this.embed ? -2 : 4;\n          } else {\n            newIndex = Math.ceil(\n              (relativeY - rect.height / 2) / (rect.height + 10)\n            );\n            top =\n              (this.embed ? -2 : 7.5) +\n              newIndex * rect.height +\n              (newIndex - 0.5) * 4;\n          }\n\n          indicatorLine.style.top = top - this._container.scrollTop + 'px';\n          return;\n        }\n        newIndex = -1;\n      });\n\n      this._disposables.addFromEvent(document, 'pointerup', () => {\n        clone.style.visibility = 'hidden';\n        indicatorLine.style.visibility = 'hidden';\n        if (\n          newIndex >= 0 &&\n          newIndex <= this.frames.length &&\n          newIndex !== index &&\n          newIndex !== index + 1\n        ) {\n          const before = this.frames[newIndex - 1]?.index || null;\n          const after = this.frames[newIndex]?.index || null;\n\n          const frame = this.frames[index];\n\n          this.edgeless.service.updateElement(frame.id, {\n            index: CommonUtils.generateKeyBetween(before, after),\n          });\n          this.edgeless.doc.captureSync();\n\n          this.requestUpdate();\n        }\n        this._disposables.dispose();\n        this._disposables = new DisposableGroup();\n        this._bindEvent();\n      });\n    });\n  }\n\n  override firstUpdated() {\n    this._bindEvent();\n  }\n\n  override render() {\n    const frame = this.frames[this._curIndex];\n\n    return html`\n      <div\n        class=\"edgeless-frame-order-items-container ${this.embed\n          ? 'embed'\n          : ''}\"\n        @click=${(e: MouseEvent) => e.stopPropagation()}\n      >\n        ${repeat(\n          this.frames,\n          frame => frame.id,\n          (frame, index) => html`\n            <div class=\"item draggable\" id=${frame.id} index=${index}>\n              <div class=\"drag-indicator\"></div>\n              <div class=\"title\">${frame.title.toString()}</div>\n            </div>\n          `\n        )}\n        <div class=\"indicator-line\"></div>\n        <div class=\"clone item\">\n          ${frame\n            ? html`<div class=\"drag-indicator\"></div>\n                <div class=\"index\">${this._curIndex + 1}</div>\n                <div class=\"title\">${frame.title.toString()}</div>`\n            : nothing}\n        </div>\n      </div>\n    `;\n  }\n\n  @query('.clone')\n  private accessor _clone!: HTMLDivElement;\n\n  @query('.edgeless-frame-order-items-container')\n  private accessor _container!: HTMLDivElement;\n\n  @state()\n  private accessor _curIndex = -1;\n\n  @query('.indicator-line')\n  private accessor _indicatorLine!: HTMLDivElement;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor embed = false;\n\n  @property({ attribute: false })\n  accessor frames!: FrameBlockModel[];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-frame-order-menu': EdgelessFrameOrderMenu;\n  }\n}\n"]}