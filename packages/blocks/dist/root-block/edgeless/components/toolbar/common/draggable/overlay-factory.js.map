{"version":3,"file":"overlay-factory.js","sourceRoot":"","sources":["../../../../../../../src/root-block/edgeless/components/toolbar/common/draggable/overlay-factory.ts"],"names":[],"mappings":"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","sourcesContent":["import { render } from 'lit';\n\nimport type { ElementInfo, OverlayLayer } from './types.js';\n\nexport type DraggingInfo<T> = {\n  startPos: { x: number; y: number };\n  offsetPos: { x: number; y: number };\n  startTime: number;\n  scopeRect: DOMRect | null;\n  edgelessRect: DOMRect;\n  elementRectOriginal: DOMRect;\n  element: HTMLElement;\n  elementInfo: ElementInfo<T>;\n  parentToMount: HTMLElement;\n  moved: boolean;\n  validMoved: boolean;\n};\n\nexport const defaultInfo = {\n  startPos: { x: 0, y: 0 },\n  offsetPos: { x: 0, y: 0 },\n  startTime: 0,\n  scopeRect: {} as DOMRect,\n  edgelessRect: {} as DOMRect,\n  elementRectOriginal: {} as DOMRect,\n  element: null as unknown as HTMLElement,\n  elementInfo: null as unknown as ElementInfo<unknown>,\n  parentToMount: null as unknown as HTMLElement,\n  moved: false,\n  validMoved: false,\n} satisfies DraggingInfo<unknown>;\n\nconst className = (name: string) =>\n  `edgeless-draggable-control-overlay-${name}`;\nconst addClass = (node: HTMLElement, name: string) =>\n  node.classList.add(className(name));\n\nexport const createShapeDraggingOverlay = <T>(\n  info: DraggingInfo<T>\n): OverlayLayer => {\n  const { edgelessRect, parentToMount, element: originalElement } = info;\n  const elementStyle = getComputedStyle(originalElement);\n  const mask = document.createElement('div');\n  addClass(mask, 'mask');\n  Object.assign(mask.style, {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    width: edgelessRect.width + 'px',\n    height: edgelessRect.height + 'px',\n    overflow: 'hidden',\n    zIndex: '9999',\n\n    // for debug purpose\n    // background: 'rgba(255, 0, 0, 0.1)',\n  });\n\n  const element = document.createElement('div');\n  addClass(element, 'element');\n  const transitionWrapper = document.createElement('div');\n  addClass(transitionWrapper, 'transition-wrapper');\n  Object.assign(transitionWrapper.style, {\n    transition: 'all 0.18s ease',\n    transform: 'scale(var(--scale, 1)) rotate(var(--rotate, 0deg))',\n    width: elementStyle.width,\n    height: elementStyle.height,\n  });\n  transitionWrapper.style.setProperty('--rotate', '0deg');\n  transitionWrapper.style.setProperty('--scale', '1');\n\n  render(info.elementInfo.preview, transitionWrapper);\n\n  Object.assign(element.style, {\n    transform:\n      'translate(var(--translate-x, 0), var(--translate-y, 0)) rotate(var(--rotate, 0deg)) scale(var(--scale, 1))',\n    position: 'absolute',\n    cursor: 'grabbing',\n    transition: 'inherit',\n  });\n\n  const styleTag = document.createElement('style');\n  styleTag.textContent = `\n    .${className('transition-wrapper')} > * {\n      display: block;\n      width: 100%;\n      height: 100%;\n    }\n  `;\n  mask.append(styleTag);\n\n  element.append(transitionWrapper);\n  mask.append(element);\n  parentToMount.append(mask);\n\n  return { mask, element, transitionWrapper };\n};\n"]}