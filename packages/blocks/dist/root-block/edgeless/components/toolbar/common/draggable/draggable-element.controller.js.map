{"version":3,"file":"draggable-element.controller.js","sourceRoot":"","sources":["../../../../../../../src/root-block/edgeless/components/toolbar/common/draggable/draggable-element.controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { assertExists, Bound } from '@blocksuite/global/utils';\nimport {\n  type ReactiveController,\n  type ReactiveControllerHost,\n  render,\n} from 'lit';\n\nimport {\n  type ElementDragEvent,\n  mouseResolver,\n  touchResolver,\n} from './event-resolver.js';\nimport {\n  createShapeDraggingOverlay,\n  defaultInfo,\n  type DraggingInfo,\n} from './overlay-factory.js';\nimport {\n  defaultIsValidMove,\n  type EdgelessDraggableElementHost,\n  type EdgelessDraggableElementOptions,\n  type ElementInfo,\n  type OverlayLayer,\n} from './types.js';\n\ninterface ReactiveState<T> {\n  cancelled: boolean;\n  draggingElement: ElementInfo<T> | null;\n  dragOut: boolean | null;\n}\ninterface EventCache {\n  onMouseUp?: (e: MouseEvent) => void;\n  onMouseMove?: (e: MouseEvent) => void;\n  onTouchMove?: (e: TouchEvent) => void;\n  onTouchEnd?: (e: TouchEvent) => void;\n}\n\nexport class EdgelessDraggableElementController<T>\n  implements ReactiveController\n{\n  clearTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  events: EventCache = {};\n\n  info = defaultInfo as DraggingInfo<T>;\n\n  overlay: OverlayLayer | null = null;\n\n  states: ReactiveState<T> = {\n    cancelled: false,\n    draggingElement: null,\n    dragOut: null,\n  };\n\n  constructor(\n    public host: EdgelessDraggableElementHost & ReactiveControllerHost,\n    public options: EdgelessDraggableElementOptions<T>\n  ) {\n    this.host = host;\n    host.addController(this);\n  }\n\n  /**\n   * let overlay shape animate back to the original position\n   */\n  private _animateCancelDrop(onFinished?: () => void, duration = 230) {\n    const { overlay, info } = this;\n    if (!overlay) return;\n    this.options?.onCanceled?.(overlay, info.elementInfo);\n    // unlock pointer events\n    overlay.mask.style.pointerEvents = 'none';\n    // clip bottom\n    if (info.scopeRect) {\n      overlay.mask.style.height =\n        info.scopeRect.bottom - info.edgelessRect.top + 'px';\n    }\n\n    const { element, elementRectOriginal } = info;\n\n    const newShapeRect = element.getBoundingClientRect();\n    const x = newShapeRect.left - elementRectOriginal.left;\n    const y = newShapeRect.top - elementRectOriginal.top;\n\n    // apply a transition\n    overlay.element.style.transition = `transform ${duration}ms ease`;\n    overlay.element.style.setProperty('--translate-x', `${x}px`);\n    overlay.element.style.setProperty('--translate-y', `${y}px`);\n    overlay.transitionWrapper.style.setProperty('--scale', '1');\n\n    this.clearTimeout = setTimeout(() => {\n      if (onFinished) return onFinished();\n      this.reset();\n      this.removeAllEvents();\n      this.clearTimeout = null;\n    }, duration);\n  }\n\n  private _createOverlay({ x, y }: Pick<ElementDragEvent, 'x' | 'y'>) {\n    const { info } = this;\n    const { elementInfo, elementRectOriginal, offsetPos, edgelessRect } = info;\n\n    this.reset();\n    this._updateState('draggingElement', elementInfo);\n    this.overlay = createShapeDraggingOverlay(info);\n\n    const { overlay } = this;\n    // init shape position with 'left' and 'top';\n    const { width, height, left, top } = elementRectOriginal;\n    const relativeX = left - edgelessRect.left;\n    const relativeY = top - edgelessRect.top;\n    // make sure the transform origin is the same as the mouse position\n    const ox = `${(((x - left) / width) * 100).toFixed(0)}%`;\n    const oy = `${(((y - top) / height) * 100).toFixed(0)}%`;\n    Object.assign(overlay.element.style, {\n      left: `${relativeX}px`,\n      top: `${relativeY}px`,\n    });\n    overlay.element.style.setProperty('--translate-x', `${offsetPos.x}px`);\n    overlay.element.style.setProperty('--translate-y', `${offsetPos.y}px`);\n    overlay.transitionWrapper.style.transformOrigin = `${ox} ${oy}`;\n\n    // lifecycle hook\n    this.options.onOverlayCreated?.(overlay, elementInfo);\n  }\n\n  private _onDragEnd() {\n    const { overlay, info, options } = this;\n    const { startTime, elementInfo, edgelessRect, validMoved } = info;\n    const { service, clickThreshold = 1500 } = options;\n    const zoom = service.viewport.zoom;\n\n    if (!validMoved) {\n      const duration = Date.now() - startTime;\n      if (duration < clickThreshold) {\n        options.onElementClick?.(info.elementInfo);\n        if (options.clickToDrag) {\n          this._createOverlay(info.startPos);\n          this.info.moved = true;\n          setTimeout(() => {\n            this._updateOverlayScale(zoom);\n          }, 50);\n          return false;\n        }\n      }\n      this.reset();\n      return true;\n    }\n\n    if (this.states.dragOut && !this.states.cancelled && overlay) {\n      const rect = overlay.transitionWrapper.getBoundingClientRect();\n      const [modelX, modelY] = this.options.service.viewport.toModelCoord(\n        rect.left - edgelessRect.left,\n        rect.top - edgelessRect.top\n      );\n      const bound = new Bound(\n        modelX,\n        modelY,\n        rect.width / zoom,\n        rect.height / zoom\n      );\n      options?.onDrop?.(elementInfo, bound);\n\n      this.reset();\n      return true;\n    }\n\n    if (!this.states.dragOut) this._animateCancelDrop();\n\n    return true;\n  }\n\n  private _onDragMove(e: ElementDragEvent) {\n    if (this.states.cancelled) return;\n    const { info, options } = this;\n\n    // first move\n    if (!info.moved) {\n      info.moved = true;\n      this._createOverlay(e);\n    }\n\n    const { overlay } = this;\n    assertExists(overlay);\n\n    const { x, y } = e;\n    const { startPos, scopeRect } = info;\n    const offsetX = x - startPos.x;\n    const offsetY = y - startPos.y;\n    info.offsetPos = { x: offsetX, y: offsetY };\n\n    if (!info.validMoved) {\n      const isValidMove = options.isValidMove ?? defaultIsValidMove;\n      info.validMoved = isValidMove(info.offsetPos);\n    }\n\n    // check if inside scopeElement\n    const newDragOut =\n      !scopeRect ||\n      y < scopeRect.top ||\n      y > scopeRect.bottom ||\n      x < scopeRect.left ||\n      x > scopeRect.right;\n    if (newDragOut !== this.states.dragOut)\n      options.onEnterOrLeaveScope?.(overlay, newDragOut);\n    this._updateState('dragOut', newDragOut);\n\n    // apply transform\n    // - move shape with translate\n    overlay.element.style.setProperty('--translate-x', `${offsetX}px`);\n    overlay.element.style.setProperty('--translate-y', `${offsetY}px`);\n    // - scale shape with scale\n    const zoom = options.service.viewport.zoom;\n    this._updateOverlayScale(zoom);\n  }\n\n  private _onDragStart(e: ElementDragEvent, elementInfo: ElementInfo<T>) {\n    const { scopeElement, edgeless } = this.options;\n    e.originalEvent.stopPropagation();\n    e.originalEvent.preventDefault();\n\n    // Safari compatibility\n    // Cannot get edgeless.host.getBoundingClientRect().width in Safari (Always 0)\n    const edgelessRect = edgeless.host.getBoundingClientRect();\n    if (edgelessRect.width === 0) {\n      edgelessRect.width = edgeless.viewport.clientWidth;\n    }\n\n    this.info = {\n      startTime: Date.now(),\n      startPos: { x: e.x, y: e.y },\n      offsetPos: { x: 0, y: 0 },\n      scopeRect: scopeElement?.getBoundingClientRect() ?? null,\n      edgelessRect,\n      elementRectOriginal: e.el.getBoundingClientRect(),\n      element: e.el,\n      elementInfo,\n      moved: false,\n      validMoved: false,\n      parentToMount: edgeless.host,\n    };\n\n    this.removeAllEvents();\n    if (e.inputType === 'mouse') {\n      const onMouseMove = (e: MouseEvent) => {\n        this._onDragMove(mouseResolver(e));\n      };\n      const onMouseUp = (_: MouseEvent) => {\n        const finished = this._onDragEnd();\n        if (finished) {\n          edgeless.host.removeEventListener('mousemove', onMouseMove);\n          window.removeEventListener('mouseup', onMouseUp);\n        }\n      };\n      edgeless.host.addEventListener('mousemove', onMouseMove);\n      window.addEventListener('mouseup', onMouseUp);\n      this.events = { onMouseMove, onMouseUp };\n    } else {\n      const onTouchMove = (e: TouchEvent) => {\n        this._onDragMove(touchResolver(e));\n      };\n      const onTouchEnd = (_: TouchEvent) => {\n        const finished = this._onDragEnd();\n        if (finished) {\n          edgeless.host.removeEventListener('touchmove', onTouchMove);\n          window.removeEventListener('touchend', onTouchEnd);\n        }\n      };\n      edgeless.host.addEventListener('touchmove', onTouchMove);\n      window.addEventListener('touchend', onTouchEnd);\n      this.events = { onTouchMove, onTouchEnd };\n    }\n  }\n\n  /**\n   * Update overlay shape scale according to the current zoom level\n   */\n  private _updateOverlayScale(zoom: number) {\n    const transitionWrapper = this.overlay?.transitionWrapper;\n    if (!transitionWrapper) return;\n\n    const standardWidth =\n      this.info.elementInfo.standardWidth ?? this.options.standardWidth ?? 100;\n\n    const { elementRectOriginal } = this.info;\n    const scale = (standardWidth * zoom) / elementRectOriginal.width;\n\n    const clickToDragScale = this.options.clickToDragScale ?? 1.2;\n\n    const finalScale = this.states.dragOut\n      ? scale\n      : this.options.clickToDrag\n        ? clickToDragScale\n        : 1;\n    transitionWrapper.style.setProperty('--scale', finalScale.toFixed(2));\n  }\n\n  /**\n   * @internal\n   */\n  private _updateState<Key extends keyof ReactiveState<T>>(\n    key: Key,\n    value: ReactiveState<T>[Key]\n  ) {\n    this.states[key] = value;\n    this.host.requestUpdate();\n  }\n\n  private _updateStates(states: Partial<ReactiveState<T>>) {\n    Object.assign(this.states, states);\n    this.host.requestUpdate();\n  }\n\n  /**\n   * Cancel the current dragging & animate even if dragOut\n   */\n  cancel() {\n    if (this.states.cancelled) return;\n    this._updateState('cancelled', true);\n    this._animateCancelDrop();\n  }\n\n  /**\n   * Same as {@link cancel} but without animation\n   */\n  cancelWithoutAnimation() {\n    if (this.states.cancelled) return;\n    this._updateState('cancelled', true);\n    this.reset();\n    this.removeAllEvents();\n  }\n\n  /**\n   * A workaround to apply click event manually\n   */\n  clickToDrag(target: HTMLElement, startPos: { x: number; y: number }) {\n    if (!this.options.clickToDrag) {\n      this.options.clickToDrag = true;\n      console.warn(\n        'clickToDrag is not enabled, it will be enabled automatically'\n      );\n    }\n    const targetRect = target.getBoundingClientRect();\n    const targetCenter = {\n      x: targetRect.left + targetRect.width / 2,\n      y: targetRect.top + targetRect.height / 2,\n    };\n\n    const mouseDownEvent = new MouseEvent('mousedown', {\n      clientX: targetCenter.x,\n      clientY: targetCenter.y,\n    });\n    const mouseUpEvent = new MouseEvent('mouseup', {\n      clientX: targetCenter.x,\n      clientY: targetCenter.y,\n    });\n    target.dispatchEvent(mouseDownEvent);\n    window.dispatchEvent(mouseUpEvent);\n\n    const mouseMoveEvent = new MouseEvent('mousemove', {\n      clientX: startPos.x,\n      clientY: startPos.y,\n    });\n\n    this.options.edgeless.host.dispatchEvent(mouseMoveEvent);\n  }\n\n  hostConnected() {\n    this.host.disposables.add(\n      this.options.service.viewport.viewportUpdated.on(({ zoom }) => {\n        this._updateOverlayScale(zoom);\n      })\n    );\n\n    this.host.disposables.addFromEvent(\n      window,\n      'keydown',\n      (e: KeyboardEvent) => {\n        if (e.key === 'Escape' && this.states.draggingElement) this.cancel();\n      }\n    );\n  }\n\n  hostDisconnected() {\n    this.removeAllEvents();\n    this.reset();\n  }\n\n  onMouseDown(e: MouseEvent, elementInfo: ElementInfo<T>) {\n    this._onDragStart(mouseResolver(e), elementInfo);\n  }\n\n  onTouchStart(e: TouchEvent, elementInfo: ElementInfo<T>) {\n    this._onDragStart(touchResolver(e), elementInfo);\n  }\n\n  removeAllEvents() {\n    const { events, options } = this;\n    const host = options.edgeless.host;\n    const { onMouseUp, onMouseMove, onTouchMove, onTouchEnd } = events;\n    onMouseUp && window.removeEventListener('mouseup', onMouseUp);\n    onMouseMove && host.removeEventListener('mousemove', onMouseMove);\n    onTouchMove && host.removeEventListener('touchmove', onTouchMove);\n    onTouchEnd && window.removeEventListener('touchend', onTouchEnd);\n    this.events = {};\n  }\n\n  reset() {\n    if (this.clearTimeout) clearTimeout(this.clearTimeout);\n    this.overlay?.mask.remove();\n    this.overlay = null;\n    this._updateStates({\n      cancelled: false,\n      draggingElement: null,\n      dragOut: null,\n    });\n  }\n\n  updateElementInfo(elementInfo: Partial<ElementInfo<T>>) {\n    this.info.elementInfo = {\n      ...this.info.elementInfo,\n      ...elementInfo,\n    };\n\n    if (elementInfo.preview && this.overlay) {\n      render(elementInfo.preview, this.overlay.transitionWrapper);\n    }\n  }\n}\n"]}