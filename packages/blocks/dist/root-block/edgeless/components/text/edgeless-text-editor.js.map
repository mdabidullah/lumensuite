{"version":3,"file":"edgeless-text-editor.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/text/edgeless-text-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import type { RichText } from '@blocksuite/affine-components/rich-text';\nimport type { TextElementModel } from '@blocksuite/affine-model';\n\nimport { CommonUtils, TextUtils } from '@blocksuite/affine-block-surface';\nimport '@blocksuite/affine-components/rich-text';\nimport { ThemeObserver } from '@blocksuite/affine-shared/theme';\nimport {\n  RANGE_SYNC_EXCLUDE_ATTR,\n  ShadowlessElement,\n  WithDisposable,\n} from '@blocksuite/block-std';\nimport { assertExists, Bound, Vec } from '@blocksuite/global/utils';\nimport { css, html, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessRootBlockComponent } from '../../edgeless-root-block.js';\n\nimport { deleteElements } from '../../utils/crud.js';\nimport { getSelectedRect } from '../../utils/query.js';\n\nconst { toRadian } = CommonUtils;\n\n@customElement('edgeless-text-editor')\nexport class EdgelessTextEditor extends WithDisposable(ShadowlessElement) {\n  static BORDER_WIDTH = 1;\n\n  static PADDING_HORIZONTAL = 10;\n\n  static PADDING_VERTICAL = 6;\n\n  static PLACEHOLDER_TEXT = 'Type from here';\n\n  static override styles = css`\n    .edgeless-text-editor {\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10;\n      transform-origin: left top;\n      font-kerning: none;\n      border: ${EdgelessTextEditor.BORDER_WIDTH}px solid\n        var(--affine-primary-color, #1e96eb);\n      border-radius: 4px;\n      box-shadow: 0px 0px 0px 2px rgba(30, 150, 235, 0.3);\n      padding: ${EdgelessTextEditor.PADDING_VERTICAL}px\n        ${EdgelessTextEditor.PADDING_HORIZONTAL}px;\n      overflow: visible;\n    }\n\n    .edgeless-text-editor .inline-editor {\n      white-space: pre-wrap !important;\n      outline: none;\n    }\n\n    .edgeless-text-editor .inline-editor span {\n      word-break: normal !important;\n      overflow-wrap: anywhere !important;\n    }\n\n    .edgeless-text-editor-placeholder {\n      pointer-events: none;\n      color: var(--affine-text-disable-color);\n      white-space: nowrap;\n    }\n  `;\n\n  private _isComposition = false;\n\n  private _keeping = false;\n\n  private _updateRect = () => {\n    const edgeless = this.edgeless;\n    const element = this.element;\n\n    if (!edgeless || !element) return;\n\n    const newWidth = this.inlineEditorContainer.scrollWidth;\n    const newHeight = this.inlineEditorContainer.scrollHeight;\n    const bound = new Bound(element.x, element.y, newWidth, newHeight);\n    const { x, y, w, h, rotate } = element;\n\n    switch (element.textAlign) {\n      case 'left':\n        {\n          const newPos = this.getCoordsOnLeftAlign(\n            {\n              x,\n              y,\n              w,\n              h,\n              r: toRadian(rotate),\n            },\n            newWidth,\n            newHeight\n          );\n\n          bound.x = newPos.x;\n          bound.y = newPos.y;\n        }\n        break;\n      case 'center':\n        {\n          const newPos = this.getCoordsOnCenterAlign(\n            {\n              x,\n              y,\n              w,\n              h,\n              r: toRadian(rotate),\n            },\n            newWidth,\n            newHeight\n          );\n\n          bound.x = newPos.x;\n          bound.y = newPos.y;\n        }\n        break;\n      case 'right':\n        {\n          const newPos = this.getCoordsOnRightAlign(\n            {\n              x,\n              y,\n              w,\n              h,\n              r: toRadian(rotate),\n            },\n            newWidth,\n            newHeight\n          );\n\n          bound.x = newPos.x;\n          bound.y = newPos.y;\n        }\n        break;\n    }\n\n    edgeless.service.updateElement(element.id, {\n      xywh: bound.serialize(),\n    });\n  };\n\n  get inlineEditor() {\n    assertExists(this.richText.inlineEditor);\n    return this.richText.inlineEditor;\n  }\n\n  get inlineEditorContainer() {\n    return this.inlineEditor.rootElement;\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    if (!this.edgeless) {\n      console.error('edgeless is not set.');\n      return;\n    }\n    if (!this.element) {\n      console.error('text element is not set.');\n      return;\n    }\n\n    this.setAttribute(RANGE_SYNC_EXCLUDE_ATTR, 'true');\n  }\n\n  override firstUpdated(): void {\n    const edgeless = this.edgeless;\n    const element = this.element;\n    const { dispatcher } = this.edgeless;\n    assertExists(dispatcher);\n\n    this.updateComplete\n      .then(() => {\n        this.inlineEditor.slots.renderComplete.on(() => {\n          this._updateRect();\n          this.requestUpdate();\n        });\n\n        this.disposables.add(\n          edgeless.service.surface.elementUpdated.on(({ id }) => {\n            if (id === element.id) this.requestUpdate();\n          })\n        );\n\n        this.disposables.add(\n          edgeless.service.viewport.viewportUpdated.on(() => {\n            this.requestUpdate();\n          })\n        );\n\n        this.disposables.add(dispatcher.add('click', () => true));\n        this.disposables.add(dispatcher.add('doubleClick', () => true));\n\n        this.disposables.add(() => {\n          element.display = true;\n\n          if (element.text.length === 0) {\n            deleteElements(edgeless, [element]);\n          }\n\n          edgeless.service.selection.set({\n            elements: [],\n            editing: false,\n          });\n        });\n\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'blur',\n          () => !this._keeping && this.remove()\n        );\n\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'compositionstart',\n          () => {\n            this._isComposition = true;\n            this.requestUpdate();\n          }\n        );\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'compositionend',\n          () => {\n            this._isComposition = false;\n            this.requestUpdate();\n          }\n        );\n\n        element.display = false;\n      })\n      .catch(console.error);\n  }\n\n  getContainerOffset() {\n    const { PADDING_VERTICAL, PADDING_HORIZONTAL, BORDER_WIDTH } =\n      EdgelessTextEditor;\n    return `-${PADDING_HORIZONTAL + BORDER_WIDTH}px, -${\n      PADDING_VERTICAL + BORDER_WIDTH\n    }px`;\n  }\n\n  getCoordsOnCenterAlign(\n    rect: { w: number; h: number; r: number; x: number; y: number },\n    w1: number,\n    h1: number\n  ): { x: number; y: number } {\n    const centerX = rect.x + rect.w / 2;\n    const centerY = rect.y + rect.h / 2;\n\n    let deltaXPrime = 0;\n    let deltaYPrime = (-rect.h / 2) * Math.cos(rect.r);\n\n    const vX = centerX + deltaXPrime;\n    const vY = centerY + deltaYPrime;\n\n    deltaXPrime = 0;\n    deltaYPrime = (-h1 / 2) * Math.cos(rect.r);\n\n    const newCenterX = vX - deltaXPrime;\n    const newCenterY = vY - deltaYPrime;\n\n    return { x: newCenterX - w1 / 2, y: newCenterY - h1 / 2 };\n  }\n\n  getCoordsOnLeftAlign(\n    rect: { w: number; h: number; r: number; x: number; y: number },\n    w1: number,\n    h1: number\n  ): { x: number; y: number } {\n    const cX = rect.x + rect.w / 2;\n    const cY = rect.y + rect.h / 2;\n\n    let deltaXPrime =\n      (-rect.w / 2) * Math.cos(rect.r) + (rect.h / 2) * Math.sin(rect.r);\n    let deltaYPrime =\n      (-rect.w / 2) * Math.sin(rect.r) - (rect.h / 2) * Math.cos(rect.r);\n\n    const vX = cX + deltaXPrime;\n    const vY = cY + deltaYPrime;\n\n    deltaXPrime = (-w1 / 2) * Math.cos(rect.r) + (h1 / 2) * Math.sin(rect.r);\n    deltaYPrime = (-w1 / 2) * Math.sin(rect.r) - (h1 / 2) * Math.cos(rect.r);\n\n    const newCenterX = vX - deltaXPrime;\n    const newCenterY = vY - deltaYPrime;\n\n    return { x: newCenterX - w1 / 2, y: newCenterY - h1 / 2 };\n  }\n\n  getCoordsOnRightAlign(\n    rect: { w: number; h: number; r: number; x: number; y: number },\n    w1: number,\n    h1: number\n  ): { x: number; y: number } {\n    const centerX = rect.x + rect.w / 2;\n    const centerY = rect.y + rect.h / 2;\n\n    let deltaXPrime =\n      (rect.w / 2) * Math.cos(rect.r) - (-rect.h / 2) * Math.sin(rect.r);\n    let deltaYPrime =\n      (rect.w / 2) * Math.sin(rect.r) + (-rect.h / 2) * Math.cos(rect.r);\n\n    const vX = centerX + deltaXPrime;\n    const vY = centerY + deltaYPrime;\n\n    deltaXPrime = (w1 / 2) * Math.cos(rect.r) - (-h1 / 2) * Math.sin(rect.r);\n    deltaYPrime = (w1 / 2) * Math.sin(rect.r) + (-h1 / 2) * Math.cos(rect.r);\n\n    const newCenterX = vX - deltaXPrime;\n    const newCenterY = vY - deltaYPrime;\n\n    return { x: newCenterX - w1 / 2, y: newCenterY - h1 / 2 };\n  }\n\n  override async getUpdateComplete(): Promise<boolean> {\n    const result = await super.getUpdateComplete();\n    await this.richText?.updateComplete;\n    return result;\n  }\n\n  getVisualPosition(element: TextElementModel) {\n    const { x, y, w, h, rotate } = element;\n    return Vec.rotWith([x, y], [x + w / 2, y + h / 2], toRadian(rotate));\n  }\n\n  override render() {\n    const {\n      text,\n      fontFamily,\n      fontSize,\n      fontWeight,\n      fontStyle,\n      textAlign,\n      rotate,\n      hasMaxWidth,\n      w,\n    } = this.element;\n    const lineHeight = TextUtils.getLineHeight(\n      fontFamily,\n      fontSize,\n      fontWeight\n    );\n    const rect = getSelectedRect([this.element]);\n\n    const { translateX, translateY, zoom } = this.edgeless.service.viewport;\n    const [visualX, visualY] = this.getVisualPosition(this.element);\n    const containerOffset = this.getContainerOffset();\n    const transformOperation = [\n      `translate(${translateX}px, ${translateY}px)`,\n      `translate(${visualX * zoom}px, ${visualY * zoom}px)`,\n      `scale(${zoom})`,\n      `rotate(${rotate}deg)`,\n      `translate(${containerOffset})`,\n    ];\n\n    const isEmpty = !text.length && !this._isComposition;\n    const color = ThemeObserver.generateColorProperty(\n      this.element.color,\n      '#000000'\n    );\n\n    return html`<div\n      style=${styleMap({\n        transform: transformOperation.join(' '),\n        minWidth: hasMaxWidth ? `${rect.width}px` : 'none',\n        maxWidth: hasMaxWidth ? `${w}px` : 'none',\n        fontFamily: TextUtils.wrapFontFamily(fontFamily),\n        fontSize: `${fontSize}px`,\n        fontWeight,\n        fontStyle,\n        color,\n        textAlign,\n        lineHeight: `${lineHeight}px`,\n        boxSizing: 'content-box',\n      })}\n      class=\"edgeless-text-editor\"\n    >\n      <rich-text\n        .yText=${text}\n        .enableFormat=${false}\n        .enableAutoScrollHorizontally=${false}\n        style=${isEmpty\n          ? styleMap({\n              position: 'absolute',\n              left: 0,\n              top: 0,\n              padding: `${EdgelessTextEditor.PADDING_VERTICAL}px\n        ${EdgelessTextEditor.PADDING_HORIZONTAL}px`,\n            })\n          : nothing}\n      ></rich-text>\n      ${isEmpty\n        ? html`<span class=\"edgeless-text-editor-placeholder\">\n            Type from here\n          </span>`\n        : nothing}\n    </div>`;\n  }\n\n  setKeeping(keeping: boolean) {\n    this._keeping = keeping;\n  }\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor element!: TextElementModel;\n\n  @query('rich-text')\n  accessor richText!: RichText;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-text-editor': EdgelessTextEditor;\n  }\n}\n"]}