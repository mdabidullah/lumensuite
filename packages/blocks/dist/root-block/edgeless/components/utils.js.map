{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/root-block/edgeless/components/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IVec } from '@lumensuite/global/utils';\n\nimport { CommonUtils } from '@lumensuite/affine-block-surface';\nimport { assertExists, Bound, Vec } from '@lumensuite/global/utils';\nimport { css, html } from 'lit';\n\nimport {\n  SURFACE_IMAGE_CARD_HEIGHT,\n  SURFACE_IMAGE_CARD_WIDTH,\n} from '../../../image-block/components/image-block-fallback.js';\n\n// \"<svg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><g><path fill='white' d='M13.7,18.5h3.9l0-1.5c0-1.4-1.2-2.6-2.6-2.6h-1.5v3.9l-5.8-5.8l5.8-5.8v3.9h2.3c3.1,0,5.6,2.5,5.6,5.6v2.3h3.9l-5.8,5.8L13.7,18.5z'/><path d='M20.4,19.4v-3.2c0-2.6-2.1-4.7-4.7-4.7h-3.2l0,0V9L9,12.6l3.6,3.6v-2.6l0,0H15c1.9,0,3.5,1.6,3.5,3.5v2.4l0,0h-2.6l3.6,3.6l3.6-3.6L20.4,19.4L20.4,19.4z'/></g></svg>\";\nexport function generateCursorUrl(angle = 0, fallback = css`default`) {\n  return `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cg transform='rotate(${angle} 16 16)'%3E%3Cpath fill='white' d='M13.7,18.5h3.9l0-1.5c0-1.4-1.2-2.6-2.6-2.6h-1.5v3.9l-5.8-5.8l5.8-5.8v3.9h2.3c3.1,0,5.6,2.5,5.6,5.6v2.3h3.9l-5.8,5.8L13.7,18.5z'/%3E%3Cpath d='M20.4,19.4v-3.2c0-2.6-2.1-4.7-4.7-4.7h-3.2l0,0V9L9,12.6l3.6,3.6v-2.6l0,0H15c1.9,0,3.5,1.6,3.5,3.5v2.4l0,0h-2.6l3.6,3.6l3.6-3.6L20.4,19.4L20.4,19.4z'/%3E%3C/g%3E%3C/svg%3E\") 16 16, ${fallback}`;\n}\n\nexport function getCommonRectStyle(\n  rect: DOMRect,\n  active = false,\n  selected = false,\n  rotate = 0\n) {\n  return {\n    '--affine-border-width': `${active ? 2 : 1}px`,\n    width: `${rect.width}px`,\n    height: `${rect.height}px`,\n    transform: `translate(${rect.x}px, ${rect.y}px) rotate(${rotate}deg)`,\n    backgroundColor: !active && selected ? 'var(--affine-hover-color)' : '',\n  };\n}\n\nexport function getTooltipWithShortcut(\n  tip: string,\n  shortcut?: string,\n  postfix?: string\n) {\n  // style for shortcut tooltip\n  const styles = css`\n    .tooltip-with-shortcut {\n      display: flex;\n      flex-wrap: nowrap;\n      align-items: center;\n      gap: 10px;\n    }\n    .tooltip__shortcut {\n      font-size: 12px;\n      position: relative;\n\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 16px;\n      min-width: 16px;\n    }\n    .tooltip__shortcut::before {\n      content: '';\n      border-radius: 4px;\n      position: absolute;\n      inset: 0;\n      background: currentColor;\n      opacity: 0.2;\n    }\n    .tooltip__label {\n      white-space: pre;\n    }\n  `;\n  return html`<style>\n      ${styles}\n    </style>\n    <div class=\"tooltip-with-shortcut\">\n      <span class=\"tooltip__label\">${tip}</span>\n      ${shortcut\n        ? html`<span class=\"tooltip__shortcut\">${shortcut}</span>`\n        : ''}\n      ${postfix ? html`<span class=\"tooltip__postfix\">${postfix}</span>` : ''}\n    </div>`;\n}\n\nexport function readImageSize(file: File) {\n  return new Promise<{ width: number; height: number }>(resolve => {\n    const size = { width: 0, height: 0 };\n    const img = new Image();\n\n    img.onload = () => {\n      size.width = img.width;\n      size.height = img.height;\n      URL.revokeObjectURL(img.src);\n      resolve(size);\n    };\n\n    img.onerror = () => {\n      URL.revokeObjectURL(img.src);\n      resolve(size);\n    };\n\n    img.src = URL.createObjectURL(file);\n  });\n}\n\nconst RESIZE_CURSORS = ['ew', 'nwse', 'ns', 'nesw'];\nexport function rotateResizeCursor(angle: number) {\n  const a = Math.round(angle / (Math.PI / 4));\n  const cursor = RESIZE_CURSORS[a % RESIZE_CURSORS.length];\n  return cursor;\n}\n\nexport function calcAngle(target: HTMLElement, point: IVec, offset = 0) {\n  const rect = target\n    .closest('.affine-edgeless-selected-rect')\n    ?.getBoundingClientRect();\n  assertExists(rect);\n  const { left, top, right, bottom } = rect;\n  const center = Vec.med([left, top], [right, bottom]);\n  return CommonUtils.normalizeDegAngle(\n    ((Vec.angle(center, point) + offset) * 180) / Math.PI\n  );\n}\n\nexport function calcAngleWithRotation(\n  target: HTMLElement,\n  point: IVec,\n  rect: DOMRect,\n  rotate: number\n) {\n  const handle = target.parentElement;\n  assertExists(handle);\n  const ariaLabel = handle.getAttribute('aria-label');\n  assertExists(ariaLabel);\n  const { left, top, right, bottom, width, height } = rect;\n  const size = Math.min(width, height);\n  const sx = size / width;\n  const sy = size / height;\n  const center = Vec.med([left, top], [right, bottom]);\n  const draggingPoint = [0, 0];\n\n  switch (ariaLabel) {\n    case 'top-left': {\n      draggingPoint[0] = left;\n      draggingPoint[1] = top;\n      break;\n    }\n    case 'top-right': {\n      draggingPoint[0] = right;\n      draggingPoint[1] = top;\n      break;\n    }\n    case 'bottom-right': {\n      draggingPoint[0] = right;\n      draggingPoint[1] = bottom;\n      break;\n    }\n    case 'bottom-left': {\n      draggingPoint[0] = left;\n      draggingPoint[1] = bottom;\n      break;\n    }\n  }\n\n  const dp = new DOMMatrix()\n    .translateSelf(center[0], center[1])\n    .rotateSelf(rotate)\n    .translateSelf(-center[0], -center[1])\n    .transformPoint(new DOMPoint(...draggingPoint));\n\n  const m = new DOMMatrix()\n    .translateSelf(dp.x, dp.y)\n    .rotateSelf(rotate)\n    .translateSelf(-dp.x, -dp.y)\n    .scaleSelf(sx, sy, 1, dp.x, dp.y, 0)\n    .translateSelf(dp.x, dp.y)\n    .rotateSelf(-rotate)\n    .translateSelf(-dp.x, -dp.y);\n\n  const c = new DOMPoint(...center).matrixTransform(m);\n\n  return CommonUtils.normalizeDegAngle(\n    (Vec.angle([c.x, c.y], point) * 180) / Math.PI\n  );\n}\n\nexport function calcAngleEdgeWithRotation(target: HTMLElement, rotate: number) {\n  let angleWithEdge = 0;\n  const handle = target.parentElement;\n  assertExists(handle);\n  const ariaLabel = handle.getAttribute('aria-label');\n  assertExists(ariaLabel);\n  switch (ariaLabel) {\n    case 'top': {\n      angleWithEdge = 270;\n      break;\n    }\n    case 'bottom': {\n      angleWithEdge = 90;\n      break;\n    }\n    case 'left': {\n      angleWithEdge = 180;\n      break;\n    }\n    case 'right': {\n      angleWithEdge = 0;\n      break;\n    }\n  }\n\n  return angleWithEdge + rotate;\n}\n\nexport function getResizeLabel(target: HTMLElement) {\n  const handle = target.parentElement;\n  assertExists(handle);\n  const ariaLabel = handle.getAttribute('aria-label');\n  assertExists(ariaLabel);\n  return ariaLabel;\n}\n\nexport function launchIntoFullscreen(element: Element) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen().catch(console.error);\n  } else if (\n    'mozRequestFullScreen' in element &&\n    element.mozRequestFullScreen instanceof Function\n  ) {\n    // Firefox\n    element.mozRequestFullScreen();\n  } else if (\n    'webkitRequestFullscreen' in element &&\n    element.webkitRequestFullscreen instanceof Function\n  ) {\n    // Chrome, Safari and Opera\n    element.webkitRequestFullscreen();\n  } else if (\n    'msRequestFullscreen' in element &&\n    element.msRequestFullscreen instanceof Function\n  ) {\n    // IE/Edge\n    element.msRequestFullscreen();\n  }\n}\n\nexport function calcBoundByOrigin(\n  point: IVec,\n  inTopLeft = false,\n  width = SURFACE_IMAGE_CARD_WIDTH,\n  height = SURFACE_IMAGE_CARD_HEIGHT\n) {\n  return inTopLeft\n    ? new Bound(point[0], point[1], width, height)\n    : Bound.fromCenter(point, width, height);\n}\n"]}