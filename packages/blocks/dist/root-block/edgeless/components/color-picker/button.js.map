{"version":3,"file":"button.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/color-picker/button.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorMenuButton } from '@lumensuite/affine-components/toolbar';\n\nimport { WithDisposable } from '@lumensuite/block-std';\nimport { html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ColorEvent } from '../panel/color-panel.js';\nimport type {\n  ModeType,\n  PickColorDetail,\n  PickColorEvent,\n  PickColorType,\n} from './types.js';\n\nimport '../panel/color-panel.js';\nimport './color-picker.js';\nimport './custom-button.js';\nimport { keepColor, preprocessColor } from './utils.js';\n\ntype Type = 'normal' | 'custom';\n\n@customElement('edgeless-color-picker-button')\nexport class EdgelessColorPickerButton extends WithDisposable(LitElement) {\n  #select = (e: ColorEvent) => {\n    this.#pick({ palette: e.detail });\n  };\n\n  switchToCustomTab = (e: MouseEvent) => {\n    e.stopPropagation();\n    if (this.colorType === 'palette') {\n      this.colorType = 'normal';\n    }\n    this.tabType = 'custom';\n    // refresh menu's position\n    this.menuButton.show(true);\n  };\n\n  get colorWithoutAlpha() {\n    return this.isCSSVariable ? this.color : keepColor(this.color);\n  }\n\n  get customButtonStyle() {\n    let b = 'transparent';\n    let c = 'transparent';\n    if (!this.isCSSVariable) {\n      b = 'var(--affine-background-overlay-panel-color)';\n      c = keepColor(this.color);\n    }\n    return { '--b': b, '--c': c };\n  }\n\n  get isCSSVariable() {\n    return this.color.startsWith('--');\n  }\n\n  get tabContentPadding() {\n    return `${this.tabType === 'custom' ? 0 : 8}px`;\n  }\n\n  #pick(detail: PickColorDetail) {\n    this.pick?.({ type: 'start' });\n    this.pick?.({ type: 'pick', detail });\n    this.pick?.({ type: 'end' });\n  }\n\n  override firstUpdated() {\n    this.disposables.addFromEvent(this.menuButton, 'toggle', (e: Event) => {\n      const newState = (e as CustomEvent).detail;\n      if (newState === 'hidden' && this.tabType !== 'normal') {\n        this.tabType = 'normal';\n      }\n    });\n  }\n\n  override render() {\n    return html`\n      <editor-menu-button\n        .contentPadding=${this.tabContentPadding}\n        .button=${html`\n          <editor-icon-button\n            aria-label=${this.label}\n            .tooltip=${this.tooltip || this.label}\n          >\n            ${this.isText\n              ? html`\n                  <edgeless-text-color-icon\n                    .color=${this.colorWithoutAlpha}\n                  ></edgeless-text-color-icon>\n                `\n              : html`\n                  <edgeless-color-button\n                    .color=${this.colorWithoutAlpha}\n                    .hollowCircle=${this.hollowCircle}\n                  ></edgeless-color-button>\n                `}\n          </editor-icon-button>\n        `}\n      >\n        ${choose(this.tabType, [\n          [\n            'normal',\n            () => html`\n              <div data-orientation=\"vertical\">\n                <slot name=\"other\"></slot>\n                <slot name=\"separator\"></slot>\n                <edgeless-color-panel\n                  role=\"listbox\"\n                  .value=${this.color}\n                  .options=${this.palettes}\n                  .hollowCircle=${this.hollowCircle}\n                  .openColorPicker=${this.switchToCustomTab}\n                  .hasTransparent=${false}\n                  @select=${this.#select}\n                >\n                  <edgeless-color-custom-button\n                    slot=\"custom\"\n                    style=${styleMap(this.customButtonStyle)}\n                    .active=${!this.isCSSVariable}\n                    @click=${this.switchToCustomTab}\n                  ></edgeless-color-custom-button>\n                </edgeless-color-panel>\n              </div>\n            `,\n          ],\n          [\n            'custom',\n            () => html`\n              <edgeless-color-picker\n                class=\"custom\"\n                .pick=${this.pick}\n                .colors=${{\n                  type:\n                    this.colorType === 'palette' ? 'normal' : this.colorType,\n                  modes: this.colors.map(\n                    preprocessColor(window.getComputedStyle(this))\n                  ),\n                }}\n              ></edgeless-color-picker>\n            `,\n          ],\n        ])}\n      </editor-menu-button>\n    `;\n  }\n\n  @property()\n  accessor color!: string;\n\n  @property({ attribute: false })\n  accessor colors: { type: ModeType; value: string }[] = [];\n\n  @property()\n  accessor colorType: PickColorType = 'palette';\n\n  @property({ attribute: false })\n  accessor hollowCircle: boolean = false;\n\n  @property({ attribute: false })\n  accessor isText!: boolean;\n\n  @property()\n  accessor label!: string;\n\n  @query('editor-menu-button')\n  accessor menuButton!: EditorMenuButton;\n\n  @property({ attribute: false })\n  accessor palettes: string[] = [];\n\n  @property({ attribute: false })\n  accessor pick!: (event: PickColorEvent) => void;\n\n  @state()\n  accessor tabType: Type = 'normal';\n\n  @property()\n  accessor tooltip: string | undefined = undefined;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-color-picker-button': EdgelessColorPickerButton;\n  }\n}\n"]}