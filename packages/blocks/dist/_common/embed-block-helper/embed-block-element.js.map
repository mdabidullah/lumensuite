{"version":3,"file":"embed-block-element.js","sourceRoot":"","sources":["../../../src/_common/embed-block-helper/embed-block-element.ts"],"names":[],"mappings":"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","sourcesContent":["import type { GfxCompatibleProps } from '@lumensuite/affine-model';\nimport type { GfxBlockElementModel } from '@lumensuite/block-std/gfx';\nimport type { BlockModel } from '@lumensuite/store';\nimport type { TemplateResult } from 'lit';\n\nimport { CaptionedBlockComponent } from '@lumensuite/affine-components/caption';\nimport { DocModeProvider } from '@lumensuite/affine-shared/services';\nimport { ThemeObserver } from '@lumensuite/affine-shared/theme';\nimport {\n  blockComponentSymbol,\n  type BlockService,\n  type GfxBlockComponent,\n  GfxElementSymbol,\n  isGfxBlockComponent,\n  toGfxBlockComponent,\n} from '@lumensuite/block-std';\nimport { Bound, Point } from '@lumensuite/global/utils';\nimport { html, render } from 'lit';\nimport { query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessRootService } from '../../root-block/edgeless/edgeless-root-service.js';\nimport type { DragHandleOption } from '../../root-block/widgets/drag-handle/config.js';\n\nimport { BOOKMARK_MIN_WIDTH } from '../../root-block/edgeless/utils/consts.js';\nimport {\n  AFFINE_DRAG_HANDLE_WIDGET,\n  AffineDragHandleWidget,\n} from '../../root-block/widgets/drag-handle/drag-handle.js';\nimport {\n  captureEventTarget,\n  convertDragPreviewDocToEdgeless,\n  convertDragPreviewEdgelessToDoc,\n} from '../../root-block/widgets/drag-handle/utils.js';\nimport { EMBED_CARD_HEIGHT, EMBED_CARD_WIDTH } from '../consts.js';\nimport { type EmbedCardStyle, matchFlavours } from '../utils/index.js';\nimport { styles } from './styles.js';\n\nexport class EmbedBlockComponent<\n  Model extends BlockModel<GfxCompatibleProps> = BlockModel<GfxCompatibleProps>,\n  Service extends BlockService = BlockService,\n  WidgetName extends string = string,\n> extends CaptionedBlockComponent<Model, Service, WidgetName> {\n  static override styles = styles;\n\n  private _dragHandleOption: DragHandleOption = {\n    flavour: /affine:embed-*/,\n    edgeless: true,\n    onDragStart: ({ state, startDragging, anchorBlockId, editorHost }) => {\n      if (!anchorBlockId) return false;\n      const anchorComponent = editorHost.std.view.getBlock(anchorBlockId);\n      if (\n        !anchorComponent ||\n        !matchFlavours(anchorComponent.model, [\n          this.flavour as keyof LumenSuite.BlockModels,\n        ])\n      )\n        return false;\n\n      const blockComponent = anchorComponent as EmbedBlockComponent;\n      const element = captureEventTarget(state.raw.target);\n\n      const isDraggingByDragHandle = !!element?.closest(\n        AFFINE_DRAG_HANDLE_WIDGET\n      );\n      const isDraggingByComponent = blockComponent.contains(element);\n      const isInSurface = isGfxBlockComponent(blockComponent);\n\n      if (!isInSurface && (isDraggingByDragHandle || isDraggingByComponent)) {\n        editorHost.selection.setGroup('note', [\n          editorHost.selection.create('block', {\n            blockId: blockComponent.blockId,\n          }),\n        ]);\n        startDragging([blockComponent], state);\n        return true;\n      } else if (isInSurface && isDraggingByDragHandle) {\n        const edgelessService = editorHost.std.getService(\n          'affine:page'\n        ) as EdgelessRootService;\n        const zoom = edgelessService?.viewport.zoom ?? 1;\n        const dragPreviewEl = document.createElement('div');\n        const bound = Bound.deserialize(blockComponent.model.xywh);\n        const offset = new Point(bound.x * zoom, bound.y * zoom);\n        render(\n          blockComponent.host.dangerouslyRenderModel(blockComponent.model),\n          dragPreviewEl\n        );\n\n        startDragging([blockComponent], state, dragPreviewEl, offset);\n        return true;\n      }\n      return false;\n    },\n    onDragEnd: props => {\n      const { state, draggingElements } = props;\n      if (\n        draggingElements.length !== 1 ||\n        !matchFlavours(draggingElements[0].model, [\n          this.flavour as keyof LumenSuite.BlockModels,\n        ])\n      )\n        return false;\n\n      const blockComponent = draggingElements[0] as EmbedBlockComponent;\n      const isInSurface = isGfxBlockComponent(blockComponent);\n      const target = captureEventTarget(state.raw.target);\n      const isTargetEdgelessContainer =\n        target?.classList.contains('edgeless-container');\n\n      if (isInSurface) {\n        const style = blockComponent._cardStyle;\n        const targetStyle =\n          style === 'vertical' || style === 'cube' ? 'horizontal' : style;\n        return convertDragPreviewEdgelessToDoc({\n          blockComponent,\n          style: targetStyle,\n          ...props,\n        });\n      } else if (isTargetEdgelessContainer) {\n        const style = blockComponent._cardStyle;\n\n        return convertDragPreviewDocToEdgeless({\n          blockComponent,\n          cssSelector: '.embed-block-container',\n          width: EMBED_CARD_WIDTH[style],\n          height: EMBED_CARD_HEIGHT[style],\n          ...props,\n        });\n      }\n\n      return false;\n    },\n  };\n\n  private _fetchAbortController = new AbortController();\n\n  protected _cardStyle: EmbedCardStyle = 'horizontal';\n\n  protected _height = EMBED_CARD_HEIGHT.horizontal;\n\n  protected _width = EMBED_CARD_WIDTH.horizontal;\n\n  protected embedContainerStyle: StyleInfo = {\n    position: 'relative',\n    width: '100%',\n  };\n\n  renderEmbed = (content: () => TemplateResult) => {\n    const theme = ThemeObserver.mode;\n    const isSelected = !!this.selected?.is('block');\n\n    if (\n      this._cardStyle === 'horizontal' ||\n      this._cardStyle === 'horizontalThin' ||\n      this._cardStyle === 'list'\n    ) {\n      this.style.display = 'block';\n\n      const mode = this.std.get(DocModeProvider).getEditorMode();\n      if (mode === 'edgeless') {\n        this.style.minWidth = `${BOOKMARK_MIN_WIDTH}px`;\n      }\n    }\n\n    return html`\n      <div\n        class=${classMap({\n          'embed-block-container': true,\n          [theme]: true,\n          selected: isSelected,\n        })}\n        style=${styleMap(this.embedContainerStyle)}\n      >\n        ${content()}\n      </div>\n    `;\n  };\n\n  get fetchAbortController() {\n    return this._fetchAbortController;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this._fetchAbortController.signal.aborted)\n      this._fetchAbortController = new AbortController();\n\n    this.contentEditable = 'false';\n    this.disposables.add(\n      AffineDragHandleWidget.registerOption(this._dragHandleOption)\n    );\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._fetchAbortController.abort();\n  }\n\n  protected override accessor blockContainerStyles: StyleInfo | undefined = {\n    margin: '18px 0',\n  };\n\n  @query('.embed-block-container')\n  protected accessor embedBlock!: HTMLDivElement;\n\n  override accessor showBlockSelection = false;\n\n  override accessor useCaptionEditor = true;\n\n  override accessor useZeroWidth = true;\n}\n\n// @ts-ignore\nexport function toEdgelessEmbedBlock<\n  Model extends GfxBlockElementModel<GfxCompatibleProps>,\n  Service extends BlockService,\n  WidgetName extends string,\n  B extends typeof EmbedBlockComponent<Model, Service, WidgetName>,\n>(block: B) {\n  // @ts-ignore\n  return class extends toGfxBlockComponent(block) {\n    _isDragging = false;\n\n    _isResizing = false;\n\n    _isSelected = false;\n\n    _showOverlay = false;\n\n    [blockComponentSymbol] = true;\n\n    protected override embedContainerStyle: StyleInfo = {\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      transformOrigin: '0 0',\n    };\n\n    [GfxElementSymbol] = true;\n\n    get bound(): Bound {\n      return Bound.deserialize(this.model.xywh);\n    }\n\n    get rootService() {\n      return this.std.getService('affine:page') as EdgelessRootService;\n    }\n\n    _handleClick(_: MouseEvent): void {\n      return;\n    }\n\n    override connectedCallback(): void {\n      super.connectedCallback();\n      const rootService = this.rootService;\n\n      this._disposables.add(\n        rootService.slots.elementResizeStart.on(() => {\n          this._isResizing = true;\n          this._showOverlay = true;\n        })\n      );\n\n      this._disposables.add(\n        rootService.slots.elementResizeEnd.on(() => {\n          this._isResizing = false;\n          this._showOverlay =\n            this._isResizing || this._isDragging || !this._isSelected;\n        })\n      );\n    }\n\n    override renderGfxBlock() {\n      const width = this._width;\n      const height = this._height;\n      const bound = Bound.deserialize(this.model.xywh);\n      const scaleX = bound.w / width;\n      const scaleY = bound.h / height;\n\n      this.embedContainerStyle.transform = `scale(${scaleX}, ${scaleY})`;\n\n      return this.renderPageContent();\n    }\n\n    protected override accessor blockContainerStyles: StyleInfo | undefined =\n      undefined;\n  } as B & {\n    new (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ...args: any[]\n    ): GfxBlockComponent;\n  };\n}\n"]}