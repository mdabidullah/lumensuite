{"version":3,"file":"embed-card-more-menu-popper.js","sourceRoot":"","sources":["../../../../src/_common/components/embed-card/embed-card-more-menu-popper.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  CenterPeekIcon,\n  CopyIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  OpenIcon,\n  RefreshIcon,\n} from '@lumensuite/affine-components/icons';\nimport { isPeekable, peek } from '@lumensuite/affine-components/peek';\nimport { toast } from '@lumensuite/affine-components/toast';\nimport { WithDisposable } from '@lumensuite/block-std';\nimport { Slice } from '@lumensuite/store';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { EmbedToolbarBlockComponent } from './type.js';\n\nimport {\n  isEmbedLinkedDocBlock,\n  isEmbedSyncedDocBlock,\n} from '../../../root-block/edgeless/utils/query.js';\nimport { getBlockProps } from '../../utils/index.js';\nimport './../button.js';\n\n@customElement('embed-card-more-menu')\nexport class EmbedCardMoreMenu extends WithDisposable(LitElement) {\n  static override styles = css`\n    .embed-card-more-menu {\n      box-sizing: border-box;\n      padding-bottom: 4px;\n    }\n\n    .embed-card-more-menu-container {\n      border-radius: 8px;\n      padding: 8px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n    }\n\n    .embed-card-more-menu-container > .menu-item {\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      width: 100%;\n    }\n\n    .embed-card-more-menu-container > .menu-item:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .embed-card-more-menu-container > .menu-item:hover.delete {\n      background: var(--affine-background-error-color);\n      color: var(--affine-error-color);\n    }\n    .embed-card-more-menu-container > .menu-item:hover.delete > svg {\n      color: var(--affine-error-color);\n    }\n\n    .embed-card-more-menu-container > .menu-item svg {\n      margin: 0 8px;\n    }\n\n    .embed-card-more-menu-container > .divider {\n      width: 148px;\n      height: 1px;\n      margin: 8px;\n      background-color: var(--affine-border-color);\n    }\n  `;\n\n  private get _doc() {\n    return this.block.doc;\n  }\n\n  private get _model() {\n    return this.block.model;\n  }\n\n  get _openButtonDisabled() {\n    return (\n      isEmbedLinkedDocBlock(this._model) && this._model.pageId === this._doc.id\n    );\n  }\n\n  private get _std() {\n    return this.block.std;\n  }\n\n  private async _copyBlock() {\n    const slice = Slice.fromModels(this._doc, [this._model]);\n    await this._std.clipboard.copySlice(slice);\n    toast(this.block.host, 'Copied link to clipboard');\n    this.abortController.abort();\n  }\n\n  private _duplicateBlock() {\n    const model = this._model;\n    const blockProps = getBlockProps(model);\n    const { width, height, xywh, rotate, zIndex, ...duplicateProps } =\n      blockProps;\n\n    const { doc } = model;\n    const parent = doc.getParent(model);\n    const index = parent?.children.indexOf(model);\n    doc.addBlock(\n      model.flavour as LumenSuite.Flavour,\n      duplicateProps,\n      parent,\n      index\n    );\n    this.abortController.abort();\n  }\n\n  private _open() {\n    this.block.open();\n    this.abortController.abort();\n  }\n\n  private _peek() {\n    peek(this.block);\n  }\n\n  private _peekable() {\n    return isPeekable(this.block);\n  }\n\n  private _refreshData() {\n    this.block.refreshData();\n    this.abortController.abort();\n  }\n\n  override render() {\n    return html`\n      <div class=\"embed-card-more-menu\">\n        <div\n          class=\"embed-card-more-menu-container\"\n          @pointerdown=${(e: MouseEvent) => e.stopPropagation()}\n        >\n          <icon-button\n            width=\"126px\"\n            height=\"32px\"\n            class=\"menu-item open\"\n            text=\"Open\"\n            @click=${() => this._open()}\n            ?disabled=${this._openButtonDisabled}\n          >\n            ${OpenIcon}\n          </icon-button>\n\n          ${this._peekable()\n            ? html`<icon-button\n                width=\"126px\"\n                height=\"32px\"\n                text=\"Open in center peek\"\n                class=\"menu-item center-peek\"\n                @click=${() => this._peek()}\n              >\n                ${CenterPeekIcon}\n              </icon-button>`\n            : nothing}\n\n          <icon-button\n            width=\"126px\"\n            height=\"32px\"\n            class=\"menu-item copy\"\n            text=\"Copy\"\n            @click=${() => this._copyBlock()}\n          >\n            ${CopyIcon}\n          </icon-button>\n\n          <icon-button\n            width=\"126px\"\n            height=\"32px\"\n            class=\"menu-item duplicate\"\n            text=\"Duplicate\"\n            ?disabled=${this._doc.readonly}\n            @click=${() => this._duplicateBlock()}\n          >\n            ${DuplicateIcon}\n          </icon-button>\n\n          ${isEmbedLinkedDocBlock(this._model) ||\n          isEmbedSyncedDocBlock(this._model)\n            ? nothing\n            : html`<icon-button\n                width=\"126px\"\n                height=\"32px\"\n                class=\"menu-item reload\"\n                text=\"Reload\"\n                ?disabled=${this._doc.readonly}\n                @click=${() => this._refreshData()}\n              >\n                ${RefreshIcon}\n              </icon-button>`}\n\n          <div class=\"divider\"></div>\n\n          <icon-button\n            width=\"126px\"\n            height=\"32px\"\n            class=\"menu-item delete\"\n            text=\"Delete\"\n            ?disabled=${this._doc.readonly}\n            @click=${() => this._doc.deleteBlock(this._model)}\n          >\n            ${DeleteIcon}\n          </icon-button>\n        </div>\n      </div>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @property({ attribute: false })\n  accessor block!: EmbedToolbarBlockComponent;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'embed-card-more-menu': EmbedCardMoreMenu;\n  }\n}\n"]}