{"version":3,"file":"ai-item-list.js","sourceRoot":"","sources":["../../../../src/_common/components/ai-item/ai-item-list.ts"],"names":[],"mappings":"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","sourcesContent":["import { createLitPortal } from '@lumensuite/affine-components/portal';\nimport {\n  EditorHost,\n  PropTypes,\n  requiredProperties,\n  WithDisposable,\n} from '@lumensuite/block-std';\nimport { flip, offset } from '@floating-ui/dom';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, nothing, unsafeCSS } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AIItem } from './ai-item.js';\nimport type { AIItemConfig, AIItemGroupConfig } from './types.js';\n\nimport './ai-item.js';\nimport {\n  SUBMENU_OFFSET_CROSS_AXIS,\n  SUBMENU_OFFSET_MAIN_AXIS,\n} from './const.js';\n\n@requiredProperties({ host: PropTypes.instanceOf(EditorHost) })\n@customElement('ai-item-list')\nexport class AIItemList extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n      width: 100%;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      user-select: none;\n    }\n    .group-name {\n      display: flex;\n      padding: 4px calc(var(--item-padding, 8px) + 4px);\n      align-items: center;\n      color: var(--affine-text-secondary-color);\n      text-align: justify;\n      font-size: var(--affine-font-xs);\n      font-style: normal;\n      font-weight: 500;\n      line-height: 20px;\n      width: 100%;\n      box-sizing: border-box;\n    }\n  `;\n\n  private _abortController: AbortController | null = null;\n\n  private _activeSubMenuItem: AIItemConfig | null = null;\n\n  private _closeSubMenu = () => {\n    if (this._abortController) {\n      this._abortController.abort();\n      this._abortController = null;\n    }\n    this._activeSubMenuItem = null;\n  };\n\n  private _itemClassName = (item: AIItemConfig) => {\n    return 'ai-item-' + item.name.split(' ').join('-').toLocaleLowerCase();\n  };\n\n  private _openSubMenu = (item: AIItemConfig) => {\n    if (!item.subItem || item.subItem.length === 0) {\n      this._closeSubMenu();\n      return;\n    }\n\n    if (item === this._activeSubMenuItem) {\n      return;\n    }\n\n    const aiItem = this.shadowRoot?.querySelector(\n      `.${this._itemClassName(item)}`\n    ) as AIItem | null;\n    if (!aiItem || !aiItem.menuItem) return;\n\n    this._closeSubMenu();\n    this._activeSubMenuItem = item;\n    this._abortController = new AbortController();\n    this._abortController.signal.addEventListener('abort', () => {\n      this._closeSubMenu();\n    });\n\n    const aiItemContainer = aiItem.menuItem;\n    const subMenuOffset = {\n      mainAxis: item.subItemOffset?.[0] ?? SUBMENU_OFFSET_MAIN_AXIS,\n      crossAxis: item.subItemOffset?.[1] ?? SUBMENU_OFFSET_CROSS_AXIS,\n    };\n\n    createLitPortal({\n      template: html`<ai-sub-item-list\n        .item=${item}\n        .host=${this.host}\n        .onClick=${this.onClick}\n        .abortController=${this._abortController}\n      ></ai-sub-item-list>`,\n      container: aiItemContainer,\n      computePosition: {\n        referenceElement: aiItemContainer,\n        placement: 'right-start',\n        middleware: [flip(), offset(subMenuOffset)],\n        autoUpdate: true,\n      },\n      abortController: this._abortController,\n      closeOnClickAway: true,\n    });\n  };\n\n  override render() {\n    return html`${repeat(this.groups, group => {\n      return html`\n        ${group.name\n          ? html`<div class=\"group-name\">\n              ${group.name.toLocaleUpperCase()}\n            </div>`\n          : nothing}\n        ${repeat(\n          group.items,\n          item =>\n            html`<ai-item\n              .onClick=${() => {\n                this.onClick?.();\n              }}\n              .item=${item}\n              .host=${this.host}\n              class=${this._itemClassName(item)}\n              @mouseover=${() => {\n                this._openSubMenu(item);\n              }}\n            ></ai-item>`\n        )}\n      `;\n    })}`;\n  }\n\n  @property({ attribute: false })\n  accessor groups: AIItemGroupConfig[] = [];\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor onClick: (() => void) | undefined = undefined;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-item-list': AIItemList;\n  }\n}\n"]}