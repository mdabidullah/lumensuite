{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/_common/components/filterable-list/index.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  type AdvancedPortalOptions,\n  createLitPortal,\n} from '@lumensuite/affine-components/portal';\nimport { WithDisposable } from '@lumensuite/block-std';\nimport { DoneIcon, SearchIcon } from '@blocksuite/icons/lit';\nimport { autoPlacement, offset, type Placement, size } from '@floating-ui/dom';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport type { FilterableListItem, FilterableListOptions } from './types.js';\n\nimport { PAGE_HEADER_HEIGHT } from '../../consts.js';\nimport { filterableListStyles } from './styles.js';\n\nexport * from './types.js';\n\n@customElement('affine-filterable-list')\nexport class FilterableListComponent<Props = unknown> extends WithDisposable(\n  LitElement\n) {\n  static override styles = filterableListStyles;\n\n  private _buildContent(items: FilterableListItem<Props>[]) {\n    return items.map((item, idx) => {\n      const focussed = this._curFocusIndex === idx;\n\n      return html`\n        <icon-button\n          class=${classMap({\n            'filterable-item': true,\n            focussed,\n          })}\n          @mouseover=${() => (this._curFocusIndex = idx)}\n          @click=${() => this._select(item)}\n          hover=${focussed}\n          width=\"100%\"\n          height=\"32px\"\n        >\n          ${item.icon ?? nothing} ${item.label ?? item.name}\n          <div slot=\"suffix\">\n            ${this.options.active?.(item) ? DoneIcon() : nothing}\n          </div>\n        </icon-button>\n      `;\n    });\n  }\n\n  private _filterItems() {\n    const searchFilter = !this._filterText\n      ? this.options.items\n      : this.options.items.filter(\n          item =>\n            item.name.startsWith(this._filterText.toLowerCase()) ||\n            item.aliases?.some(alias =>\n              alias.startsWith(this._filterText.toLowerCase())\n            )\n        );\n    return searchFilter.sort((a, b) => {\n      const isActiveA = this.options.active?.(a);\n      const isActiveB = this.options.active?.(b);\n\n      if (isActiveA && !isActiveB) return -Infinity;\n      if (!isActiveA && isActiveB) return Infinity;\n\n      return this.listFilter?.(a, b) ?? Infinity;\n    });\n  }\n\n  private _scrollFocusedItemIntoView() {\n    this.updateComplete\n      .then(() => {\n        this._focussedItem?.scrollIntoView({\n          block: 'nearest',\n          inline: 'start',\n        });\n      })\n      .catch(console.error);\n  }\n\n  private _select(item: FilterableListItem) {\n    this.abortController?.abort();\n    this.options.onSelect(item);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    requestAnimationFrame(() => {\n      this._filterInput.focus();\n    });\n  }\n\n  override render() {\n    const filteredItems = this._filterItems();\n    const content = this._buildContent(filteredItems);\n    const isFlip = !!this.placement?.startsWith('top');\n\n    const _handleInputKeydown = (ev: KeyboardEvent) => {\n      switch (ev.key) {\n        case 'ArrowUp': {\n          ev.preventDefault();\n          this._curFocusIndex =\n            (this._curFocusIndex + content.length - 1) % content.length;\n          this._scrollFocusedItemIntoView();\n          break;\n        }\n        case 'ArrowDown': {\n          ev.preventDefault();\n          this._curFocusIndex = (this._curFocusIndex + 1) % content.length;\n          this._scrollFocusedItemIntoView();\n          break;\n        }\n        case 'Enter': {\n          if (ev.isComposing) break;\n          ev.preventDefault();\n          const item = filteredItems[this._curFocusIndex];\n          this._select(item);\n          break;\n        }\n        case 'Escape': {\n          ev.preventDefault();\n          this.abortController?.abort();\n          break;\n        }\n      }\n    };\n\n    return html`\n      <div\n        class=${classMap({ 'affine-filterable-list': true, flipped: isFlip })}\n      >\n        <div class=\"input-wrapper\">\n          ${SearchIcon()}\n          <input\n            id=\"filter-input\"\n            type=\"text\"\n            placeholder=${this.options?.placeholder ?? 'Search'}\n            @input=\"${() => {\n              this._filterText = this._filterInput?.value;\n              this._curFocusIndex = 0;\n            }}\"\n            @keydown=\"${_handleInputKeydown}\"\n          />\n        </div>\n\n        <editor-toolbar-separator\n          data-orientation=\"horizontal\"\n        ></editor-toolbar-separator>\n        <div class=\"items-container\">${content}</div>\n      </div>\n    `;\n  }\n\n  @state()\n  private accessor _curFocusIndex = 0;\n\n  @query('#filter-input')\n  private accessor _filterInput!: HTMLInputElement;\n\n  @state()\n  private accessor _filterText = '';\n\n  @query('.filterable-item.focussed')\n  private accessor _focussedItem!: HTMLElement | null;\n\n  @property({ attribute: false })\n  accessor abortController: AbortController | null = null;\n\n  @property({ attribute: false })\n  accessor listFilter:\n    | ((a: FilterableListItem<Props>, b: FilterableListItem<Props>) => number)\n    | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor options!: FilterableListOptions<Props>;\n\n  @property({ attribute: false })\n  accessor placement: Placement | undefined = undefined;\n}\n\nexport function showPopFilterableList({\n  options,\n  filter,\n  abortController = new AbortController(),\n  referenceElement,\n  container,\n  maxHeight = 440,\n  portalStyles,\n}: {\n  options: FilterableListComponent['options'];\n  referenceElement: Element;\n  container?: Element;\n  abortController?: AbortController;\n  filter?: FilterableListComponent['listFilter'];\n  maxHeight?: number;\n  portalStyles?: AdvancedPortalOptions['portalStyles'];\n}) {\n  const portalPadding = {\n    top: PAGE_HEADER_HEIGHT + 12,\n    bottom: 12,\n  } as const;\n\n  const list = new FilterableListComponent();\n  list.options = options;\n  list.listFilter = filter;\n  list.abortController = abortController;\n\n  createLitPortal({\n    closeOnClickAway: true,\n    template: ({ positionSlot }) => {\n      positionSlot.on(({ placement }) => {\n        list.placement = placement;\n      });\n\n      return list;\n    },\n    container,\n    portalStyles,\n    computePosition: {\n      referenceElement,\n      placement: 'bottom-start',\n      middleware: [\n        offset(4),\n        autoPlacement({\n          allowedPlacements: ['top-start', 'bottom-start'],\n          padding: portalPadding,\n        }),\n        size({\n          padding: portalPadding,\n          apply({ availableHeight, elements, placement }) {\n            Object.assign(elements.floating.style, {\n              height: '100%',\n              maxHeight: `${Math.min(maxHeight, availableHeight)}px`,\n              pointerEvents: 'none',\n              ...(placement.startsWith('top')\n                ? {\n                    display: 'flex',\n                    alignItems: 'flex-end',\n                  }\n                : {\n                    display: null,\n                    alignItems: null,\n                  }),\n            });\n          },\n        }),\n      ],\n      autoUpdate: {\n        // fix the lang list position incorrectly when scrolling\n        animationFrame: true,\n      },\n    },\n    abortController,\n  });\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-filterable-list': FilterableListComponent;\n  }\n}\n"]}