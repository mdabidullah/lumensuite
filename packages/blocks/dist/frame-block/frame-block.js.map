{"version":3,"file":"frame-block.js","sourceRoot":"","sources":["../../src/frame-block/frame-block.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockStdScope } from '@blocksuite/block-std';\nimport type { Doc } from '@blocksuite/store';\n\nimport { ColorScheme, FrameBlockModel } from '@blocksuite/affine-model';\nimport { ThemeObserver } from '@blocksuite/affine-shared/theme';\nimport {\n  docContext,\n  GfxBlockComponent,\n  modelContext,\n  ShadowlessElement,\n  SignalWatcher,\n  stdContext,\n  WithDisposable,\n} from '@blocksuite/block-std';\nimport { GfxControllerIdentifier } from '@blocksuite/block-std/gfx';\nimport { Bound, type SerializedXYWH } from '@blocksuite/global/utils';\nimport { consume } from '@lit/context';\nimport { cssVarV2 } from '@toeverything/theme/v2';\nimport { css, html, nothing, unsafeCSS } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessRootService } from '../root-block/index.js';\n\nimport { parseStringToRgba } from '../root-block/edgeless/components/color-picker/utils.js';\nimport { isTransparent } from '../root-block/edgeless/components/panel/color-panel.js';\n\nexport const frameTitleStyleVars = {\n  nestedFrameOffset: 4,\n  height: 22,\n  fontSize: 14,\n};\n\n@customElement('edgeless-frame-title')\nexport class EdgelessFrameTitle extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    edgeless-frame-title {\n      position: relative;\n    }\n\n    .affine-frame-title {\n      position: absolute;\n      display: flex;\n      align-items: center;\n      z-index: 1;\n      left: 0px;\n      top: 0px;\n      border: 1px solid ${unsafeCSS(cssVarV2('edgeless/frame/border/default'))};\n      border-radius: 4px;\n      width: fit-content;\n      height: ${frameTitleStyleVars.height}px;\n      padding: 0px 4px;\n      transform-origin: left bottom;\n      background-color: var(--bg-color);\n\n      span {\n        font-family: var(--affine-font-family);\n        font-size: ${frameTitleStyleVars.fontSize}px;\n        cursor: default;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n    }\n\n    .affine-frame-title:hover {\n      background-color: color-mix(in srgb, var(--bg-color), #000000 7%);\n    }\n  `;\n\n  private _cachedHeight = 0;\n\n  private _cachedWidth = 0;\n\n  get colors() {\n    let backgroundColor = ThemeObserver.getColorValue(\n      this.model.background,\n      undefined,\n      true\n    );\n    if (isTransparent(backgroundColor)) {\n      backgroundColor = ThemeObserver.getPropertyValue(\n        cssVarV2('edgeless/frame/background/white').replace(\n          /var\\((--.*)\\)/,\n          '$1'\n        )\n      );\n    }\n\n    const { r, g, b, a } = parseStringToRgba(backgroundColor);\n\n    let textColor: string;\n    {\n      let rPrime, gPrime, bPrime;\n      if (ThemeObserver.instance.mode$.value === ColorScheme.Light) {\n        rPrime = 1 - a + a * r;\n        gPrime = 1 - a + a * g;\n        bPrime = 1 - a + a * b;\n      } else {\n        rPrime = a * r;\n        gPrime = a * g;\n        bPrime = a * b;\n      }\n\n      // light\n      const L = 0.299 * rPrime + 0.587 * gPrime + 0.114 * bPrime;\n      textColor = L > 0.5 ? 'black' : 'white';\n    }\n\n    return {\n      background: backgroundColor,\n      text: textColor,\n    };\n  }\n\n  get gfx() {\n    return this.std.get(GfxControllerIdentifier);\n  }\n\n  get rootService() {\n    return this.std.getService('affine:page') as EdgelessRootService;\n  }\n\n  private _isInsideFrame() {\n    return this.gfx.grid.has(\n      this.model.elementBound,\n      true,\n      true,\n      model => model !== this.model && model instanceof FrameBlockModel\n    );\n  }\n\n  private _updateFrameTitleSize() {\n    const { _nestedFrame, _zoom: zoom } = this;\n    const { elementBound } = this.model;\n    const width = this._cachedWidth / zoom;\n    const height = this._cachedHeight / zoom;\n\n    const { nestedFrameOffset } = frameTitleStyleVars;\n\n    if (width && height) {\n      this.model.externalXYWH = `[${\n        elementBound.x + (_nestedFrame ? nestedFrameOffset / zoom : 0)\n      },${\n        elementBound.y +\n        (_nestedFrame\n          ? nestedFrameOffset / zoom\n          : -(height + nestedFrameOffset / zoom))\n      },${width},${height}]`;\n\n      this.gfx.grid.update(this.model);\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    const { _disposables, doc, gfx, rootService } = this;\n\n    this._nestedFrame = this._isInsideFrame();\n\n    _disposables.add(\n      doc.slots.blockUpdated.on(payload => {\n        if (\n          (payload.type === 'update' &&\n            payload.props.key === 'xywh' &&\n            doc.getBlock(payload.id)?.model instanceof FrameBlockModel) ||\n          (payload.type === 'add' && payload.flavour === 'affine:frame')\n        ) {\n          this._nestedFrame = this._isInsideFrame();\n        }\n\n        if (\n          payload.type === 'delete' &&\n          payload.model instanceof FrameBlockModel &&\n          payload.model !== this.model\n        ) {\n          this._nestedFrame = this._isInsideFrame();\n        }\n      })\n    );\n\n    _disposables.add(\n      this.model.propsUpdated.on(() => {\n        this._xywh = this.model.xywh;\n        this.requestUpdate();\n      })\n    );\n\n    _disposables.add(\n      rootService.selection.slots.updated.on(() => {\n        this._editing =\n          rootService.selection.selectedIds[0] === this.model.id &&\n          rootService.selection.editing;\n      })\n    );\n\n    _disposables.add(\n      rootService.slots.edgelessToolUpdated.on(tool => {\n        this._isNavigator = tool.type === 'frameNavigator';\n      })\n    );\n\n    _disposables.add(\n      gfx.viewport.viewportUpdated.on(({ zoom }) => {\n        this._zoom = zoom;\n      })\n    );\n\n    this._zoom = gfx.viewport.zoom;\n\n    const updateTitle = () => {\n      this._frameTitle = this.model.title.toString().trim();\n    };\n    _disposables.add(() => {\n      this.model.title.yText.unobserve(updateTitle);\n    });\n    this.model.title.yText.observe(updateTitle);\n\n    this._frameTitle = this.model.title.toString().trim();\n    this._xywh = this.model.xywh;\n  }\n\n  override firstUpdated() {\n    if (!this._frameTitleEl) return;\n    this._cachedWidth = this._frameTitleEl.clientWidth;\n    this._cachedHeight = this._frameTitleEl.clientHeight;\n    this._updateFrameTitleSize();\n  }\n\n  override render() {\n    const model = this.model;\n    const bound = Bound.deserialize(model.xywh);\n\n    const { _isNavigator, _editing, _zoom: zoom } = this;\n\n    const { nestedFrameOffset, height } = frameTitleStyleVars;\n\n    const nestedFrame = this._nestedFrame;\n    const maxWidth = nestedFrame\n      ? bound.w * zoom - nestedFrameOffset / zoom\n      : bound.w * zoom;\n    const hidden = height / zoom >= bound.h;\n    const transformOperation = [\n      `translate(0%, ${nestedFrame ? 0 : -100}%)`,\n      `scale(${1 / zoom})`,\n      `translate(${nestedFrame ? nestedFrameOffset : 0}px, ${\n        nestedFrame ? nestedFrameOffset : -nestedFrameOffset\n      }px)`,\n    ];\n\n    return html`\n      ${this._frameTitle &&\n      this._frameTitle.length !== 0 &&\n      !_isNavigator &&\n      !_editing\n        ? html`\n            <div\n              style=${styleMap({\n                '--bg-color': this.colors.background,\n                display: hidden ? 'none' : 'flex',\n                transform: transformOperation.join(' '),\n                maxWidth: maxWidth + 'px',\n                transformOrigin: nestedFrame ? 'top left' : 'bottom left',\n                color: this.colors.text,\n              })}\n              class=\"affine-frame-title\"\n            >\n              <span>${this._frameTitle}</span>\n            </div>\n          `\n        : nothing}\n    `;\n  }\n\n  override updated(_changedProperties: Map<string, unknown>) {\n    if (\n      (!this.gfx.viewport.viewportBounds.contains(this.model.elementBound) &&\n        !this.gfx.viewport.viewportBounds.isIntersectWithBound(\n          this.model.elementBound\n        )) ||\n      !this._frameTitleEl\n    ) {\n      return;\n    }\n\n    let sizeChanged = false;\n    if (\n      this._cachedWidth === 0 ||\n      this._cachedHeight === 0 ||\n      _changedProperties.has('_frameTitle') ||\n      _changedProperties.has('_nestedFrame') ||\n      _changedProperties.has('_xywh')\n    ) {\n      this._cachedWidth = this._frameTitleEl.clientWidth;\n      this._cachedHeight = this._frameTitleEl.clientHeight;\n      sizeChanged = true;\n    }\n    if (sizeChanged || _changedProperties.has('_zoom')) {\n      this._updateFrameTitleSize();\n    }\n  }\n\n  @state()\n  private accessor _editing = false;\n\n  @state()\n  private accessor _frameTitle = '';\n\n  @query('.affine-frame-title')\n  private accessor _frameTitleEl!: HTMLDivElement;\n\n  @state()\n  private accessor _isNavigator = false;\n\n  @state()\n  private accessor _nestedFrame = false;\n\n  @state()\n  private accessor _xywh: SerializedXYWH | null = null;\n\n  @state()\n  private accessor _zoom!: number;\n\n  @consume({ context: docContext })\n  accessor doc!: Doc;\n\n  @consume({ context: modelContext })\n  accessor model!: FrameBlockModel;\n\n  @consume({\n    context: stdContext,\n  })\n  accessor std!: BlockStdScope;\n}\n\n@customElement('affine-frame')\nexport class FrameBlockComponent extends GfxBlockComponent<FrameBlockModel> {\n  get rootService() {\n    return this.std.getService('affine:page') as EdgelessRootService;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._disposables.add(\n      this.doc.slots.blockUpdated.on(({ type, id }) => {\n        if (id === this.model.id && type === 'update') {\n          this.requestUpdate();\n        }\n      })\n    );\n  }\n\n  override firstUpdated() {\n    this.rootService.slots.edgelessToolUpdated.on(tool => {\n      this._isNavigator = tool.type === 'frameNavigator';\n    });\n  }\n\n  override renderGfxBlock() {\n    const { model, _isNavigator, showBorder, rootService } = this;\n    const backgroundColor = ThemeObserver.generateColorProperty(\n      model.background,\n      '--affine-platte-transparent'\n    );\n    const frameIndex = rootService.layer.getZIndex(model);\n\n    return html`\n      <edgeless-frame-title\n        style=${styleMap({\n          zIndex: 2147483647 - -frameIndex,\n        })}\n      ></edgeless-frame-title>\n      <div\n        class=\"affine-frame-container\"\n        style=${styleMap({\n          zIndex: `${frameIndex}`,\n          backgroundColor,\n          height: '100%',\n          width: '100%',\n          borderRadius: '2px',\n          border:\n            _isNavigator || !showBorder\n              ? 'none'\n              : `1px solid ${cssVarV2('edgeless/frame/border/default')}`,\n        })}\n      ></div>\n    `;\n  }\n\n  override toZIndex(): string {\n    return 'auto';\n  }\n\n  @state()\n  private accessor _isNavigator = false;\n\n  @state()\n  accessor showBorder = true;\n\n  @query('edgeless-frame-title')\n  accessor titleElement: EdgelessFrameTitle | null = null;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-frame': FrameBlockComponent;\n  }\n}\n"]}