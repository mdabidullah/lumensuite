{"version":3,"file":"surface-ref-block.js","sourceRoot":"","sources":["../../src/surface-ref-block/surface-ref-block.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockCaptionEditor } from '@lumensuite/affine-components/caption';\nimport type { SurfaceRefBlockModel } from '@lumensuite/affine-model';\nimport type { Doc } from '@lumensuite/store';\n\nimport {\n  type SurfaceBlockModel,\n  SurfaceElementModel,\n} from '@lumensuite/affine-block-surface';\nimport {\n  EdgelessModeIcon,\n  FrameIcon,\n  MoreDeleteIcon,\n} from '@lumensuite/affine-components/icons';\nimport { Peekable } from '@lumensuite/affine-components/peek';\nimport { DocModeProvider } from '@lumensuite/affine-shared/services';\nimport { requestConnectedFrame } from '@lumensuite/affine-shared/utils';\nimport {\n  type BaseSelection,\n  BlockStdScope,\n  type EditorHost,\n} from '@lumensuite/block-std';\nimport { BlockComponent, BlockServiceWatcher } from '@lumensuite/block-std';\nimport { GfxBlockElementModel } from '@lumensuite/block-std/gfx';\nimport {\n  Bound,\n  deserializeXYWH,\n  type SerializedXYWH,\n} from '@lumensuite/global/utils';\nimport { assertExists } from '@lumensuite/global/utils';\nimport { css, html, nothing, type TemplateResult } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { FrameBlockComponent } from '../frame-block/frame-block.js';\nimport type { EdgelessRootPreviewBlockComponent } from '../root-block/edgeless/edgeless-root-preview-block.js';\nimport type { EdgelessRootService } from '../root-block/index.js';\nimport type { SurfaceRefBlockService } from './surface-ref-service.js';\n\nimport { SpecProvider } from '../_specs/index.js';\nimport { noContentPlaceholder } from './utils.js';\n\nconst REF_LABEL_ICON = {\n  'affine:frame': FrameIcon,\n  DEFAULT_NOTE_HEIGHT: EdgelessModeIcon,\n} as Record<string, TemplateResult>;\n\nconst NO_CONTENT_TITLE = {\n  'affine:frame': 'Frame',\n  group: 'Group',\n  DEFAULT: 'Content',\n} as Record<string, string>;\n\nconst NO_CONTENT_REASON = {\n  group: 'This content was ungrouped or deleted on edgeless mode',\n  DEFAULT: 'This content was deleted on edgeless mode',\n} as Record<string, string>;\n\n@customElement('affine-surface-ref')\n@Peekable()\nexport class SurfaceRefBlockComponent extends BlockComponent<\n  SurfaceRefBlockModel,\n  SurfaceRefBlockService\n> {\n  static override styles = css`\n    .affine-surface-ref {\n      position: relative;\n      user-select: none;\n      margin: 10px 0;\n      break-inside: avoid;\n    }\n\n    @media print {\n      .affine-surface-ref {\n        outline: none !important;\n      }\n    }\n\n    .ref-placeholder {\n      padding: 26px 0px 0px;\n    }\n\n    .placeholder-image {\n      margin: 0 auto;\n      text-align: center;\n    }\n\n    .placeholder-text {\n      margin: 12px auto 0;\n      text-align: center;\n      font-size: 28px;\n      font-weight: 600;\n      line-height: 36px;\n      font-family: var(--affine-font-family);\n    }\n\n    .placeholder-action {\n      margin: 32px auto 0;\n      text-align: center;\n    }\n\n    .delete-button {\n      width: 204px;\n      padding: 4px 18px;\n\n      display: inline-flex;\n      justify-content: center;\n      align-items: center;\n      gap: 4px;\n\n      border-radius: 8px;\n      border: 1px solid var(--affine-border-color);\n\n      font-family: var(--affine-font-family);\n      font-size: 12px;\n      font-weight: 500;\n      line-height: 20px;\n\n      background-color: transparent;\n      cursor: pointer;\n    }\n\n    .delete-button > .icon > svg {\n      color: var(--affine-icon-color);\n      width: 16px;\n      height: 16px;\n      display: block;\n    }\n\n    .placeholder-reason {\n      margin: 72px auto 0;\n      padding: 10px;\n\n      text-align: center;\n      font-size: 12px;\n      font-family: var(--affine-font-family);\n      line-height: 20px;\n\n      color: var(--affine-warning-color);\n      background-color: var(--affine-background-error-color);\n    }\n\n    .ref-content {\n      position: relative;\n      padding: 20px;\n      background-color: var(--affine-background-primary-color);\n      background: radial-gradient(\n        var(--affine-edgeless-grid-color) 1px,\n        var(--affine-background-primary-color) 1px\n      );\n    }\n\n    .ref-viewport {\n      max-width: 100%;\n      margin: 0 auto;\n      position: relative;\n      overflow: hidden;\n      pointer-events: none;\n      user-select: none;\n    }\n\n    .ref-viewport.frame {\n      border-radius: 2px;\n      border: 1px solid var(--affine-black-30);\n    }\n\n    .surface-ref-mask {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      break-inside: avoid;\n    }\n\n    .surface-ref-mask:hover {\n      background-color: rgba(211, 211, 211, 0.1);\n    }\n\n    .surface-ref-mask:hover .ref-label {\n      display: block;\n    }\n\n    .ref-label {\n      display: none;\n      user-select: none;\n    }\n\n    .ref-label {\n      position: absolute;\n      left: 0;\n      bottom: 0;\n\n      width: 100%;\n      padding: 8px 16px;\n      border: 1px solid var(--affine-border-color);\n      gap: 14px;\n\n      background: var(--affine-background-primary-color);\n\n      font-size: 12px;\n\n      user-select: none;\n    }\n\n    .ref-label .title {\n      display: inline-block;\n      font-weight: 600;\n      font-family: var(--affine-font-family);\n      line-height: 20px;\n\n      color: var(--affine-text-secondary-color);\n    }\n\n    .ref-label .title > svg {\n      color: var(--affine-icon-secondary);\n      display: inline-block;\n      vertical-align: baseline;\n      width: 20px;\n      height: 20px;\n      vertical-align: bottom;\n    }\n\n    .ref-label .suffix {\n      display: inline-block;\n      font-weight: 400;\n      color: var(--affine-text-disable-color);\n      line-height: 20px;\n    }\n  `;\n\n  private _previewDoc: Doc | null = null;\n\n  private _previewSpec = SpecProvider.getInstance().getSpec('edgeless:preview');\n\n  private _referencedModel: LumenSuite.EdgelessModel | null = null;\n\n  private _referenceXYWH: SerializedXYWH | null = null;\n\n  private get _shouldRender() {\n    return (\n      this.isConnected &&\n      // prevent surface-ref from render itself in loop\n      !this.parentComponent?.closest('affine-surface-ref')\n    );\n  }\n\n  get referenceModel() {\n    return this._referencedModel;\n  }\n\n  private _deleteThis() {\n    this.doc.deleteBlock(this.model);\n  }\n\n  private _focusBlock() {\n    this.selection.update(() => {\n      return [this.selection.create('block', { blockId: this.blockId })];\n    });\n  }\n\n  private _initHotkey() {\n    const selection = this.host.selection;\n    const addParagraph = () => {\n      if (!this.doc.getParent(this.model)) return;\n\n      const [paragraphId] = this.doc.addSiblingBlocks(this.model, [\n        {\n          flavour: 'affine:paragraph',\n        },\n      ]);\n      const model = this.doc.getBlockById(paragraphId);\n      assertExists(model, `Failed to add paragraph block.`);\n\n      requestConnectedFrame(() => {\n        selection.update(selList => {\n          return selList\n            .filter<BaseSelection>(sel => !sel.is('block'))\n            .concat(\n              selection.create('text', {\n                from: {\n                  blockId: model.id,\n                  index: 0,\n                  length: 0,\n                },\n                to: null,\n              })\n            );\n        });\n      }, this);\n    };\n\n    this.bindHotKey({\n      Enter: () => {\n        if (!this._focused) return;\n        addParagraph();\n        return true;\n      },\n    });\n  }\n\n  private _initReferencedModel() {\n    const surfaceModel: SurfaceBlockModel | null =\n      (this.doc.getBlocksByFlavour('affine:surface')[0]?.model as\n        | SurfaceBlockModel\n        | undefined) ?? null;\n    this._surfaceModel = surfaceModel;\n\n    const findReferencedModel = (): [\n      LumenSuite.EdgelessModel | null,\n      string,\n    ] => {\n      if (!this.model.reference) return [null, this.doc.id];\n\n      if (this.doc.getBlock(this.model.reference)) {\n        return [\n          this.doc.getBlock(this.model.reference)\n            ?.model as GfxBlockElementModel,\n          this.doc.id,\n        ];\n      }\n\n      if (this._surfaceModel?.getElementById(this.model.reference)) {\n        return [\n          this._surfaceModel.getElementById(this.model.reference),\n          this.doc.id,\n        ];\n      }\n\n      const doc = [...this.std.collection.docs.values()]\n        .map(doc => doc.getDoc())\n        .find(\n          doc =>\n            doc.getBlock(this.model.reference) ||\n            (\n              doc.getBlocksByFlavour('affine:surface')[0]\n                .model as SurfaceBlockModel\n            ).getElementById(this.model.reference)\n        );\n\n      if (doc) {\n        this._surfaceModel = doc.getBlocksByFlavour('affine:surface')[0]\n          .model as SurfaceBlockModel;\n      }\n\n      if (doc && doc.getBlock(this.model.reference)) {\n        return [\n          doc.getBlock(this.model.reference)?.model as GfxBlockElementModel,\n          doc.id,\n        ];\n      }\n\n      if (doc && doc.getBlocksByFlavour('affine:surface')[0]) {\n        return [\n          (\n            doc.getBlocksByFlavour('affine:surface')[0]\n              .model as SurfaceBlockModel\n          ).getElementById(this.model.reference),\n          doc.id,\n        ];\n      }\n\n      return [null, this.doc.id];\n    };\n\n    const init = () => {\n      const [referencedModel, docId] = findReferencedModel();\n\n      this._referencedModel =\n        referencedModel && referencedModel.xywh ? referencedModel : null;\n      this._previewDoc = this.doc.collection.getDoc(docId, {\n        readonly: true,\n      });\n      this._referenceXYWH = this._referencedModel?.xywh ?? null;\n    };\n\n    init();\n\n    this._disposables.add(\n      this.model.propsUpdated.on(payload => {\n        if (\n          payload.key === 'reference' &&\n          this.model.reference !== this._referencedModel?.id\n        ) {\n          init();\n        }\n      })\n    );\n\n    if (surfaceModel && this._referencedModel instanceof SurfaceElementModel) {\n      this._disposables.add(\n        surfaceModel.elementRemoved.on(({ id }) => {\n          if (this.model.reference === id) {\n            init();\n          }\n        })\n      );\n    }\n\n    if (this._referencedModel instanceof GfxBlockElementModel) {\n      this._disposables.add(\n        this.doc.slots.blockUpdated.on(({ type, id }) => {\n          if (type === 'delete' && id === this.model.reference) {\n            init();\n          }\n        })\n      );\n    }\n  }\n\n  private _initSelection() {\n    const selection = this.host.selection;\n    this._disposables.add(\n      selection.slots.changed.on(selList => {\n        this._focused = selList.some(\n          sel => sel.blockId === this.blockId && sel.is('block')\n        );\n      })\n    );\n  }\n\n  private _initSpec() {\n    const refreshViewport = this._refreshViewport.bind(this);\n    class PageViewWatcher extends BlockServiceWatcher {\n      static override readonly flavour = 'affine:page';\n\n      override mounted() {\n        this.blockService.disposables.add(\n          this.blockService.specSlots.viewConnected.once(({ component }) => {\n            const edgelessBlock =\n              component as EdgelessRootPreviewBlockComponent;\n\n            edgelessBlock.editorViewportSelector = 'ref-viewport';\n            edgelessBlock.service.viewport.sizeUpdated.once(() => {\n              refreshViewport();\n            });\n          })\n        );\n      }\n    }\n    this._previewSpec.extend([PageViewWatcher]);\n\n    const reference = this.model.reference;\n\n    class FrameViewWatcher extends BlockServiceWatcher {\n      static override readonly flavour = 'affine:frame';\n\n      override mounted() {\n        const disposable = this.blockService.specSlots.viewConnected.on(\n          ({ component }) => {\n            const frameBlock = component as FrameBlockComponent;\n            if (frameBlock.model.id !== reference) return;\n\n            frameBlock.showBorder = false;\n            disposable.dispose();\n\n            this.blockService.disposables.add(\n              frameBlock.model.xywh$.subscribe(() => {\n                refreshViewport();\n              })\n            );\n          }\n        );\n        this.blockService.disposables.add(disposable);\n      }\n    }\n\n    this._previewSpec.extend([FrameViewWatcher]);\n  }\n\n  private _refreshViewport() {\n    if (!this._referenceXYWH) return;\n\n    const previewEditorHost = this.previewEditor;\n\n    if (!previewEditorHost) return;\n\n    const edgelessService = previewEditorHost.std.getService(\n      'affine:page'\n    ) as EdgelessRootService;\n\n    edgelessService.viewport.setViewportByBound(\n      Bound.deserialize(this._referenceXYWH)\n    );\n  }\n\n  private _renderMask(\n    referencedModel: LumenSuite.EdgelessModel,\n    flavourOrType: string\n  ) {\n    const title = 'title' in referencedModel ? referencedModel.title : '';\n\n    return html`\n      <div class=\"surface-ref-mask\">\n        <div class=\"ref-label\">\n          <div class=\"title\">\n            ${REF_LABEL_ICON[flavourOrType ?? 'DEFAULT'] ??\n            REF_LABEL_ICON.DEFAULT}\n            <span>${title}</span>\n          </div>\n          <div class=\"suffix\">from edgeless mode</div>\n        </div>\n      </div>\n    `;\n  }\n\n  private _renderRefContent(referencedModel: LumenSuite.EdgelessModel) {\n    const [, , w, h] = deserializeXYWH(referencedModel.xywh);\n    const flavourOrType =\n      'flavour' in referencedModel\n        ? referencedModel.flavour\n        : referencedModel.type;\n    const _previewSpec = this._previewSpec.value;\n\n    return html`<div class=\"ref-content\">\n      <div\n        class=\"ref-viewport ${flavourOrType === 'affine:frame' ? 'frame' : ''}\"\n        style=${styleMap({\n          width: `${w}px`,\n          aspectRatio: `${w} / ${h}`,\n        })}\n      >\n        ${new BlockStdScope({\n          doc: this._previewDoc!,\n          extensions: _previewSpec,\n        }).render()}\n      </div>\n      ${this._renderMask(referencedModel, flavourOrType)}\n    </div>`;\n  }\n\n  private _renderRefPlaceholder(model: SurfaceRefBlockModel) {\n    return html`<div class=\"ref-placeholder\">\n      <div class=\"placeholder-image\">${noContentPlaceholder}</div>\n      <div class=\"placeholder-text\">\n        No Such\n        ${NO_CONTENT_TITLE[model.refFlavour ?? 'DEFAULT'] ??\n        NO_CONTENT_TITLE.DEFAULT}\n      </div>\n      <div class=\"placeholder-action\">\n        <button class=\"delete-button\" type=\"button\" @click=${this._deleteThis}>\n          <span class=\"icon\">${MoreDeleteIcon}</span\n          ><span>Delete this block</span>\n        </button>\n      </div>\n      <div class=\"placeholder-reason\">\n        ${NO_CONTENT_REASON[model.refFlavour ?? 'DEFAULT'] ??\n        NO_CONTENT_REASON.DEFAULT}\n      </div>\n    </div>`;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.contentEditable = 'false';\n\n    if (!this._shouldRender) return;\n\n    const service = this.service;\n    assertExists(service, `Surface ref block must run with its service.`);\n    this._initHotkey();\n    this._initSpec();\n    this._initReferencedModel();\n    this._initSelection();\n  }\n\n  override render() {\n    if (!this._shouldRender) return nothing;\n\n    const { _surfaceModel, _referencedModel, model } = this;\n    const isEmpty =\n      !_surfaceModel || !_referencedModel || !_referencedModel.xywh;\n    const content = isEmpty\n      ? this._renderRefPlaceholder(model)\n      : this._renderRefContent(_referencedModel);\n\n    return html`\n      <div\n        class=\"affine-surface-ref\"\n        @click=${this._focusBlock}\n        style=${styleMap({\n          outline: this._focused\n            ? '2px solid var(--affine-primary-color)'\n            : undefined,\n        })}\n      >\n        ${content}\n      </div>\n\n      <block-caption-editor></block-caption-editor>\n\n      ${Object.values(this.widgets)}\n    `;\n  }\n\n  viewInEdgeless() {\n    if (!this._referenceXYWH) return;\n\n    const viewport = {\n      xywh: this._referenceXYWH,\n      padding: [60, 20, 20, 20] as [number, number, number, number],\n    };\n    const pageService = this.std.getService('affine:page');\n\n    pageService.editPropsStore.setStorage('viewport', viewport);\n\n    this.std.get(DocModeProvider).setEditorMode('edgeless');\n  }\n\n  override willUpdate(_changedProperties: Map<PropertyKey, unknown>): void {\n    if (_changedProperties.has('_referencedModel')) {\n      this._refreshViewport();\n    }\n  }\n\n  @state()\n  private accessor _focused: boolean = false;\n\n  @state()\n  private accessor _surfaceModel: SurfaceBlockModel | null = null;\n\n  @query('affine-surface-ref > block-caption-editor')\n  accessor captionElement!: BlockCaptionEditor;\n\n  @query('editor-host')\n  accessor previewEditor!: EditorHost | null;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-surface-ref': SurfaceRefBlockComponent;\n  }\n}\n"]}