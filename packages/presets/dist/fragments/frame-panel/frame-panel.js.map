{"version":3,"file":"frame-panel.js","sourceRoot":"","sources":["../../../src/fragments/frame-panel/frame-panel.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@lumensuite/block-std';\nimport { FramePreview } from '@lumensuite/blocks';\nimport { DisposableGroup } from '@lumensuite/global/utils';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, type PropertyValues, unsafeCSS } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { AffineEditorContainer } from '../../index.js';\n\nimport './body/frame-panel-body.js';\nimport './header/frame-panel-header.js';\n\nconst styles = css`\n  frame-panel {\n    display: block;\n    width: 100%;\n    height: 100%;\n  }\n\n  .frame-panel-container {\n    background-color: var(--affine-background-primary-color);\n    box-sizing: border-box;\n\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n\n    height: 100%;\n    font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n    padding: 8px;\n  }\n\n  .frame-panel-body {\n    padding-top: 12px;\n    flex-grow: 1;\n    width: 100%;\n\n    overflow: auto;\n    overflow-x: hidden;\n    scrollbar-width: thin; /* For Firefox */\n    scrollbar-color: transparent transparent; /* For Firefox */\n  }\n\n  .frame-panel-body::-webkit-scrollbar {\n    width: 4px;\n  }\n\n  .frame-panel-body::-webkit-scrollbar-thumb {\n    border-radius: 2px;\n  }\n\n  .frame-panel-body:hover::-webkit-scrollbar-thumb {\n    background-color: var(--affine-black-30);\n  }\n\n  .frame-panel-body::-webkit-scrollbar-track {\n    background-color: transparent;\n  }\n\n  .frame-panel-body::-webkit-scrollbar-corner {\n    display: none;\n  }\n`;\n\nexport const AFFINE_FRAME_PANEL = 'affine-frame-panel';\n\n@customElement(AFFINE_FRAME_PANEL)\nexport class FramePanel extends WithDisposable(ShadowlessElement) {\n  static override styles = styles;\n\n  private _editorDisposables: DisposableGroup | null = null;\n\n  get doc() {\n    return this.editor.doc;\n  }\n\n  get edgeless() {\n    return this.editor.querySelector('affine-edgeless-root');\n  }\n\n  get host() {\n    return this.editor.host;\n  }\n\n  private _clearEditorDisposables() {\n    this._editorDisposables?.dispose();\n    this._editorDisposables = null;\n  }\n\n  private _setEditorDisposables() {\n    this._clearEditorDisposables();\n    this._editorDisposables = new DisposableGroup();\n    this._editorDisposables.add(\n      this.editor.slots.editorModeSwitched.on(() => {\n        this.editor.updateComplete\n          .then(() => this.requestUpdate())\n          .catch(console.error);\n      })\n    );\n    this._editorDisposables.add(\n      this.editor.slots.docUpdated.on(() => {\n        this.editor.updateComplete\n          .then(() => {\n            this.requestUpdate();\n          })\n          .catch(console.error);\n      })\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    if (!customElements.get('frame-preview')) {\n      customElements.define('frame-preview', FramePreview);\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._clearEditorDisposables();\n  }\n\n  override render() {\n    return html`<div class=\"frame-panel-container\">\n      <affine-frame-panel-header\n        .edgeless=${this.edgeless}\n        .editorHost=${this.host}\n      ></affine-frame-panel-header>\n      <affine-frame-panel-body\n        class=\"frame-panel-body\"\n        .edgeless=${this.edgeless}\n        .doc=${this.doc}\n        .editorHost=${this.host}\n        .fitPadding=${this.fitPadding}\n      ></affine-frame-panel-body>\n    </div>`;\n  }\n\n  override updated(_changedProperties: PropertyValues) {\n    if (_changedProperties.has('editor')) {\n      this._setEditorDisposables();\n    }\n  }\n\n  @property({ attribute: false })\n  accessor editor!: AffineEditorContainer;\n\n  @property({ attribute: false })\n  accessor fitPadding: number[] = [50, 380, 50, 50];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_FRAME_PANEL]: FramePanel;\n  }\n}\n"]}