{"version":3,"file":"backlink-popover.js","sourceRoot":"","sources":["../../../src/fragments/doc-meta-tags/backlink-popover.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAC;AACvD,OAAO,EAAE,cAAc,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAC;AACpE,OAAO,EAAE,SAAS,EAAE,MAAM,qBAAqB,CAAC;AAChD,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,UAAU,EAAE,SAAS,EAAE,MAAM,KAAK,CAAC;AACvD,OAAO,EAAE,aAAa,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAEzD,OAAO,EAAqB,gBAAgB,EAAE,MAAM,YAAY,CAAC;IAGpD,cAAc;4BAD1B,aAAa,CAAC,iBAAiB,CAAC;;;;sBACG,cAAc,CAAC,UAAU,CAAC;;;;8BAAlC,SAAQ,WAA0B;;;;wCAiH3D,KAAK,EAAE;YACR,yLAAiB,YAAY,6BAAZ,YAAY,mGAAS;YAlHxC,6KAmHC;;;;iBAlHiB,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;qBAoBT,SAAS,CAAC,SAAS,CAAC,cAAc,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAiDlD,cAAc,CAAC,0BAA0B,CAAC;GAC7C,AAtEqB,CAsEpB;QAYF,YAAY,SAAyB;YACnC,KAAK,EAAE,CAAC;YATV,uBAAuB;YACf,iBAAY,GAAG,CAAC,CAAQ,EAAE,EAAE;gBAClC,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI;oBAAE,OAAO;gBAC9B,IAAI,CAAC,IAAI,CAAC,YAAY;oBAAE,OAAO;gBAC/B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;gBAC1B,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YAC/D,CAAC,CAAC;YAiCe,0FAAe,KAAK,EAAC;;YA5BpC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;SAC7B;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAE1B,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QACpB,CAAC;QAED,OAAO;YACL,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC;YACvC,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QAC5D,CAAC;QAEQ,MAAM;YACb,iCAAiC;YACjC,MAAM,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC;YAClC,IAAI,CAAC,SAAS,CAAC,MAAM;gBAAE,OAAO,IAAI,CAAC;YAEnC,OAAO,IAAI,CAAA;iCACkB,IAAI,CAAC,OAAO;UACnC,cAAc,oBAAoB,SAAS,CAAC,MAAM;UAClD,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI;;KAE1D,CAAC;QACJ,CAAC;QAGD,+BAAsC;QAAtC,IAAiB,YAAY,kDAAS;QAAtC,IAAiB,YAAY,wDAAS;;YAlH3B,uDAAc;;;;;SAAd,cAAc;AAqH3B,SAAS,eAAe,CAAC,SAAyB;IAChD,OAAO,IAAI,CAAA;;aAEA,CAAC,CAAa,EAAE,EAAE,CAAC,CAAC,CAAC,eAAe,EAAE;;;;;UAKzC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;QACrB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,gBAAgB,CAAC;QAC7C,OAAO,IAAI,CAAA;;;oBAGD,KAAK;0BACC,IAAI,CAAC,IAAI;;cAErB,IAAI,CAAC,IAAI;yBACE,CAAC;IAClB,CAAC,CAAC;;;SAGD,CAAC;AACV,CAAC","sourcesContent":["import { WithDisposable } from '@blocksuite/block-std';\nimport { DualLinkIcon16, scrollbarStyle } from '@blocksuite/blocks';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, unsafeCSS } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\n\nimport { type BacklinkData, DEFAULT_DOC_NAME } from './utils.js';\n\n@customElement('backlink-button')\nexport class BacklinkButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      position: relative;\n      display: flex;\n    }\n\n    .btn {\n      padding: 0 12px;\n      box-sizing: border-box;\n      display: inline-flex;\n      align-items: center;\n      border: none;\n      height: 30px;\n      border-radius: 8px;\n      gap: 4px;\n      background: transparent;\n      cursor: pointer;\n\n      user-select: none;\n      font-size: var(--affine-font-sm);\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      fill: var(--affine-text-secondary-color);\n      color: var(--affine-text-secondary-color);\n      pointer-events: auto;\n    }\n\n    .btn > span {\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    .btn:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .btn:active {\n      background: var(--affine-hover-color);\n    }\n\n    .backlink-popover {\n      position: absolute;\n      left: 0;\n      bottom: 0;\n      transform: translateY(100%);\n      z-index: 1;\n      padding-top: 8px;\n    }\n\n    .menu {\n      display: flex;\n      flex-direction: column;\n      padding: 8px 4px;\n      background: var(--affine-white);\n      box-shadow: var(--affine-menu-shadow);\n      border-radius: 12px;\n    }\n\n    .backlink-popover .group-title {\n      color: var(--affine-text-secondary-color);\n      margin: 8px 12px;\n    }\n\n    .backlink-popover icon-button {\n      padding: 8px;\n      justify-content: flex-start;\n      gap: 8px;\n    }\n\n    ${scrollbarStyle('.backlink-popover .group')}\n  `;\n\n  private _backlinks: BacklinkData[];\n\n  // Handle click outside\n  private _onClickAway = (e: Event) => {\n    if (e.target === this) return;\n    if (!this._showPopover) return;\n    this._showPopover = false;\n    document.removeEventListener('mousedown', this._onClickAway);\n  };\n\n  constructor(backlinks: BacklinkData[]) {\n    super();\n\n    this._backlinks = backlinks;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.tabIndex = 0;\n  }\n\n  onClick() {\n    this._showPopover = !this._showPopover;\n    document.addEventListener('mousedown', this._onClickAway);\n  }\n\n  override render() {\n    // Only show linked doc backlinks\n    const backlinks = this._backlinks;\n    if (!backlinks.length) return null;\n\n    return html`\n      <div class=\"btn\" @click=\"${this.onClick}\">\n        ${DualLinkIcon16}<span>Backlinks (${backlinks.length})</span>\n        ${this._showPopover ? backlinkPopover(backlinks) : null}\n      </div>\n    `;\n  }\n\n  @state()\n  private accessor _showPopover = false;\n}\n\nfunction backlinkPopover(backlinks: BacklinkData[]) {\n  return html`<div\n    class=\"backlink-popover\"\n    @click=${(e: MouseEvent) => e.stopPropagation()}\n  >\n    <div class=\"menu\">\n      <div class=\"group-title\">Linked to this doc</div>\n      <div class=\"group\" style=\"overflow-y: scroll; max-height: 372px;\">\n        ${backlinks.map(link => {\n          const title = link.title || DEFAULT_DOC_NAME;\n          return html`<icon-button\n            width=\"248px\"\n            height=\"32px\"\n            text=\"${title}\"\n            @mousedown=\"${link.jump}\"\n          >\n            ${link.icon}\n          </icon-button>`;\n        })}\n      </div>\n    </div>\n  </div>`;\n}\n"]}