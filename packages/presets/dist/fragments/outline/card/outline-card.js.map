{"version":3,"file":"outline-card.js","sourceRoot":"","sources":["../../../../src/fragments/outline/card/outline-card.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockModel, Doc } from '@blocksuite/store';\n\nimport { SignalWatcher, WithDisposable } from '@blocksuite/block-std';\nimport {\n  createButtonPopper,\n  type NoteBlockModel,\n  NoteDisplayMode,\n  on,\n  once,\n  ThemeObserver,\n} from '@blocksuite/blocks';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, nothing, unsafeCSS } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport type { SelectEvent } from '../utils/custom-events.js';\n\nimport { HiddenIcon, SmallArrowDownIcon } from '../../_common/icons.js';\nimport './outline-preview.js';\n\nconst styles = css`\n  :host {\n    display: block;\n    position: relative;\n  }\n\n  .card-container {\n    position: relative;\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n  }\n\n  .card-preview {\n    position: relative;\n\n    width: 100%;\n\n    border-radius: 4px;\n\n    cursor: default;\n    user-select: none;\n  }\n\n  .card-preview.edgeless:hover {\n    background: var(--affine-hover-color);\n  }\n\n  .card-header-container {\n    padding: 0 8px;\n    width: 100%;\n    min-height: 28px;\n    display: none;\n    align-items: center;\n    gap: 8px;\n    box-sizing: border-box;\n  }\n\n  .card-header-container.enable-sorting {\n    display: flex;\n  }\n\n  .card-header-container .card-number {\n    text-align: center;\n    font-size: var(--affine-font-sm);\n    font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n    color: var(--affine-brand-color, #1e96eb);\n    font-weight: 500;\n    line-height: 14px;\n    line-height: 20px;\n  }\n\n  .card-header-container .card-header-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .card-header-container .card-divider {\n    height: 1px;\n    flex: 1;\n    border-top: 1px dashed var(--affine-border-color);\n    transform: translateY(50%);\n  }\n\n  .display-mode-button-group {\n    display: none;\n    align-items: center;\n    gap: 4px;\n    padding: 2px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 20px;\n    position: relative;\n  }\n\n  .card-preview:hover .display-mode-button-group {\n    display: flex;\n  }\n\n  .display-mode-button-label {\n    color: var(--affine-text-primary-color);\n  }\n\n  .display-mode-button {\n    display: flex;\n    border-radius: 4px;\n    background-color: var(--affine-hover-color);\n    align-items: center;\n  }\n\n  .current-mode-label {\n    display: flex;\n    padding: 2px 0px 2px 4px;\n    align-items: center;\n  }\n\n  note-display-mode-panel {\n    position: absolute;\n    display: none;\n    background: var(--affine-background-overlay-panel-color);\n    border-radius: 8px;\n    box-shadow: var(--affine-shadow-2);\n    box-sizing: border-box;\n    padding: 8px;\n    font-size: var(--affine-font-sm);\n    color: var(--affine-text-primary-color);\n    line-height: 22px;\n    font-weight: 400;\n    font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n  }\n\n  note-display-mode-panel[data-show] {\n    display: flex;\n  }\n\n  .card-content {\n    font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n    user-select: none;\n    color: var(--affine-text-primary-color);\n  }\n\n  .card-preview.edgeless .card-content:hover {\n    cursor: pointer;\n  }\n\n  .card-preview.edgeless .card-header-container:hover {\n    cursor: grab;\n  }\n\n  .card-container.placeholder {\n    pointer-events: none;\n    opacity: 0.5;\n  }\n\n  .card-container.selected .card-preview.edgeless {\n    background: var(--affine-hover-color);\n  }\n\n  .card-container.placeholder .card-preview.edgeless {\n    background: var(--affine-hover-color);\n    opacity: 0.9;\n  }\n\n  .card-container[data-sortable='true'] {\n    padding: 2px 0;\n  }\n\n  .card-container[data-invisible='true'] .card-header-container .card-number,\n  .card-container[data-invisible='true']\n    .card-header-container\n    .card-header-icon,\n  .card-container[data-invisible='true'] .card-preview .card-content {\n    color: var(--affine-text-disable-color);\n    pointer-events: none;\n  }\n\n  .card-preview.page outline-block-preview:hover {\n    color: var(--affine-brand-color);\n  }\n`;\n\nexport const AFFINE_OUTLINE_NOTE_CARD = 'affine-outline-note-card';\n\n@customElement(AFFINE_OUTLINE_NOTE_CARD)\nexport class OutlineNoteCard extends SignalWatcher(WithDisposable(LitElement)) {\n  static override styles = styles;\n\n  private _displayModePopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _dispatchClickBlockEvent(block: BlockModel) {\n    const event = new CustomEvent('clickblock', {\n      detail: {\n        blockId: block.id,\n      },\n    });\n\n    this.dispatchEvent(event);\n  }\n\n  private _dispatchDisplayModeChangeEvent(\n    note: NoteBlockModel,\n    newMode: NoteDisplayMode\n  ) {\n    const event = new CustomEvent('displaymodechange', {\n      detail: {\n        note,\n        newMode,\n      },\n    });\n\n    this.dispatchEvent(event);\n  }\n\n  private _dispatchDragEvent(e: MouseEvent) {\n    e.preventDefault();\n    if (\n      e.button !== 0 ||\n      this.editorMode === 'page' ||\n      !this.enableNotesSorting\n    )\n      return;\n\n    const { clientX: startX, clientY: startY } = e;\n    const disposeDragStart = on(this.ownerDocument, 'mousemove', e => {\n      if (\n        Math.abs(startX - e.clientX) < 5 &&\n        Math.abs(startY - e.clientY) < 5\n      ) {\n        return;\n      }\n      if (this.status !== 'selected') {\n        this._dispatchSelectEvent(e);\n      }\n\n      const event = new CustomEvent('drag');\n\n      this.dispatchEvent(event);\n      disposeDragStart();\n    });\n\n    once(this.ownerDocument, 'mouseup', () => {\n      disposeDragStart();\n    });\n  }\n\n  private _dispatchFitViewEvent(e: MouseEvent) {\n    e.stopPropagation();\n\n    const event = new CustomEvent('fitview', {\n      detail: {\n        block: this.note,\n      },\n    });\n\n    this.dispatchEvent(event);\n  }\n\n  private _dispatchSelectEvent(e: MouseEvent) {\n    e.stopPropagation();\n    const event = new CustomEvent('select', {\n      detail: {\n        id: this.note.id,\n        selected: this.status !== 'selected',\n        number: this.number,\n        multiselect: e.shiftKey,\n      },\n    }) as SelectEvent;\n\n    this.dispatchEvent(event);\n  }\n\n  private _getCurrentModeLabel(mode: NoteDisplayMode) {\n    switch (mode) {\n      case NoteDisplayMode.DocAndEdgeless:\n        return 'Both';\n      case NoteDisplayMode.EdgelessOnly:\n        return 'Edgeless';\n      case NoteDisplayMode.DocOnly:\n        return 'Page';\n      default:\n        return 'Both';\n    }\n  }\n\n  override firstUpdated() {\n    this._displayModePopper = createButtonPopper(\n      this._displayModeButtonGroup,\n      this._displayModePanel,\n      ({ display }) => {\n        this._showPopper = display === 'show';\n      },\n      {\n        mainAxis: 8,\n        crossAxis: -60,\n      }\n    );\n\n    this.disposables.add(this._displayModePopper);\n  }\n\n  override render() {\n    if (this.note.isEmpty.peek()) return nothing;\n\n    const mode = ThemeObserver.mode;\n    const { children, displayMode } = this.note;\n    const currentMode = this._getCurrentModeLabel(displayMode);\n    const cardHeaderClasses = classMap({\n      'card-header-container': true,\n      'enable-sorting': this.enableNotesSorting,\n    });\n\n    return html`\n      <div\n        data-invisible=\"${this.invisible ? 'true' : 'false'}\"\n        data-sortable=\"${this.enableNotesSorting ? 'true' : 'false'}\"\n        class=\"card-container ${this.status ?? ''} ${mode}\"\n      >\n        <div\n          class=\"card-preview ${this.editorMode}\"\n          @mousedown=${this._dispatchDragEvent}\n          @click=${this._dispatchSelectEvent}\n          @dblclick=${this._dispatchFitViewEvent}\n        >\n        ${html`<div class=${cardHeaderClasses}>\n          ${this.invisible\n            ? html`<span class=\"card-header-icon\">${HiddenIcon}</span>`\n            : html`<span class=\"card-number\">${this.number}</span>`}\n          <span class=\"card-divider\"></span>\n          <div class=\"display-mode-button-group\">\n            <span class=\"display-mode-button-label\">Show in</span>\n            <edgeless-tool-icon-button\n              .tooltip=${this._showPopper ? '' : 'Display Mode'}\n              .tipPosition=${'left-start'}\n              .iconContainerPadding=${0}\n              @click=${(e: MouseEvent) => {\n                e.stopPropagation();\n                this._displayModePopper?.toggle();\n              }}\n              @dblclick=${(e: MouseEvent) => e.stopPropagation()}\n            >\n              <div class=\"display-mode-button\">\n                <span class=\"current-mode-label\">${currentMode}</span>\n                ${SmallArrowDownIcon}\n              </div>\n            </edgeless-tool-icon-button>\n          </div>\n          <note-display-mode-panel\n            .displayMode=${displayMode}\n            .panelWidth=${220}\n            .onSelect=${(newMode: NoteDisplayMode) => {\n              this._dispatchDisplayModeChangeEvent(this.note, newMode);\n              this._displayModePopper?.hide();\n            }}\n          >\n          </note-display-mode-panel>\n        </div>`}\n          <div class=\"card-content\">\n            ${children.map(block => {\n              return html`<affine-outline-block-preview\n                .block=${block}\n                .className=${this.activeHeadingId === block.id ? 'active' : ''}\n                .showPreviewIcon=${this.showPreviewIcon}\n                .disabledIcon=${this.invisible}\n                .cardNumber=${this.number}\n                .enableNotesSorting=${this.enableNotesSorting}\n                @click=${() => {\n                  if (this.editorMode === 'edgeless' || this.invisible) return;\n                  this._dispatchClickBlockEvent(block);\n                }}\n              ></affine-outline-block-preview>`;\n            })}\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  @query('.display-mode-button-group')\n  private accessor _displayModeButtonGroup!: HTMLDivElement;\n\n  @query('note-display-mode-panel')\n  private accessor _displayModePanel!: HTMLDivElement;\n\n  @state()\n  private accessor _showPopper = false;\n\n  @property({ attribute: false })\n  accessor activeHeadingId: string | null = null;\n\n  @property({ attribute: false })\n  accessor doc!: Doc;\n\n  @property({ attribute: false })\n  accessor editorMode: 'page' | 'edgeless' = 'page';\n\n  @property({ attribute: false })\n  accessor enableNotesSorting!: boolean;\n\n  @property({ attribute: false })\n  accessor index!: number;\n\n  @property({ attribute: false })\n  accessor invisible = false;\n\n  @property({ attribute: false })\n  accessor note!: NoteBlockModel;\n\n  @property({ attribute: false })\n  accessor number!: number;\n\n  @property({ attribute: false })\n  accessor showPreviewIcon!: boolean;\n\n  @property({ attribute: false })\n  accessor status: 'selected' | 'placeholder' | undefined = undefined;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_OUTLINE_NOTE_CARD]: OutlineNoteCard;\n  }\n}\n"]}