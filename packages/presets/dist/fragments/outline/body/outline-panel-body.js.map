{"version":3,"file":"outline-panel-body.js","sourceRoot":"","sources":["../../../../src/fragments/outline/body/outline-panel-body.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  EdgelessRootBlockComponent,\n  NoteBlockModel,\n} from '@blocksuite/blocks';\nimport type { Doc } from '@blocksuite/store';\n\nimport { SignalWatcher, WithDisposable } from '@blocksuite/block-std';\nimport { BlocksUtils, NoteDisplayMode } from '@blocksuite/blocks';\nimport { Bound, DisposableGroup } from '@blocksuite/global/utils';\nimport { effect, signal } from '@lit-labs/preact-signals';\nimport { css, html, LitElement, nothing, type PropertyValues } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AffineEditorContainer } from '../../../editors/editor-container.js';\nimport type {\n  ClickBlockEvent,\n  DisplayModeChangeEvent,\n  FitViewEvent,\n  SelectEvent,\n} from '../utils/custom-events.js';\n\nimport '../card/outline-card.js';\nimport { startDragging } from '../utils/drag.js';\nimport {\n  getHeadingBlocksFromDoc,\n  getNotesFromDoc,\n  isHeadingBlock,\n} from '../utils/query.js';\nimport {\n  observeActiveHeadingDuringScroll,\n  scrollToBlockWithHighlight,\n} from '../utils/scroll.js';\nimport './outline-notice.js';\n\ntype OutlineNoteItem = {\n  note: NoteBlockModel;\n\n  /**\n   * the index of the note inside its parent's children property\n   */\n  index: number;\n\n  /**\n   * the number displayed on the outline panel\n   */\n  number: number;\n};\n\nconst styles = css`\n  .outline-panel-body-container {\n    position: relative;\n    display: flex;\n    align-items: start;\n    box-sizing: border-box;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    padding: 0 8px;\n  }\n\n  .panel-list {\n    position: relative;\n    width: 100%;\n  }\n\n  .panel-list .hidden-title {\n    width: 100%;\n    font-size: 14px;\n    line-height: 24px;\n    font-weight: 500;\n    color: var(--affine-text-secondary-color);\n    padding-left: 8px;\n    height: 40px;\n    box-sizing: border-box;\n    padding: 6px 8px;\n    margin-top: 8px;\n  }\n\n  .insert-indicator {\n    height: 2px;\n    border-radius: 1px;\n    background-color: var(--affine-brand-color);\n    border-radius: 1px;\n    position: absolute;\n    contain: layout size;\n    width: 100%;\n  }\n\n  .no-note-container {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n  }\n\n  .note-placeholder {\n    margin-top: 240px;\n    align-self: center;\n    width: 190px;\n    height: 48px;\n    color: var(--affine-text-secondary-color, #8e8d91);\n    text-align: center;\n    /* light/base */\n    font-size: 15px;\n    font-style: normal;\n    font-weight: 400;\n    line-height: 24px;\n  }\n`;\n\nexport const AFFINE_OUTLINE_PANEL_BODY = 'affine-outline-panel-body';\n\n@customElement(AFFINE_OUTLINE_PANEL_BODY)\nexport class OutlinePanelBody extends SignalWatcher(\n  WithDisposable(LitElement)\n) {\n  static override styles = styles;\n\n  private _activeHeadingId$ = signal<string | null>(null);\n\n  private _changedFlag = false;\n\n  private _clearHighlightMask = () => {};\n\n  private _docDisposables: DisposableGroup | null = null;\n\n  private _indicatorTranslateY = 0;\n\n  private _lockActiveHeadingId = false;\n\n  private _oldViewport?: {\n    zoom: number;\n    center: {\n      x: number;\n      y: number;\n    };\n  };\n\n  get viewportPadding(): [number, number, number, number] {\n    return this.fitPadding\n      ? ([0, 0, 0, 0].map((val, idx) =>\n          Number.isFinite(this.fitPadding[idx]) ? this.fitPadding[idx] : val\n        ) as [number, number, number, number])\n      : [0, 0, 0, 0];\n  }\n\n  private _clearDocDisposables() {\n    this._docDisposables?.dispose();\n    this._docDisposables = null;\n  }\n\n  /*\n   * Click at blank area to clear selection\n   */\n  private _clickHandler(e: MouseEvent) {\n    e.stopPropagation();\n    // check if click at outline-card, if so, do nothing\n    if (\n      (e.target as HTMLElement).closest('outline-note-card') ||\n      this._selected.length === 0\n    ) {\n      return;\n    }\n\n    this._selected = [];\n    this.edgeless?.service.selection.set({\n      elements: this._selected,\n      editing: false,\n    });\n  }\n\n  private _deSelectNoteInEdgelessMode(note: NoteBlockModel) {\n    if (!this._isEdgelessMode() || !this.edgeless) return;\n\n    const { selection } = this.edgeless.service;\n    if (!selection.has(note.id)) return;\n    const selectedIds = selection.selectedIds.filter(id => id !== note.id);\n    selection.set({\n      elements: selectedIds,\n      editing: false,\n    });\n  }\n\n  /*\n   * Double click at blank area to disable notes sorting option\n   */\n  private _doubleClickHandler(e: MouseEvent) {\n    e.stopPropagation();\n    // check if click at outline-card, if so, do nothing\n    if (\n      (e.target as HTMLElement).closest('outline-note-card') ||\n      !this.enableNotesSorting\n    ) {\n      return;\n    }\n\n    this.toggleNotesSorting();\n  }\n\n  private _drag() {\n    if (\n      !this._selected.length ||\n      !this._pageVisibleNotes.length ||\n      !this.doc.root\n    )\n      return;\n\n    this._dragging = true;\n\n    // cache the notes in case it is changed by other peers\n    const children = this.doc.root.children.slice() as NoteBlockModel[];\n    const notes = this._pageVisibleNotes;\n    const notesMap = this._pageVisibleNotes.reduce((map, note, index) => {\n      map.set(note.note.id, {\n        ...note,\n        number: index + 1,\n      });\n      return map;\n    }, new Map<string, OutlineNoteItem>());\n    const selected = this._selected.slice();\n\n    startDragging({\n      container: this,\n      document: this.ownerDocument,\n      host: this.domHost ?? this.ownerDocument,\n      doc: this.doc,\n      outlineListContainer: this.panelListElement,\n      onDragEnd: insertIdx => {\n        this._dragging = false;\n        this.insertIndex = undefined;\n\n        if (insertIdx === undefined) return;\n\n        this._moveNotes(insertIdx, selected, notesMap, notes, children);\n      },\n      onDragMove: (idx, indicatorTranslateY) => {\n        this.insertIndex = idx;\n        this._indicatorTranslateY = indicatorTranslateY ?? 0;\n      },\n    });\n  }\n\n  private _EmptyPanel() {\n    return html`<div class=\"no-note-container\">\n      <div class=\"note-placeholder\">\n        Use headings to create a table of contents.\n      </div>\n    </div>`;\n  }\n\n  private _fitToElement(e: FitViewEvent) {\n    const edgeless = this.edgeless;\n\n    if (!edgeless) return;\n\n    const { block } = e.detail;\n    const bound = Bound.deserialize(block.xywh);\n\n    edgeless.service.viewport.setViewportByBound(\n      bound,\n      this.viewportPadding,\n      true\n    );\n  }\n\n  // when display mode change to page only, we should de-select the note if it is selected in edgeless mode\n  private _handleDisplayModeChange(e: DisplayModeChangeEvent) {\n    const { note, newMode } = e.detail;\n    const { displayMode: currentMode } = note;\n    if (newMode === currentMode) {\n      return;\n    }\n\n    this.doc.updateBlock(note, { displayMode: newMode });\n\n    const noteParent = this.doc.getParent(note);\n    if (noteParent === null) {\n      console.error(`Failed to get parent of note(id:${note.id})`);\n      return;\n    }\n\n    const noteParentChildNotes = noteParent.children.filter(block =>\n      BlocksUtils.matchFlavours(block, ['affine:note'])\n    ) as NoteBlockModel[];\n    const noteParentLastNote =\n      noteParentChildNotes[noteParentChildNotes.length - 1];\n\n    // When the display mode of a note change from edgeless to page visible\n    // We should move the note to the end of the note list\n    if (\n      currentMode === NoteDisplayMode.EdgelessOnly &&\n      note !== noteParentLastNote\n    ) {\n      this.doc.moveBlocks([note], noteParent, noteParentLastNote, false);\n    }\n\n    // When the display mode of a note changed to page only\n    // We should check if the note is selected in edgeless mode\n    // If so, we should de-select it\n    if (newMode === NoteDisplayMode.DocOnly) {\n      this._deSelectNoteInEdgelessMode(note);\n    }\n  }\n\n  private _isEdgelessMode() {\n    return this.editor.mode === 'edgeless';\n  }\n\n  private _moveNotes(\n    index: number,\n    selected: string[],\n    notesMap: Map<string, OutlineNoteItem>,\n    notes: OutlineNoteItem[],\n    children: NoteBlockModel[]\n  ) {\n    if (!this._isEdgelessMode() || !children.length || !this.doc.root) return;\n\n    const blocks = selected.map(\n      id => (notesMap.get(id) as OutlineNoteItem).note\n    );\n    const draggingBlocks = new Set(blocks);\n    const targetIndex =\n      index === notes.length ? notes[index - 1].index + 1 : notes[index].index;\n\n    const leftPart = children\n      .slice(0, targetIndex)\n      .filter(block => !draggingBlocks.has(block));\n    const rightPart = children\n      .slice(targetIndex)\n      .filter(block => !draggingBlocks.has(block));\n    const newChildren = [...leftPart, ...blocks, ...rightPart];\n\n    this._changedFlag = true;\n    this.doc.updateBlock(this.doc.root, {\n      children: newChildren,\n    });\n  }\n\n  private _PanelList(withEdgelessOnlyNotes: boolean) {\n    const selectedNotesSet = new Set(this._selected);\n\n    return html`<div class=\"panel-list\">\n      ${this.insertIndex !== undefined\n        ? html`<div\n            class=\"insert-indicator\"\n            style=${`transform: translateY(${this._indicatorTranslateY}px)`}\n          ></div>`\n        : nothing}\n      ${this._renderDocTitle()}\n      ${this._pageVisibleNotes.length\n        ? repeat(\n            this._pageVisibleNotes,\n            note => note.note.id,\n            (note, idx) => html`\n              <affine-outline-note-card\n                data-note-id=${note.note.id}\n                .note=${note.note}\n                .number=${idx + 1}\n                .index=${note.index}\n                .doc=${this.doc}\n                .editorMode=${this.editor.mode}\n                .activeHeadingId=${this._activeHeadingId$.value}\n                .status=${selectedNotesSet.has(note.note.id)\n                  ? this._dragging\n                    ? 'placeholder'\n                    : 'selected'\n                  : undefined}\n                .showPreviewIcon=${this.showPreviewIcon}\n                .enableNotesSorting=${this.enableNotesSorting}\n                @select=${this._selectNote}\n                @drag=${this._drag}\n                @fitview=${this._fitToElement}\n                @clickblock=${(e: ClickBlockEvent) => {\n                  this._scrollToBlock(e.detail.blockId).catch(console.error);\n                }}\n                @displaymodechange=${this._handleDisplayModeChange}\n              ></affine-outline-note-card>\n            `\n          )\n        : html`${nothing}`}\n      ${withEdgelessOnlyNotes\n        ? html`<div class=\"hidden-title\">Hidden Contents</div>\n            ${repeat(\n              this._edgelessOnlyNotes,\n              note => note.note.id,\n              (note, idx) =>\n                html`<affine-outline-note-card\n                  data-note-id=${note.note.id}\n                  .note=${note.note}\n                  .number=${idx + 1}\n                  .index=${note.index}\n                  .doc=${this.doc}\n                  .activeHeadingId=${this._activeHeadingId$.value}\n                  .invisible=${true}\n                  .showPreviewIcon=${this.showPreviewIcon}\n                  .enableNotesSorting=${this.enableNotesSorting}\n                  @fitview=${this._fitToElement}\n                  @displaymodechange=${this._handleDisplayModeChange}\n                ></affine-outline-note-card>`\n            )} `\n        : nothing}\n    </div>`;\n  }\n\n  private _renderDocTitle() {\n    if (!this.doc.root) return nothing;\n\n    const hasNotEmptyHeadings =\n      getHeadingBlocksFromDoc(\n        this.doc,\n        [NoteDisplayMode.DocOnly, NoteDisplayMode.DocAndEdgeless],\n        true\n      ).length > 0;\n\n    if (!hasNotEmptyHeadings) return nothing;\n\n    return html`<affine-outline-block-preview\n      class=${classMap({\n        active: this.doc.root.id === this._activeHeadingId$.value,\n      })}\n      .block=${this.doc.root}\n      .className=${this.doc.root?.id === this._activeHeadingId$.value\n        ? 'active'\n        : ''}\n      .cardNumber=${1}\n      .enableNotesSorting=${false}\n      .showPreviewIcon=${this.showPreviewIcon}\n      @click=${() => {\n        if (!this.doc.root) return;\n        this._scrollToBlock(this.doc.root.id).catch(console.error);\n      }}\n    ></affine-outline-block-preview>`;\n  }\n\n  private async _scrollToBlock(blockId: string) {\n    this._lockActiveHeadingId = true;\n    this._activeHeadingId$.value = blockId;\n    this._clearHighlightMask = await scrollToBlockWithHighlight(\n      this.editor,\n      blockId\n    );\n    this._lockActiveHeadingId = false;\n  }\n\n  private _selectNote(e: SelectEvent) {\n    if (!this._isEdgelessMode()) return;\n\n    const { selected, id, multiselect } = e.detail;\n\n    if (!selected) {\n      this._selected = this._selected.filter(noteId => noteId !== id);\n    } else if (multiselect) {\n      this._selected = [...this._selected, id];\n    } else {\n      this._selected = [id];\n    }\n\n    // When edgeless mode, should select notes which display in both mode\n    const selectedIds = this._pageVisibleNotes.reduce((ids, item) => {\n      const note = item.note;\n      if (\n        this._selected.includes(note.id) &&\n        (!note.displayMode ||\n          note.displayMode === NoteDisplayMode.DocAndEdgeless)\n      ) {\n        ids.push(note.id);\n      }\n      return ids;\n    }, [] as string[]);\n    this.edgeless?.service.selection.set({\n      elements: selectedIds,\n      editing: false,\n    });\n  }\n\n  private _setDocDisposables() {\n    this._clearDocDisposables();\n    this._docDisposables = new DisposableGroup();\n    this._docDisposables.add(\n      effect(() => {\n        this._updateNotes();\n        this._updateNoticeVisibility();\n      })\n    );\n  }\n\n  /**\n   * There are two cases that we should render note list:\n   * 1. There are headings in the notes\n   * 2. No headings, but there are blocks in the notes and note sorting option is enabled\n   */\n  private _shouldRenderNoteList(noteItems: OutlineNoteItem[]) {\n    if (!noteItems.length) return false;\n\n    let hasHeadings = false;\n    let hasChildrenBlocks = false;\n\n    for (const noteItem of noteItems) {\n      for (const block of noteItem.note.children) {\n        hasChildrenBlocks = true;\n\n        if (isHeadingBlock(block)) {\n          hasHeadings = true;\n          break;\n        }\n      }\n\n      if (hasHeadings) {\n        break;\n      }\n    }\n\n    return hasHeadings || (this.enableNotesSorting && hasChildrenBlocks);\n  }\n\n  private _updateNotes() {\n    const rootModel = this.doc.root;\n\n    if (this._dragging) return;\n\n    if (!rootModel) {\n      this._pageVisibleNotes = [];\n      return;\n    }\n\n    const oldSelectedSet = this._selected.reduce((pre, id) => {\n      pre.add(id);\n      return pre;\n    }, new Set<string>());\n    const newSelected: string[] = [];\n\n    rootModel.children.forEach(block => {\n      if (!['affine:note'].includes(block.flavour)) return;\n\n      const blockModel = block as NoteBlockModel;\n\n      if (blockModel.displayMode !== NoteDisplayMode.EdgelessOnly) {\n        if (oldSelectedSet.has(block.id)) {\n          newSelected.push(block.id);\n        }\n      }\n    });\n\n    this._pageVisibleNotes = getNotesFromDoc(this.doc, [\n      NoteDisplayMode.DocAndEdgeless,\n      NoteDisplayMode.DocOnly,\n    ]);\n    this._edgelessOnlyNotes = getNotesFromDoc(this.doc, [\n      NoteDisplayMode.EdgelessOnly,\n    ]);\n    this._selected = newSelected;\n  }\n\n  private _updateNoticeVisibility() {\n    if (this.enableNotesSorting) {\n      if (this.noticeVisible) {\n        this.setNoticeVisibility(false);\n      }\n      return;\n    }\n\n    const shouldShowNotice = this._pageVisibleNotes.some(\n      note => note.note.displayMode === NoteDisplayMode.DocOnly\n    );\n\n    if (shouldShowNotice && !this.noticeVisible) {\n      this.setNoticeVisibility(true);\n    }\n  }\n\n  private _zoomToFit() {\n    const edgeless = this.edgeless;\n\n    if (!edgeless) return;\n\n    const bound = edgeless.getElementsBound();\n\n    if (!bound) return;\n\n    this._oldViewport = {\n      zoom: edgeless.service.viewport.zoom,\n      center: {\n        x: edgeless.service.viewport.center.x,\n        y: edgeless.service.viewport.center.y,\n      },\n    };\n    edgeless.service.viewport.setViewportByBound(\n      new Bound(bound.x, bound.y, bound.w, bound.h),\n      this.viewportPadding,\n      true\n    );\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    this.disposables.add(\n      observeActiveHeadingDuringScroll(\n        () => this.editor,\n        newHeadingId => {\n          if (this._lockActiveHeadingId) return;\n          this._activeHeadingId$.value = newHeadingId;\n        }\n      )\n    );\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n\n    if (!this._changedFlag && this._oldViewport) {\n      const edgeless = this.edgeless;\n\n      if (!edgeless) return;\n\n      edgeless.service.viewport.setViewport(\n        this._oldViewport.zoom,\n        [this._oldViewport.center.x, this._oldViewport.center.y],\n        true\n      );\n    }\n\n    this._clearDocDisposables();\n    this._clearHighlightMask();\n  }\n\n  override firstUpdated(): void {\n    this.disposables.addFromEvent(this, 'click', this._clickHandler);\n    this.disposables.addFromEvent(this, 'dblclick', this._doubleClickHandler);\n  }\n\n  override render() {\n    const shouldRenderPageVisibleNotes = this._shouldRenderNoteList(\n      this._pageVisibleNotes\n    );\n    const shouldRenderEdgelessOnlyNotes =\n      this.renderEdgelessOnlyNotes &&\n      this._shouldRenderNoteList(this._edgelessOnlyNotes);\n\n    const shouldRenderEmptyPanel =\n      !shouldRenderPageVisibleNotes && !shouldRenderEdgelessOnlyNotes;\n\n    return html`\n      <div class=\"outline-panel-body-container\">\n        ${shouldRenderEmptyPanel\n          ? this._EmptyPanel()\n          : this._PanelList(shouldRenderEdgelessOnlyNotes)}\n      </div>\n    `;\n  }\n\n  override willUpdate(_changedProperties: PropertyValues) {\n    if (_changedProperties.has('doc') || _changedProperties.has('edgeless')) {\n      this._setDocDisposables();\n    }\n\n    if (\n      _changedProperties.has('mode') &&\n      this.edgeless &&\n      this._isEdgelessMode()\n    ) {\n      this._clearHighlightMask();\n      if (_changedProperties.get('mode') === undefined) return;\n\n      requestAnimationFrame(() => this._zoomToFit());\n    }\n  }\n\n  @state()\n  private accessor _dragging = false;\n\n  @state()\n  private accessor _edgelessOnlyNotes: OutlineNoteItem[] = [];\n\n  @state()\n  private accessor _pageVisibleNotes: OutlineNoteItem[] = [];\n\n  /**\n   * store the id of selected notes\n   */\n  @state()\n  private accessor _selected: string[] = [];\n\n  @property({ attribute: false })\n  accessor doc!: Doc;\n\n  @property({ attribute: false })\n  accessor domHost!: Document | HTMLElement;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent | null;\n\n  @property({ attribute: false })\n  accessor editor!: AffineEditorContainer;\n\n  @property({ attribute: false })\n  accessor enableNotesSorting!: boolean;\n\n  @property({ attribute: false })\n  accessor fitPadding!: number[];\n\n  @property({ attribute: false })\n  accessor insertIndex: number | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor noticeVisible!: boolean;\n\n  @query('.outline-panel-body-container')\n  accessor OutlinePanelContainer!: HTMLElement;\n\n  @query('.panel-list')\n  accessor panelListElement!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor renderEdgelessOnlyNotes: boolean = true;\n\n  @property({ attribute: false })\n  accessor setNoticeVisibility!: (visibility: boolean) => void;\n\n  @property({ attribute: false })\n  accessor showPreviewIcon!: boolean;\n\n  @property({ attribute: false })\n  accessor toggleNotesSorting!: () => void;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_OUTLINE_PANEL_BODY]: OutlinePanelBody;\n  }\n}\n"]}