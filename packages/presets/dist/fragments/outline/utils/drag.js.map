{"version":3,"file":"drag.js","sourceRoot":"","sources":["../../../../src/fragments/outline/utils/drag.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Doc } from '@lumensuite/store';\n\nimport { on, once } from '@lumensuite/blocks';\n\nimport type { OutlinePanelBody } from '../body/outline-panel-body.js';\nimport type { OutlineNoteCard } from '../card/outline-card.js';\n\n/**\n * start drag notes\n * @param notes notes to drag\n */\nexport function startDragging(options: {\n  onDragEnd?: (insertIndex?: number) => void;\n  onDragMove?: (insertIdx?: number, indicatorTranslateY?: number) => void;\n  outlineListContainer: HTMLElement;\n  document: Document;\n  host: Document | HTMLElement;\n  container: OutlinePanelBody;\n  doc: Doc;\n}) {\n  const {\n    document,\n    host,\n    container,\n    onDragMove,\n    onDragEnd,\n    outlineListContainer,\n  } = options;\n  const maskElement = createMaskElement(document);\n  const listContainerRect = outlineListContainer.getBoundingClientRect();\n  const children = Array.from(\n    outlineListContainer.children\n  ) as OutlineNoteCard[];\n  let idx: undefined | number;\n  let indicatorTranslateY: undefined | number;\n\n  container.renderRoot.append(maskElement);\n\n  const insideListContainer = (e: MouseEvent) => {\n    return (\n      e.clientX >= listContainerRect.left &&\n      e.clientX <= listContainerRect.right &&\n      e.clientY >= listContainerRect.top &&\n      e.clientY <= listContainerRect.bottom\n    );\n  };\n\n  const disposeMove = on(container, 'mousemove', e => {\n    if (!insideListContainer(e)) {\n      idx = undefined;\n      onDragMove?.(idx, 0);\n      return;\n    }\n\n    idx = 0;\n    for (const note of children) {\n      if (note.invisible || !note.note) break;\n\n      const topBoundary =\n        listContainerRect.top + note.offsetTop - outlineListContainer.scrollTop;\n      const midBoundary = topBoundary + note.offsetHeight / 2;\n      const bottomBoundary = topBoundary + note.offsetHeight;\n\n      if (e.clientY >= topBoundary && e.clientY <= bottomBoundary) {\n        idx = e.clientY > midBoundary ? idx + 1 : idx;\n\n        indicatorTranslateY =\n          e.clientY > midBoundary ? bottomBoundary : topBoundary;\n        indicatorTranslateY -= listContainerRect.top;\n\n        onDragMove?.(idx, indicatorTranslateY);\n        return;\n      }\n\n      ++idx;\n    }\n\n    onDragMove?.(idx);\n  });\n\n  let ended = false;\n  const dragEnd = () => {\n    if (ended) return;\n\n    ended = true;\n    maskElement.remove();\n\n    disposeMove();\n    onDragEnd?.(idx);\n  };\n\n  once(host as Document, 'mouseup', dragEnd);\n}\n\nfunction createMaskElement(doc: Document) {\n  const mask = doc.createElement('div');\n\n  mask.style.height = '100vh';\n  mask.style.width = '100vw';\n  mask.style.position = 'fixed';\n  mask.style.left = '0';\n  mask.style.top = '0';\n  mask.style.zIndex = 'calc(var(--affine-z-index-popover, 0) + 3)';\n  mask.style.cursor = 'grabbing';\n\n  return mask;\n}\n"]}