{"version":3,"file":"setup.js","sourceRoot":"","sources":["../../../src/__tests__/utils/setup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockCollection } from '@blocksuite/store';\n\nimport {\n  CommunityCanvasTextFonts,\n  type DocMode,\n  FontConfigExtension,\n} from '@blocksuite/blocks';\nimport { AffineSchemas } from '@blocksuite/blocks/schemas';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  DocCollection,\n  IdGeneratorType,\n  Schema,\n  Text,\n} from '@blocksuite/store';\n\nimport { AffineEditorContainer } from '../../index.js';\n\nfunction createCollectionOptions() {\n  const schema = new Schema();\n  const room = Math.random().toString(16).slice(2, 8);\n\n  schema.register(AffineSchemas);\n\n  const idGenerator: IdGeneratorType = IdGeneratorType.AutoIncrement; // works only in single user mode\n\n  return {\n    id: room,\n    schema,\n    idGenerator,\n    defaultFlags: {\n      enable_synced_doc_block: true,\n      enable_pie_menu: true,\n      readonly: {\n        'doc:home': false,\n      },\n    },\n  };\n}\n\nfunction initCollection(collection: DocCollection) {\n  const doc = collection.createDoc({ id: 'doc:home' });\n\n  doc.load(() => {\n    const rootId = doc.addBlock('affine:page', {\n      title: new Text(),\n    });\n    doc.addBlock('affine:surface', {}, rootId);\n  });\n  doc.resetHistory();\n}\n\nasync function createEditor(collection: DocCollection, mode: DocMode = 'page') {\n  const app = document.createElement('div');\n  const blockCollection = collection.docs.values().next().value as\n    | BlockCollection\n    | undefined;\n  assertExists(blockCollection, 'Need to create a doc first');\n  const doc = blockCollection.getDoc();\n  const editor = new AffineEditorContainer();\n  editor.doc = doc;\n  editor.mode = mode;\n  editor.pageSpecs = editor.pageSpecs.concat([\n    FontConfigExtension(CommunityCanvasTextFonts),\n  ]);\n  editor.edgelessSpecs = editor.edgelessSpecs.concat([\n    FontConfigExtension(CommunityCanvasTextFonts),\n  ]);\n  app.append(editor);\n\n  window.editor = editor;\n  window.doc = doc;\n\n  app.style.width = '100%';\n  app.style.height = '1280px';\n\n  document.body.append(app);\n  await editor.updateComplete;\n  return app;\n}\n\nexport async function setupEditor(mode: DocMode = 'page') {\n  const collection = new DocCollection(createCollectionOptions());\n  collection.meta.initialize();\n\n  window.collection = collection;\n\n  initCollection(collection);\n  const appElement = await createEditor(collection, mode);\n\n  return () => {\n    appElement.remove();\n    cleanup();\n  };\n}\n\nexport function cleanup() {\n  window.editor.remove();\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  delete (window as any).collection;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  delete (window as any).editor;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  delete (window as any).doc;\n}\n"]}