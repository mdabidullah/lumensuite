{"version":3,"file":"migrate-collection.js","sourceRoot":"","sources":["../../src/migration/migrate-collection.ts"],"names":[],"mappings":"AAQA,MAAM,CAAC,MAAM,oBAAoB,GAA0B;IACzD;QACE,IAAI,EAAE,yBAAyB;QAC/B,SAAS,EAAE,CAAC,OAAc,EAAE,EAAE;YAC5B,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACpC,MAAM,gBAAgB,GAAG,IAAI,CAAC,GAAG,CAAC,kBAAkB,CAAW,CAAC;YAChE,OAAO,gBAAgB,GAAG,CAAC,CAAC;QAC9B,CAAC;QACD,OAAO,EAAE,CAAC,OAAc,EAAE,EAAE;YAC1B,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACpC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;YAC3B,IAAI,CAAC,GAAG,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC;QAClC,CAAC;KACF;CACF,CAAC","sourcesContent":["import type * as Y from 'yjs';\n\ninterface ICollctionMigration {\n  desc: string;\n  condition: (rootDoc: Y.Doc) => boolean;\n  migrate: (rootDoc: Y.Doc) => void;\n}\n\nexport const collectionMigrations: ICollctionMigration[] = [\n  {\n    desc: 'add pageVersion in meta',\n    condition: (rootDoc: Y.Doc) => {\n      const meta = rootDoc.getMap('meta');\n      const workspaceVersion = meta.get('workspaceVersion') as number;\n      return workspaceVersion < 2;\n    },\n    migrate: (rootDoc: Y.Doc) => {\n      const meta = rootDoc.getMap('meta');\n      meta.set('pageVersion', 1);\n      meta.set('workspaceVersion', 2);\n    },\n  },\n];\n"]}