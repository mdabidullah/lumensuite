{"version":3,"file":"pointer.js","sourceRoot":"","sources":["../../../src/event/control/pointer.ts"],"names":[],"mappings":"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","sourcesContent":["import { IS_IPAD } from '@blocksuite/global/env';\n\nimport type { UIEventDispatcher } from '../dispatcher.js';\n\nimport { UIEventState, UIEventStateContext } from '../base.js';\nimport { MultiPointerEventState, PointerEventState } from '../state/index.js';\nimport { EventScopeSourceType, EventSourceState } from '../state/source.js';\nimport { center, isFarEnough } from '../utils.js';\n\ntype PointerId = typeof PointerEvent.prototype.pointerId;\n\nfunction createContext(\n  event: Event,\n  state: PointerEventState | MultiPointerEventState\n) {\n  return UIEventStateContext.from(\n    new UIEventState(event),\n    new EventSourceState({\n      event,\n      sourceType: EventScopeSourceType.Target,\n    }),\n    state\n  );\n}\n\nabstract class PointerControllerBase {\n  protected get _rect() {\n    return this._dispatcher.host.getBoundingClientRect();\n  }\n\n  constructor(protected _dispatcher: UIEventDispatcher) {}\n\n  abstract listen(): void;\n}\n\nclass PointerEventForward extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    const { pointerId } = event;\n\n    const pointerState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n    this._startStates.set(pointerId, pointerState);\n    this._lastStates.set(pointerId, pointerState);\n    this._dispatcher.run('pointerDown', createContext(event, pointerState));\n  };\n\n  private _lastStates = new Map<PointerId, PointerEventState>();\n\n  private _move = (event: PointerEvent) => {\n    const { pointerId } = event;\n\n    const start = this._startStates.get(pointerId) ?? null;\n    const last = this._lastStates.get(pointerId) ?? null;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: start?.x ?? -Infinity,\n      startY: start?.y ?? -Infinity,\n      last,\n    });\n    this._lastStates.set(pointerId, state);\n\n    this._dispatcher.run('pointerMove', createContext(event, state));\n  };\n\n  private _startStates = new Map<PointerId, PointerEventState>();\n\n  private _upOrOut = (up: boolean) => (event: PointerEvent) => {\n    const { pointerId } = event;\n\n    const start = this._startStates.get(pointerId) ?? null;\n    const last = this._lastStates.get(pointerId) ?? null;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: start?.x ?? -Infinity,\n      startY: start?.y ?? -Infinity,\n      last,\n    });\n\n    this._startStates.delete(pointerId);\n    this._lastStates.delete(pointerId);\n\n    this._dispatcher.run(\n      up ? 'pointerUp' : 'pointerOut',\n      createContext(event, state)\n    );\n  };\n\n  listen() {\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    disposables.addFromEvent(host, 'pointermove', this._move);\n    disposables.addFromEvent(host, 'pointerup', this._upOrOut(true));\n    disposables.addFromEvent(host, 'pointerout', this._upOrOut(false));\n  }\n}\n\nclass ClickController extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    // disable for secondary pointer\n    if (event.isPrimary === false) return;\n\n    if (\n      this._downPointerState &&\n      event.pointerId === this._downPointerState.raw.pointerId &&\n      event.timeStamp - this._downPointerState.raw.timeStamp < 500 &&\n      !isFarEnough(event, this._downPointerState.raw)\n    ) {\n      this._pointerDownCount++;\n    } else {\n      this._pointerDownCount = 1;\n    }\n\n    this._downPointerState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n  };\n\n  private _downPointerState: PointerEventState | null = null;\n\n  private _pointerDownCount = 0;\n\n  private _up = (event: PointerEvent) => {\n    if (!this._downPointerState) return;\n\n    if (isFarEnough(this._downPointerState.raw, event)) {\n      this._pointerDownCount = 0;\n      this._downPointerState = null;\n      return;\n    }\n\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n    const context = createContext(event, state);\n\n    const run = () => {\n      this._dispatcher.run('pointerUp', context);\n      this._dispatcher.run('click', context);\n      if (this._pointerDownCount === 2) {\n        this._dispatcher.run('doubleClick', context);\n      }\n      if (this._pointerDownCount === 3) {\n        this._dispatcher.run('tripleClick', context);\n      }\n    };\n\n    run();\n  };\n\n  listen() {\n    const { host, disposables } = this._dispatcher;\n\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    disposables.addFromEvent(host, 'pointerup', this._up);\n  }\n}\n\nclass DragController extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    if (!event.isPrimary) {\n      if (this._dragging && this._lastPointerState) {\n        this._up(this._lastPointerState.raw);\n      }\n      this._reset();\n      return;\n    }\n\n    const pointerState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n    this._startPointerState = pointerState;\n\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'pointermove',\n      this._move\n    );\n    this._dispatcher.disposables.addFromEvent(document, 'pointerup', this._up);\n  };\n\n  private _dragging = false;\n\n  private _lastPointerState: PointerEventState | null = null;\n\n  private _move = (event: PointerEvent) => {\n    if (\n      this._startPointerState === null ||\n      this._startPointerState.raw.pointerId !== event.pointerId\n    )\n      return;\n\n    const start = this._startPointerState;\n    const last = this._lastPointerState ?? start;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: start.x,\n      startY: start.y,\n      last,\n    });\n\n    this._lastPointerState = state;\n\n    if (!this._dragging && isFarEnough(event, this._startPointerState.raw)) {\n      this._dragging = true;\n      this._dispatcher.run('dragStart', createContext(event, start));\n    }\n\n    if (this._dragging) {\n      this._dispatcher.run('dragMove', createContext(event, state));\n    }\n  };\n\n  private _reset = () => {\n    this._dragging = false;\n    this._startPointerState = null;\n    this._lastPointerState = null;\n\n    document.removeEventListener('pointermove', this._move);\n    document.removeEventListener('pointerup', this._up);\n  };\n\n  private _startPointerState: PointerEventState | null = null;\n\n  private _up = (event: PointerEvent) => {\n    if (\n      !this._startPointerState ||\n      this._startPointerState.raw.pointerId !== event.pointerId\n    )\n      return;\n\n    const start = this._startPointerState;\n    const last = this._lastPointerState;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: start.x,\n      startY: start.y,\n      last,\n    });\n\n    if (this._dragging) {\n      this._dispatcher.run('dragEnd', createContext(event, state));\n    }\n\n    this._reset();\n  };\n\n  // https://mikepk.com/2020/10/iOS-safari-scribble-bug/\n  private _applyScribblePatch() {\n    if (!IS_IPAD) return;\n\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'touchmove', (event: TouchEvent) => {\n      if (\n        this._dragging &&\n        this._startPointerState &&\n        this._startPointerState.raw.pointerType === 'pen'\n      ) {\n        event.preventDefault();\n      }\n    });\n  }\n\n  listen() {\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    this._applyScribblePatch();\n  }\n}\n\nabstract class DualDragControllerBase extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    // Another pointer down\n    if (\n      this._startPointerStates.primary !== null &&\n      this._startPointerStates.secondary !== null\n    ) {\n      this._reset();\n    }\n\n    if (this._startPointerStates.primary === null && !event.isPrimary) {\n      return;\n    }\n\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n\n    if (event.isPrimary) {\n      this._startPointerStates.primary = state;\n    } else {\n      this._startPointerStates.secondary = state;\n    }\n  };\n\n  private _lastPointerStates: {\n    primary: PointerEventState | null;\n    secondary: PointerEventState | null;\n  } = {\n    primary: null,\n    secondary: null,\n  };\n\n  private _move = (event: PointerEvent) => {\n    if (\n      this._startPointerStates.primary === null ||\n      this._startPointerStates.secondary === null\n    ) {\n      return;\n    }\n\n    const { pointerId } = event;\n\n    const start1 =\n      this._startPointerStates.primary.raw.pointerId === pointerId\n        ? this._startPointerStates.primary\n        : this._startPointerStates.secondary;\n\n    const last1 =\n      (this._lastPointerStates.primary?.raw.pointerId === pointerId\n        ? this._lastPointerStates.primary\n        : this._lastPointerStates.secondary) ?? start1;\n\n    if (!isFarEnough(last1.raw, event)) return;\n\n    const state1 = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: start1.x,\n      startY: start1.y,\n      last: last1,\n    });\n\n    const start2 =\n      this._startPointerStates.primary.raw.pointerId !== pointerId\n        ? this._startPointerStates.primary\n        : this._startPointerStates.secondary;\n\n    const last2 =\n      (this._lastPointerStates.primary?.raw.pointerId !== pointerId\n        ? this._lastPointerStates.primary\n        : this._lastPointerStates.secondary) ?? start2;\n\n    const state2 = new PointerEventState({\n      event: last2.raw,\n      rect: this._rect,\n      startX: start2.x,\n      startY: start2.y,\n      last: last2,\n    });\n\n    if (!isFarEnough(state1.delta, state2.delta)) return;\n\n    const multiPointerState = new MultiPointerEventState(event, [\n      state1,\n      state2,\n    ]);\n\n    this._handleMove(event, multiPointerState);\n\n    this._lastPointerStates = {\n      primary: state1.raw.isPrimary ? state1 : state2,\n      secondary: state1.raw.isPrimary ? state2 : state1,\n    };\n  };\n\n  private _reset = () => {\n    this._startPointerStates = {\n      primary: null,\n      secondary: null,\n    };\n    this._lastPointerStates = {\n      primary: null,\n      secondary: null,\n    };\n  };\n\n  private _startPointerStates: {\n    primary: PointerEventState | null;\n    secondary: PointerEventState | null;\n  } = {\n    primary: null,\n    secondary: null,\n  };\n\n  private _upOrOut = (event: PointerEvent) => {\n    const { pointerId } = event;\n    if (\n      pointerId === this._startPointerStates.primary?.raw.pointerId ||\n      pointerId === this._startPointerStates.secondary?.raw.pointerId\n    ) {\n      this._reset();\n    }\n  };\n\n  abstract _handleMove(\n    event: PointerEvent,\n    state: MultiPointerEventState\n  ): void;\n\n  override listen(): void {\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    disposables.addFromEvent(host, 'pointermove', this._move);\n    disposables.addFromEvent(host, 'pointerup', this._upOrOut);\n    disposables.addFromEvent(host, 'pointerout', this._upOrOut);\n  }\n}\n\nclass PinchController extends DualDragControllerBase {\n  override _handleMove(event: PointerEvent, state: MultiPointerEventState) {\n    if (event.pointerType !== 'touch') return;\n\n    // the changes of distance between two pointers is not far enough\n    if (!isFarEnough(state.pointers[0].delta, state.pointers[1].delta)) return;\n\n    this._dispatcher.run('pinch', createContext(event, state));\n  }\n}\n\nclass PanController extends DualDragControllerBase {\n  override _handleMove(event: PointerEvent, state: MultiPointerEventState) {\n    if (event.pointerType !== 'touch') return;\n\n    //  current center,          last center   = center move vector\n    // 0.5 * (a + da + b + db) - 0.5 * (a + b) = 0.5 * (da + db)\n    const centerMoveVec = center(\n      state.pointers[0].delta,\n      state.pointers[1].delta\n    );\n\n    // the center move distance is not far enough\n    if (!isFarEnough({ x: 0, y: 0 }, centerMoveVec)) return;\n\n    this._dispatcher.run('pan', createContext(event, state));\n  }\n}\n\nexport class PointerControl {\n  private controllers: PointerControllerBase[];\n\n  constructor(_dispatcher: UIEventDispatcher) {\n    this.controllers = [\n      new PointerEventForward(_dispatcher),\n      new ClickController(_dispatcher),\n      new DragController(_dispatcher),\n      new PanController(_dispatcher),\n      new PinchController(_dispatcher),\n    ];\n  }\n\n  listen() {\n    this.controllers.forEach(controller => controller.listen());\n  }\n}\n"]}