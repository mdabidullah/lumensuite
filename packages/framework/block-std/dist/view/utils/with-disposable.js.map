{"version":3,"file":"with-disposable.js","sourceRoot":"","sources":["../../../src/view/utils/with-disposable.ts"],"names":[],"mappings":"AAEA,OAAO,EAAoB,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAU7E;;;;;;;;;;;;;;;GAeG;AACH,MAAM,UAAU,cAAc,CAC5B,UAAa;IAEb,MAAM,YAAa,SAAQ,UAAU;QAArC;;YACY,iBAAY,GAAG,IAAI,eAAe,EAAE,CAAC;QAiBjD,CAAC;QAfC,IAAI,WAAW;YACb,OAAO,IAAI,CAAC,YAAY,CAAC;QAC3B,CAAC;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAC1B,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;gBAC/B,IAAI,CAAC,YAAY,GAAG,IAAI,eAAe,EAAE,CAAC;YAC5C,CAAC;QACH,CAAC;QAEQ,oBAAoB;YAC3B,KAAK,CAAC,oBAAoB,EAAE,CAAC;YAC7B,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;QAC9B,CAAC;KACF;IACD,OAAO,YAA2D,CAAC;AACrE,CAAC","sourcesContent":["import type { LitElement } from 'lit';\n\nimport { type Constructor, DisposableGroup } from '@lumensuite/global/utils';\n\n// See https://lit.dev/docs/composition/mixins/#mixins-in-typescript\n// This definition should be exported, see https://github.com/microsoft/TypeScript/issues/30355#issuecomment-839834550\nexport declare class DisposableClass {\n  protected _disposables: DisposableGroup;\n\n  readonly disposables: DisposableGroup;\n}\n\n/**\n * Mixin that adds a `_disposables: DisposableGroup` property to the class.\n *\n * The `_disposables` property is initialized in `connectedCallback` and disposed in `disconnectedCallback`.\n *\n * see https://lit.dev/docs/composition/mixins/\n *\n * @example\n * ```ts\n * class MyElement extends WithDisposable(ShadowlessElement) {\n *   onClick() {\n *     this._disposables.add(...);\n *   }\n * }\n * ```\n */\nexport function WithDisposable<T extends Constructor<LitElement>>(\n  SuperClass: T\n) {\n  class DerivedClass extends SuperClass {\n    protected _disposables = new DisposableGroup();\n\n    get disposables() {\n      return this._disposables;\n    }\n\n    override connectedCallback() {\n      super.connectedCallback();\n      if (this._disposables.disposed) {\n        this._disposables = new DisposableGroup();\n      }\n    }\n\n    override disconnectedCallback() {\n      super.disconnectedCallback();\n      this._disposables.dispose();\n    }\n  }\n  return DerivedClass as unknown as T & Constructor<DisposableClass>;\n}\n"]}