{"version":3,"file":"widget-component.js","sourceRoot":"","sources":["../../../src/view/element/widget-component.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockModel, Doc } from '@blocksuite/store';\n\nimport { consume } from '@lit/context';\nimport { LitElement } from 'lit';\n\nimport type { EventName, UIEventHandler } from '../../event/index.js';\nimport type { BlockService } from '../../extension/index.js';\nimport type { BlockStdScope } from '../../scope/index.js';\nimport type { BlockComponent } from './block-component.js';\n\nimport { SignalWatcher } from '../signal-watcher.js';\nimport { WithDisposable } from '../utils/with-disposable.js';\nimport { modelContext, serviceContext } from './consts.js';\nimport { docContext, stdContext } from './lit-host.js';\n\nexport class WidgetComponent<\n  Model extends BlockModel = BlockModel,\n  B extends BlockComponent = BlockComponent,\n  S extends BlockService = BlockService,\n> extends SignalWatcher(WithDisposable(LitElement)) {\n  handleEvent = (\n    name: EventName,\n    handler: UIEventHandler,\n    options?: { global?: boolean }\n  ) => {\n    this._disposables.add(\n      this.host.event.add(name, handler, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  };\n\n  get block() {\n    return this.std.view.getBlock(this.model.id) as B;\n  }\n\n  get doc() {\n    return this._doc;\n  }\n\n  get flavour(): string {\n    return this.model.flavour;\n  }\n\n  get host() {\n    return this.std.host;\n  }\n\n  get model() {\n    return this._model;\n  }\n\n  get service() {\n    return this._service;\n  }\n\n  get std() {\n    return this._std;\n  }\n\n  get widgetId() {\n    return this.dataset.widgetId as string;\n  }\n\n  bindHotKey(\n    keymap: Record<string, UIEventHandler>,\n    options?: { global: boolean }\n  ) {\n    this._disposables.add(\n      this.host.event.bindHotkey(keymap, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.std.view.setWidget(this);\n\n    this.service.specSlots.widgetConnected.emit({\n      service: this.service,\n      component: this,\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.std?.view.deleteWidget(this);\n    this.service.specSlots.widgetDisconnected.emit({\n      service: this.service,\n      component: this,\n    });\n  }\n\n  override render(): unknown {\n    return null;\n  }\n\n  @consume({ context: docContext })\n  private accessor _doc!: Doc;\n\n  @consume({ context: modelContext })\n  private accessor _model!: Model;\n\n  @consume({ context: serviceContext as never })\n  private accessor _service!: S;\n\n  @consume({ context: stdContext })\n  private accessor _std!: BlockStdScope;\n}\n"]}