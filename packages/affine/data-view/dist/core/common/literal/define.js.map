{"version":3,"file":"define.js","sourceRoot":"","sources":["../../../../src/core/common/literal/define.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  createPopup,\n  popMenu,\n} from '@lumensuite/affine-components/context-menu';\nimport { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  tBoolean,\n  tDate,\n  tNumber,\n  tString,\n  tTag,\n} from '../../logical/data-type.js';\nimport { isTArray, tArray } from '../../logical/typesystem.js';\nimport { createUniComponentFromWebComponent } from '../../utils/uni-component/uni-component.js';\nimport { literalMatcher } from './matcher.js';\nimport { DateLiteral } from './renderer/date-literal.js';\nimport {\n  BooleanLiteral,\n  NumberLiteral,\n  StringLiteral,\n} from './renderer/literal-element.js';\nimport { MultiTagLiteral, TagLiteral } from './renderer/tag-literal.js';\n\nliteralMatcher.register(tBoolean.create(), {\n  view: createUniComponentFromWebComponent(BooleanLiteral),\n  popEdit: (position, { value, onChange }) => {\n    popMenu(position, {\n      options: {\n        input: {\n          search: true,\n        },\n        items: [true, false].map(v => {\n          return {\n            type: 'action',\n            name: v.toString().toUpperCase(),\n            isSelected: v === value,\n            select: () => {\n              onChange(v);\n            },\n          };\n        }),\n      },\n    });\n  },\n});\nliteralMatcher.register(tString.create(), {\n  view: createUniComponentFromWebComponent(StringLiteral),\n  popEdit: (position, { value, onChange }) => {\n    popMenu(position, {\n      options: {\n        input: {\n          initValue: value?.toString() ?? '',\n          onComplete: text => {\n            onChange(text || undefined);\n          },\n        },\n        items: [],\n      },\n    });\n  },\n});\nliteralMatcher.register(tNumber.create(), {\n  view: createUniComponentFromWebComponent(NumberLiteral),\n  popEdit: (position, { value, onChange }) => {\n    popMenu(position, {\n      options: {\n        input: {\n          initValue: value?.toString() ?? '',\n          onComplete: text => {\n            if (!text) {\n              onChange(undefined);\n              return;\n            }\n            const number = Number.parseFloat(text);\n            if (!Number.isNaN(number)) {\n              onChange(number);\n            }\n          },\n        },\n        items: [],\n      },\n    });\n  },\n});\nliteralMatcher.register(tArray(tTag.create()), {\n  view: createUniComponentFromWebComponent(MultiTagLiteral),\n  popEdit: (position, { value, onChange, type }) => {\n    if (!isTArray(type)) {\n      return;\n    }\n    if (!tTag.is(type.ele)) {\n      return;\n    }\n    let list = Array.isArray(value) ? value : [];\n    popMenu(position, {\n      options: {\n        input: {\n          search: true,\n        },\n        items:\n          type.ele.data?.tags.map(tag => {\n            const styles = styleMap({\n              backgroundColor: tag.color,\n              padding: '0 8px',\n              width: 'max-content',\n            });\n            return {\n              type: 'checkbox',\n              name: tag.value,\n              checked: list.includes(tag.id),\n              label: () =>\n                html` <div class=\"dv-round-4\" style=${styles}>\n                  ${tag.value}\n                </div>`,\n              select: checked => {\n                if (checked) {\n                  list = list.filter(v => v !== tag.id);\n                  onChange(list);\n                  return false;\n                } else {\n                  list = [...list, tag.id];\n                  onChange(list);\n                  return true;\n                }\n              },\n            };\n          }) ?? [],\n      },\n    });\n  },\n});\nliteralMatcher.register(tTag.create(), {\n  view: createUniComponentFromWebComponent(TagLiteral),\n  popEdit: (position, { onChange, type }) => {\n    if (!tTag.is(type)) {\n      return;\n    }\n    popMenu(position, {\n      options: {\n        input: {\n          search: true,\n        },\n        items:\n          type.data?.tags.map(tag => {\n            const styles = styleMap({\n              backgroundColor: tag.color,\n              padding: '0 8px',\n              width: 'max-content',\n            });\n            return {\n              type: 'action',\n              name: tag.value,\n              label: () =>\n                html` <div class=\"dv-round-4\" style=${styles}>\n                  ${tag.value}\n                </div>`,\n              select: () => {\n                onChange(tag.id);\n              },\n            };\n          }) ?? [],\n      },\n    });\n  },\n});\n\nliteralMatcher.register(tDate.create(), {\n  view: createUniComponentFromWebComponent(DateLiteral),\n  popEdit: (position, { value, onChange }) => {\n    const input = document.createElement('input');\n    input.type = 'date';\n    input.click();\n    input.valueAsNumber = value as number;\n    document.body.append(input);\n    input.style.position = 'absolute';\n    const close = createPopup(position, input);\n    requestAnimationFrame(() => {\n      input.showPicker();\n      input.onchange = () => {\n        onChange(input.valueAsNumber);\n        close();\n      };\n    });\n  },\n});\n"]}