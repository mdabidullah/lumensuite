{"version":3,"file":"ref.js","sourceRoot":"","sources":["../../../../src/core/common/ref/ref.ts"],"names":[],"mappings":"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","sourcesContent":["import { popFilterableSimpleMenu } from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { AddCursorIcon } from '@blocksuite/icons/lit';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { Filter, Variable, VariableOrProperty } from '../ast.js';\n\nimport { renderUniLit } from '../../utils/uni-component/uni-component.js';\nimport { firstFilterByRef, firstFilterInGroup } from '../ast.js';\n\n@customElement('variable-ref-view')\nexport class VariableRefView extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    variable-ref-view {\n      font-size: 12px;\n      line-height: 20px;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      padding: 0 4px;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    variable-ref-view:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    variable-ref-view svg {\n      width: 16px;\n      height: 16px;\n      fill: var(--affine-icon-color);\n      color: var(--affine-icon-color);\n    }\n  `;\n\n  get field() {\n    if (!this.data) {\n      return;\n    }\n    if (this.data.type === 'ref') {\n      return this.data.name;\n    }\n    return this.data.ref.name;\n  }\n\n  get fieldData() {\n    const id = this.field;\n    if (!id) {\n      return;\n    }\n    return this.vars.find(v => v.id === id);\n  }\n\n  get property() {\n    if (!this.data) {\n      return;\n    }\n    if (this.data.type === 'ref') {\n      return;\n    }\n    return this.data.propertyFuncName;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.addFromEvent(this, 'click', e => {\n      popFilterableSimpleMenu(\n        e.target as HTMLElement,\n        this.vars.map(v => ({\n          type: 'action',\n          name: v.name,\n          icon: renderUniLit(v.icon, {}),\n          select: () => {\n            this.setData({\n              type: 'ref',\n              name: v.id,\n            });\n          },\n        }))\n      );\n    });\n  }\n\n  override render() {\n    const data = this.fieldData;\n    return html` ${renderUniLit(data?.icon, {})} ${data?.name} `;\n  }\n\n  @property({ attribute: false })\n  accessor data: VariableOrProperty | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor setData!: (filter: VariableOrProperty) => void;\n\n  @property({ attribute: false })\n  accessor vars!: Variable[];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'variable-ref-view': VariableRefView;\n  }\n}\nexport const popCreateFilter = (\n  target: HTMLElement,\n  props: {\n    vars: Variable[];\n    onSelect: (filter: Filter) => void;\n    onClose?: () => void;\n  }\n) => {\n  popFilterableSimpleMenu(\n    target,\n    [\n      ...props.vars.map(v => ({\n        type: 'action' as const,\n        name: v.name,\n        icon: renderUniLit(v.icon, {}),\n        select: () => {\n          props.onSelect(\n            firstFilterByRef(props.vars, {\n              type: 'ref',\n              name: v.id,\n            })\n          );\n        },\n      })),\n      {\n        type: 'group',\n        name: '',\n        children: () => [\n          {\n            type: 'action',\n            name: 'Add filter group',\n            icon: AddCursorIcon(),\n            select: () => {\n              props.onSelect(firstFilterInGroup(props.vars));\n            },\n          },\n        ],\n      },\n    ],\n    props.onClose\n  );\n};\n"]}