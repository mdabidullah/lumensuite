{"version":3,"file":"field.js","sourceRoot":"","sources":["../../../../src/core/common/detail/field.ts"],"names":[],"mappings":"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","sourcesContent":["import { popMenu } from '@lumensuite/affine-components/context-menu';\nimport {\n  ShadowlessElement,\n  SignalWatcher,\n  WithDisposable,\n} from '@lumensuite/block-std';\nimport {\n  DeleteIcon,\n  DuplicateIcon,\n  MoveLeftIcon,\n  MoveRightIcon,\n} from '@blocksuite/icons/lit';\nimport { computed } from '@lit-labs/preact-signals';\nimport { css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { createRef } from 'lit/directives/ref.js';\nimport { html } from 'lit/static-html.js';\n\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../../column/index.js';\nimport type { Column } from '../../view-manager/column.js';\nimport type { SingleView } from '../../view-manager/single-view.js';\n\nimport { renderUniLit } from '../../utils/uni-component/uni-component.js';\nimport { inputConfig, typeConfig } from '../column-menu.js';\n\n@customElement('affine-data-view-record-field')\nexport class RecordField extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    affine-data-view-record-field {\n      display: flex;\n      gap: 12px;\n    }\n\n    .field-left {\n      padding: 6px;\n      display: flex;\n      height: max-content;\n      align-items: center;\n      gap: 6px;\n      font-size: var(--data-view-cell-text-size);\n      line-height: var(--data-view-cell-text-line-height);\n      color: var(--affine-text-secondary-color);\n      width: 160px;\n      border-radius: 4px;\n      cursor: pointer;\n      user-select: none;\n    }\n\n    .field-left:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    affine-data-view-record-field .icon {\n      display: flex;\n      align-items: center;\n      width: 16px;\n      height: 16px;\n    }\n\n    affine-data-view-record-field .icon svg {\n      width: 16px;\n      height: 16px;\n      fill: var(--affine-icon-color);\n    }\n\n    .filed-name {\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n\n    .field-content {\n      padding: 6px 8px;\n      border-radius: 4px;\n      flex: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      border: 1px solid transparent;\n    }\n\n    .field-content .affine-database-number {\n      text-align: left;\n      justify-content: start;\n    }\n\n    .field-content:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .field-content.is-editing {\n      box-shadow: 0px 0px 0px 2px rgba(30, 150, 235, 0.3);\n    }\n\n    .field-content.is-focus {\n      border: 1px solid var(--affine-primary-color);\n    }\n    .field-content.empty::before {\n      content: 'Empty';\n      color: var(--affine-text-disable-color);\n      font-size: 14px;\n      line-height: 22px;\n    }\n  `;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  _click = (e: MouseEvent) => {\n    e.stopPropagation();\n    if (this.readonly) return;\n\n    this.changeEditing(true);\n  };\n\n  _clickLeft = (e: MouseEvent) => {\n    if (this.readonly) return;\n    const ele = e.currentTarget as HTMLElement;\n    const columns = this.view.detailColumns$.value;\n    popMenu(ele, {\n      options: {\n        input: inputConfig(this.column),\n        items: [\n          {\n            type: 'group',\n            name: 'Column Prop Group ',\n            children: () => [typeConfig(this.column)],\n          },\n          {\n            type: 'action',\n            name: 'Duplicate Column',\n            icon: DuplicateIcon(),\n            hide: () =>\n              !this.column.duplicate || this.column.type$.value === 'title',\n            select: () => {\n              this.column.duplicate?.();\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Up',\n            icon: html` <div\n              style=\"transform: rotate(90deg);display:flex;align-items:center;\"\n            >\n              ${MoveLeftIcon()}\n            </div>`,\n            hide: () => columns.findIndex(v => v === this.column.id) === 0,\n            select: () => {\n              const index = columns.findIndex(v => v === this.column.id);\n              const targetId = columns[index - 1];\n              if (!targetId) {\n                return;\n              }\n              this.view.columnMove(this.column.id, {\n                id: targetId,\n                before: true,\n              });\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Down',\n            icon: html` <div\n              style=\"transform: rotate(90deg);display:flex;align-items:center;\"\n            >\n              ${MoveRightIcon()}\n            </div>`,\n            hide: () =>\n              columns.findIndex(v => v === this.column.id) ===\n              columns.length - 1,\n            select: () => {\n              const index = columns.findIndex(v => v === this.column.id);\n              const targetId = columns[index + 1];\n              if (!targetId) {\n                return;\n              }\n              this.view.columnMove(this.column.id, {\n                id: targetId,\n                before: false,\n              });\n            },\n          },\n          {\n            type: 'group',\n            name: 'operation',\n            children: () => [\n              {\n                type: 'action',\n                name: 'Delete Column',\n                icon: DeleteIcon(),\n                hide: () =>\n                  !this.column.delete || this.column.type$.value === 'title',\n                select: () => {\n                  this.column.delete?.();\n                },\n                class: 'delete-item',\n              },\n            ],\n          },\n        ],\n      },\n    });\n  };\n\n  cell$ = computed(() => {\n    return this.column.cellGet(this.rowId);\n  });\n\n  changeEditing = (editing: boolean) => {\n    const selection = this.closest('affine-data-view-record-detail')?.selection;\n    if (selection) {\n      selection.selection = {\n        propertyId: this.column.id,\n        isEditing: editing,\n      };\n    }\n  };\n\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  private get readonly() {\n    return this.view.readonly$.value;\n  }\n\n  override render() {\n    const column = this.column;\n\n    const props: CellRenderProps = {\n      cell: this.cell$.value,\n      isEditing: this.editing,\n      selectCurrentCell: this.changeEditing,\n    };\n    const renderer = this.column.renderer$.value;\n    if (!renderer) {\n      return;\n    }\n    const { view, edit } = renderer;\n    const contentClass = classMap({\n      'field-content': true,\n      empty: !this.editing && this.cell$.value.isEmpty$.value,\n      'is-editing': this.editing,\n      'is-focus': this.isFocus,\n    });\n    return html`\n      <div>\n        <div class=\"field-left\" @click=\"${this._clickLeft}\">\n          <div class=\"icon\">\n            <uni-lit .uni=\"${this.column.icon}\"></uni-lit>\n          </div>\n          <div class=\"filed-name\">${column.name$.value}</div>\n        </div>\n      </div>\n      <div @click=\"${this._click}\" class=\"${contentClass}\">\n        ${renderUniLit(this.editing && edit ? edit : view, props, {\n          ref: this._cell,\n          class: 'kanban-cell',\n        })}\n      </div>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor column!: Column;\n\n  @state()\n  accessor editing = false;\n\n  @state()\n  accessor isFocus = false;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  @property({ attribute: false })\n  accessor view!: SingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-record-field': RecordField;\n  }\n}\n"]}