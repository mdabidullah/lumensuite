{"version":3,"file":"detail.js","sourceRoot":"","sources":["../../../../src/core/common/detail/detail.ts"],"names":[],"mappings":"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","sourcesContent":["import { popFilterableSimpleMenu } from '@blocksuite/affine-components/context-menu';\nimport {\n  ShadowlessElement,\n  SignalWatcher,\n  WithDisposable,\n} from '@blocksuite/block-std';\nimport {\n  ArrowDownBigIcon,\n  ArrowUpBigIcon,\n  PlusIcon,\n} from '@blocksuite/icons/lit';\nimport { computed } from '@lit-labs/preact-signals';\nimport { css, nothing, unsafeCSS } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { keyed } from 'lit/directives/keyed.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { SingleView } from '../../view-manager/single-view.js';\nimport type { DetailSlotProps, DetailSlots } from '../data-source/base.js';\n\nimport { renderUniLit } from '../../utils/uni-component/uni-component.js';\nimport { dataViewCommonStyle } from '../css-variable.js';\nimport './field.js';\nimport { DetailSelection } from './selection.js';\n\nconst styles = css`\n  ${unsafeCSS(dataViewCommonStyle('affine-data-view-record-detail'))}\n  affine-data-view-record-detail {\n    position: relative;\n    display: flex;\n    flex: 1;\n    flex-direction: column;\n    padding: 20px;\n    gap: 12px;\n    background-color: var(--affine-background-primary-color);\n    border-radius: 8px;\n    height: 100%;\n    width: 100%;\n  }\n\n  .add-property {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: var(--data-view-cell-text-size);\n    font-style: normal;\n    font-weight: 400;\n    line-height: var(--data-view-cell-text-line-height);\n    color: var(--affine-text-disable-color);\n    border-radius: 4px;\n    padding: 6px 8px 6px 4px;\n    cursor: pointer;\n    margin-top: 8px;\n    width: max-content;\n  }\n\n  .add-property:hover {\n    background-color: var(--affine-hover-color);\n  }\n\n  .add-property .icon {\n    display: flex;\n    align-items: center;\n  }\n\n  .add-property .icon svg {\n    fill: var(--affine-icon-color);\n    width: 20px;\n    height: 20px;\n  }\n  .switch-row {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 2px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 22px;\n    color: var(--affine-icon-color);\n  }\n  .switch-row:hover {\n    background-color: var(--affine-hover-color);\n  }\n  .switch-row.disable {\n    cursor: default;\n    background: none;\n    opacity: 0.5;\n  }\n`;\n\n@customElement('affine-data-view-record-detail')\nexport class RecordDetail extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = styles;\n\n  _clickAddProperty = () => {\n    popFilterableSimpleMenu(\n      this.addPropertyButton,\n      this.view.allColumnMetas.map(meta => {\n        return {\n          type: 'action',\n          name: meta.config.name,\n          icon: renderUniLit(this.view.getIcon(meta.type)),\n          select: () => {\n            this.view.columnAdd('end', meta.type);\n          },\n        };\n      })\n    );\n  };\n\n  columns$ = computed(() => {\n    return this.view.detailColumns$.value.map(id => this.view.columnGet(id));\n  });\n\n  detailSlots?: DetailSlots;\n\n  selection = new DetailSelection(this);\n\n  private get readonly() {\n    return this.view.readonly$.value;\n  }\n\n  private renderHeader() {\n    const header = this.detailSlots?.header;\n    if (header) {\n      const props: DetailSlotProps = {\n        view: this.view,\n        rowId: this.rowId,\n      };\n      return renderUniLit(header, props);\n    }\n    return undefined;\n  }\n\n  private renderNote() {\n    const note = this.detailSlots?.note;\n    if (note) {\n      const props: DetailSlotProps = {\n        view: this.view,\n        rowId: this.rowId,\n      };\n      return renderUniLit(note, props);\n    }\n    return undefined;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.stopPropagation();\n      this.selection.selection = undefined;\n    });\n    //FIXME: simulate as a widget\n    this.dataset.widgetId = 'affine-detail-widget';\n    this.detailSlots = this.view.detailSlots;\n  }\n\n  hasNext() {\n    return this.view.rowGetNext(this.rowId) != null;\n  }\n\n  hasPrev() {\n    return this.view.rowGetPrev(this.rowId) != null;\n  }\n\n  nextRow() {\n    const rowId = this.view.rowGetNext(this.rowId);\n    if (rowId == null) {\n      return;\n    }\n    this.rowId = rowId;\n    this.requestUpdate();\n  }\n\n  prevRow() {\n    const rowId = this.view.rowGetPrev(this.rowId);\n    if (rowId == null) {\n      return;\n    }\n    this.rowId = rowId;\n    this.requestUpdate();\n  }\n\n  override render() {\n    const columns = this.columns$.value;\n    const upClass = classMap({\n      'switch-row': true,\n      disable: !this.hasPrev(),\n    });\n    const downClass = classMap({\n      'switch-row': true,\n      disable: !this.hasNext(),\n    });\n    return html`\n      <div\n        style=\"position: absolute;left: 20px;top:20px;display: flex;align-items:center;gap:4px;\"\n      >\n        <div @click=\"${this.prevRow}\" class=\"${upClass}\">\n          ${ArrowUpBigIcon()}\n        </div>\n        <div @click=\"${this.nextRow}\" class=\"${downClass}\">\n          ${ArrowDownBigIcon()}\n        </div>\n      </div>\n      <div\n        style=\"max-width: var(--affine-editor-width);display: flex;flex-direction: column;margin: 0 auto\"\n      >\n        ${keyed(this.rowId, this.renderHeader())}\n        ${repeat(\n          columns,\n          v => v.id,\n          column => {\n            return keyed(\n              this.rowId,\n              html` <affine-data-view-record-field\n                .view=\"${this.view}\"\n                .column=\"${column}\"\n                .rowId=\"${this.rowId}\"\n                data-column-id=\"${column.id}\"\n              ></affine-data-view-record-field>`\n            );\n          }\n        )}\n        ${!this.readonly\n          ? html`<div class=\"add-property\" @click=\"${this._clickAddProperty}\">\n              <div class=\"icon\">${PlusIcon()}</div>\n              Add Property\n            </div>`\n          : nothing}\n        <div style=\"width: var(--affine-editor-width)\"></div>\n      </div>\n      ${keyed(this.rowId, this.renderNote())}\n    `;\n  }\n\n  @query('.add-property')\n  accessor addPropertyButton!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  @property({ attribute: false })\n  accessor view!: SingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-record-detail': RecordDetail;\n  }\n}\n"]}