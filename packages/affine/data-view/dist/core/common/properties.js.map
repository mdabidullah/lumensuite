{"version":3,"file":"properties.js","sourceRoot":"","sources":["../../../src/core/common/properties.ts"],"names":[],"mappings":"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","sourcesContent":["import { createPopup } from '@lumensuite/affine-components/context-menu';\nimport {\n  ShadowlessElement,\n  SignalWatcher,\n  WithDisposable,\n} from '@lumensuite/block-std';\nimport {\n  ArrowLeftBigIcon,\n  InvisibleIcon,\n  ViewIcon,\n} from '@blocksuite/icons/lit';\nimport { css, html } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport Sortable from 'sortablejs';\n\nimport type { Column } from '../view-manager/column.js';\nimport type { SingleView } from '../view-manager/single-view.js';\n\n@customElement('data-view-properties-setting')\nexport class DataViewPropertiesSettingView extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    data-view-properties-setting {\n      position: absolute;\n      background-color: var(--affine-background-overlay-panel-color);\n      border-radius: 8px;\n      box-shadow: var(--affine-shadow-2);\n      padding: 8px;\n      min-width: 300px;\n    }\n\n    .properties-group-header {\n      user-select: none;\n      padding: 4px 12px 12px 12px;\n      margin-bottom: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      border-bottom: 1px solid var(--affine-divider-color);\n    }\n\n    .properties-group-title {\n      font-size: 12px;\n      line-height: 20px;\n      color: var(--affine-text-secondary-color);\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .properties-group-op {\n      padding: 4px 8px;\n      font-size: 12px;\n      line-height: 20px;\n      font-weight: 500;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .properties-group-op:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .properties-group {\n      min-height: 40px;\n    }\n\n    .property-item {\n      padding: 4px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      user-select: none;\n      cursor: pointer;\n      border-radius: 4px;\n    }\n\n    .property-item:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .property-item-drag-bar {\n      width: 4px;\n      height: 12px;\n      border-radius: 1px;\n      background-color: #efeff0;\n    }\n\n    .property-item:hover .property-item-drag-bar {\n      background-color: #c0bfc1;\n    }\n\n    .property-item-icon {\n      display: flex;\n      align-items: center;\n    }\n\n    .property-item-icon svg {\n      color: var(--affine-icon-color);\n      fill: var(--affine-icon-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .property-item-op-icon {\n      display: flex;\n      align-items: center;\n      border-radius: 4px;\n    }\n\n    .property-item-op-icon:hover {\n      background-color: var(--affine-hover-color);\n    }\n    .property-item-op-icon.disabled:hover {\n      background-color: transparent;\n    }\n\n    .property-item-op-icon svg {\n      fill: var(--affine-icon-color);\n      color: var(--affine-icon-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .property-item-op-icon.disabled svg {\n      fill: var(--affine-text-disable-color);\n      color: var(--affine-text-disable-color);\n    }\n\n    .property-item-name {\n      font-size: 14px;\n      line-height: 22px;\n      flex: 1;\n    }\n  `;\n\n  clickChangeAll = (allShow: boolean) => {\n    this.view.columnsWithoutFilter$.value.forEach(id => {\n      if (this.view.columnGetType(id) !== 'title') {\n        this.view.columnUpdateHide(id, allShow);\n      }\n    });\n  };\n\n  renderColumn = (column: Column) => {\n    const isTitle = column.type$.value === 'title';\n    const icon = column.hide$.value ? InvisibleIcon() : ViewIcon();\n    const changeVisible = () => {\n      if (column.type$.value !== 'title') {\n        column.updateHide(!column.hide$.value);\n      }\n    };\n    const classList = classMap({\n      'property-item-op-icon': true,\n      disabled: isTitle,\n    });\n    return html` <div class=\"property-item\">\n      <div class=\"property-item-drag-bar\"></div>\n      <uni-lit class=\"property-item-icon\" .uni=\"${column.icon}\"></uni-lit>\n      <div class=\"property-item-name\">${column.name$.value}</div>\n      <div class=\"${classList}\" @click=\"${changeVisible}\">${icon}</div>\n    </div>`;\n  };\n\n  private itemsGroup() {\n    return this.view.columnsWithoutFilter$.value.map(id =>\n      this.view.columnGet(id)\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(this, 'pointerdown', e => {\n      e.stopPropagation();\n    });\n  }\n\n  override firstUpdated() {\n    const sortable = new Sortable(this.groupContainer, {\n      animation: 150,\n      group: `properties-sort-${this.view.id}`,\n      onEnd: evt => {\n        const properties = [...this.view.columnsWithoutFilter$.value];\n        const index = evt.oldIndex ?? -1;\n        const from = properties[index];\n        properties.splice(index, 1);\n        const to = properties[evt.newIndex ?? -1];\n        this.view.columnMove(\n          from,\n          to\n            ? {\n                before: true,\n                id: to,\n              }\n            : 'end'\n        );\n      },\n    });\n    this._disposables.add({\n      dispose: () => sortable.destroy(),\n    });\n  }\n\n  override render() {\n    const items = this.itemsGroup();\n    const isAllShowed = items.every(v => !v.hide$.value);\n    const clickChangeAll = () => this.clickChangeAll(isAllShowed);\n    return html`\n      <div class=\"properties-group-header\">\n        <div class=\"properties-group-title dv-icon-20\">\n          <div\n            @click=${this.onBack}\n            style=\"display:flex;\"\n            class=\"dv-hover dv-round-4 dv-pd-2\"\n          >\n            ${ArrowLeftBigIcon()}\n          </div>\n          PROPERTIES\n        </div>\n        <div class=\"properties-group-op\" @click=\"${clickChangeAll}\">\n          ${isAllShowed ? 'Hide All' : 'Show All'}\n        </div>\n      </div>\n      <div class=\"properties-group\">\n        ${repeat(items, v => v.id, this.renderColumn)}\n      </div>\n    `;\n  }\n\n  @query('.properties-group')\n  accessor groupContainer!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor onBack: (() => void) | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor view!: SingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-properties-setting': DataViewPropertiesSettingView;\n  }\n}\n\nexport const popPropertiesSetting = (\n  target: HTMLElement,\n  props: {\n    view: SingleView;\n    onClose?: () => void;\n    onBack?: () => void;\n  }\n) => {\n  const view = new DataViewPropertiesSettingView();\n  view.view = props.view;\n  view.onBack = () => {\n    close();\n    props.onBack?.();\n  };\n  const close = createPopup(target, view, { onClose: props.onClose });\n};\n"]}