{"version":3,"file":"frame-loop.js","sourceRoot":"","sources":["../../../src/core/utils/frame-loop.ts"],"names":[],"mappings":"AAAA,MAAM,CAAC,MAAM,cAAc,GAAG,CAAC,EAA2B,EAAE,EAAE;IAC5D,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,IAAI,OAAO,GAAG,CAAC,CAAC;IAChB,MAAM,GAAG,GAAG,GAAG,EAAE;QACf,MAAM,GAAG,qBAAqB,CAAC,IAAI,CAAC,EAAE;YACpC,IAAI,CAAC;gBACH,EAAE,CAAC,IAAI,GAAG,OAAO,CAAC,CAAC;YACrB,CAAC;oBAAS,CAAC;gBACT,OAAO,GAAG,IAAI,CAAC;gBACf,GAAG,EAAE,CAAC;YACR,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;IACF,GAAG,EAAE,CAAC;IACN,OAAO,GAAG,EAAE;QACV,oBAAoB,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC,CAAC;AACJ,CAAC,CAAC;AACF,MAAM,UAAU,GAAG,CAAC,GAAG,EAAE,CAAC;AAC1B,MAAM,cAAc,GAAG,CAAC,GAAG,CAAC,CAAC;AAC7B,MAAM,CAAC,MAAM,oBAAoB,GAAG,CAClC,SAAsB,EACtB,GAYC,EACD,EAAE;IACF,MAAM,EAAE,QAAQ,GAAG,KAAK,EAAE,UAAU,GAAG,IAAI,EAAE,QAAQ,EAAE,GAAG,GAAG,IAAI,EAAE,CAAC;IACpE,MAAM,eAAe,GAAG,EAAE,CAAC;IAC3B,MAAM,EACJ,IAAI,GAAG,eAAe,EACtB,KAAK,GAAG,eAAe,EACvB,GAAG,GAAG,eAAe,EACrB,MAAM,GAAG,eAAe,GACzB,GAAG,OAAO,QAAQ,KAAK,QAAQ;QAC9B,CAAC,CAAC;YACE,IAAI,EAAE,QAAQ;YACd,KAAK,EAAE,QAAQ;YACf,GAAG,EAAE,QAAQ;YACb,MAAM,EAAE,QAAQ;SACjB;QACH,CAAC,CAAC,CAAC,QAAQ,IAAI;YACX,IAAI,EAAE,eAAe;YACrB,KAAK,EAAE,eAAe;YACtB,GAAG,EAAE,eAAe;YACpB,MAAM,EAAE,eAAe;SACxB,CAAC,CAAC;IACP,MAAM,aAAa,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IACrC,MAAM,SAAS,GAAG,CAAC,CAAa,EAAE,EAAE;QAClC,aAAa,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC;QAC5B,aAAa,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC;IAC9B,CAAC,CAAC;IACF,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAClD,MAAM,MAAM,GAAG,CAAC,KAAa,EAAE,EAAE;QAC/B,MAAM,IAAI,GAAG,SAAS,CAAC,qBAAqB,EAAE,CAAC;QAC/C,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,aAAa,CAAC;QAC/B,MAAM,SAAS,GAAG,CAAC,IAAY,EAAE,EAAE,CACjC,CAAC,IAAI,GAAG,cAAc,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,UAAU,CAAC;QACnD,IAAI,UAAU,EAAE,CAAC;YACf,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACnC,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACtC,IAAI,CAAC,GAAG,SAAS,EAAE,CAAC;gBAClB,SAAS,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;YACnD,CAAC;iBAAM,IAAI,CAAC,GAAG,UAAU,EAAE,CAAC;gBAC1B,SAAS,CAAC,UAAU,IAAI,SAAS,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC;YACpD,CAAC;QACH,CAAC;QACD,IAAI,QAAQ,EAAE,CAAC;YACb,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;YAChC,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACzC,IAAI,CAAC,GAAG,QAAQ,EAAE,CAAC;gBACjB,SAAS,CAAC,SAAS,IAAI,SAAS,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;YACjD,CAAC;iBAAM,IAAI,CAAC,GAAG,WAAW,EAAE,CAAC;gBAC3B,SAAS,CAAC,SAAS,IAAI,SAAS,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC;YACpD,CAAC;QACH,CAAC;QACD,GAAG,EAAE,QAAQ,EAAE,EAAE,CAAC;IACpB,CAAC,CAAC;IACF,MAAM,MAAM,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC;IACtC,OAAO,GAAG,EAAE;QACV,MAAM,EAAE,CAAC;QACT,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IACvD,CAAC,CAAC;AACJ,CAAC,CAAC","sourcesContent":["export const startFrameLoop = (fn: (delta: number) => void) => {\n  let handle = 0;\n  let preTime = 0;\n  const run = () => {\n    handle = requestAnimationFrame(time => {\n      try {\n        fn(time - preTime);\n      } finally {\n        preTime = time;\n        run();\n      }\n    });\n  };\n  run();\n  return () => {\n    cancelAnimationFrame(handle);\n  };\n};\nconst timeWeight = 1 / 16;\nconst distanceWeight = 1 / 8;\nexport const autoScrollOnBoundary = (\n  container: HTMLElement,\n  ops?: {\n    vertical?: boolean;\n    horizontal?: boolean;\n    boundary?:\n      | number\n      | {\n          left?: number;\n          right?: number;\n          top?: number;\n          bottom?: number;\n        };\n    onScroll?: () => void;\n  }\n) => {\n  const { vertical = false, horizontal = true, boundary } = ops ?? {};\n  const defaultBoundary = 20;\n  const {\n    left = defaultBoundary,\n    right = defaultBoundary,\n    top = defaultBoundary,\n    bottom = defaultBoundary,\n  } = typeof boundary === 'number'\n    ? {\n        left: boundary,\n        right: boundary,\n        top: boundary,\n        bottom: boundary,\n      }\n    : (boundary ?? {\n        left: defaultBoundary,\n        right: defaultBoundary,\n        top: defaultBoundary,\n        bottom: defaultBoundary,\n      });\n  const mousePosition = { x: 0, y: 0 };\n  const mouseMove = (e: MouseEvent) => {\n    mousePosition.x = e.clientX;\n    mousePosition.y = e.clientY;\n  };\n  document.addEventListener('mousemove', mouseMove);\n  const scroll = (delta: number) => {\n    const rect = container.getBoundingClientRect();\n    const { x, y } = mousePosition;\n    const getResult = (diff: number) =>\n      (diff * distanceWeight + 1) * delta * timeWeight;\n    if (horizontal) {\n      const leftBound = rect.left + left;\n      const rightBound = rect.right - right;\n      if (x < leftBound) {\n        container.scrollLeft -= getResult(leftBound - x);\n      } else if (x > rightBound) {\n        container.scrollLeft += getResult(x - rightBound);\n      }\n    }\n    if (vertical) {\n      const topBound = rect.top + top;\n      const bottomBound = rect.bottom - bottom;\n      if (y < topBound) {\n        container.scrollTop -= getResult(topBound - x);\n      } else if (y > bottomBound) {\n        container.scrollTop += getResult(x - bottomBound);\n      }\n    }\n    ops?.onScroll?.();\n  };\n  const cancel = startFrameLoop(scroll);\n  return () => {\n    cancel();\n    document.removeEventListener('mousemove', mouseMove);\n  };\n};\n"]}