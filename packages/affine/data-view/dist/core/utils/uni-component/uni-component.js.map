{"version":3,"file":"uni-component.js","sourceRoot":"","sources":["../../../../src/core/utils/uni-component/uni-component.ts"],"names":[],"mappings":"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","sourcesContent":["import type { LitElement, PropertyValues, TemplateResult } from 'lit';\nimport type { Ref } from 'lit/directives/ref.js';\n\nimport { ShadowlessElement, SignalWatcher } from '@lumensuite/block-std';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nexport type UniComponentReturn<\n  Props = NonNullable<unknown>,\n  Expose extends NonNullable<unknown> = NonNullable<unknown>,\n> = {\n  update: (props: Props) => void;\n  unmount: () => void;\n  expose: Expose;\n};\nexport type UniComponent<\n  Props = NonNullable<unknown>,\n  Expose extends NonNullable<unknown> = NonNullable<unknown>,\n> = (ele: HTMLElement, props: Props) => UniComponentReturn<Props, Expose>;\nexport const renderUniLit = <Props, Expose extends NonNullable<unknown>>(\n  uni: UniComponent<Props, Expose> | undefined,\n  props?: Props,\n  options?: {\n    ref?: Ref<Expose>;\n    style?: Readonly<StyleInfo>;\n    class?: string;\n  }\n): TemplateResult => {\n  return html` <uni-lit\n    .uni=\"${uni}\"\n    .props=\"${props}\"\n    .ref=\"${options?.ref}\"\n    style=${options?.style ? styleMap(options?.style) : ''}\n  ></uni-lit>`;\n};\n\n@customElement('uni-lit')\nexport class UniLit<\n  Props,\n  Expose extends NonNullable<unknown> = NonNullable<unknown>,\n> extends ShadowlessElement {\n  static override styles = css`\n    uni-lit {\n      display: contents;\n    }\n  `;\n\n  uniReturn?: UniComponentReturn<Props, Expose>;\n\n  get expose(): Expose | undefined {\n    return this.uniReturn?.expose;\n  }\n\n  private mount() {\n    this.uniReturn = this.uni?.(this, this.props);\n    if (this.ref) {\n      // @ts-expect-error\n      this.ref.value = this.uniReturn?.expose;\n    }\n  }\n\n  private unmount() {\n    this.uniReturn?.unmount();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.mount();\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.unmount();\n  }\n\n  protected override render(): unknown {\n    return html``;\n  }\n\n  protected override updated(_changedProperties: PropertyValues) {\n    super.updated(_changedProperties);\n    if (_changedProperties.has('uni')) {\n      this.unmount();\n      this.mount();\n    } else if (_changedProperties.has('props')) {\n      this.uniReturn?.update(this.props);\n    }\n  }\n\n  @property({ attribute: false })\n  accessor props!: Props;\n\n  @property({ attribute: false })\n  accessor ref: Ref<Expose> | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor uni: UniComponent<Props, Expose> | undefined = undefined;\n}\n\nexport const createUniComponentFromWebComponent = <\n  T,\n  Expose extends NonNullable<unknown> = NonNullable<unknown>,\n>(\n  component: typeof LitElement\n): UniComponent<T, Expose> => {\n  return (ele, props) => {\n    const ins = new component();\n    Object.assign(ins, props);\n    ele.append(ins);\n    return {\n      update: props => {\n        Object.assign(ins, props);\n        ins.requestUpdate();\n      },\n      unmount: () => {\n        ins.remove();\n      },\n      expose: ins as never as Expose,\n    };\n  };\n};\n\n@customElement('uni-any-render')\nclass UniAnyRender<\n  T,\n  Expose extends NonNullable<unknown>,\n> extends SignalWatcher(ShadowlessElement) {\n  override render() {\n    return this.renderTemplate(this.props, this.expose);\n  }\n\n  @property({ attribute: false })\n  accessor expose!: Expose;\n\n  @property({ attribute: false })\n  accessor props!: T;\n\n  @property({ attribute: false })\n  accessor renderTemplate!: (props: T, expose: Expose) => TemplateResult;\n}\nexport const defineUniComponent = <T, Expose extends NonNullable<unknown>>(\n  renderTemplate: (props: T, expose: Expose) => TemplateResult\n): UniComponent<T, Expose> => {\n  return (ele, props) => {\n    const ins = new UniAnyRender<T, Expose>();\n    ins.props = props;\n    ins.expose = {} as Expose;\n    ins.renderTemplate = renderTemplate;\n    ele.append(ins);\n    return {\n      update: props => {\n        ins.props = props;\n        ins.requestUpdate();\n      },\n      unmount: () => {\n        ins.remove();\n      },\n      expose: ins.expose,\n    };\n  };\n};\n"]}