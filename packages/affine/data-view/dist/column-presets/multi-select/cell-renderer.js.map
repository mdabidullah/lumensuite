{"version":3,"file":"cell-renderer.js","sourceRoot":"","sources":["../../../src/column-presets/multi-select/cell-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import { customElement } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { SelectColumnData } from '../../core/column/types.js';\n\nimport { BaseCellRenderer } from '../../core/column/index.js';\nimport { createFromBaseCellRenderer } from '../../core/column/renderer.js';\nimport '../../core/utils/tags/multi-tag-select.js';\nimport {\n  popTagSelect,\n  type SelectTag,\n} from '../../core/utils/tags/multi-tag-select.js';\nimport { createIcon } from '../../core/utils/uni-icon.js';\nimport { multiSelectColumnModelConfig } from './define.js';\n\n@customElement('affine-database-multi-select-cell')\nexport class MultiSelectCell extends BaseCellRenderer<\n  string[],\n  SelectColumnData\n> {\n  override render() {\n    return html`\n      <affine-multi-tag-view\n        .value=\"${Array.isArray(this.value) ? this.value : []}\"\n        .options=\"${this.column.data$.value.options}\"\n      ></affine-multi-tag-view>\n    `;\n  }\n}\n\n@customElement('affine-database-multi-select-cell-editing')\nexport class MultiSelectCellEditing extends BaseCellRenderer<\n  string[],\n  SelectColumnData\n> {\n  private popTagSelect = () => {\n    this._disposables.add({\n      dispose: popTagSelect(\n        this.querySelector('affine-multi-tag-view') ?? this,\n        {\n          options: this._options,\n          onOptionsChange: this._onOptionsChange,\n          value: this._value,\n          onChange: this._onChange,\n          onComplete: this._editComplete,\n          minWidth: 400,\n        }\n      ),\n    });\n  };\n\n  _editComplete = () => {\n    this.selectCurrentCell(false);\n  };\n\n  _onChange = (ids: string[]) => {\n    this.onChange(ids);\n  };\n\n  _onOptionsChange = (options: SelectTag[]) => {\n    this.column.updateData(data => {\n      return {\n        ...data,\n        options,\n      };\n    });\n  };\n\n  get _options(): SelectTag[] {\n    return this.column.data$.value.options;\n  }\n\n  get _value() {\n    return this.value ?? [];\n  }\n\n  override firstUpdated() {\n    this.popTagSelect();\n  }\n\n  override render() {\n    return html`\n      <affine-multi-tag-view\n        .value=\"${this._value}\"\n        .options=\"${this._options}\"\n      ></affine-multi-tag-view>\n    `;\n  }\n}\n\nexport const multiSelectColumnConfig =\n  multiSelectColumnModelConfig.createColumnMeta({\n    icon: createIcon('MultiSelectIcon'),\n    cellRenderer: {\n      view: createFromBaseCellRenderer(MultiSelectCell),\n      edit: createFromBaseCellRenderer(MultiSelectCellEditing),\n    },\n  });\n"]}