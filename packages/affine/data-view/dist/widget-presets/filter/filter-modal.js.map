{"version":3,"file":"filter-modal.js","sourceRoot":"","sources":["../../../src/widget-presets/filter/filter-modal.ts"],"names":[],"mappings":"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","sourcesContent":["import { createPopup } from '@lumensuite/affine-components/context-menu';\nimport { ShadowlessElement, WithDisposable } from '@lumensuite/block-std';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { FilterGroup, Variable } from '../../core/common/ast.js';\n\nimport './filter-group.js';\nimport './filter-root.js';\n\n@customElement('advanced-filter-modal')\nexport class AdvancedFilterModal extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    advanced-filter-modal {\n      background-color: var(--affine-background-overlay-panel-color);\n      position: absolute;\n      border-radius: 8px;\n      box-shadow: var(--affine-shadow-2);\n      min-width: 500px;\n    }\n\n    .filter-modal-bottom {\n      border-top: 1px solid var(--affine-border-color);\n      padding: 8px;\n    }\n\n    .filter-modal-button {\n      padding: 8px 12px;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      font-size: 14px;\n      line-height: 22px;\n      border-radius: 4px;\n      cursor: pointer;\n      color: var(--affine-text-secondary-color);\n    }\n\n    .filter-modal-button svg {\n      fill: var(--affine-text-secondary-color);\n      color: var(--affine-text-secondary-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .filter-modal-button:hover {\n      background-color: var(--affine-hover-color);\n      color: var(--affine-text-primary-color);\n    }\n    .filter-modal-button:hover svg {\n      fill: var(--affine-text-primary-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-delete-button:hover {\n      background-color: var(--affine-background-error-color);\n      color: var(--affine-error-color);\n    }\n\n    .filter-exactly-hover-container {\n      transition: background-color 0.2s ease-in-out;\n    }\n\n    .filter-exactly-hover-background {\n      background-color: var(--affine-hover-color);\n    }\n  `;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.addFromEvent(this, 'mouseover', e => {\n      let current: HTMLElement | null = e.target as HTMLElement;\n      while (current && current !== this) {\n        if (current.classList.contains('filter-exactly-hover-container')) {\n          current.classList.add('filter-exactly-hover-background');\n          break;\n        }\n        current = current.parentElement;\n      }\n    });\n    this.disposables.addFromEvent(this, 'mouseout', e => {\n      let current: HTMLElement | null = e.target as HTMLElement;\n      while (current && current !== this) {\n        if (current.classList.contains('filter-exactly-hover-container')) {\n          current.classList.remove('filter-exactly-hover-background');\n          break;\n        }\n        current = current.parentElement;\n      }\n    });\n  }\n\n  override render() {\n    return html`\n      <div class=\"filter-modal-container\">\n        ${this.isRoot\n          ? html` <filter-root-view\n              .onBack=${this.onBack}\n              .vars=\"${this.vars}\"\n              .data=\"${this.data}\"\n              .setData=\"${this.setData}\"\n            ></filter-root-view>`\n          : html` <filter-group-view\n              .vars=\"${this.vars}\"\n              .data=\"${this.data}\"\n              .setData=\"${this.setData}\"\n            ></filter-group-view>`}\n      </div>\n      <div class=\"filter-modal-bottom\">\n        <div\n          @click=${this.onDelete}\n          class=\"filter-modal-button filter-delete-button\"\n        >\n          Delete\n        </div>\n      </div>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor data!: FilterGroup;\n\n  @property({ attribute: false })\n  accessor isRoot = false;\n\n  @property({ attribute: false })\n  accessor onBack!: () => void;\n\n  @property({ attribute: false })\n  accessor onDelete!: () => void;\n\n  @property({ attribute: false })\n  accessor setData!: (filter: FilterGroup) => void;\n\n  @property({ attribute: false })\n  accessor vars!: Variable[];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'advanced-filter-modal': AdvancedFilterModal;\n  }\n}\nexport const popFilterModal = (\n  target: HTMLElement,\n  props: {\n    isRoot: boolean;\n    vars: Variable[];\n    value: FilterGroup;\n    onChange: (value: FilterGroup) => void;\n    onDelete: () => void;\n    onBack: () => void;\n  }\n) => {\n  const filter = new AdvancedFilterModal();\n  filter.vars = props.vars;\n  filter.data = props.value;\n  filter.isRoot = props.isRoot;\n  filter.onDelete = () => {\n    props.onDelete();\n    close();\n  };\n  filter.onBack = () => {\n    props.onBack();\n    close();\n  };\n  filter.setData = group => {\n    props.onChange(group);\n    filter.data = group;\n  };\n  const close = createPopup(target, filter);\n};\n"]}