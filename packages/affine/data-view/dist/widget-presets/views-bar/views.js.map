{"version":3,"file":"views.js","sourceRoot":"","sources":["../../../src/widget-presets/views-bar/views.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  popFilterableSimpleMenu,\n  popMenu,\n} from '@lumensuite/affine-components/context-menu';\nimport {\n  AddCursorIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  MoreHorizontalIcon,\n  MoveLeftIcon,\n  MoveRightIcon,\n} from '@blocksuite/icons/lit';\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport '../../core/common/component/overflow/overflow.js';\nimport { renderUniLit } from '../../core/index.js';\nimport { WidgetBase } from '../../core/widget/widget-base.js';\n\n@customElement('data-view-header-views')\nexport class DataViewHeaderViews extends WidgetBase {\n  static override styles = css`\n    data-view-header-views {\n      height: 32px;\n      display: flex;\n      user-select: none;\n      gap: 4px;\n    }\n    data-view-header-views::-webkit-scrollbar-thumb {\n      width: 1px;\n    }\n\n    .database-view-button {\n      height: 100%;\n      cursor: pointer;\n      padding: 4px 8px;\n      border-radius: 4px;\n      font-size: 14px;\n      display: flex;\n      align-items: center;\n      color: var(--affine-text-secondary-color);\n      white-space: nowrap;\n    }\n\n    .database-view-button .name {\n      align-items: center;\n      height: 22px;\n      max-width: 100px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .database-view-button .icon {\n      margin-right: 6px;\n      display: block;\n    }\n\n    .database-view-button .icon svg {\n      width: 16px;\n      height: 16px;\n    }\n\n    .database-view-button.active {\n      color: var(--affine-text-primary-color);\n      background-color: var(--affine-hover-color-filled);\n    }\n  `;\n\n  _addViewMenu = (event: MouseEvent) => {\n    popFilterableSimpleMenu(\n      event.target as HTMLElement,\n      this.dataSource.viewMetas.map(v => {\n        return {\n          type: 'action',\n          name: v.model.defaultName,\n          icon: html`<uni-lit .uni=${v.renderer.icon}></uni-lit>`,\n          select: () => {\n            const id = this.viewManager.viewAdd(v.type);\n            this.viewManager.setCurrentView(id);\n          },\n        };\n      })\n    );\n  };\n\n  _showMore = (event: MouseEvent) => {\n    const views = this.viewManager.views$.value;\n    popFilterableSimpleMenu(event.target as HTMLElement, [\n      ...views.map(id => {\n        const openViewOption = (event: MouseEvent) => {\n          event.stopPropagation();\n          this.openViewOption(event.target as HTMLElement, id);\n        };\n        const view = this.viewManager.viewGet(id);\n        return {\n          type: 'action' as const,\n          icon: html`<uni-lit .uni=${this.getRenderer(id).icon}></uni-lit>`,\n          name: view.viewData$.value?.name ?? '',\n          label: () => html`${view.viewData$.value?.name}`,\n          isSelected: this.viewManager.currentViewId$.value === id,\n          select: () => {\n            this.viewManager.setCurrentView(id);\n          },\n          postfix: html`<div\n            class=\"dv-hover dv-round-4\"\n            @click=\"${openViewOption}\"\n            style=\"display:flex;align-items:center;\"\n          >\n            ${MoreHorizontalIcon()}\n          </div>`,\n        };\n      }),\n      {\n        type: 'group',\n        name: '',\n        hide: () => this.readonly,\n        children: () =>\n          this.dataSource.viewMetas.map(v => {\n            return {\n              type: 'action',\n              name: `Create ${v.model.defaultName}`,\n              icon: html`<uni-lit .uni=${v.renderer.icon}></uni-lit>`,\n              select: () => {\n                const id = this.viewManager.viewAdd(v.type);\n                this.viewManager.setCurrentView(id);\n              },\n            };\n          }),\n      },\n    ]);\n  };\n\n  openViewOption = (target: HTMLElement, id: string) => {\n    if (this.readonly) {\n      return;\n    }\n    const views = this.viewManager.views$.value;\n    const index = views.findIndex(v => v === id);\n    const view = this.viewManager.viewGet(views[index]);\n    if (!view) {\n      return;\n    }\n    popMenu(target, {\n      options: {\n        input: {\n          initValue: view.viewData$.value?.name,\n          onComplete: text => {\n            view.viewDataUpdate(_data => ({\n              name: text,\n            }));\n          },\n        },\n        items: [\n          {\n            type: 'action',\n            name: 'Edit View',\n            icon: renderUniLit(this.getRenderer(id).icon, {}),\n            select: () => {\n              this.closest('affine-data-view-renderer')\n                ?.querySelector('data-view-header-tools-view-options')\n                ?.openMoreAction(target);\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Left',\n            hide: () => index === 0,\n            icon: MoveLeftIcon(),\n            select: () => {\n              const targetId = views[index - 1];\n              this.viewManager.moveTo(\n                id,\n                targetId ? { before: true, id: targetId } : 'start'\n              );\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Right',\n            icon: MoveRightIcon(),\n            hide: () => index === views.length - 1,\n            select: () => {\n              const targetId = views[index + 1];\n              this.viewManager.moveTo(\n                id,\n                targetId ? { before: false, id: targetId } : 'end'\n              );\n            },\n          },\n          {\n            type: 'action',\n            name: 'Duplicate',\n            icon: DuplicateIcon(),\n            select: () => {\n              this.viewManager.viewDuplicate(id);\n            },\n          },\n          {\n            type: 'group',\n            name: '',\n            children: () => [\n              {\n                type: 'action',\n                name: 'Delete View',\n                icon: DeleteIcon(),\n                select: () => {\n                  view.delete();\n                },\n                class: 'delete-item',\n              },\n            ],\n          },\n        ],\n      },\n    });\n  };\n\n  renderMore = (count: number) => {\n    const views = this.viewManager.views$.value;\n    if (count === views.length) {\n      if (this.readonly) {\n        return;\n      }\n      return html`<div\n        class=\"database-view-button dv-icon-16 dv-hover\"\n        data-testid=\"database-add-view-button\"\n        @click=\"${this._addViewMenu}\"\n      >\n        ${AddCursorIcon()}\n      </div>`;\n    }\n    return html`\n      <div class=\"database-view-button dv-hover\" @click=\"${this._showMore}\">\n        ${views.length - count} More\n      </div>\n    `;\n  };\n\n  renderViews = () => {\n    const views = this.viewManager.views$.value;\n    return views.map(id => () => {\n      const classList = classMap({\n        'database-view-button': true,\n        'dv-hover': true,\n        active: this.viewManager.currentViewId$.value === id,\n      });\n      const view = this.viewManager.viewDataGet(id);\n      return html`\n        <div\n          class=\"${classList}\"\n          style=\"margin-right: 4px;\"\n          @click=\"${(event: MouseEvent) => this._clickView(event, id)}\"\n        >\n          <uni-lit class=\"icon\" .uni=\"${this.getRenderer(id).icon}\"></uni-lit>\n          <div class=\"name\">${view?.name}</div>\n        </div>\n      `;\n    });\n  };\n\n  get readonly() {\n    return this.viewManager.readonly$.value;\n  }\n\n  private getRenderer(viewId: string) {\n    return this.dataSource.viewMetaGetById(viewId).renderer;\n  }\n\n  _clickView(event: MouseEvent, id: string) {\n    if (this.viewManager.currentViewId$.value !== id) {\n      this.viewManager.setCurrentView(id);\n      return;\n    }\n    this.openViewOption(event.target as HTMLElement, id);\n  }\n\n  override render() {\n    return html`\n      <component-overflow\n        .renderItem=\"${this.renderViews()}\"\n        .renderMore=\"${this.renderMore}\"\n      ></component-overflow>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-views': DataViewHeaderViews;\n  }\n}\n"]}