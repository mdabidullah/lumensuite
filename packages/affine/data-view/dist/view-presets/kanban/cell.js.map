{"version":3,"file":"cell.js","sourceRoot":"","sources":["../../../src/view-presets/kanban/cell.ts"],"names":[],"mappings":"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","sourcesContent":["// related component\n\nimport {\n  ShadowlessElement,\n  SignalWatcher,\n  WithDisposable,\n} from '@lumensuite/block-std';\nimport { css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { createRef } from 'lit/directives/ref.js';\nimport { html } from 'lit/static-html.js';\n\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../../core/column/index.js';\nimport type { Column } from '../../core/view-manager/column.js';\nimport type { KanbanSingleView } from './kanban-view-manager.js';\nimport type { KanbanViewSelection } from './types.js';\n\nimport { renderUniLit } from '../../core/utils/uni-component/uni-component.js';\n\nconst styles = css`\n  affine-data-view-kanban-cell {\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    padding: 4px;\n    min-height: 20px;\n    border: 1px solid transparent;\n    box-sizing: border-box;\n  }\n\n  affine-data-view-kanban-cell:hover {\n    background-color: var(--affine-hover-color);\n  }\n\n  affine-data-view-kanban-cell .icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    align-self: start;\n    margin-right: 12px;\n    height: var(--data-view-cell-text-line-height);\n  }\n\n  affine-data-view-kanban-cell .icon svg {\n    width: 16px;\n    height: 16px;\n    fill: var(--affine-icon-color);\n    color: var(--affine-icon-color);\n  }\n\n  .kanban-cell {\n    flex: 1;\n    display: block;\n    width: 196px;\n  }\n`;\n\n@customElement('affine-data-view-kanban-cell')\nexport class KanbanCell extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = styles;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  selectCurrentCell = (editing: boolean) => {\n    const selectionView = this.closest(\n      'affine-data-view-kanban'\n    )?.selectionController;\n    if (!selectionView) return;\n    if (selectionView) {\n      const selection = selectionView.selection;\n      if (selection && this.isSelected(selection) && editing) {\n        selectionView.selection = {\n          selectionType: 'cell',\n          groupKey: this.groupKey,\n          cardId: this.cardId,\n          columnId: this.column.id,\n          isEditing: true,\n        };\n      } else {\n        selectionView.selection = {\n          selectionType: 'cell',\n          groupKey: this.groupKey,\n          cardId: this.cardId,\n          columnId: this.column.id,\n          isEditing: false,\n        };\n      }\n    }\n  };\n\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  get selection() {\n    return this.closest('affine-data-view-kanban')?.selectionController;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(this, 'click', e => {\n      if (e.shiftKey) {\n        return;\n      }\n      e.stopPropagation();\n      const selectionElement = this.closest(\n        'affine-data-view-kanban'\n      )?.selectionController;\n      if (!selectionElement) return;\n      if (e.shiftKey) return;\n\n      if (!this.editing) {\n        this.selectCurrentCell(!this.column.readonly$.value);\n      }\n    });\n  }\n\n  isSelected(selection: KanbanViewSelection) {\n    if (\n      selection.selectionType !== 'cell' ||\n      selection.groupKey !== this.groupKey\n    ) {\n      return;\n    }\n    return (\n      selection.cardId === this.cardId && selection.columnId === this.column.id\n    );\n  }\n\n  override render() {\n    const props: CellRenderProps = {\n      cell: this.column.cellGet(this.cardId),\n      isEditing: this.editing,\n      selectCurrentCell: this.selectCurrentCell,\n    };\n    const renderer = this.column.renderer$.value;\n    if (!renderer) return;\n    const { view, edit } = renderer;\n    this.style.border = this.isFocus\n      ? '1px solid var(--affine-primary-color)'\n      : '';\n    this.style.boxShadow = this.editing\n      ? '0px 0px 0px 2px rgba(30, 150, 235, 0.30)'\n      : '';\n    return html` ${this.renderIcon()}\n    ${renderUniLit(this.editing && edit ? edit : view, props, {\n      ref: this._cell,\n      class: 'kanban-cell',\n      style: { display: 'block', flex: '1', overflow: 'hidden' },\n    })}`;\n  }\n\n  renderIcon() {\n    if (this.contentOnly) {\n      return;\n    }\n    return html` <uni-lit class=\"icon\" .uni=\"${this.column.icon}\"></uni-lit>`;\n  }\n\n  @property({ attribute: false })\n  accessor cardId!: string;\n\n  @property({ attribute: false })\n  accessor column!: Column;\n\n  @property({ attribute: false })\n  accessor contentOnly = false;\n\n  @state()\n  accessor editing = false;\n\n  @property({ attribute: false })\n  accessor groupKey!: string;\n\n  @state()\n  accessor isFocus = false;\n\n  @property({ attribute: false })\n  accessor view!: KanbanSingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-kanban-cell': KanbanCell;\n  }\n}\n"]}