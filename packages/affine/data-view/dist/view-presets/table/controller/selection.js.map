{"version":3,"file":"selection.js","sourceRoot":"","sources":["../../../../src/view-presets/table/controller/selection.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReactiveController } from 'lit';\nimport type { Ref } from 'lit/directives/ref.js';\n\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { effect } from '@lit-labs/preact-signals';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { createRef, ref } from 'lit/directives/ref.js';\n\nimport type { DatabaseCellContainer } from '../cell.js';\nimport type { TableRow } from '../row/row.js';\nimport type { DataViewTable } from '../table-view.js';\n\nimport { startDrag } from '../../../core/utils/drag.js';\nimport { autoScrollOnBoundary } from '../../../core/utils/frame-loop.js';\nimport {\n  type CellFocus,\n  type MultiSelection,\n  RowWithGroup,\n  TableAreaSelection,\n  TableRowSelection,\n  type TableViewSelection,\n  type TableViewSelectionWithType,\n} from '../types.js';\nimport {\n  DragToFillElement,\n  fillSelectionWithFocusCellData,\n} from './drag-to-fill.js';\n\nexport class TableSelectionController implements ReactiveController {\n  private _tableViewSelection?: TableViewSelectionWithType;\n\n  private getFocusCellContainer = () => {\n    if (\n      !this._tableViewSelection ||\n      this._tableViewSelection.selectionType !== 'area'\n    )\n      return null;\n    const { groupKey, focus } = this._tableViewSelection;\n\n    const dragStartCell = this.getCellContainer(\n      groupKey,\n      focus.rowIndex,\n      focus.columnIndex\n    );\n    return dragStartCell ?? null;\n  };\n\n  __dragToFillElement = new DragToFillElement();\n\n  __selectionElement;\n\n  selectionStyleUpdateTask = 0;\n\n  private get areaSelectionElement() {\n    return this.__selectionElement.selectionRef.value;\n  }\n\n  get dragToFillDraggable() {\n    return this.__dragToFillElement.dragToFillRef.value;\n  }\n\n  private get focusSelectionElement() {\n    return this.__selectionElement.focusRef.value;\n  }\n\n  get selection(): TableViewSelectionWithType | undefined {\n    return this._tableViewSelection;\n  }\n\n  set selection(data: TableViewSelection | undefined) {\n    if (!data) {\n      this.clearSelection();\n      return;\n    }\n    const selection: TableViewSelectionWithType = {\n      ...data,\n      viewId: this.view.id,\n      type: 'table',\n    };\n    if (selection.selectionType === 'area' && selection.isEditing) {\n      const focus = selection.focus;\n      const container = this.getCellContainer(\n        selection.groupKey,\n        focus.rowIndex,\n        focus.columnIndex\n      );\n      const cell = container?.cell;\n      const isEditing = cell ? cell.beforeEnterEditMode() : true;\n      this.host.setSelection({\n        ...selection,\n        isEditing,\n      });\n    } else {\n      this.host.setSelection(selection);\n    }\n  }\n\n  get tableContainer() {\n    return this.host.querySelector('.affine-database-table-container');\n  }\n\n  get view() {\n    return this.host.view;\n  }\n\n  get viewData() {\n    return this.view;\n  }\n\n  constructor(public host: DataViewTable) {\n    host.addController(this);\n    this.__selectionElement = new SelectionElement();\n    this.__selectionElement.controller = this;\n  }\n\n  private clearSelection() {\n    this.host.setSelection();\n  }\n\n  private handleDragEvent() {\n    this.host.disposables.add(\n      this.host.handleEvent('dragStart', context => {\n        if (this.host.view.readonly$.value) {\n          return;\n        }\n        const event = context.get('pointerState').raw;\n        const target = event.target;\n        if (target instanceof HTMLElement) {\n          const [cell, fillValues] = this.resolveDragStartTarget(target);\n\n          if (cell) {\n            const selection = this.selection;\n            if (\n              selection &&\n              selection.selectionType === 'area' &&\n              selection.isEditing &&\n              selection.focus.rowIndex === cell.rowIndex &&\n              selection.focus.columnIndex === cell.columnIndex\n            ) {\n              return false;\n            }\n            this.startDrag(event, cell, fillValues);\n            event.preventDefault();\n            return true;\n          }\n          return false;\n        }\n        return false;\n      })\n    );\n  }\n\n  private handleSelectionChange() {\n    this.host.disposables.add(\n      this.host.selection$.subscribe(tableSelection => {\n        if (!this.isValidSelection(tableSelection)) {\n          this.selection = undefined;\n          return;\n        }\n        const old =\n          this._tableViewSelection?.selectionType === 'area'\n            ? this._tableViewSelection\n            : undefined;\n        const newSelection =\n          tableSelection?.selectionType === 'area' ? tableSelection : undefined;\n        if (\n          old?.focus.rowIndex !== newSelection?.focus.rowIndex ||\n          old?.focus.columnIndex !== newSelection?.focus.columnIndex\n        ) {\n          requestAnimationFrame(() => {\n            this.scrollToFocus();\n          });\n        }\n\n        if (\n          this.isRowSelection() &&\n          (old?.rowsSelection?.start !== newSelection?.rowsSelection?.start ||\n            old?.rowsSelection?.end !== newSelection?.rowsSelection?.end)\n        ) {\n          requestAnimationFrame(() => {\n            this.scrollToAreaSelection();\n          });\n        }\n\n        if (old) {\n          const container = this.getCellContainer(\n            old.groupKey,\n            old.focus.rowIndex,\n            old.focus.columnIndex\n          );\n          if (container) {\n            const cell = container.cell;\n            if (old.isEditing) {\n              requestAnimationFrame(() => {\n                cell?.onExitEditMode();\n              });\n              cell?.blurCell();\n              container.isEditing = false;\n            }\n          }\n        }\n        this._tableViewSelection = tableSelection;\n\n        if (newSelection) {\n          const container = this.getCellContainer(\n            newSelection.groupKey,\n            newSelection.focus.rowIndex,\n            newSelection.focus.columnIndex\n          );\n          if (container) {\n            const cell = container.cell;\n            if (newSelection.isEditing) {\n              cell?.onEnterEditMode();\n              container.isEditing = true;\n              cell?.focusCell();\n            }\n          }\n        }\n      })\n    );\n  }\n\n  private insertTo(\n    groupKey: string | undefined,\n    rowId: string,\n    before: boolean\n  ) {\n    const id = this.view.rowAdd({ before, id: rowId });\n    if (groupKey != null) {\n      this.view.groupManager.moveCardTo(id, undefined, groupKey, {\n        before,\n        id: rowId,\n      });\n    }\n    const rows =\n      groupKey != null\n        ? this.view.groupManager.groupDataMap$.value?.[groupKey].rows\n        : this.view.rows$.value;\n    requestAnimationFrame(() => {\n      const index = this.host.view.columnManagerList$.value.findIndex(\n        v => v.type$.value === 'title'\n      );\n      this.selection = TableAreaSelection.create({\n        groupKey: groupKey,\n        focus: {\n          rowIndex: rows?.findIndex(v => v === id) ?? 0,\n          columnIndex: index,\n        },\n        isEditing: true,\n      });\n    });\n  }\n\n  private resolveDragStartTarget(\n    target: HTMLElement\n  ): [cell: DatabaseCellContainer | null, fillValues: boolean] {\n    let cell: DatabaseCellContainer | null;\n    const fillValues = !!target.dataset.dragToFill;\n    if (fillValues) {\n      const focusCellContainer = this.getFocusCellContainer();\n      cell = focusCellContainer ?? null;\n    } else {\n      cell = target.closest('affine-database-cell-container');\n    }\n    return [cell, fillValues];\n  }\n\n  private scrollToAreaSelection() {\n    this.areaSelectionElement?.scrollIntoView({\n      block: 'nearest',\n      inline: 'nearest',\n    });\n  }\n\n  private scrollToFocus() {\n    this.focusSelectionElement?.scrollIntoView({\n      block: 'nearest',\n      inline: 'nearest',\n    });\n  }\n\n  areaToRows(selection: TableAreaSelection) {\n    const rows = this.rows(selection.groupKey) ?? [];\n    const ids = Array.from({\n      length: selection.rowsSelection.end - selection.rowsSelection.start + 1,\n    })\n      .map((_, index) => index + selection.rowsSelection.start)\n      .map(row => rows[row]?.rowId);\n    return ids.map(id => ({ id, groupKey: selection.groupKey }));\n  }\n\n  cellPosition(groupKey: string | undefined) {\n    const rows = this.rows(groupKey);\n    const cells = rows\n      ?.item(0)\n      .querySelectorAll('affine-database-cell-container');\n\n    return (x1: number, x2: number, y1: number, y2: number) => {\n      const rowOffsets: number[] = Array.from(rows ?? []).map(\n        v => v.getBoundingClientRect().top\n      );\n      const columnOffsets: number[] = Array.from(cells ?? []).map(\n        v => v.getBoundingClientRect().left\n      );\n      const [startX, endX] = x1 < x2 ? [x1, x2] : [x2, x1];\n      const [startY, endY] = y1 < y2 ? [y1, y2] : [y2, y1];\n      const row: MultiSelection = {\n        start: 0,\n        end: 0,\n      };\n      const column: MultiSelection = {\n        start: 0,\n        end: 0,\n      };\n      for (let i = 0; i < rowOffsets.length; i++) {\n        const offset = rowOffsets[i];\n        if (offset < startY) {\n          row.start = i;\n        }\n        if (offset < endY) {\n          row.end = i;\n        }\n      }\n      for (let i = 0; i < columnOffsets.length; i++) {\n        const offset = columnOffsets[i];\n        if (offset < startX) {\n          column.start = i;\n        }\n        if (offset < endX) {\n          column.end = i;\n        }\n      }\n      return {\n        row,\n        column,\n      };\n    };\n  }\n\n  deleteRow(rowId: string) {\n    this.view.rowDelete([rowId]);\n    this.focusToCell('up');\n  }\n\n  focusFirstCell() {\n    this.selection = TableAreaSelection.create({\n      focus: {\n        rowIndex: 0,\n        columnIndex: 0,\n      },\n      isEditing: false,\n    });\n  }\n\n  focusToArea(selection: TableAreaSelection) {\n    return {\n      ...selection,\n      rowsSelection: selection.rowsSelection ?? {\n        start: selection.focus.rowIndex,\n        end: selection.focus.rowIndex,\n      },\n      columnsSelection: selection.columnsSelection ?? {\n        start: selection.focus.columnIndex,\n        end: selection.focus.columnIndex,\n      },\n      isEditing: false,\n    } satisfies TableAreaSelection;\n  }\n\n  focusToCell(position: 'left' | 'right' | 'up' | 'down') {\n    if (!this.selection || this.selection.selectionType !== 'area') {\n      return;\n    }\n    const cell = this.getCellContainer(\n      this.selection.groupKey,\n      this.selection.focus.rowIndex,\n      this.selection.focus.columnIndex\n    );\n    if (!cell) {\n      return;\n    }\n    const row = cell.closest('data-view-table-row');\n    const rows = Array.from(\n      row\n        ?.closest('.affine-database-table-container')\n        ?.querySelectorAll('data-view-table-row') ?? []\n    );\n    const cells = Array.from(\n      row?.querySelectorAll('affine-database-cell-container') ?? []\n    );\n    if (!row || !rows || !cells) {\n      return;\n    }\n    let rowIndex = rows.indexOf(row);\n    let columnIndex = cells.indexOf(cell);\n    if (position === 'left') {\n      if (columnIndex === 0) {\n        columnIndex = cells.length - 1;\n        rowIndex--;\n      } else {\n        columnIndex--;\n      }\n    }\n    if (position === 'right') {\n      if (columnIndex === cells.length - 1) {\n        columnIndex = 0;\n        rowIndex++;\n      } else {\n        columnIndex++;\n      }\n    }\n    if (position === 'up') {\n      if (rowIndex === 0) {\n        //\n      } else {\n        rowIndex--;\n      }\n    }\n    if (position === 'down') {\n      if (rowIndex === rows.length - 1) {\n        //\n      } else {\n        rowIndex++;\n      }\n    }\n    rows[rowIndex]\n      ?.querySelectorAll('affine-database-cell-container')\n      ?.item(columnIndex)\n      ?.selectCurrentCell(false);\n  }\n\n  getCellContainer(\n    groupKey: string | undefined,\n    rowIndex: number,\n    columnIndex: number\n  ): DatabaseCellContainer | undefined {\n    const row = this.rows(groupKey)?.item(rowIndex);\n    return row\n      ?.querySelectorAll('affine-database-cell-container')\n      .item(columnIndex);\n  }\n\n  getGroup(groupKey: string | undefined) {\n    const container =\n      groupKey != null\n        ? this.tableContainer?.querySelector(\n            `affine-data-view-table-group[data-group-key=\"${groupKey}\"]`\n          )\n        : this.tableContainer;\n    return container ?? null;\n  }\n\n  getRect(\n    groupKey: string | undefined,\n    top: number,\n    bottom: number,\n    left: number,\n    right: number\n  ):\n    | undefined\n    | {\n        top: number;\n        left: number;\n        width: number;\n        height: number;\n        scale: number;\n      } {\n    const rows = this.rows(groupKey);\n    const topRow = rows?.item(top);\n    const bottomRow = rows?.item(bottom);\n    if (!topRow || !bottomRow) {\n      return;\n    }\n    const topCells = topRow.querySelectorAll('affine-database-cell-container');\n    const leftCell = topCells.item(left);\n    const rightCell = topCells.item(right);\n    if (!leftCell || !rightCell) {\n      return;\n    }\n    const leftRect = leftCell.getBoundingClientRect();\n    const scale = leftRect.width / leftCell.column.width$.value;\n    return {\n      top: leftRect.top / scale,\n      left: leftRect.left / scale,\n      width: (rightCell.getBoundingClientRect().right - leftRect.left) / scale,\n      height: (bottomRow.getBoundingClientRect().bottom - leftRect.top) / scale,\n      scale,\n    };\n  }\n\n  getRow(groupKey: string | undefined, rowId: string) {\n    return this.getGroup(groupKey)?.querySelector(\n      `data-view-table-row[data-row-id='${rowId}']`\n    );\n  }\n\n  getSelectionAreaBorder(position: 'left' | 'right' | 'top' | 'bottom') {\n    return this.__selectionElement.selectionRef.value?.querySelector(\n      `.area-border.area-${position}`\n    );\n  }\n\n  hostConnected() {\n    requestAnimationFrame(() => {\n      this.tableContainer?.append(this.__selectionElement);\n      this.tableContainer?.append(this.__dragToFillElement);\n    });\n    this.handleDragEvent();\n    this.handleSelectionChange();\n  }\n\n  insertRowAfter(groupKey: string | undefined, rowId: string) {\n    this.insertTo(groupKey, rowId, false);\n  }\n\n  insertRowBefore(groupKey: string | undefined, rowId: string) {\n    this.insertTo(groupKey, rowId, true);\n  }\n\n  isRowSelection() {\n    return this.selection?.selectionType === 'row';\n  }\n\n  isValidSelection(selection?: TableViewSelectionWithType): boolean {\n    if (!selection || selection.selectionType === 'row') {\n      return true;\n    }\n    if (selection.focus.rowIndex > this.view.rows$.value.length - 1) {\n      this.selection = undefined;\n      return false;\n    }\n    if (selection.focus.columnIndex > this.view.columns$.value.length - 1) {\n      this.selection = undefined;\n      return false;\n    }\n    return true;\n  }\n\n  navigateRowSelection(direction: 'up' | 'down', append = false) {\n    if (!TableRowSelection.is(this.selection)) return;\n    const rows = this.selection.rows;\n    const lastRow = rows[rows.length - 1];\n    const lastRowIndex =\n      (\n        this.getGroup(lastRow.groupKey)?.querySelector(\n          `data-view-table-row[data-row-id='${lastRow.id}']`\n        ) as TableRow | null\n      )?.rowIndex ?? 0;\n    const getRowByIndex = (index: number) => {\n      const tableRow = this.rows(lastRow.groupKey)?.item(index);\n      if (!tableRow) {\n        return;\n      }\n      return {\n        id: tableRow.rowId,\n        groupKey: lastRow.groupKey,\n      };\n    };\n    const prevRow = getRowByIndex(lastRowIndex - 1);\n    const nextRow = getRowByIndex(lastRowIndex + 1);\n    const includes = (row: RowWithGroup) => {\n      if (!row) {\n        return false;\n      }\n      return rows.some(r => RowWithGroup.equal(r, row));\n    };\n    if (append) {\n      const addList: RowWithGroup[] = [];\n      const removeList: RowWithGroup[] = [];\n      if (direction === 'up' && prevRow != null) {\n        if (includes(prevRow)) {\n          removeList.push(lastRow);\n        } else {\n          addList.push(prevRow);\n        }\n      }\n      if (direction === 'down' && nextRow != null) {\n        if (includes(nextRow)) {\n          removeList.push(lastRow);\n        } else {\n          addList.push(nextRow);\n        }\n      }\n      this.rowSelectionChange({ add: addList, remove: removeList });\n    } else {\n      const target = direction === 'up' ? prevRow : nextRow;\n      if (target != null) {\n        this.selection = TableRowSelection.create({\n          rows: [target],\n        });\n      }\n    }\n  }\n\n  rows(groupKey: string | undefined) {\n    const container =\n      groupKey != null\n        ? this.tableContainer?.querySelector(\n            `affine-data-view-table-group[data-group-key=\"${groupKey}\"]`\n          )\n        : this.tableContainer;\n    return container?.querySelectorAll('data-view-table-row');\n  }\n\n  rowSelectionChange({\n    add,\n    remove,\n  }: {\n    add: RowWithGroup[];\n    remove: RowWithGroup[];\n  }) {\n    const key = (r: RowWithGroup) => `${r.id}.${r.groupKey ? r.groupKey : ''}`;\n    const rows = new Set(\n      TableRowSelection.rows(this.selection).map(r => key(r))\n    );\n    remove.forEach(row => rows.delete(key(row)));\n    add.forEach(row => rows.add(key(row)));\n    const result = [...rows]\n      .map(r => r.split('.'))\n      .map(([id, groupKey]) => ({\n        id,\n        groupKey: groupKey ? groupKey : undefined,\n      }));\n    this.selection = TableRowSelection.create({\n      rows: result,\n    });\n  }\n\n  rowsToArea(\n    rows: string[]\n  ): { start: number; end: number; groupKey?: string } | undefined {\n    let groupKey: string | undefined = undefined;\n    let minIndex: number | undefined = undefined;\n    let maxIndex: number | undefined = undefined;\n    const set = new Set(rows);\n    if (!this.tableContainer) return;\n    for (const row of this.tableContainer\n      ?.querySelectorAll('data-view-table-row')\n      .values() ?? []) {\n      if (!set.has(row.rowId)) {\n        continue;\n      }\n      minIndex =\n        minIndex != null ? Math.min(minIndex, row.rowIndex) : row.rowIndex;\n      maxIndex =\n        maxIndex != null ? Math.max(maxIndex, row.rowIndex) : row.rowIndex;\n      if (groupKey == null) {\n        groupKey = row.groupKey;\n      } else if (groupKey !== row.groupKey) {\n        return;\n      }\n    }\n    if (minIndex == null || maxIndex == null) {\n      return;\n    }\n    return {\n      groupKey,\n      start: minIndex,\n      end: maxIndex,\n    };\n  }\n\n  selectionAreaDown() {\n    const selection = this.selection;\n    if (!selection || selection.selectionType !== 'area') {\n      return;\n    }\n    const newSelection = this.focusToArea(selection);\n    if (newSelection.rowsSelection.start === newSelection.focus.rowIndex) {\n      newSelection.rowsSelection.end = Math.min(\n        (this.rows(newSelection.groupKey)?.length ?? 0) - 1,\n        newSelection.rowsSelection.end + 1\n      );\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('bottom')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    } else {\n      newSelection.rowsSelection.start += 1;\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('top')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    }\n    this.selection = newSelection;\n  }\n\n  selectionAreaLeft() {\n    const selection = this.selection;\n    if (!selection || selection.selectionType !== 'area') {\n      return;\n    }\n    const newSelection = this.focusToArea(selection);\n    if (newSelection.columnsSelection.end === newSelection.focus.columnIndex) {\n      newSelection.columnsSelection.start = Math.max(\n        0,\n        newSelection.columnsSelection.start - 1\n      );\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('left')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    } else {\n      newSelection.columnsSelection.end -= 1;\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('right')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    }\n    this.selection = newSelection;\n  }\n\n  selectionAreaRight() {\n    const selection = this.selection;\n    if (!selection || selection.selectionType !== 'area') {\n      return;\n    }\n    const newSelection = this.focusToArea(selection);\n    if (\n      newSelection.columnsSelection.start === newSelection.focus.columnIndex\n    ) {\n      const max =\n        (this.rows(newSelection.groupKey)\n          ?.item(0)\n          .querySelectorAll('affine-database-cell-container').length ?? 0) - 1;\n      newSelection.columnsSelection.end = Math.min(\n        max,\n        newSelection.columnsSelection.end + 1\n      );\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('right')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    } else {\n      newSelection.columnsSelection.start += 1;\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('left')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    }\n    this.selection = newSelection;\n  }\n\n  selectionAreaUp() {\n    const selection = this.selection;\n    if (!selection || selection.selectionType !== 'area') {\n      return;\n    }\n    const newSelection = this.focusToArea(selection);\n    if (newSelection.rowsSelection.end === newSelection.focus.rowIndex) {\n      newSelection.rowsSelection.start = Math.max(\n        0,\n        newSelection.rowsSelection.start - 1\n      );\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('top')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    } else {\n      newSelection.rowsSelection.end -= 1;\n      requestAnimationFrame(() => {\n        this.getSelectionAreaBorder('bottom')?.scrollIntoView({\n          block: 'nearest',\n          inline: 'nearest',\n          behavior: 'smooth',\n        });\n      });\n    }\n    this.selection = newSelection;\n  }\n\n  startDrag(\n    evt: PointerEvent,\n    cell: DatabaseCellContainer,\n    fillValues?: boolean\n  ) {\n    const groupKey = cell.closest('affine-data-view-table-group')?.group?.key;\n    const table = this.tableContainer;\n    const scrollContainer = table?.parentElement;\n    if (!table || !scrollContainer) {\n      return;\n    }\n    const tableRect = table.getBoundingClientRect();\n    const startOffsetX = evt.x - tableRect.left;\n    const startOffsetY = evt.y - tableRect.top;\n    const offsetToSelection = this.cellPosition(groupKey);\n    const select = (selection: {\n      row: MultiSelection;\n      column: MultiSelection;\n    }) => {\n      this.selection = TableAreaSelection.create({\n        groupKey: groupKey,\n        rowsSelection: selection.row,\n        columnsSelection: selection.column,\n        focus: {\n          rowIndex: cell.rowIndex,\n          columnIndex: cell.columnIndex,\n        },\n        isEditing: false,\n      });\n    };\n    const cancelScroll = autoScrollOnBoundary(scrollContainer, {\n      onScroll() {\n        drag.move({ x: drag.last.x, y: drag.last.y });\n      },\n    });\n    const drag = startDrag<\n      | {\n          row: MultiSelection;\n          column: MultiSelection;\n        }\n      | undefined,\n      {\n        x: number;\n        y: number;\n      }\n    >(evt, {\n      transform: evt => ({\n        x: evt.x,\n        y: evt.y,\n      }),\n      onDrag: () => {\n        if (fillValues) this.__dragToFillElement.dragging = true;\n        return undefined;\n      },\n      onMove: ({ x, y }) => {\n        if (!table) return;\n        const tableRect = table.getBoundingClientRect();\n        const startX = tableRect.left + startOffsetX;\n        const startY = tableRect.top + startOffsetY;\n        const selection = offsetToSelection(startX, x, startY, y);\n\n        if (fillValues)\n          selection.column = {\n            start: cell.columnIndex,\n            end: cell.columnIndex,\n          };\n\n        select(selection);\n        return selection;\n      },\n      onDrop: selection => {\n        if (!selection) {\n          return;\n        }\n        select(selection);\n        if (fillValues && this.selection) {\n          this.__dragToFillElement.dragging = false;\n          fillSelectionWithFocusCellData(\n            this.host,\n            TableAreaSelection.create({\n              groupKey: groupKey,\n              rowsSelection: selection.row,\n              columnsSelection: selection.column,\n              focus: {\n                rowIndex: cell.rowIndex,\n                columnIndex: cell.columnIndex,\n              },\n              isEditing: false,\n            })\n          );\n        }\n      },\n      onClear: () => {\n        cancelScroll();\n      },\n    });\n  }\n\n  toggleRow(rowId: string, groupKey?: string) {\n    const row = {\n      id: rowId,\n      groupKey,\n    };\n    const isSelected = TableRowSelection.includes(this.selection, row);\n    this.rowSelectionChange({\n      add: isSelected ? [] : [row],\n      remove: isSelected ? [row] : [],\n    });\n  }\n}\n\n@customElement('data-view-table-selection')\nclass SelectionElement extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .database-selection {\n      position: absolute;\n      z-index: 2;\n      box-sizing: border-box;\n      background: var(--affine-primary-color-04);\n      pointer-events: none;\n      display: none;\n    }\n\n    .database-focus {\n      position: absolute;\n      width: 100%;\n      z-index: 2;\n      box-sizing: border-box;\n      border: 1px solid var(--affine-primary-color);\n      border-radius: 2px;\n      pointer-events: none;\n      display: none;\n      outline: none;\n    }\n\n    .area-border {\n      position: absolute;\n      pointer-events: none;\n    }\n    .area-left {\n      left: 0;\n      height: 100%;\n      width: 1px;\n    }\n    .area-right {\n      right: 0;\n      height: 100%;\n      width: 1px;\n    }\n    .area-top {\n      top: 0;\n      width: 100%;\n      height: 1px;\n    }\n    .area-bottom {\n      bottom: 0;\n      width: 100%;\n      height: 1px;\n    }\n    @media print {\n      data-view-table-selection {\n        display: none;\n      }\n    }\n  `;\n\n  focusRef: Ref<HTMLDivElement> = createRef<HTMLDivElement>();\n\n  preTask = 0;\n\n  selectionRef: Ref<HTMLDivElement> = createRef<HTMLDivElement>();\n\n  get selection$() {\n    return this.controller.host.selection$;\n  }\n\n  clearAreaStyle() {\n    const div = this.selectionRef.value;\n    if (!div) return;\n    div.style.display = 'none';\n  }\n\n  clearFocusStyle() {\n    const div = this.focusRef.value;\n    const dragToFill = this.controller.dragToFillDraggable;\n    if (!div || !dragToFill) return;\n    div.style.display = 'none';\n    dragToFill.style.display = 'none';\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.add(\n      effect(() => {\n        this.startUpdate(this.selection$.value);\n      })\n    );\n  }\n\n  override render() {\n    return html`\n      <div ${ref(this.selectionRef)} class=\"database-selection\">\n        <div class=\"area-border area-left\"></div>\n        <div class=\"area-border area-right\"></div>\n        <div class=\"area-border area-top\"></div>\n        <div class=\"area-border area-bottom\"></div>\n      </div>\n      <div tabindex=\"0\" ${ref(this.focusRef)} class=\"database-focus\"></div>\n    `;\n  }\n\n  startUpdate(selection?: TableViewSelection) {\n    if (this.preTask) {\n      cancelAnimationFrame(this.preTask);\n      this.preTask = 0;\n    }\n    if (\n      selection?.selectionType === 'area' &&\n      !this.controller.host.view.readonly$.value\n    ) {\n      this.updateAreaSelectionStyle(\n        selection.groupKey,\n        selection.rowsSelection,\n        selection.columnsSelection\n      );\n\n      const columnSelection = selection.columnsSelection;\n      const rowSelection = selection.rowsSelection;\n\n      const isSingleRowSelection = rowSelection.end - rowSelection.start === 0;\n      const isSingleColumnSelection =\n        columnSelection.end - columnSelection.start === 0;\n\n      const isDragElemDragging = this.controller.__dragToFillElement.dragging;\n      const isEditing = selection.isEditing;\n\n      const showDragToFillHandle =\n        !isEditing &&\n        (isDragElemDragging || isSingleRowSelection) &&\n        isSingleColumnSelection;\n\n      this.updateFocusSelectionStyle(\n        selection.groupKey,\n        selection.focus,\n        isEditing,\n        showDragToFillHandle\n      );\n      this.preTask = requestAnimationFrame(() =>\n        this.startUpdate(this.selection$.value)\n      );\n    } else {\n      this.clearFocusStyle();\n      this.clearAreaStyle();\n    }\n  }\n\n  updateAreaSelectionStyle(\n    groupKey: string | undefined,\n    rowSelection: MultiSelection,\n    columnSelection: MultiSelection\n  ) {\n    const div = this.selectionRef.value;\n    if (!div) return;\n    const tableContainer = this.controller.tableContainer;\n    if (!tableContainer) return;\n    const tableRect = tableContainer.getBoundingClientRect();\n    const rect = this.controller.getRect(\n      groupKey,\n      rowSelection?.start ?? 0,\n      rowSelection?.end ?? this.controller.view.rows$.value.length - 1,\n      columnSelection?.start ?? 0,\n      columnSelection?.end ??\n        this.controller.view.columnManagerList$.value.length - 1\n    );\n    if (!rect) {\n      this.clearAreaStyle();\n      return;\n    }\n    const { left, top, width, height, scale } = rect;\n    div.style.left = `${left - tableRect.left / scale}px`;\n    div.style.top = `${top - tableRect.top / scale}px`;\n    div.style.width = `${width}px`;\n    div.style.height = `${height}px`;\n    div.style.display = 'block';\n  }\n\n  updateFocusSelectionStyle(\n    groupKey: string | undefined,\n    focus: CellFocus,\n    isEditing: boolean,\n    showDragToFillHandle = false\n  ) {\n    const div = this.focusRef.value;\n    const dragToFill = this.controller.dragToFillDraggable;\n    if (!div || !dragToFill) return;\n    // Check if row is removed.\n    const rows = this.controller.rows(groupKey) ?? [];\n    if (rows.length <= focus.rowIndex) return;\n\n    const rect = this.controller.getRect(\n      groupKey,\n      focus.rowIndex,\n      focus.rowIndex,\n      focus.columnIndex,\n      focus.columnIndex\n    );\n    if (!rect) {\n      this.clearFocusStyle();\n      return;\n    }\n    const { left, top, width, height, scale } = rect;\n    const tableContainer = this.controller.tableContainer;\n    if (!tableContainer) return;\n    const tableRect = tableContainer?.getBoundingClientRect();\n    if (!tableRect) {\n      this.clearFocusStyle();\n      return;\n    }\n\n    const x = left - tableRect.left / scale;\n    const y = top - 1 - tableRect.top / scale;\n    const w = width + 1;\n    const h = height + 1;\n    div.style.left = `${x}px`;\n    div.style.top = `${y}px`;\n    div.style.width = `${w}px`;\n    div.style.height = `${h}px`;\n    div.style.borderColor = 'var(--affine-primary-color)';\n    div.style.borderStyle = this.controller.__dragToFillElement.dragging\n      ? 'dashed'\n      : 'solid';\n    div.style.boxShadow = isEditing\n      ? '0px 0px 0px 2px rgba(30, 150, 235, 0.30)'\n      : 'unset';\n    div.style.display = 'block';\n\n    dragToFill.style.left = `${x + w}px`;\n    dragToFill.style.top = `${y + h}px`;\n    dragToFill.style.display = showDragToFillHandle ? 'block' : 'none';\n  }\n\n  @property({ attribute: false })\n  accessor controller!: TableSelectionController;\n}\n"]}