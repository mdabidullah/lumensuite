{"version":3,"file":"reassociate-connectors.js","sourceRoot":"","sources":["../../src/commands/reassociate-connectors.ts"],"names":[],"mappings":"AAEA;;;;;GAKG;AACH,MAAM,CAAC,MAAM,4BAA4B,GAIrC,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,GAAG,CAAC;IAC7B,MAAM,OAAO,GAAG,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;IACrD,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC;QACjC,IAAI,EAAE,CAAC;QACP,OAAO;IACT,CAAC;IAED,MAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;IAChC,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;IAChD,KAAK,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,UAAU,EAAE,CAAC;QAChD,IAAI,MAAM,CAAC,EAAE,KAAK,KAAK,EAAE,CAAC;YACxB,OAAO,CAAC,aAAa,CAAC,EAAE,EAAE;gBACxB,MAAM,EAAE;oBACN,GAAG,MAAM;oBACT,EAAE,EAAE,KAAK;iBACV;aACF,CAAC,CAAC;YACH,SAAS;QACX,CAAC;QACD,IAAI,MAAM,CAAC,EAAE,KAAK,KAAK,EAAE,CAAC;YACxB,OAAO,CAAC,aAAa,CAAC,EAAE,EAAE;gBACxB,MAAM,EAAE;oBACN,GAAG,MAAM;oBACT,EAAE,EAAE,KAAK;iBACV;aACF,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAED,IAAI,EAAE,CAAC;AACT,CAAC,CAAC","sourcesContent":["import type { Command } from '@lumensuite/block-std';\n\n/**\n * Re-associate bindings for block that have been converted.\n *\n * @param oldId - the old block id\n * @param newId - the new block id\n */\nexport const reassociateConnectorsCommand: Command<\n  never,\n  never,\n  { oldId: string; newId: string }\n> = (ctx, next) => {\n  const { oldId, newId } = ctx;\n  const service = ctx.std.getService('affine:surface');\n  if (!oldId || !newId || !service) {\n    next();\n    return;\n  }\n\n  const surface = service.surface;\n  const connectors = surface.getConnectors(oldId);\n  for (const { id, source, target } of connectors) {\n    if (source.id === oldId) {\n      surface.updateElement(id, {\n        source: {\n          ...source,\n          id: newId,\n        },\n      });\n      continue;\n    }\n    if (target.id === oldId) {\n      surface.updateElement(id, {\n        target: {\n          ...target,\n          id: newId,\n        },\n      });\n    }\n  }\n\n  next();\n};\n\ndeclare global {\n  namespace LumenSuite {\n    interface Commands {\n      reassociateConnectors: typeof reassociateConnectorsCommand;\n    }\n  }\n}\n"]}