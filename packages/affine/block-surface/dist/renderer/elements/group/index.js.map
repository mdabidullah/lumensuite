{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/renderer/elements/group/index.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,KAAK,EAAE,MAAM,0BAA0B,CAAC;AAIjD,OAAO,EAAE,iBAAiB,EAAE,MAAM,YAAY,CAAC;AAE/C,MAAM,UAAU,KAAK,CACnB,KAAwB,EACxB,GAA6B,EAC7B,MAAiB,EACjB,QAAwB;IAExB,MAAM,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;IACvB,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IACtC,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,gBAAgB,EAAE,EAAE,IAAI,EAAE,CAAC;IAE9D,MAAM,YAAY,GAAG,iBAAiB,CAAC,KAAK,EAAE,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACtE,KAAK,CAAC,YAAY,GAAG,YAAY,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;IAEzD,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;IAEzB,IAAI,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC;QAChC,IAAI,KAAK,CAAC,SAAS,EAAE,CAAC;YACpB,WAAW,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC;QAClD,CAAC;aAAM,CAAC;YACN,GAAG,CAAC,SAAS,GAAG,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC;YAC3C,GAAG,CAAC,WAAW,GAAG,QAAQ,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;YAC7D,GAAG,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QACzC,CAAC;IACH,CAAC;SAAM,IAAI,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;QAC1E,GAAG,CAAC,SAAS,GAAG,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC;QAC3C,GAAG,CAAC,WAAW,GAAG,SAAS,CAAC;QAC5B,GAAG,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QAEvC,IAAI,KAAK,CAAC,SAAS;YAAE,WAAW,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC;IACvE,CAAC;AACH,CAAC;AAED,SAAS,WAAW,CAClB,KAAwB,EACxB,GAA6B,EAC7B,QAAwB,EACxB,YAAkD;IAElD,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,GAAG,YAAY,CAAC;IAE7E,KAAK,CAAC,YAAY,GAAG,UAAU,CAAC,SAAS,EAAE,CAAC;IAE5C,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;IAE1B,GAAG,CAAC,SAAS,EAAE,CAAC;IAEhB,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC;IAChB,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;IAC3D,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC;IACvB,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC;IAC5B,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,GAAG,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/D,CAAC","sourcesContent":["import type { GroupElementModel } from '@lumensuite/affine-model';\n\nimport { Bound } from '@lumensuite/global/utils';\n\nimport type { CanvasRenderer } from '../../canvas-renderer.js';\n\nimport { titleRenderParams } from './utils.js';\n\nexport function group(\n  model: GroupElementModel,\n  ctx: CanvasRenderingContext2D,\n  matrix: DOMMatrix,\n  renderer: CanvasRenderer\n) {\n  const { xywh } = model;\n  const bound = Bound.deserialize(xywh);\n  const elements = renderer.provider.selectedElements?.() || [];\n\n  const renderParams = titleRenderParams(model, renderer.viewport.zoom);\n  model.externalXYWH = renderParams.titleBound.serialize();\n\n  ctx.setTransform(matrix);\n\n  if (elements.includes(model.id)) {\n    if (model.showTitle) {\n      renderTitle(model, ctx, renderer, renderParams);\n    } else {\n      ctx.lineWidth = 2 / renderer.viewport.zoom;\n      ctx.strokeStyle = renderer.getPropertyValue('--affine-blue');\n      ctx.strokeRect(0, 0, bound.w, bound.h);\n    }\n  } else if (model.childElements.some(child => elements.includes(child.id))) {\n    ctx.lineWidth = 2 / renderer.viewport.zoom;\n    ctx.strokeStyle = '#8FD1FF';\n    ctx.strokeRect(0, 0, bound.w, bound.h);\n\n    if (model.showTitle) renderTitle(model, ctx, renderer, renderParams);\n  }\n}\n\nfunction renderTitle(\n  model: GroupElementModel,\n  ctx: CanvasRenderingContext2D,\n  renderer: CanvasRenderer,\n  renderParams: ReturnType<typeof titleRenderParams>\n) {\n  const { text, lineHeight, font, padding, offset, titleBound } = renderParams;\n\n  model.externalXYWH = titleBound.serialize();\n\n  ctx.translate(0, -offset);\n\n  ctx.beginPath();\n\n  ctx.font = font;\n  ctx.fillStyle = renderer.getPropertyValue('--affine-blue');\n  ctx.textAlign = 'left';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(text, padding[0], -lineHeight / 2 - padding[1]);\n}\n"]}