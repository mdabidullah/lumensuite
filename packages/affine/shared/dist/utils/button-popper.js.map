{"version":3,"file":"button-popper.js","sourceRoot":"","sources":["../../src/utils/button-popper.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Disposable } from '@blocksuite/global/utils';\n\nimport { autoUpdate } from '@floating-ui/dom';\nimport {\n  autoPlacement,\n  computePosition,\n  offset,\n  type Rect,\n  shift,\n  size,\n} from '@floating-ui/dom';\n\nexport function listenClickAway(\n  element: HTMLElement,\n  onClickAway: () => void\n): Disposable {\n  const callback = (event: MouseEvent) => {\n    const inside = event.composedPath().includes(element);\n    if (!inside) {\n      onClickAway();\n    }\n  };\n\n  document.addEventListener('click', callback);\n\n  return {\n    dispose: () => {\n      document.removeEventListener('click', callback);\n    },\n  };\n}\n\ntype Display = 'show' | 'hidden';\n\nconst ATTR_SHOW = 'data-show';\n/**\n * Using attribute 'data-show' to control popper visibility.\n *\n * ```css\n * selector {\n *   display: none;\n * }\n * selector[data-show] {\n *   display: block;\n * }\n * ```\n */\nexport function createButtonPopper(\n  reference: HTMLElement,\n  popperElement: HTMLElement,\n  stateUpdated: (state: { display: Display }) => void = () => {\n    /** DEFAULT EMPTY FUNCTION */\n  },\n  {\n    mainAxis,\n    crossAxis,\n    rootBoundary,\n    ignoreShift,\n  }: {\n    mainAxis?: number;\n    crossAxis?: number;\n    rootBoundary?: Rect | (() => Rect | undefined);\n    ignoreShift?: boolean;\n  } = {}\n) {\n  let display: Display = 'hidden';\n  let cleanup: (() => void) | void;\n\n  const originMaxHeight = window.getComputedStyle(popperElement).maxHeight;\n\n  function compute() {\n    const overflowOptions = {\n      rootBoundary:\n        typeof rootBoundary === 'function' ? rootBoundary() : rootBoundary,\n    };\n\n    computePosition(reference, popperElement, {\n      middleware: [\n        offset({\n          mainAxis: mainAxis ?? 14,\n          crossAxis: crossAxis ?? 0,\n        }),\n        autoPlacement({\n          allowedPlacements: ['top', 'bottom'],\n          ...overflowOptions,\n        }),\n        shift(overflowOptions),\n        size({\n          ...overflowOptions,\n          apply({ availableHeight }) {\n            popperElement.style.maxHeight = originMaxHeight\n              ? `min(${originMaxHeight}, ${availableHeight}px)`\n              : `${availableHeight}px`;\n          },\n        }),\n      ],\n    })\n      .then(({ x, y, middlewareData: data }) => {\n        if (!ignoreShift) {\n          x += data.shift?.x ?? 0;\n          y += data.shift?.y ?? 0;\n        }\n        Object.assign(popperElement.style, {\n          position: 'absolute',\n          zIndex: 1,\n          left: `${x}px`,\n          top: `${y}px`,\n        });\n      })\n      .catch(console.error);\n  }\n\n  const show = (force = false) => {\n    const displayed = display === 'show';\n\n    if (displayed && !force) return;\n\n    if (!displayed) {\n      popperElement.setAttribute(ATTR_SHOW, '');\n      display = 'show';\n      stateUpdated({ display });\n    }\n\n    cleanup?.();\n    cleanup = autoUpdate(reference, popperElement, compute, {\n      animationFrame: true,\n    });\n  };\n\n  const hide = () => {\n    if (display === 'hidden') return;\n    popperElement.removeAttribute(ATTR_SHOW);\n    display = 'hidden';\n    stateUpdated({ display });\n    cleanup?.();\n  };\n\n  const toggle = () => {\n    if (popperElement.hasAttribute(ATTR_SHOW)) {\n      hide();\n    } else {\n      show();\n    }\n  };\n\n  const clickAway = listenClickAway(reference, () => hide());\n\n  return {\n    get state() {\n      return display;\n    },\n    show,\n    hide,\n    toggle,\n    dispose: () => {\n      cleanup?.();\n      clickAway.dispose();\n    },\n  };\n}\n"]}