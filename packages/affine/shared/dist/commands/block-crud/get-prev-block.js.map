{"version":3,"file":"get-prev-block.js","sourceRoot":"","sources":["../../../src/commands/block-crud/get-prev-block.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AAExD,SAAS,cAAc,CAAC,GAAmB,EAAE,IAAY;IACvD,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;IACtB,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAClC,IAAI,CAAC,KAAK;QAAE,OAAO,IAAI,CAAC;IACxB,MAAM,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IAC1C,IAAI,CAAC,IAAI;QAAE,OAAO,IAAI,CAAC;IACvB,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAChC,CAAC;AAED,SAAS,YAAY,CAAC,GAAmB,EAAE,IAAY;IACrD,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;IAEtB,MAAM,IAAI,GAA0B,cAAc,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAE9D,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAClC,IAAI,CAAC,KAAK;QAAE,OAAO,IAAI,CAAC;IAExB,IAAI,IAAI,IAAI,IAAI,CAAC,OAAO,KAAK,IAAI,EAAE,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;IAED,OAAO,IAAI,CAAC;AACd,CAAC;AAED,MAAM,CAAC,MAAM,mBAAmB,GAM5B,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,oBAAoB,CAAC;IAClD,YAAY,CACV,IAAI,EACJ,oGAAoG,CACrG,CAAC;IAEF,MAAM,SAAS,GAAG,YAAY,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAE9C,IAAI,SAAS,EAAE,CAAC;QACd,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC;IACtB,CAAC;AACH,CAAC,CAAC","sourcesContent":["import type { BlockComponent, Command } from '@lumensuite/block-std';\n\nimport { assertExists } from '@lumensuite/global/utils';\n\nfunction getPrevSibling(std: LumenSuite.Std, path: string) {\n  const view = std.view;\n  const block = view.getBlock(path);\n  if (!block) return null;\n  const prev = std.doc.getPrev(block.model);\n  if (!prev) return null;\n  return view.getBlock(prev.id);\n}\n\nfunction getPrevBlock(std: LumenSuite.Std, path: string) {\n  const view = std.view;\n\n  const prev: BlockComponent | null = getPrevSibling(std, path);\n\n  if (!prev) {\n    return null;\n  }\n\n  const block = view.getBlock(path);\n  if (!block) return null;\n\n  if (prev && prev.blockId !== path) {\n    return prev;\n  }\n\n  return null;\n}\n\nexport const getPrevBlockCommand: Command<\n  'currentSelectionPath',\n  'prevBlock',\n  {\n    path?: string;\n  }\n> = (ctx, next) => {\n  const path = ctx.path ?? ctx.currentSelectionPath;\n  assertExists(\n    path,\n    '`path` is required, you need to pass it in args or ctx before adding this command to the pipeline.'\n  );\n\n  const prevBlock = getPrevBlock(ctx.std, path);\n\n  if (prevBlock) {\n    next({ prevBlock });\n  }\n};\n\ndeclare global {\n  namespace LumenSuite {\n    interface CommandContext {\n      prevBlock?: BlockComponent;\n    }\n\n    interface Commands {\n      getPrevBlock: typeof getPrevBlockCommand;\n    }\n  }\n}\n"]}