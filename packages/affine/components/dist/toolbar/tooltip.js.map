{"version":3,"file":"tooltip.js","sourceRoot":"","sources":["../../src/toolbar/tooltip.ts"],"names":[],"mappings":"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","sourcesContent":["import type { CSSResult } from 'lit';\n\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  arrow,\n  type ComputePositionReturn,\n  flip,\n  offset,\n  type Placement,\n} from '@floating-ui/dom';\nimport { css, html, LitElement, unsafeCSS } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nimport { HoverController, type HoverOptions } from '../hover/index.js';\n\nconst styles = css`\n  .affine-tooltip {\n    box-sizing: border-box;\n    max-width: 280px;\n    min-height: 32px;\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-sm);\n    border-radius: 4px;\n    padding: 6px 12px;\n    color: var(--affine-white);\n    background: var(--affine-tooltip);\n\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .arrow {\n    position: absolute;\n\n    width: 0;\n    height: 0;\n  }\n`;\n\n// See http://apps.eky.hk/css-triangle-generator/\nconst TRIANGLE_HEIGHT = 6;\nconst triangleMap = {\n  top: {\n    bottom: '-6px',\n    borderStyle: 'solid',\n    borderWidth: '6px 5px 0 5px',\n    borderColor: 'var(--affine-tooltip) transparent transparent transparent',\n  },\n  right: {\n    left: '-6px',\n    borderStyle: 'solid',\n    borderWidth: '5px 6px 5px 0',\n    borderColor: 'transparent var(--affine-tooltip) transparent transparent',\n  },\n  bottom: {\n    top: '-6px',\n    borderStyle: 'solid',\n    borderWidth: '0 5px 6px 5px',\n    borderColor: 'transparent transparent var(--affine-tooltip) transparent',\n  },\n  left: {\n    right: '-6px',\n    borderStyle: 'solid',\n    borderWidth: '5px 0 5px 6px',\n    borderColor: 'transparent transparent transparent var(--affine-tooltip)',\n  },\n};\n\n// Ported from https://floating-ui.com/docs/tutorial#arrow-middleware\nconst updateArrowStyles = ({\n  placement,\n  middlewareData,\n}: ComputePositionReturn): StyleInfo => {\n  const arrowX = middlewareData.arrow?.x;\n  const arrowY = middlewareData.arrow?.y;\n\n  const triangleStyles =\n    triangleMap[placement.split('-')[0] as keyof typeof triangleMap];\n\n  return {\n    left: arrowX != null ? `${arrowX}px` : '',\n    top: arrowY != null ? `${arrowY}px` : '',\n    ...triangleStyles,\n  };\n};\n\n/**\n * @example\n * ```ts\n * // Simple usage\n * html`\n * <affine-tooltip>Content</affine-tooltip>\n * `\n * // With placement\n * html`\n * <affine-tooltip tip-position=\"top\">\n *   Content\n * </affine-tooltip>\n * `\n *\n * // With custom properties\n * html`\n * <affine-tooltip\n *   .zIndex=${0}\n *   .offset=${4}\n *   .autoFlip=${true}\n *   .arrow=${true}\n *   .tooltipStyle=${css`:host { z-index: 0; --affine-tooltip: #fff; }`}\n *   .allowInteractive=${false}\n * >\n *   Content\n * </affine-tooltip>\n * `\n * ```\n */\n@customElement('affine-tooltip')\nexport class Tooltip extends LitElement {\n  static override styles = css`\n    :host {\n      display: none;\n    }\n  `;\n\n  private _hoverController!: HoverController;\n\n  private _setUpHoverController = () => {\n    this._hoverController = new HoverController(\n      this,\n      () => {\n        // const parentElement = this.parentElement;\n        // if (\n        //   parentElement &&\n        //   'disabled' in parentElement &&\n        //   parentElement.disabled\n        // )\n        //   return null;\n        if (this.hidden) return null;\n        let arrowStyles: StyleInfo = {};\n        return {\n          template: ({ positionSlot, updatePortal }) => {\n            positionSlot.on(data => {\n              // The tooltip placement may change,\n              // so we need to update the arrow position\n              if (this.arrow) {\n                arrowStyles = updateArrowStyles(data);\n              } else {\n                arrowStyles = {};\n              }\n              updatePortal();\n            });\n\n            const children = Array.from(this.childNodes).map(node =>\n              node.cloneNode(true)\n            );\n\n            return html`\n              <style>\n                ${this._getStyles()}\n              </style>\n              <div class=\"affine-tooltip\" role=\"tooltip\">${children}</div>\n              <div class=\"arrow\" style=${styleMap(arrowStyles)}></div>\n            `;\n          },\n          computePosition: portalRoot => ({\n            referenceElement: this.parentElement!,\n            placement: this.placement,\n            middleware: [\n              this.autoFlip && flip({ padding: 12 }),\n              offset((this.arrow ? TRIANGLE_HEIGHT : 0) + this.offset),\n              arrow({\n                element: portalRoot.shadowRoot!.querySelector('.arrow')!,\n              }),\n            ],\n            autoUpdate: true,\n          }),\n        };\n      },\n      {\n        leaveDelay: 0,\n        // The tooltip is not interactive by default\n        safeBridge: false,\n        allowMultiple: true,\n        ...this.hoverOptions,\n      }\n    );\n\n    const parent = this.parentElement;\n    assertExists(parent, 'Tooltip must have a parent element');\n\n    // Wait for render\n    setTimeout(() => {\n      this._hoverController.setReference(parent);\n    }, 0);\n  };\n\n  private _getStyles() {\n    return css`\n      ${styles}\n      :host {\n        z-index: ${unsafeCSS(this.zIndex)};\n        opacity: 0;\n        ${\n          // All the styles are applied to the portal element\n          unsafeCSS(this.style.cssText)\n        }\n      }\n\n      ${this.allowInteractive\n        ? css``\n        : css`\n            :host {\n              pointer-events: none;\n            }\n          `}\n\n      ${this.tooltipStyle}\n    `;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._setUpHoverController();\n  }\n\n  getPortal() {\n    return this._hoverController.portal;\n  }\n\n  /**\n   * Allow the tooltip to be interactive.\n   * eg. allow the user to select text in the tooltip.\n   */\n  @property({ attribute: false })\n  accessor allowInteractive = false;\n\n  /**\n   * Show a triangle arrow pointing to the reference element.\n   */\n  @property({ attribute: false })\n  accessor arrow = true;\n\n  /**\n   * changes the placement of the floating element in order to keep it in view,\n   * with the ability to flip to any placement.\n   *\n   * See https://floating-ui.com/docs/flip\n   */\n  @property({ attribute: false })\n  accessor autoFlip = true;\n\n  @property({ attribute: false })\n  accessor hoverOptions: Partial<HoverOptions> = {};\n\n  /**\n   * Default is `4px`\n   *\n   * See https://floating-ui.com/docs/offset\n   */\n  @property({ attribute: false })\n  accessor offset = 4;\n\n  @property({ attribute: 'tip-position' })\n  accessor placement: Placement = 'top';\n\n  @property({ attribute: false })\n  accessor tooltipStyle: CSSResult = css``;\n\n  @property({ attribute: false })\n  accessor zIndex: number | string = 'var(--affine-z-index-popover)';\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-tooltip': Tooltip;\n  }\n}\n"]}