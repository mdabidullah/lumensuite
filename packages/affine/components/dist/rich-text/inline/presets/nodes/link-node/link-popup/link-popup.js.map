{"version":3,"file":"link-popup.js","sourceRoot":"","sources":["../../../../../../../src/rich-text/inline/presets/nodes/link-node/link-popup/link-popup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EmbedOptions } from '@lumensuite/affine-shared/types';\nimport type { BlockComponent } from '@lumensuite/block-std';\nimport type { InlineRange } from '@lumensuite/inline/types';\n\nimport { EmbedOptionProvider } from '@lumensuite/affine-shared/services';\nimport {\n  getHostName,\n  isValidUrl,\n  normalizeUrl,\n} from '@lumensuite/affine-shared/utils';\nimport { BLOCK_ID_ATTR, WithDisposable } from '@lumensuite/block-std';\nimport { computePosition, inline, offset, shift } from '@floating-ui/dom';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { EditorIconButton } from '../../../../../../toolbar/index.js';\nimport type { AffineInlineEditor } from '../../../affine-inline-specs.js';\n\nimport {\n  ConfirmIcon,\n  CopyIcon,\n  DeleteIcon,\n  EditIcon,\n  MoreVerticalIcon,\n  OpenIcon,\n  SmallArrowDownIcon,\n  UnlinkIcon,\n} from '../../../../../../icons/index.js';\nimport { toast } from '../../../../../../toast/index.js';\nimport {\n  renderActions,\n  renderToolbarSeparator,\n} from '../../../../../../toolbar/index.js';\nimport { linkPopupStyle } from './styles.js';\n\n@customElement('link-popup')\nexport class LinkPopup extends WithDisposable(LitElement) {\n  static override styles = linkPopupStyle;\n\n  private _bodyOverflowStyle = '';\n\n  private _createTemplate = () => {\n    this.updateComplete\n      .then(() => {\n        this.linkInput?.focus();\n\n        this._updateConfirmBtn();\n      })\n      .catch(console.error);\n\n    return html`\n      <div class=\"affine-link-popover create\">\n        <input\n          id=\"link-input\"\n          class=\"affine-link-popover-input\"\n          type=\"text\"\n          spellcheck=\"false\"\n          placeholder=\"Paste or type a link\"\n          @input=${this._updateConfirmBtn}\n        />\n        ${this._confirmBtnTemplate()}\n      </div>\n    `;\n  };\n\n  private _delete = () => {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.deleteText(this.targetInlineRange);\n    }\n    this.abortController.abort();\n  };\n\n  private _edit = () => {\n    this.type = 'edit';\n  };\n\n  private _editTemplate = () => {\n    this.updateComplete\n      .then(() => {\n        if (\n          !this.textInput ||\n          !this.linkInput ||\n          !this.currentText ||\n          !this.currentLink\n        )\n          return;\n\n        this.textInput.value = this.currentText;\n        this.linkInput.value = this.currentLink;\n\n        this.textInput.select();\n\n        this._updateConfirmBtn();\n      })\n      .catch(console.error);\n\n    return html`\n      <div class=\"affine-link-edit-popover\">\n        <div class=\"affine-edit-area text\">\n          <input\n            class=\"affine-edit-input\"\n            id=\"text-input\"\n            type=\"text\"\n            placeholder=\"Enter text\"\n            @input=${this._updateConfirmBtn}\n          />\n          <label class=\"affine-edit-label\" for=\"text-input\">Text</label>\n        </div>\n        <div class=\"affine-edit-area link\">\n          <input\n            id=\"link-input\"\n            class=\"affine-edit-input\"\n            type=\"text\"\n            spellcheck=\"false\"\n            placeholder=\"Paste or type a link\"\n            @input=${this._updateConfirmBtn}\n          />\n          <label class=\"affine-edit-label\" for=\"link-input\">Link</label>\n        </div>\n        ${this._confirmBtnTemplate()}\n      </div>\n    `;\n  };\n\n  private _embedOptions: EmbedOptions | null = null;\n\n  private _openLink = () => {\n    let link = this.currentLink;\n    if (!link) return;\n    if (!link.match(/^[a-zA-Z]+:\\/\\//)) {\n      link = 'https://' + link;\n    }\n    window.open(link, '_blank');\n    this.abortController.abort();\n  };\n\n  private _removeLink = () => {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.formatText(this.targetInlineRange, {\n        link: null,\n      });\n    }\n    this.abortController.abort();\n  };\n\n  private _viewTemplate = () => {\n    if (!this.currentLink) return;\n\n    this._embedOptions =\n      this.std\n        ?.get(EmbedOptionProvider)\n        .getEmbedBlockOptions(this.currentLink) ?? null;\n\n    const buttons = [\n      html`\n        <a\n          class=\"affine-link-preview\"\n          href=${this.currentLink}\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          <span>${getHostName(this.currentLink)}</span>\n        </a>\n\n        <editor-icon-button\n          aria-label=\"Copy\"\n          data-testid=\"copy-link\"\n          .tooltip=${'Click to copy link'}\n          @click=${this._copyUrl}\n        >\n          ${CopyIcon}\n        </editor-icon-button>\n\n        <editor-icon-button\n          aria-label=\"Edit\"\n          data-testid=\"edit\"\n          .tooltip=${'Edit'}\n          @click=${this._edit}\n        >\n          ${EditIcon}\n        </editor-icon-button>\n      `,\n\n      this._viewMenuButton(),\n\n      html`\n        <editor-menu-button\n          .contentPadding=${'8px'}\n          .button=${html`\n            <editor-icon-button aria-label=\"More\" .tooltip=${'More'}>\n              ${MoreVerticalIcon}\n            </editor-icon-button>\n          `}\n        >\n          <div data-size=\"large\" data-orientation=\"vertical\">\n            ${this._moreActions()}\n          </div>\n        </editor-menu-button>\n      `,\n    ];\n\n    return html`\n      <editor-toolbar class=\"affine-link-popover view\">\n        ${join(\n          buttons.filter(button => button !== nothing),\n          renderToolbarSeparator\n        )}\n      </editor-toolbar>\n    `;\n  };\n\n  private get _canConvertToEmbedView() {\n    return this._embedOptions?.viewType === 'embed';\n  }\n\n  private get _isBookmarkAllowed() {\n    const block = this.block;\n    if (!block) return false;\n    const schema = block.doc.schema;\n    const parent = block.doc.getParent(block.model);\n    if (!parent) return false;\n    const bookmarkSchema = schema.flavourSchemaMap.get('affine:bookmark');\n    if (!bookmarkSchema) return false;\n    const parentSchema = schema.flavourSchemaMap.get(parent.flavour);\n    if (!parentSchema) return false;\n\n    try {\n      schema.validateSchema(bookmarkSchema, parentSchema);\n    } catch {\n      return false;\n    }\n\n    return true;\n  }\n\n  get block() {\n    const block = this.inlineEditor.rootElement.closest<BlockComponent>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    if (!block) return null;\n    return block;\n  }\n\n  get currentLink() {\n    return this.inlineEditor.getFormat(this.targetInlineRange).link;\n  }\n\n  get currentText() {\n    return this.inlineEditor.yTextString.slice(\n      this.targetInlineRange.index,\n      this.targetInlineRange.index + this.targetInlineRange.length\n    );\n  }\n\n  get host() {\n    return this.block?.host;\n  }\n\n  get std() {\n    return this.block?.std;\n  }\n\n  private _confirmBtnTemplate() {\n    return html`\n      <editor-icon-button\n        class=\"affine-confirm-button\"\n        .iconSize=${'24px'}\n        .disabled=${true}\n        @click=${this._onConfirm}\n      >\n        ${ConfirmIcon}\n      </editor-icon-button>\n    `;\n  }\n\n  private _convertToCardView() {\n    if (!this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      return;\n    }\n\n    let targetFlavour = 'affine:bookmark';\n\n    if (this._embedOptions && this._embedOptions.viewType === 'card') {\n      targetFlavour = this._embedOptions.flavour;\n    }\n\n    const block = this.block;\n    if (!block) return;\n    const url = this.currentLink;\n    const title = this.currentText;\n    const props = {\n      url,\n      title: title === url ? '' : title,\n    };\n    const doc = block.doc;\n    const parent = doc.getParent(block.model);\n    if (!parent) return;\n    const index = parent.children.indexOf(block.model);\n    doc.addBlock(targetFlavour as never, props, parent, index + 1);\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.formatText(this.targetInlineRange, { link: null });\n    }\n\n    this.abortController.abort();\n  }\n\n  private _convertToEmbedView() {\n    if (!this._embedOptions || this._embedOptions.viewType !== 'embed') {\n      return;\n    }\n\n    const { flavour } = this._embedOptions;\n    const url = this.currentLink;\n\n    const block = this.block;\n    if (!block) return;\n    const doc = block.doc;\n    const parent = doc.getParent(block.model);\n    if (!parent) return;\n    const index = parent.children.indexOf(block.model);\n\n    doc.addBlock(flavour as never, { url }, parent, index + 1);\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.formatText(this.targetInlineRange, { link: null });\n    }\n\n    this.abortController.abort();\n  }\n\n  private _copyUrl() {\n    if (!this.currentLink) return;\n    navigator.clipboard.writeText(this.currentLink).catch(console.error);\n    if (!this.host) return;\n    toast(this.host, 'Copied link to clipboard');\n    this.abortController.abort();\n  }\n\n  private _moreActions() {\n    return renderActions([\n      [\n        {\n          label: 'Open',\n          type: 'open',\n          icon: OpenIcon,\n          action: this._openLink,\n        },\n\n        {\n          label: 'Copy',\n          type: 'copy',\n          icon: CopyIcon,\n          action: this._copyUrl,\n        },\n\n        {\n          label: 'Remove link',\n          type: 'remove-link',\n          icon: UnlinkIcon,\n          action: this._removeLink,\n        },\n      ],\n\n      [\n        {\n          type: 'delete',\n          label: 'Delete',\n          icon: DeleteIcon,\n          action: this._delete,\n        },\n      ],\n    ]);\n  }\n\n  private _onConfirm() {\n    if (!this.inlineEditor.isValidInlineRange(this.targetInlineRange)) return;\n    if (!this.linkInput) return;\n\n    const linkInputValue = this.linkInput.value;\n    if (!linkInputValue || !isValidUrl(linkInputValue)) return;\n\n    const link = normalizeUrl(linkInputValue);\n\n    if (this.type === 'create') {\n      this.inlineEditor.formatText(this.targetInlineRange, {\n        link: link,\n        reference: null,\n      });\n      this.inlineEditor.setInlineRange(this.targetInlineRange);\n      const textSelection = this.host?.selection.find('text');\n      if (!textSelection) return;\n\n      this.std?.range.syncTextSelectionToRange(textSelection);\n    } else if (this.type === 'edit') {\n      const text = this.textInput?.value ?? link;\n      this.inlineEditor.insertText(this.targetInlineRange, text, {\n        link: link,\n        reference: null,\n      });\n      this.inlineEditor.setInlineRange({\n        index: this.targetInlineRange.index,\n        length: text.length,\n      });\n      const textSelection = this.host?.selection.find('text');\n      if (!textSelection) return;\n\n      this.std?.range.syncTextSelectionToRange(textSelection);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _onKeydown(e: KeyboardEvent) {\n    e.stopPropagation();\n    if (e.key === 'Enter' && !e.isComposing) {\n      e.preventDefault();\n      this._onConfirm();\n    }\n  }\n\n  private _updateConfirmBtn() {\n    if (!this.confirmButton) {\n      return;\n    }\n    const link = this.linkInput?.value.trim();\n    this.confirmButton.disabled = !(link && isValidUrl(link));\n    this.confirmButton.requestUpdate();\n  }\n\n  private _viewMenuButton() {\n    if (!this._isBookmarkAllowed) return nothing;\n\n    const buttons = [];\n\n    buttons.push({\n      type: 'inline',\n      label: 'Inline view',\n    });\n\n    buttons.push({\n      type: 'card',\n      label: 'Card view',\n      action: () => this._convertToCardView(),\n    });\n\n    if (this._canConvertToEmbedView) {\n      buttons.push({\n        type: 'embed',\n        label: 'Embed view',\n        action: () => this._convertToEmbedView(),\n      });\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Switch view\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n            .iconContainerWidth=${'110px'}\n          >\n            <div class=\"label\">Inline view</div>\n            ${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"small\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.type,\n            ({ type, label, action }) => html`\n              <editor-menu-action\n                data-testid=${`link-to-${type}`}\n                ?data-selected=${type === 'inline'}\n                @click=${action}\n              >\n                ${label}\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this.targetInlineRange.length === 0) {\n      return;\n    }\n\n    if (this.type === 'edit' || this.type === 'create') {\n      // disable body scroll\n      this._bodyOverflowStyle = document.body.style.overflow;\n      document.body.style.overflow = 'hidden';\n      this.disposables.add({\n        dispose: () => {\n          document.body.style.overflow = this._bodyOverflowStyle;\n        },\n      });\n    }\n  }\n\n  protected override firstUpdated() {\n    if (!this.linkInput) return;\n\n    this._disposables.addFromEvent(this.linkInput, 'copy', e => {\n      e.stopPropagation();\n    });\n    this._disposables.addFromEvent(this.linkInput, 'cut', e => {\n      e.stopPropagation();\n    });\n    this._disposables.addFromEvent(this.linkInput, 'paste', e => {\n      e.stopPropagation();\n    });\n  }\n\n  override render() {\n    return html`\n      <div class=\"overlay-root\">\n        ${this.type === 'view'\n          ? nothing\n          : html`\n              <div\n                class=\"affine-link-popover-overlay-mask\"\n                @click=${() => {\n                  this.abortController.abort();\n                  this.host?.selection.clear();\n                }}\n              ></div>\n            `}\n        <div class=\"affine-link-popover-container\" @keydown=${this._onKeydown}>\n          ${choose(this.type, [\n            ['create', this._createTemplate],\n            ['edit', this._editTemplate],\n            ['view', this._viewTemplate],\n          ])}\n        </div>\n        <div class=\"mock-selection-container\"></div>\n      </div>\n    `;\n  }\n\n  override updated() {\n    const range = this.inlineEditor.toDomRange(this.targetInlineRange);\n    if (!range) {\n      return;\n    }\n\n    if (this.type !== 'view') {\n      const domRects = range.getClientRects();\n\n      Object.values(domRects).forEach(domRect => {\n        if (!this.mockSelectionContainer) {\n          return;\n        }\n        const mockSelection = document.createElement('div');\n        mockSelection.classList.add('mock-selection');\n        mockSelection.style.left = `${domRect.left}px`;\n        mockSelection.style.top = `${domRect.top}px`;\n        mockSelection.style.width = `${domRect.width}px`;\n        mockSelection.style.height = `${domRect.height}px`;\n\n        this.mockSelectionContainer.append(mockSelection);\n      });\n    }\n\n    const visualElement = {\n      getBoundingClientRect: () => range.getBoundingClientRect(),\n      getClientRects: () => range.getClientRects(),\n    };\n    computePosition(visualElement, this.popupContainer, {\n      middleware: [\n        offset(10),\n        inline(),\n        shift({\n          padding: 6,\n        }),\n      ],\n    })\n      .then(({ x, y }) => {\n        const popupContainer = this.popupContainer;\n        if (!popupContainer) return;\n        popupContainer.style.left = `${x}px`;\n        popupContainer.style.top = `${y}px`;\n      })\n      .catch(console.error);\n  }\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @query('.affine-confirm-button')\n  accessor confirmButton: EditorIconButton | null = null;\n\n  @property({ attribute: false })\n  accessor inlineEditor!: AffineInlineEditor;\n\n  @query('#link-input')\n  accessor linkInput: HTMLInputElement | null = null;\n\n  @query('.mock-selection-container')\n  accessor mockSelectionContainer!: HTMLDivElement;\n\n  @query('.affine-link-popover-container')\n  accessor popupContainer!: HTMLDivElement;\n\n  @property({ attribute: false })\n  accessor targetInlineRange!: InlineRange;\n\n  @query('#text-input')\n  accessor textInput: HTMLInputElement | null = null;\n\n  @property()\n  accessor type: 'create' | 'edit' | 'view' = 'create';\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'link-popup': LinkPopup;\n  }\n}\n"]}