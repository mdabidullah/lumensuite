{"version":3,"file":"rich-text.js","sourceRoot":"","sources":["../../src/rich-text/rich-text.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Y } from '@lumensuite/store';\n\nimport { ShadowlessElement, WithDisposable } from '@lumensuite/block-std';\nimport { assertExists } from '@lumensuite/global/utils';\nimport {\n  type AttributeRenderer,\n  createInlineKeyDownHandler,\n  type DeltaInsert,\n  InlineEditor,\n  type InlineRange,\n  type InlineRangeProvider,\n  type KeyboardBindingContext,\n  type VLine,\n} from '@lumensuite/inline';\nimport { DocCollection, Text } from '@lumensuite/store';\nimport { css, html, type TemplateResult } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { z } from 'zod';\n\nimport type { AffineTextAttributes } from './extension/index.js';\nimport type { AffineInlineEditor } from './inline/index.js';\n\nimport { onVBeforeinput, onVCompositionEnd } from './hooks.js';\n\ninterface RichTextStackItem {\n  meta: Map<'richtext-v-range', InlineRange | null>;\n}\n\n@customElement('rich-text')\nexport class RichText extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    rich-text {\n      display: block;\n      height: 100%;\n      width: 100%;\n      overflow-x: auto;\n      overflow-y: hidden;\n\n      scroll-margin-top: 50px;\n      scroll-margin-bottom: 30px;\n    }\n\n    .inline-editor {\n      height: 100%;\n      width: 100%;\n      outline: none;\n      cursor: text;\n    }\n\n    .inline-editor.readonly {\n      cursor: default;\n    }\n\n    rich-text .nowrap-lines v-text span,\n    rich-text .nowrap-lines v-element span {\n      white-space: pre !important;\n    }\n  `;\n\n  #verticalScrollContainer: HTMLElement | null = null;\n\n  private _inlineEditor: AffineInlineEditor | null = null;\n\n  private _onCopy = (e: ClipboardEvent) => {\n    const inlineEditor = this.inlineEditor;\n    if (!inlineEditor) return;\n\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    const text = inlineEditor.yTextString.slice(\n      inlineRange.index,\n      inlineRange.index + inlineRange.length\n    );\n\n    e.clipboardData?.setData('text/plain', text);\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  private _onCut = (e: ClipboardEvent) => {\n    const inlineEditor = this.inlineEditor;\n    if (!inlineEditor) return;\n\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    const text = inlineEditor.yTextString.slice(\n      inlineRange.index,\n      inlineRange.index + inlineRange.length\n    );\n    inlineEditor.deleteText(inlineRange);\n    inlineEditor.setInlineRange({\n      index: inlineRange.index,\n      length: 0,\n    });\n\n    e.clipboardData?.setData('text/plain', text);\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  private _onPaste = (e: ClipboardEvent) => {\n    const inlineEditor = this.inlineEditor;\n    if (!inlineEditor) return;\n\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    const text = e.clipboardData\n      ?.getData('text/plain')\n      ?.replace(/\\r?\\n|\\r/g, '\\n');\n    if (!text) return;\n\n    inlineEditor.insertText(inlineRange, text);\n    inlineEditor.setInlineRange({\n      index: inlineRange.index + text.length,\n      length: 0,\n    });\n\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  private _onStackItemAdded = (event: { stackItem: RichTextStackItem }) => {\n    const inlineRange = this.inlineEditor?.getInlineRange();\n    if (inlineRange) {\n      event.stackItem.meta.set('richtext-v-range', inlineRange);\n    }\n  };\n\n  private _onStackItemPopped = (event: { stackItem: RichTextStackItem }) => {\n    const inlineRange = event.stackItem.meta.get('richtext-v-range');\n    if (inlineRange && this.inlineEditor?.isValidInlineRange(inlineRange)) {\n      this.inlineEditor?.setInlineRange(inlineRange);\n    }\n  };\n\n  private get _yText() {\n    return this.yText instanceof Text ? this.yText.yText : this.yText;\n  }\n\n  // It will listen ctrl+z/ctrl+shift+z and call undoManager.undo/redo, keydown event will not\n  get inlineEditor() {\n    return this._inlineEditor;\n  }\n\n  get inlineEditorContainer() {\n    assertExists(this._inlineEditorContainer);\n    return this._inlineEditorContainer;\n  }\n\n  private _init() {\n    if (this._inlineEditor) {\n      console.error('Inline editor already exists.');\n      return;\n    }\n\n    if (!this.enableFormat) {\n      this.attributesSchema = z.object({});\n    }\n\n    // init inline editor\n    this._inlineEditor = new InlineEditor<AffineTextAttributes>(this._yText, {\n      isEmbed: delta => this.embedChecker(delta),\n      hooks: {\n        beforeinput: onVBeforeinput,\n        compositionEnd: onVCompositionEnd,\n      },\n      inlineRangeProvider: this.inlineRangeProvider,\n      vLineRenderer: this.vLineRenderer,\n    });\n    if (this.attributesSchema) {\n      this._inlineEditor.setAttributeSchema(this.attributesSchema);\n    }\n    if (this.attributeRenderer) {\n      this._inlineEditor.setAttributeRenderer(this.attributeRenderer);\n    }\n    const inlineEditor = this._inlineEditor;\n\n    const markdownShortcutHandler = this.markdownShortcutHandler;\n    if (markdownShortcutHandler) {\n      const keyDownHandler = createInlineKeyDownHandler(inlineEditor, {\n        inputRule: {\n          key: [' ', 'Enter'],\n          handler: context =>\n            markdownShortcutHandler(context, this.undoManager),\n        },\n      });\n\n      inlineEditor.disposables.addFromEvent(\n        this.inlineEventSource ?? this.inlineEditorContainer,\n        'keydown',\n        keyDownHandler\n      );\n    }\n\n    // init auto scroll\n    inlineEditor.disposables.add(\n      inlineEditor.slots.inlineRangeUpdate.on(([inlineRange]) => {\n        if (!inlineRange) return;\n\n        // lazy\n        const verticalScrollContainer =\n          this.#verticalScrollContainer ||\n          (this.#verticalScrollContainer =\n            this.verticalScrollContainerGetter?.() || null);\n\n        inlineEditor\n          .waitForUpdate()\n          .then(() => {\n            if (!inlineEditor.mounted) return;\n\n            const range = inlineEditor.toDomRange(inlineRange);\n            if (!range) return;\n\n            if (verticalScrollContainer) {\n              const containerRect =\n                verticalScrollContainer.getBoundingClientRect();\n              const rangeRect = range.getBoundingClientRect();\n\n              if (rangeRect.top < containerRect.top) {\n                this.scrollIntoView({ block: 'start' });\n              } else if (rangeRect.bottom > containerRect.bottom) {\n                this.scrollIntoView({ block: 'end' });\n              }\n            }\n\n            // scroll container is this\n            if (this.enableAutoScrollHorizontally) {\n              const containerRect = this.getBoundingClientRect();\n              const rangeRect = range.getBoundingClientRect();\n\n              let scrollLeft = this.scrollLeft;\n              if (\n                rangeRect.left + rangeRect.width >\n                containerRect.left + containerRect.width\n              ) {\n                scrollLeft +=\n                  rangeRect.left +\n                  rangeRect.width -\n                  (containerRect.left + containerRect.width) +\n                  2;\n              }\n              this.scrollLeft = scrollLeft;\n            }\n          })\n          .catch(console.error);\n      })\n    );\n\n    inlineEditor.mount(\n      this.inlineEditorContainer,\n      this.inlineEventSource,\n      this.readonly\n    );\n  }\n\n  private _unmount() {\n    if (this.inlineEditor?.mounted) {\n      this.inlineEditor.unmount();\n    }\n    this._inlineEditor = null;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (!this._yText) {\n      console.error('rich-text need yText to init.');\n      return;\n    }\n    if (!this._yText.doc) {\n      console.error('yText should be bind to yDoc.');\n      return;\n    }\n\n    if (!this.undoManager) {\n      this.undoManager = new DocCollection.Y.UndoManager(this._yText, {\n        trackedOrigins: new Set([this._yText.doc.clientID]),\n      });\n    }\n\n    if (this.enableUndoRedo) {\n      this.disposables.addFromEvent(this, 'keydown', (e: KeyboardEvent) => {\n        if (e.ctrlKey || e.metaKey) {\n          if (e.key === 'z' || e.key === 'Z') {\n            if (e.shiftKey) {\n              this.undoManager.redo();\n            } else {\n              this.undoManager.undo();\n            }\n            e.stopPropagation();\n          }\n        }\n      });\n\n      this.undoManager.on('stack-item-added', this._onStackItemAdded);\n      this.undoManager.on('stack-item-popped', this._onStackItemPopped);\n      this.disposables.add({\n        dispose: () => {\n          this.undoManager.off('stack-item-added', this._onStackItemAdded);\n          this.undoManager.off('stack-item-popped', this._onStackItemPopped);\n        },\n      });\n    }\n\n    if (this.enableClipboard) {\n      this.disposables.addFromEvent(this, 'copy', this._onCopy);\n      this.disposables.addFromEvent(this, 'cut', this._onCut);\n      this.disposables.addFromEvent(this, 'paste', this._onPaste);\n    }\n\n    this.updateComplete\n      .then(() => {\n        this._unmount();\n        this._init();\n\n        this.disposables.add({\n          dispose: () => {\n            this._unmount();\n          },\n        });\n      })\n      .catch(console.error);\n  }\n\n  override async getUpdateComplete(): Promise<boolean> {\n    const result = await super.getUpdateComplete();\n    await this.inlineEditor?.waitForUpdate();\n    return result;\n  }\n\n  // If it is true rich-text will handle undo/redo by itself. (including v-range restore)\n  override render() {\n    const classes = classMap({\n      'inline-editor': true,\n      'nowrap-lines': !this.wrapText,\n      readonly: this.readonly,\n    });\n\n    return html`<div\n      contenteditable=${this.readonly ? 'false' : 'true'}\n      class=${classes}\n    ></div>`;\n  }\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>) {\n    if (this._inlineEditor && changedProperties.has('readonly')) {\n      this._inlineEditor.setReadonly(this.readonly);\n    }\n  }\n\n  @query('.inline-editor')\n  private accessor _inlineEditorContainer!: HTMLDivElement;\n\n  @property({ attribute: false })\n  accessor attributeRenderer: AttributeRenderer | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor attributesSchema: z.ZodSchema | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor embedChecker: <\n    TextAttributes extends AffineTextAttributes = AffineTextAttributes,\n  >(\n    delta: DeltaInsert<TextAttributes>\n  ) => boolean = () => false;\n\n  @property({ attribute: false })\n  accessor enableAutoScrollHorizontally = true;\n\n  // If it is true rich-text will prevent events related to clipboard bubbling up and handle them by itself.\n  @property({ attribute: false })\n  accessor enableClipboard = true;\n\n  // `attributesSchema` will be overwritten to `z.object({})` if `enableFormat` is false.\n  @property({ attribute: false })\n  accessor enableFormat = true;\n\n  // bubble up if pressed ctrl+z/ctrl+shift+z.\n  @property({ attribute: false })\n  accessor enableUndoRedo = true;\n\n  @property({ attribute: false })\n  accessor inlineEventSource: HTMLElement | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor inlineRangeProvider: InlineRangeProvider | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor markdownShortcutHandler:\n    | (<TextAttributes extends AffineTextAttributes = AffineTextAttributes>(\n        context: KeyboardBindingContext<TextAttributes>,\n        undoManager: Y.UndoManager\n      ) => boolean)\n    | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor readonly = false;\n\n  // rich-text will create a undoManager if it is not provided.\n  @property({ attribute: false })\n  accessor undoManager!: Y.UndoManager;\n\n  @property({ attribute: false })\n  accessor verticalScrollContainerGetter:\n    | (() => HTMLElement | null)\n    | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor vLineRenderer: ((vLine: VLine) => TemplateResult) | undefined;\n\n  @property({ attribute: false })\n  accessor wrapText = true;\n\n  @property({ attribute: false })\n  accessor yText!: Y.Text | Text;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rich-text': RichText;\n  }\n}\n"]}