{"version":3,"file":"group.js","sourceRoot":"","sources":["../../../src/elements/group/group.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  BaseElementProps,\n  SerializedElement,\n} from '@lumensuite/block-std/gfx';\nimport type { Y } from '@lumensuite/store';\n\nimport {\n  field,\n  GfxGroupLikeElementModel,\n  local,\n  observe,\n} from '@lumensuite/block-std/gfx';\nimport {\n  Bound,\n  type IVec,\n  keys,\n  linePolygonIntersects,\n  type PointLocation,\n} from '@lumensuite/global/utils';\nimport { DocCollection } from '@lumensuite/store';\n\ntype GroupElementProps = BaseElementProps & {\n  children: Y.Map<boolean>;\n  title: Y.Text;\n};\n\nexport type SerializedGroupElement = SerializedElement & {\n  title: string;\n  children: Record<string, boolean>;\n};\n\nexport class GroupElementModel extends GfxGroupLikeElementModel<GroupElementProps> {\n  get rotate() {\n    return 0;\n  }\n\n  set rotate(_: number) {}\n\n  get type() {\n    return 'group';\n  }\n\n  static override propsToY(props: Record<string, unknown>) {\n    if ('title' in props && !(props.title instanceof DocCollection.Y.Text)) {\n      props.title = new DocCollection.Y.Text(props.title as string);\n    }\n\n    if (props.children && !(props.children instanceof DocCollection.Y.Map)) {\n      const children = new DocCollection.Y.Map() as Y.Map<boolean>;\n\n      keys(props.children).forEach(key => {\n        children.set(key as string, true);\n      });\n\n      props.children = children;\n    }\n\n    return props as GroupElementProps;\n  }\n\n  addChild(element: LumenSuite.EdgelessModel | string) {\n    const id = typeof element === 'string' ? element : element.id;\n    if (!this.children) {\n      return;\n    }\n    this.surface.doc.transact(() => {\n      this.children.set(id, true);\n    });\n  }\n\n  override containsBound(bound: Bound): boolean {\n    return bound.contains(Bound.deserialize(this.xywh));\n  }\n\n  override getLineIntersections(\n    start: IVec,\n    end: IVec\n  ): PointLocation[] | null {\n    const bound = Bound.deserialize(this.xywh);\n    return linePolygonIntersects(start, end, bound.points);\n  }\n\n  removeChild(element: LumenSuite.EdgelessModel | string) {\n    const id = typeof element === 'string' ? element : element.id;\n    if (!this.children) {\n      return;\n    }\n    this.surface.doc.transact(() => {\n      this.children.delete(id);\n    });\n  }\n\n  override serialize() {\n    const result = super.serialize();\n    return result as SerializedGroupElement;\n  }\n\n  @observe(\n    // use `GroupElementModel` type in decorator will cause playwright error\n    (_, instance: GfxGroupLikeElementModel<GroupElementProps>, transaction) => {\n      instance.setChildIds(\n        Array.from(instance.children.keys()),\n        transaction?.local ?? false\n      );\n    }\n  )\n  @field()\n  accessor children: Y.Map<boolean> = new DocCollection.Y.Map<boolean>();\n\n  @local()\n  accessor showTitle: boolean = true;\n\n  @field()\n  accessor title: Y.Text = new DocCollection.Y.Text();\n}\n\ndeclare global {\n  namespace LumenSuite {\n    interface SurfaceGroupLikeModelMap {\n      group: GroupElementModel;\n    }\n\n    interface SurfaceElementModelMap {\n      group: GroupElementModel;\n    }\n  }\n}\n"]}