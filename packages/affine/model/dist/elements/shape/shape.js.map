{"version":3,"file":"shape.js","sourceRoot":"","sources":["../../../src/elements/shape/shape.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  BaseElementProps,\n  PointTestOptions,\n} from '@lumensuite/block-std/gfx';\nimport type {\n  Bound,\n  IBound,\n  IVec,\n  PointLocation,\n  SerializedXYWH,\n} from '@lumensuite/global/utils';\n\nimport {\n  type Color,\n  DEFAULT_ROUGHNESS,\n  FontFamily,\n  FontStyle,\n  FontWeight,\n  StrokeStyle,\n  TextAlign,\n  type TextStyleProps,\n  TextVerticalAlign,\n} from '@lumensuite/affine-model';\nimport {\n  field,\n  GfxPrimitiveElementModel,\n  local,\n} from '@lumensuite/block-std/gfx';\nimport { DocCollection, type Y } from '@lumensuite/store';\n\nimport {\n  LineColor,\n  ShapeFillColor,\n  ShapeStyle,\n  ShapeTextFontSize,\n  ShapeType,\n  TextResizing,\n} from '../../consts/index.js';\nimport { shapeMethods } from './api/index.js';\n\nexport type ShapeProps = BaseElementProps & {\n  shapeType: ShapeType;\n  radius: number;\n  filled: boolean;\n  fillColor: Color;\n  strokeWidth: number;\n  strokeColor: Color;\n  strokeStyle: StrokeStyle;\n  shapeStyle: ShapeStyle;\n  // https://github.com/rough-stuff/rough/wiki#roughness\n  roughness?: number;\n\n  text?: Y.Text;\n  textHorizontalAlign?: TextAlign;\n  textVerticalAlign?: TextVerticalAlign;\n  textResizing?: TextResizing;\n  maxWidth?: false | number;\n} & Partial<TextStyleProps>;\n\nexport const SHAPE_TEXT_PADDING = 20;\nexport const SHAPE_TEXT_VERTICAL_PADDING = 10;\n\nexport class ShapeElementModel extends GfxPrimitiveElementModel<ShapeProps> {\n  textBound: IBound | null = null;\n\n  get type() {\n    return 'shape';\n  }\n\n  static override propsToY(props: ShapeProps) {\n    if (props.text && !(props.text instanceof DocCollection.Y.Text)) {\n      props.text = new DocCollection.Y.Text(props.text);\n    }\n\n    return props;\n  }\n\n  override containsBound(bounds: Bound) {\n    return shapeMethods[this.shapeType].containsBound(bounds, this);\n  }\n\n  override getLineIntersections(start: IVec, end: IVec) {\n    return shapeMethods[this.shapeType].getLineIntersections(start, end, this);\n  }\n\n  override getNearestPoint(point: IVec): IVec {\n    return shapeMethods[this.shapeType].getNearestPoint(point, this) as IVec;\n  }\n\n  override getRelativePointLocation(point: IVec): PointLocation {\n    return shapeMethods[this.shapeType].getRelativePointLocation(point, this);\n  }\n\n  override includesPoint(x: number, y: number, options: PointTestOptions) {\n    return shapeMethods[this.shapeType].includesPoint.call(this, x, y, {\n      ...options,\n      ignoreTransparent: options.ignoreTransparent ?? true,\n    });\n  }\n\n  @field('#000000' as Color)\n  accessor color!: Color;\n\n  @field()\n  accessor fillColor: Color = ShapeFillColor.Yellow;\n\n  @field()\n  accessor filled: boolean = false;\n\n  @field(FontFamily.Inter as string)\n  accessor fontFamily!: string;\n\n  @field(ShapeTextFontSize.MEDIUM)\n  accessor fontSize!: number;\n\n  @field(FontStyle.Normal as FontStyle)\n  accessor fontStyle!: FontStyle;\n\n  @field(FontWeight.Regular as FontWeight)\n  accessor fontWeight!: FontWeight;\n\n  @field(false as false | number)\n  accessor maxWidth: false | number = false;\n\n  @field([SHAPE_TEXT_VERTICAL_PADDING, SHAPE_TEXT_PADDING])\n  accessor padding: [number, number] = [\n    SHAPE_TEXT_VERTICAL_PADDING,\n    SHAPE_TEXT_PADDING,\n  ];\n\n  @field()\n  accessor radius: number = 0;\n\n  @field(0)\n  accessor rotate: number = 0;\n\n  @field(DEFAULT_ROUGHNESS)\n  accessor roughness: number = DEFAULT_ROUGHNESS;\n\n  @field()\n  accessor shadow: {\n    blur: number;\n    offsetX: number;\n    offsetY: number;\n    color: string;\n  } | null = null;\n\n  @field()\n  accessor shapeStyle: ShapeStyle = ShapeStyle.General;\n\n  @field()\n  accessor shapeType: ShapeType = ShapeType.Rect;\n\n  @field()\n  accessor strokeColor: Color = LineColor.Yellow;\n\n  @field()\n  accessor strokeStyle: StrokeStyle = StrokeStyle.Solid;\n\n  @field()\n  accessor strokeWidth: number = 4;\n\n  @field()\n  accessor text: Y.Text | undefined = undefined;\n\n  @field(TextAlign.Center as TextAlign)\n  accessor textAlign!: TextAlign;\n\n  @local()\n  accessor textDisplay: boolean = true;\n\n  @field(TextAlign.Center as TextAlign)\n  accessor textHorizontalAlign!: TextAlign;\n\n  @field(TextResizing.AUTO_HEIGHT as TextResizing)\n  accessor textResizing: TextResizing = TextResizing.AUTO_HEIGHT;\n\n  @field(TextVerticalAlign.Center as TextVerticalAlign)\n  accessor textVerticalAlign!: TextVerticalAlign;\n\n  @field()\n  accessor xywh: SerializedXYWH = '[0,0,100,100]';\n}\n\ndeclare global {\n  namespace LumenSuite {\n    interface SurfaceElementModelMap {\n      shape: ShapeElementModel;\n    }\n\n    interface EdgelessTextModelMap {\n      shape: ShapeElementModel;\n    }\n  }\n}\n"]}